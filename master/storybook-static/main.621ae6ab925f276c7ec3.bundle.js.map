{"version":3,"sources":["webpack:///./src/api/i18n.ts","webpack:///./src/api/common.ts","webpack:///./src/constants/actions.ts","webpack:///./src/containers/hooks.ts","webpack:///./src/utils/logger.ts","webpack:///./src/api/runtime.ts","webpack:///./src/actions/map.ts","webpack:///./src/constants/index.ts","webpack:///./src/api/error.ts","webpack:///./src/utils/string.ts","webpack:///./src/api/client.ts","webpack:///./src/utils/url.ts","webpack:///./src/utils/number.ts","webpack:///./src/api/builders/deArrayify.ts","webpack:///./src/constants/assets.ts","webpack:///./src/api/registry/command.ts","webpack:///./src/utils/type-guards.ts","webpack:///./src/api/registry/component.tsx","webpack:///./src/utils/array.ts","webpack:///./src/api/request-builder.ts","webpack:///./src/api/ol-style-helpers.ts","webpack:///./src/utils/units.tsx","webpack:///./src/utils/asset.ts","webpack:///./src/utils/never.ts","webpack:///./src/components/error.tsx","webpack:///./src/components/map-viewer-context.ts","webpack:///./src/api/layer-manager.ts","webpack:///./src/components/context.ts","webpack:///./src/api/builders/mapagent.ts","webpack:///./src/actions/modal.ts","webpack:///./src/api/registry/layout.ts","webpack:///./src/actions/legend.ts","webpack:///./src/containers/map-capturer-context.ts","webpack:///./src/components/layer-manager/wfs-capabilities-panel.tsx","webpack:///./src/utils/index.ts","webpack:///./src/components/icon.tsx","webpack:///./src/api/registry/projections.ts","webpack:///./src/api/index.ts","webpack:///./src/api/contracts/weblayout.ts","webpack:///./src/api/builders/factory.ts","webpack:///./src/components/map-viewer-base.tsx","webpack:///./src/utils/site-version.ts","webpack:///./src/api/layer-manager/driver-registry.ts","webpack:///./src/api/session-store.ts","webpack:///./src/actions/template.ts","webpack:///./src/actions/taskpane.ts","webpack:///./src/containers/legend.tsx","webpack:///./src/components/base-layer-switcher.tsx","webpack:///./src/containers/map-viewer.tsx","webpack:///./src/actions/flyout.ts","webpack:///./src/api/ol-factory.ts","webpack:///./src/containers/mouse-coordinates.tsx","webpack:///./src/containers/navigator.tsx","webpack:///./src/containers/scale-display.tsx","webpack:///./src/containers/selected-feature-count.tsx","webpack:///./src/containers/selection-panel.tsx","webpack:///./src/components/toolbar.tsx","webpack:///./src/containers/task-pane.tsx","webpack:///./src/containers/viewer-options.tsx","webpack:///./src/containers/base-layer-switcher.tsx","webpack:///./src/containers/map-menu.tsx","webpack:///./src/containers/coordinate-tracker.tsx","webpack:///./src/containers/add-manage-layers.tsx","webpack:///./src/components/vector-style-editor.tsx","webpack:///./src/components/color-picker.tsx","webpack:///./src/containers/view-size.tsx","webpack:///./src/api/layer-manager/parsed-features.ts","webpack:///./src/reducers/config.ts","webpack:///./src/reducers/template.ts","webpack:///./.storybook/config.js","webpack:///./src/stories/story-bootstrap.tsx","webpack:///./src/api/builders/index.ts","webpack:///./stdassets/cursors/digitizePoint.cur","webpack:///./stdassets/cursors/digitizeLine.cur","webpack:///./stdassets/cursors/digitizeLineString.cur","webpack:///./stdassets/cursors/digitizeRectangle.cur","webpack:///./stdassets/cursors/digitizePolygon.cur","webpack:///./stdassets/cursors/digitizeCircle.cur","webpack:///./stdassets/cursors/grabbing.cur","webpack:///./stdassets/cursors/grab.cur","webpack:///./stdassets/cursors/zoomin.cur","webpack:///./stdassets/images/res/sliderscale.png","webpack:///./stdassets/images/res/spinner.gif","webpack:///./stdassets/images/res/slider.png","webpack:///./stdassets/images/icons/PoweredBy_en.png","webpack:///./stdassets/images/icons/about.png","webpack:///./stdassets/images/icons/application-browser.png","webpack:///./stdassets/images/icons/back.png","webpack:///./stdassets/images/icons/buffer.png","webpack:///./stdassets/images/icons/control-180.png","webpack:///./stdassets/images/icons/control-stop-180.png","webpack:///./stdassets/images/icons/control-stop.png","webpack:///./stdassets/images/icons/control.png","webpack:///./stdassets/images/icons/coordinate-tracker.png","webpack:///./stdassets/images/icons/edit-copy.png","webpack:///./stdassets/images/icons/edit-cut.png","webpack:///./stdassets/images/icons/edit-duplicate.png","webpack:///./stdassets/images/icons/edit-paste.png","webpack:///./stdassets/images/icons/edit-xml.png","webpack:///./stdassets/images/icons/feature-info.png","webpack:///./stdassets/images/icons/file-print.png","webpack:///./stdassets/images/icons/file-save.png","webpack:///./stdassets/images/icons/folder-horizontal-open.png","webpack:///./stdassets/images/icons/folder-horizontal.png","webpack:///./stdassets/images/icons/forward.png","webpack:///./stdassets/images/icons/geolocation.png","webpack:///./stdassets/images/icons/help.png","webpack:///./stdassets/images/icons/icon_home.png","webpack:///./stdassets/images/icons/icon_menuarrow_disabled.png","webpack:///./stdassets/images/icons/icon_menuarrow.png","webpack:///./stdassets/images/icons/icon_menuarrowup_disabled.png","webpack:///./stdassets/images/icons/icon_menuarrowup.png","webpack:///./stdassets/images/icons/icon_refreshmap.png","webpack:///./stdassets/images/icons/select.png","webpack:///./stdassets/images/icons/icon_zoomselect.png","webpack:///./stdassets/images/icons/iconNavigator.png","webpack:///./stdassets/images/icons/info.png","webpack:///./stdassets/images/icons/initial-center.png","webpack:///./stdassets/images/icons/invoke-script.png","webpack:///./stdassets/images/icons/invoke-url.png","webpack:///./stdassets/images/icons/lc_unselect.png","webpack:///./stdassets/images/icons/legend-DWF.png","webpack:///./stdassets/images/icons/legend-layer.png","webpack:///./stdassets/images/icons/legend-map.png","webpack:///./stdassets/images/icons/legend-raster.png","webpack:///./stdassets/images/icons/legend-theme.png","webpack:///./stdassets/images/icons/maptip.png","webpack:///./stdassets/images/icons/measure.png","webpack:///./stdassets/images/icons/options.png","webpack:///./stdassets/images/icons/out-of-range.png","webpack:///./stdassets/images/icons/overview-map.png","webpack:///./stdassets/images/icons/pan-east.png","webpack:///./stdassets/images/icons/pan-north.png","webpack:///./stdassets/images/icons/pan-south.png","webpack:///./stdassets/images/icons/pan-west.png","webpack:///./stdassets/images/icons/pan.png","webpack:///./stdassets/images/icons/preview.png","webpack:///./stdassets/images/icons/print.png","webpack:///./stdassets/images/icons/property.png","webpack:///./stdassets/images/icons/query.png","webpack:///./stdassets/images/icons/redline.png","webpack:///./stdassets/images/icons/search.png","webpack:///./stdassets/images/icons/select-centre.png","webpack:///./stdassets/images/icons/select-clear.png","webpack:///./stdassets/images/icons/select-features.png","webpack:///./stdassets/images/icons/select-polygon.png","webpack:///./stdassets/images/icons/select-radius.png","webpack:///./stdassets/images/icons/select-zoom.png","webpack:///./stdassets/images/icons/theme.png","webpack:///./stdassets/images/icons/toggle-expand.png","webpack:///./stdassets/images/icons/toggle.png","webpack:///./stdassets/images/icons/ui-menu.png","webpack:///./stdassets/images/icons/view-back.png","webpack:///./stdassets/images/icons/view-forward.png","webpack:///./stdassets/images/icons/view-refresh.png","webpack:///./stdassets/images/icons/icon_warning.png","webpack:///./stdassets/images/icons/zoom-dynamic.png","webpack:///./stdassets/images/icons/zoom-full.png","webpack:///./stdassets/images/icons/zoom-in-fixed.png","webpack:///./stdassets/images/icons/zoom-in.png","webpack:///./stdassets/images/icons/zoom-out-fixed.png","webpack:///./stdassets/images/icons/layer_add.png","webpack:///./stdassets/images/icons/globe_add.png","webpack:///./stdassets/images/icons/globe-share.png","webpack:///./src/strings/en.ts","webpack:///./src/api/contracts/index.ts","webpack:///./src/api/contracts/runtime-map.ts","webpack:///./src/api/registry/index.ts","webpack:///./src/api/bootstrap.ts","webpack:///./src/api/default-commands.ts","webpack:///./src/components/tooltips/mouse.ts","webpack:///./src/components/tooltips/feature.ts","webpack:///./src/api/layer-set.ts","webpack:///./src/api/ol-mapguide-source-factory.ts","webpack:///./src/components/external-layer-factory.ts","webpack:///./src/components/tooltips/selected-features.ts","webpack:///./src/containers/viewer-shim.tsx","webpack:///./src/components/form-frame-shim.tsx","webpack:///./src/api/default-components.tsx","webpack:///./src/components/legend.tsx","webpack:///./src/utils/menu.ts","webpack:///./src/containers/subscriber.tsx","webpack:///./src/components/mouse-coordinates.tsx","webpack:///./src/components/navigator.tsx","webpack:///./src/components/scale-display.tsx","webpack:///./src/components/selected-feature-count.tsx","webpack:///./src/components/selection-panel.tsx","webpack:///./src/components/task-pane.tsx","webpack:///./src/components/pbmg.tsx","webpack:///./src/components/about.tsx","webpack:///./src/components/session-expired.tsx","webpack:///./src/containers/measure.tsx","webpack:///./src/containers/measure-context.ts","webpack:///./src/containers/quick-plot.tsx","webpack:///./src/components/map-menu.tsx","webpack:///./src/components/layer-manager/manage-layers.tsx","webpack:///./src/components/layer-manager/add-layer.tsx","webpack:///./src/components/layer-manager/add-wms-layer.tsx","webpack:///./src/components/layer-manager/wms-capabilities-panel.tsx","webpack:///./src/components/layer-manager/add-wfs-layer.tsx","webpack:///./src/components/layer-manager/wfs-capabilities-parser.ts","webpack:///./src/components/view-size.tsx","webpack:///./src/containers/share-link-to-view.tsx","webpack:///./src/api/layer-manager/csv-driver.ts","webpack:///./src/api/layer-manager/format-driver.ts","webpack:///./src/stories sync .stories.tsx$","webpack:///./src/stories/1.map.stories.tsx","webpack:///./src/stories/fake-app.tsx","webpack:///./src/store/configure-store.ts","webpack:///./src/store/promise-middleware.ts","webpack:///./src/store/logger.ts","webpack:///./src/reducers/root.ts","webpack:///./src/reducers/toolbar.ts","webpack:///./src/reducers/taskpane.ts","webpack:///./src/reducers/last-action.ts","webpack:///./src/reducers/modal.ts","webpack:///./src/reducers/init-error.ts","webpack:///./src/reducers/map-state.ts","webpack:///./src/reducers/viewer.ts","webpack:///./src/reducers/mouse.ts","webpack:///./src/containers/app.tsx","webpack:///./src/actions/init.ts","webpack:///./src/api/registry/command-spec.ts","webpack:///./src/containers/url-state.ts","webpack:///./src/stories/2.common.stories.tsx","webpack:///./src/stories/3.accordion.stories.tsx","webpack:///./src/components/accordion.tsx","webpack:///./src/styles/index.css?e1e9","webpack:///./src/styles/index.css","webpack:///./src/styles/ol.css","webpack:///./stdassets/sprites/icons.css","webpack:///./stdassets/sprites/icons.png","webpack:///./src/stories/styles/accordion-slate.css?c3e1","webpack:///./src/stories/styles/accordion-slate.css"],"names":["DEFAULT_LOCALE","STRINGS","fmt","format","args","str","p","split","join","registerStringBundle","locale","bundle","tr","key","logger","warn","UnitOfMeasure","ActiveMapTool","RefreshMode","DEFAULT_MODAL_SIZE","KC_ESCAPE","KC_U","NOOP","ALWAYS_FALSE","ALWAYS_TRUE","getInitialView","state","config","activeMapName","mapState","initialView","getSelectionSet","selectionSet","getRuntimeMap","runtimeMap","getCurrentView","currentView","getExternalBaseLayers","externalBaseLayers","LayerProperty","SourceProperty","MgLayerType","MG_LAYER_TYPE_NAME","MG_BASE_LAYER_GROUP_NAME","MgBuiltInLayers","ActionType","getActiveMapBranch","useActiveMapSelectableLayers","useSelector","selectableLayers","useActiveMapState","usePrevious","value","ref","useRef","useEffect","current","useActiveMapName","useActiveMapSessionId","SessionId","useActiveMapLayers","layers","left","right","areArraysDifferent","l","r","name","opacity","visible","vectorStyle","useViewerLocale","useActiveMapView","useActiveMapWidth","viewer","size","useActiveMapHeight","useViewerSizeUnits","viewSizeUnits","useActiveMapMetersPerUnit","mpu","ms","CoordinateSystem","MetersPerUnit","useActiveMapFiniteScales","map","FiniteDisplayScale","undefined","useActiveMapExternalBaseLayers","useActiveMapProjection","proj","EpsgCode","useCurrentMouseCoordinates","mouse","coords","useViewerFlyouts","toolbar","flyouts","useInitWarnings","initError","warnings","useInitError","error","useInitErrorStack","includeStack","useInitErrorOptions","options","useActiveMapBranch","useActiveMapExpandedGroups","expandedGroups","useActiveMapShowGroups","showGroups","useActiveMapShowLayers","showLayers","useActiveMapHideGroups","hideGroups","useActiveMapHideLayers","hideLayers","useActiveMapSelectableLayerNames","Layer","filter","layer","Selectable","ObjectId","Name","useActiveMapLayerTransparency","layerTransparency","useActiveMapActiveSelectedFeature","activeSelectedFeature","useActiveMapSelectionSet","useActiveMapInitialView","useAvailableMaps","availableMaps","useViewerBusyCount","busyCount","useViewerViewRotation","viewRotation","useViewerActiveTool","tool","useViewerViewRotationEnabled","viewRotationEnabled","useConfiguredCoordinateProjection","coordinates","projection","useConfiguredCoordinateDecimals","decimals","useConfiguredCoordinateFormat","useConfiguredAgentUri","agentUri","useConfiguredAgentKind","agentKind","useIsContextMenuOpen","isContextMenuOpen","WEBLAYOUT_CONTEXTMENU","open","useViewerImageFormat","imageFormat","useViewerSelectionImageFormat","selectionImageFormat","useViewerSelectionColor","selectionColor","useViewerActiveFeatureSelectionColor","activeSelectedFeatureColor","useViewerPointSelectionBuffer","pointSelectionBuffer","useViewerFeatureTooltipsEnabled","featureTooltipsEnabled","useConfiguredManualFeatureTooltips","manualFeatureTooltips","useConfiguredLoadIndicatorPositioning","loadIndicatorPositioning","useConfiguredLoadIndicatorColor","loadIndicatorColor","useConfiguredCancelDigitizationKey","cancelDigitizationKey","useConfiguredUndoLastPointKey","undoLastPointKey","useConfiguredCapabilities","capabilities","useTemplateLegendVisible","template","legendVisible","useTemplateTaskPaneVisible","taskPaneVisible","useTemplateSelectionVisible","selectionPanelVisible","useTemplateInitialInfoPaneWidth","initialInfoPaneWidth","useTemplateInitialTaskPaneWidth","initialTaskPaneWidth","useTaskPaneInitialUrl","taskpane","initialUrl","useTaskPaneNavigationIndex","navIndex","useTaskPaneLastUrlPushed","lastUrlPushed","useTaskPaneNavigationStack","navigation","useLastDispatchedAction","lastaction","useReducedToolbarAppState","reduceAppToToolbarState","busyWorkerCount","hasNextView","hasPreviousView","hasSelection","activeTool","info","message","console","optionalParams","debug","_fusionRoot","_viewer","setFusionRoot","root","getFusionRoot","setViewer","isReady","getViewer","combineSelectedFeatureSets","oldRes","newRes","merged","SelectedLayer","push","layerId","layerName","existing","length","Feature","combineSelectedFeatures","feat","f","Property","np","Value","combineFeatureSets","Class","ID","makeUnique","concat","setSelection","mapName","type","MAP_SET_SELECTION","payload","selection","queryMapFeatures","opts","dispatch","getState","Client","res","callback","sv","getSiteVersion","canUseQueryMapFeaturesV4","queryMapFeatures_v4","then","persist","append","combineSelections","SelectedFeatures","FeatureSet","Hyperlink","InlineSelectionImage","mergedXml","buildSelectionXml","session","mapname","featurefilter","storeSelectionSet","catch","err","errBack","setCurrentView","view","newView","dispatchThis","fi","getFiniteScaleIndexForScale","scale","areViewsCloseToEqual","MAP_SET_VIEW","mapResized","width","height","MAP_RESIZED","invokeCommand","cmd","parameters","invoke","setBusyCount","MAP_SET_BUSY_COUNT","setBaseLayer","MAP_SET_BASE_LAYER","setScale","resolution","scaleToResolution","MAP_SET_SCALE","setMouseCoordinates","coord","UPDATE_MOUSE_COORDINATES","setLayerTransparency","MAP_SET_LAYER_TRANSPARENCY","setViewSizeUnits","unit","MAP_SET_VIEW_SIZE_UNITS","previousView","MAP_PREVIOUS_VIEW","nextView","MAP_NEXT_VIEW","setActiveTool","MAP_SET_ACTIVE_TOOL","setActiveMap","MAP_SET_ACTIVE_MAP","setFeatureTooltipsEnabled","enabled","MAP_SET_MAPTIP","setManualFeatureTooltipsEnabled","MAP_SET_MANUAL_MAPTIP","setViewRotation","rotation","MAP_SET_VIEW_ROTATION","setViewRotationEnabled","MAP_SET_VIEW_ROTATION_ENABLED","showSelectedFeature","selectionKey","MAP_SHOW_SELECTED_FEATURE","mapLayerAdded","LAYER_ADDED","removeMapLayer","REMOVE_LAYER","setMapLayerIndex","index","SET_LAYER_INDEX","setMapLayerOpacity","SET_LAYER_OPACITY","setMapLayerVisibility","SET_LAYER_VISIBILITY","setMapLayerVectorStyle","style","SET_LAYER_VECTOR_STYLE","addMapLayerBusyWorker","ADD_LAYER_BUSY_WORKER","removeMapLayerBusyWorker","REMOVE_LAYER_BUSY_WORKER","NBSP","String","fromCharCode","DEG","EMPTY_OBJECT","MDF_INFINITY","WEBLAYOUT_TOOLBAR","WEBLAYOUT_TASKMENU","FUSION_TASKPANE_NAME","FUSION_MAP_NAME","FUSION_REDLINE_NAME","LAYER_ID_BASE","LAYER_ID_MG_BASE","LAYER_ID_MG_SEL_OVERLAY","BLANK_GIF_DATA_URI","stack","Error","MgError","isSessionExpiredError","indexOf","strEndsWith","suffix","strReplaceAll","find","replace","STR_EMPTY","strIsNullOrEmpty","strTrim","prototype","trim","kind","this","builder","createRequestBuilder","getText","url","fetch","ok","statusText","text","get","Promise","resolve","reject","headers","method","response","isErrorResponse","json","post","data","body","serialize","createSession","username","password","getServerSessionTimeout","getResource","resourceId","createRuntimeMap","describeRuntimeMap","getTileTemplateUrl","groupName","xPlaceholder","yPlaceholder","zPlaceholder","parse","DEFAULT_PARSE_OPTIONS","ignoreQueryPrefix","isComponentUri","uri","parseUrl","qi","lastIndexOf","substring","query","queryString","appendParameters","bOverwriteExisting","bConvertToUppercase","bDiscardExistingParams","currentParams","parsed","paramNames","toUpperCase","params2","stringify","result","toString","protocol","areUrlsSame","url1","url2","parsed1","parsed2","params1","slashes","auth","host","hostname","port","pathname","hash","areParamsEqual","keys1","Object","keys","k","toLowerCase","sort","arraysEqual","a","b","i","parseComponentUri","props","ensureParameters","uppercase","extraParameters","params","bNeedMapName","bNeedSession","bNeedLocale","MAPNAME","SESSION","LOCALE","stringifyQuery","parseUrlParameters","SHIM_EPSILON","Math","pow","getClosestScaleIndex","scales","abs","restrictToRange","val","lower","upper","min","max","areNumbersEqual","epsilon","Number","EPSILON","scaleRangeBetween","minScale","maxScale","finiteScaleList","deg2rad","deg","PI","sum","array","numSelector","total","roundTo","num","round","buildPropertyGetter","el","tryGetAsProperty","parseInt","parseFloat","deArrayifyRules","rules","getter","LegendLabel","Filter","Icon","deArrayifyFeatureStyles","fts","ft","Type","Rule","deArrayifyScaleRanges","MinScale","MaxScale","Constants","FeatureStyle","sc","deArrayifyFeatureSourceInfo","fs","ResourceId","ClassName","Geometry","deArrayifyLayers","lyr","LayerDefinition","ParentId","DisplayInLegend","ExpandInLegend","Visible","ActuallyVisible","FeatureSource","ScaleRange","deArrayifyGroups","groups","grp","deArrayifyCoordinateSystem","cs","Wkt","MentorCode","deArrayifyCoordinate","X","Y","deArrayifyExtents","extents","LowerLeftCoordinate","UpperRightCoordinate","deArrayifyFiniteDisplayScales","fds","deArrayifyFeatureSetClass","deArrayifyFeatureSetLayers","deArrayifyFeatureSet","deArrayifyInlineSelectionImage","MimeType","Content","deArrayifyFeatureProperties","deArrayifyFeatures","Bounds","SelectionKey","deArrayifyLayerMetadataProperties","DisplayName","deArrayifyLayerMetadata","deArrayifySelectedLayer","LayerMetadata","deArrayifySelectedFeatures","deArrayifyWebLayoutControl","deArrayifyWebLayoutInfoPane","Width","LegendVisible","PropertiesVisible","deArrayifyWebLayoutInitialView","CenterX","CenterY","Scale","deArrayifyWebLayoutMap","InitialView","HyperlinkTarget","HyperlinkTargetFrame","deArrayifyTaskButton","Tooltip","Description","ImageURL","DisabledImageURL","deArrayifyWebLayoutTaskBar","taskbar","Home","Forward","Back","Tasks","MenuButton","mb","deArrayifyUIItem","deArrayifyWebLayoutTaskPane","InitialTask","TaskBar","func","item","Function","Command","Label","SubItem","si","deArrayifyItemContainer","container","deArrayifyCommand","TargetViewer","Action","Target","TargetFrame","Prompt","ResultColumns","deArrayifyWebLayoutSearchResultColumnSet","Column","col","MatchLimit","URL","LayerSet","deArrayifyWebLayoutInvokeURLLayerSet","AdditionalParameter","deArrayifyWebLayoutParameterPairs","pairs","kvp","Key","DisableIfSelectionEmpty","Script","deArrayifyWebLayoutCommandSet","set","deArrayifyMapGroup","mapGroup","Map","iview","m","SingleTile","Extension","deArrayifyExtension","deArrayifyMapSet","MapGroup","deArrayifyContainerItems","items","Widget","ImageUrl","ImageClass","Item","deArrayifyContainer","containers","c","Position","deArrayifyWidgets","widgets","w","uiw","deArrayifyUiWidget","deArrayifyWidget","WidgetType","Location","arrayCheck","ext","Array","isArray","StatusText","Disabled","deArrayifyMapWidget","MapId","deArrayifyWidgetSet","widgetSet","ws","Container","MapWidget","deArrayify","deArrayifyRuntimeMap","SiteVersion","MapDefinition","TileSetDefinition","TileWidth","TileHeight","BackgroundColor","DisplayDpi","IconMimeType","Extents","Group","RuntimeMap","deArrayifyFeatureInformation","FeatureInformation","deArrayifyWebLayout","Title","EnablePingServer","SelectionColor","PointSelectionBuffer","MapImageFormat","SelectionImageFormat","StartupScript","ToolBar","InformationPane","ContextMenu","TaskPane","StatusBar","ZoomControl","CommandSet","WebLayout","deArrayifyFlexibleLayout","TemplateUrl","MapSet","WidgetSet","ApplicationDefinition","layerIds","xml","cls","getActiveSelectedFeatureXml","STD_CSS_SPRITE_RELPATH","default","ICON_ERROR","SPRITE_GLOBE_ADD","SPRITE_LAYER_ADD","SPRITE_COORDINATE_TRACKER","SPRITE_CONTROL_180","SPRITE_CONTROL","SPRITE_ICON_ZOOMSELECT","SPRITE_LEGEND_LAYER","SPRITE_ICON_SELECT","SPRITE_LC_UNSELECT","SPRITE_LEGEND_THEME","SPRITE_LEGEND_RASTER","SPRITE_LEGEND_TOGGLE","SPRITE_LEGEND_TOGGLE_EXPAND","SPRITE_FOLDER_HORIZONTAL","SPRITE_ICON_ERROR","SPRITE_ICON_HOME","SPRITE_BACK","SPRITE_FORWARD","SPRITE_ICON_MENUARROWUP","SPRITE_ICON_MENUARROW","SPRITE_SELECT","SPRITE_PAN","SPRITE_ZOOM_IN","SPRITE_ZOOM_IN_FIXED","SPRITE_ZOOM_OUT_FIXED","SPRITE_ZOOM_FULL","SPRITE_MAPTIP","SPRITE_PAN_WEST","SPRITE_PAN_EAST","SPRITE_PAN_NORTH","SPRITE_PAN_SOUTH","SPRITE_ABOUT","SPRITE_HELP","SPRITE_MEASURE","SPRITE_PRINT","SPRITE_OPTIONS","SPRITE_SELECT_RADIUS","SPRITE_SELECT_POLYGON","SPRITE_INITIAL_CENTER","SPRITE_SELECT_CLEAR","SPRITE_ICON_REFRESHMAP","SPRITE_VIEW_BACK","SPRITE_VIEW_FORWARD","SPRITE_GEOLOCATION","SPRITE_BUFFER","SPRITE_SELECT_FEATURES","SPRITE_REDLINE","SPRITE_FEATURE_INFO","SPRITE_QUERY","SPRITE_THEME","SPRITE_INVOKE_SCRIPT","SPRITE_INVOKE_URL","SPRITE_SELECT_CENTRE","SPRITE_GLOBE_SHARE","FUSION_ICON_REGEX","fixIconPath","path","test","getAssetRoot","fusionFixSpriteClass","tb","spriteClass","iconClass","mergeInvokeUrlParameters","currentParameters","currentP","reduce","prev","arr","fixChildItems","childItems","commandInvoker","mapToolbarReference","tooltip","label","selected","componentName","icon","flyoutId","componentProps","isSeparator","command","getCommand","children","visibleWmsLayerCount","historyIndex","history","selectable","visibleAndSelectableWmsLayerCount","isNotBusy","disabledIfEmptySelection","CommandConditions","DefaultCommands","commands","openModalUrl","modalTitle","ModalActions","showModalUrl","modal","title","backdrop","overflowYScroll","openUrlInTarget","cmdDef","hasTaskPane","target","TASK_INVOKE_URL","targetFrame","window","frames","bInvoked","location","assertNever","registerCommand","isInvokeUrlCommand","disableIfSelectionEmpty","isSearchCommand","encodeURIComponent","prompt","PointZoomLevel","matchLimit","resultColumns","isModalDisplayOptions","arg","isModalComponentDisplayOptions","isError","isInitError","isMenuRef","isComponentFlyout","isMenu","isLayer","isMapView","isCoordinate","isAction","action","DefaultComponentNames","components","getComponentFactory","id","registerComponentFactory","factory","render","componentId","React","Component","PlaceholderComponent","other","equalityFn","RuntimeMapFeatureFlags","QueryFeaturesSet","RequestBuilder","num2hex","n","lpad","inStr","len","padChar","slice","toHtmlColor","ca","asArray","DEFAULT_COLOR","toBasicFill","alpha","color","toBasicStroke","s","getWidth","toOLColor","vectorStyleToOLStyleMap","ptStyle","point","DEFAULT_POINT_STYLE","pts","image","radius","fill","stroke","lnStyle","line","DEFAULT_LINE_STYLE","lns","plStyle","polygon","DEFAULT_POLY_STYLE","pls","cpts","clone","cpls","gcs","getImage","getStroke","getFill","shortid","generate","Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Circle","GeometryCollection","olStyleMapToVectorStyle","os","pi","getRadius","setOLVectorLayerStyle","ols","VECTOR_STYLE","layerStyleFunc","feature","getGeometry","getType","bind","setStyle","mUnits","localizedName","abbreviation","unitsPerMeter","metersPerUnit","getUnitOfMeasure","getUnitsOfMeasure","Centimeters","DecimalDegrees","Degrees","DMS","Feet","Inches","Kilometers","Meters","Miles","Millimeters","NauticalMiles","Pixels","Unknown","Yards","getUnits","getMapSize","displaySize","units","precision","gw","gh","uom","prec","factor","getAssetPath","mRoot","ICON_ZOOM_OUT_FIXED","setAssetRoot","getRelativeIconPath","iconName","normalizeStack","errorRenderer","Callout","intent","Intent","DANGER","className","ln","MapGuideMockMode","MapDebugContext","createContext","initTooltipEnabled","_map","_layerSets","_mouseTooltip","MouseTrackingTooltip","_featureTooltip","FeatureQueryTooltip","_selectTooltip","SelectedFeaturesTooltip","setEnabled","initLayerSet","layerSet","MgLayerSet","_activeMapName","update","initContext","overviewMapElementSelector","overviewMapOpts","getLayersForOverviewMap","getProjection","tipLabel","collapseLabel","ReactDOM","findDOMNode","collapsed","collapsible","_ovMap","addControl","setMapGuideMocking","getMockMode","attach","updateOverviewMapElement","setCollapsed","setCollapsible","setTarget","getOverviewMap","getLayerSet","bCreate","isMouseOver","clearMouseTooltip","clear","setMouseTooltip","setText","handleMouseTooltipMouseMove","e","onMouseMove","hideSelectedVectorFeaturesTooltip","hide","showSelectedVectorFeatures","features","pixel","queryWmsFeatures","layerMgr","getView","getResolution","queryFeatureTooltip","isEnabled","raiseQueryFromPoint","handleFeatureTooltipMouseMove","isFeatureTooltipEnabled","enableFeatureTooltips","refreshOnStateChange","refreshMap","mode","LayersOnly","SelectionOnly","mapExtent","featureXml","getClient","selectionformat","selectioncolor","requestdata","layerattributefilter","dataUri","showActiveSelectedFeature","BLANK_SIZE","MapViewerContext","getLayerInfo","isExternal","getSource","HAS_WMS_LEGEND","getLegendUrl","vs","getVisible","IS_SELECTABLE","LAYER_NAME","LAYER_TYPE","getOpacity","extensions","BUSY_WORKER_COUNT","_olFormats","getFormatDrivers","getLayers","getCustomLayers","hasLayer","addLayer","allowReplace","removeLayer","getLayer","apply","parseFeaturesFromFile","file","that","reader","FileReader","addEventListener","formats","loadedType","bLoaded","ii","tryParse","hasFeatures","readAsText","addLayerFromParsedFeatures","source","SUPPRESS_LOAD_EVENTS","addTo","IS_EXTERNAL","IS_GROUP","MgLayerManager","VOID_NOOP","AppContext","allowHtmlValuesInSelection","getHTMLCleaner","v","LegendContext","isFiltering","getFilterText","getLocale","getBaseIconSize","getIconMimeType","getChildren","getCurrentScale","getTree","getLayerVisibility","getGroupVisibility","setGroupVisibility","setLayerVisibility","getLayerSelectability","setLayerSelectability","getGroupExpanded","setGroupExpanded","getLayerExpanded","setLayerExpanded","ToolbarContext","openFlyout","closeFlyout","openComponent","closeComponent","status","keyName","stringifyGetUrl","version","bFirst","operation","USERNAME","PASSWORD","p1","Request","MapAgentRequestBuilder","showModalComponent","MODAL_SHOW_COMPONENT","MODAL_SHOW_URL","hideModal","MODAL_CLOSE","layouts","registerLayout","getLayout","LEGEND_SET_GROUP_VISIBILITY","LEGEND_SET_LAYER_VISIBILITY","LEGEND_SET_GROUP_EXPANDABLE","setLayerSelectable","LEGEND_SET_LAYER_SELECTABLE","refresh","requestedFeatures","LayerFeatureSources","LayerIcons","LayersAndGroups","MAP_REFRESH","h","mapCapturerSource","mapCapturerLayer","intTranslate","on","onTranslateEnd","getRing","origin","paperSize","scaleDenominator","ring","getMetersPerUnit","x","y","getLength","activeCallback","poly","boxCoords","getCoordinates","npoly","ncenter","olExtent","getCenter","getExtent","rotate","nBoxCoords","updateBoxCoords","updateBox","createCaptureBox","center","setCoordinates","box","getMapName","activate","getLayerManager","addInteraction","deactivate","removeInteraction","MapCapturerContext","parseEpsgCodeFromCRS","crs","match","isGeoJsonMimeType","mimeType","lmt","WfsCapabilitiesPanel","onAddLayer","Card","href","abstract","marginBottom","geoJsonFmt","getGeoJsonFormat","serviceInfo","lformats","sformats","allowedOutputFormats","getLayerCrs","pdc","defaultCrs","otherCrs","matches","poc","epsgCode","origCrs","otherActions","padding","paddingTop","ButtonGroup","Button","onClick","wgs84Bounds","PRIMARY","spStyle","display","otherProps","baseSize","ImageIcon","src","onError","currentTarget","resolveProjectionFromEpsgIoAsync","epsg","mapDef","resp","results","defs","proj4","mapDefinition","ensureProjection","alias","factoryIfNotFound","bAdded","resolvedName","register","isCommandItem","isFlyoutItem","isSeparatorItem","isBasicCommand","isTargetedCommand","isInvokeURLCommand","_builders","registerRequestBuilder","otherView","areMapsSame","layerTransparencyChanged","setLayers","otherLayers","getSession","client","onSessionExpired","tm","interval","timeoutID","setTimeout","tick","lastTry","MapLoadIndicator","loaded","loading","position","visibility","toFixed","zIndex","background","transition","top","bottom","onResize","onMapResized","getSize","onKeyDown","cancelKey","undoKey","keyCode","cancelDigitization","_activeDrawInteraction","removeLastPoint","setState","shiftKey","onKeyUp","onMouseDown","isMouseDown","onMouseUp","onContextMenu","_mapContext","isMouseOverTooltip","preventDefault","clientX","clientY","debounce","_refreshOnStateChange","stateChangeDebounceTimeout","_wktFormat","_busyWorkers","_triggerZoomRequestOnMoveEnd","ism","navigator","userAgent","_supportsTouch","phone","tablet","digitizingType","resolutionToScale","getPointSelectionBox","ptBuffer","ll","getCoordinateFromPixel","ur","onMapClick","onHideContextMenu","isDigitizing","WmsQueryFeatures","coordinate","Select","_select","getFeatures","forEachFeatureAtPixel","px","geom","fromExtent","buildDefaultQueryOptions","maxfeatures","sendSelectionQuery","getSelectableLayers","selectableLayerNames","reqQueryFeatures","wkt","names","writeGeometry","geometry","layernames","onZoomSelectBox","extent","_zoomSelectBox","Zoom","onRequestZoomToView","getViewForExtent","queryOpts","success","failure","incrementBusyWorker","qOrig","selectionvariant","queryOptions","onQueryMapFeatures","decrementBusyWorker","zoomByDelta","delta","currentZoom","getZoom","newZoom","getConstrainedZoom","getAnimating","cancelAnimations","animate","zoom","duration","easing","olEasing","easeOut","removeActiveDrawInteraction","pushDrawInteraction","draw","handler","onBeginDigitization","cancel","once","onMouseCoordinateChanged","addImageLoading","newLoading","addImageLoaded","newLoadedCount","onBusyLoading","onImageError","_keepAlive","createOLMap","getCallback","mock","_client","getAgentUri","getAgentKind","getSessionId","openTooltipLink","onOpenTooltipLink","addFeatureToHighlight","bAppend","sf","clearScratchLayer","addScratchFeature","applyView","vw","setCenter","setResolution","componentDidUpdate","prevProps","nextProps","bChangedView","oldLayerSet","newLayerSet","ovMap","detach","fitViewToExtent","updateSelectionColor","updateExternalBaseLayers","updateTransparency","getOLView","setRotation","enableRotation","resolutions","getResolutions","minResolution","getMinResolution","maxResolution","getMaxResolution","maxZoom","getMaxZoom","minZoom","getMinZoom","setView","activeSelectedFeatureXml","me","calculateExtent","componentDidMount","mapNode","condition","IS_SCRATCH","SessionKeepAlive","mapOptions","controls","interactions","isMiddleMouseDownEvent","which","button","originalEvent","Pan","activeLayerSet","document","frameState","viewState","onRotationChanged","zoomToView","fit","cursor","CURSOR_DIGITIZE_POINT","CURSOR_DIGITIZE_LINE","CURSOR_DIGITIZE_LINESTRING","CURSOR_DIGITIZE_RECT","CURSOR_DIGITIZE_POLYGON","CURSOR_DIGITIZE_CIRCLE","CURSOR_GRABBING","CURSOR_GRAB","CURSOR_ZOOM_IN","backgroundColor","loadIndicatorPosition","getScaleForExtent","bounds","mcsW","mcsH","getHeight","devW","devH","metersPerPixel","getDpi","ov","getCurrentExtent","setSelectionXml","clearSelection","zoomDelta","zoomToExtent","getInteractions","getArray","inter","digitizePoint","POINT","digitizeLine","LINE_STRING","minPoints","maxPoints","digitizeLineString","digitizeCircle","CIRCLE","digitizeRectangle","geometryFunction","start","end","digitizePolygon","POLYGON","selectByGeometry","selectionMethod","interaction","addOverlay","overlay","removeOverlay","addHandler","eventName","removeHandler","un","updateSize","screenToMapUnits","mapDevW","mapDevH","extX1","extY1","getSelectedFeatures","MapViewerBase","sMaj","sMin","sPatch","sRev","vMaj","vMin","vPatch","vRev","_drivers","addFormatDriver","driver","encodeKey","sessionId","clearSessionStore","localStorage","startsWith","removeItem","JSON","setItem","content","getItem","setElementStates","states","FUSION_SET_ELEMENT_STATE","setTaskPaneVisibility","FUSION_SET_TASK_PANE_VISIBILITY","setSelectionPanelVisibility","FUSION_SET_SELECTION_PANEL_VISIBILITY","setLegendVisibility","FUSION_SET_LEGEND_VISIBILITY","goHome","TASK_PANE_HOME","goBack","TASK_PANE_BACK","goForward","TASK_PANE_FORWARD","pushUrl","silent","TASK_PANE_PUSH_URL","maxHeight","inlineBaseLayerSwitcher","useDispatch","MapActions","LegendActions","Legend","currentScale","onBaseLayerChanged","overrideSelectableLayers","overrideExpandedItems","onLayerSelectabilityChanged","onGroupExpansionChanged","expanded","onGroupVisibilityChanged","groupId","onLayerVisibilityChanged","BaseLayerSwitcher","visLayers","setSelected","checked","onChange","inner","olFactory","OLFactory","attachExternal","disp","toastSuccess","toastWarning","toastError","toastPrimary","dismissToast","getViewRotation","isViewRotationEnabled","getOLFactory","setFeatureTooltipEnabled","getSelection","getSelectionXml","getActiveTool","addSubscribers","removeSubscribers","getSubscribers","toasterRef","innerRef","mapDebugContext","useContext","subscribers","setSubscribers","count","showContextMenu","pos","FlyoutActions","openContextMenu","hideContextMenu","closeContextMenu","innerViewer","adapter","MapViewerAdapter","Runtime","browserWindow","dismiss","show","SUCCESS","WARNING","ns","ol","Toaster","usePortal","TOP","None","SessionExpired","newRotation","fixedUrl","Subscriber","CONTEXT_MENU_OPEN","CONTEXT_MENU_CLOSE","metrics","FLYOUT_OPEN","FLYOUT_CLOSE","COMPONENT_OPEN","COMPONENT_CLOSE","createStyle","createStyleFill","createStyleStroke","createStyleCircle","createFeatureCollection","extentContainsXY","containsXY","extendExtent","extend","createProjection","transformCoordinateFromLonLat","lonlat","olProj","fromLonLat","transformCoordinate","transform","transformExtent","createGeomPoint","createGeomLineString","createGeomCircle","createGeomLinearRing","createGeomPolygon","createGeomPolygonFromCircle","circle","fromCircle","createGeomMultiLineString","createGeomMultiPoint","createGeomMultiPolygon","createGeomCollection","geometries","createVectorSource","createVectorLayer","createOverlay","createInteractionDraw","createInteractionExtent","createInteractionTranslate","createInteractionSnap","createInteractionModify","createInteractionSelect","createFeature","geomOrProps","createFormatGeoJSON","createFormatWKT","createStyleIcon","createStyleRegularShape","createStyleText","mapProjection","prj","MouseCoordinates","finiteScales","Navigator","busy","onRequestZoomToScale","onPan","direction","PanDirection","East","PanRight","West","PanLeft","North","PanUp","South","PanDown","onZoom","ZoomDirection","In","ZoomIn","Out","ZoomOut","ScaleDisplay","onScaleChanged","SelectedFeatureCount","selectedFeatureRenderer","appContext","SelectionPanel","onResolveLayerLabel","_","allowHtmlValues","cleanHTML","onRequestZoomToFeature","bbox","onShowSelectedFeature","DEFAULT_TOOLBAR_SIZE","TOOLBAR_BACKGROUND_COLOR","SVG_SIZE_RATIO","getSelected","sel","getEnabled","en","getIconElement","iconStyle","getIconStyle","bpIconName","iconSize","getFlyoutIconElement","isFlownOut","getTooltip","tt","imgStyle","verticalAlign","lineHeight","getItemStyle","vertical","pad","paddingLeft","paddingRight","paddingBottom","borderWidth","vertPad","FlyoutMenuChildItem","setIsMouseOver","getMenuItemStyle","border","iconEl","onMouseEnter","onMouseLeave","onInvoked","ComponentFlyoutItem","toolbarCtx","ttip","rect","getBoundingClientRect","posX","posY","FlyoutMenuReferenceItem","menu","align","flyoutAlign","ToolbarSeparator","getToolbarSeparatorItemStyle","marginLeft","marginRight","ToolbarButton","hideVerticalLabels","Toolbar","containerStyle","containerClass","flyoutStates","onOpenFlyout","onCloseFlyout","onOpenComponent","onCloseComponent","ch","providerImpl","Provider","onUrlLoaded","navigationStack","currentUrl","canGoHome","initUrl","canGoBack","canGoForward","homeAction","backAction","forwardAction","hasTaskBar","isResizing","fid","showTaskBar","TASK_PANE_OVERLAY_BGCOLOR","NonIdealState","description","TaskPaneContainerInner","TaskPaneActions","onMgLayerOpacityChanged","onBaseOpacityChanged","onManualFeatureTooltipsChanged","opBase","opMgBase","opMgSelOverlay","Slider","stepSize","HTMLSelect","setViewSizeDisplayUnits","u","ui","entries","MapMenu","onActiveMapChanged","selectedMap","maps","projections","margin","NaN","getLayerIndex","Tabs","renderActiveTabPanelOnly","Tab","SIZE_STANDARD","panel","AddLayer","onLayerAdded","onAddLayerBusyWorker","onRemoveLayerBusyWorker","ManageLayers","currentResolution","onSetOpacity","onSetVisibility","onZoomToBounds","ll_bbox","WGS84_BBOX","zoomBounds","sp","dp","onMoveLayerDown","newIndex","onMoveLayerUp","onRemoveLayer","onVectorStyleChanged","PointStyleEditor","FormGroup","ColorPicker","labelStepSize","NumericInput","onValueChange","LineStyleEditor","PolygonStyleEditor","VectorStyleEditor","enableLine","enablePoint","enablePolygon","selectedTab","setSelectedTab","pointStyle","setPointStyle","lineStyle","setLineStyle","polyStyle","setPolyStyle","onStyleChanged","newStyle","t","selectedTabId","st","SimpleColorPicker","isPickerOpen","setIsPickerOpen","borderRadius","Collapse","isOpen","sizeUnits","ViewSize","dataProjection","tg","setGeometry","addFeatures","ParsedFeatures","CONFIG_INITIAL_STATE","hasStatusBar","hasNavigator","hasSelectionPanel","hasLegend","hasToolbar","hasViewSize","configReducer","SET_LOCALE","INIT_APP","am","mapNames","mapGroupId","state1","newState","coordConfig","viewerConfig","coordinateProjection","coordinateDecimals","coordinateDisplayFormat","state2","_ovReducer","isElementState","TEMPLATE_INITIAL_STATE","autoDisplaySelectionPanelOnSelection","setCustomTemplateReducer","templateReducer","origState","addParameters","viewport","viewports","INITIAL_VIEWPORTS","defaultViewport","DEFAULT_VIEWPORT","req","require","configure","loadStories","forEach","module","bootstrap","CsvFormatDriver","CSV_COLUMN_ALIASES","FormatDriver","STRINGS_EN","FeatureStyleType","LayerType","GroupType","handleMapBrowserEvent","mapBrowserEvent","frameState_","dragging","viewport_","contains","interactionsArray","dispatchEvent","getActive","handleEvent","panMap","newPos","current_center","currentExtent","buildTargetedCommand","cmdTarget","initDefaultCommands","WmsQuery","MapTip","About","component","Help","Measure","QuickPlot","ViewerOptions","SelectRadius","SelectionType","SelectPolygon","RestoreView","ZoomExtents","ClearSelection","ZoomToSelection","RefreshMap","PreviousView","NextView","Geolocation","rtMap","geoOptions","ZoomLevel","EnableHighAccuracy","enableHighAccuracy","Timeout","timeout","MaximumAge","maximumAge","geolocation","getCurrentPosition","txCoord","longitude","latitude","testCoord","code","Buffer","SelectWithin","Redline","bUseAdvancedStylization","defaultDataStoreFormat","defaultRedlineGeometryType","bCreateOnStartup","AutogenerateLayerNames","StylizationType","DataStoreFormat","RedlineGeometryFormat","geomTypes","AutoCreateOnStartup","enableRedlineMessagePrompt","UseMapMessage","FeatureInfo","Query","Theme","CoordinateTracker","Projection","AddManageLayers","CenterSelection","TemplateActions","contextMenuTest","getViewport","onMouseOut","tooltipElement","createElement","element","offset","positioning","CENTER_LEFT","classList","add","setPosition","remove","innerHTML","destroy","parentNode","removeChild","setLinkClickHandler","linkElement","onclick","handleLinkClick","wktFormat","featureTooltipElement","featureTooltip","throttledMouseMove","Date","sendTooltipQuery","html","getElementById","blankImageLoadFunction","mockMapGuideImageLoadFunction","tCtx","getContext","clearRect","canvas","strings","maxSize","measureText","yoff","fillStyle","fillRect","font","fontSize","fillText","toDataURL","mgTiledLayers","externalBaseLayersGroup","dpi","inPerUnit","olHas","DEVICE_PIXEL_RATIO","getSourcesForProgressTracking","sources","getLayersArray","bl","selectionOverlay","activeSelectedFeatureOverlay","updateParams","showlayers","showgroups","hidelayers","hidegroups","setVisible","SELECTIONCOLOR","trans","setOpacity","seq","getTime","makeActiveSelectedFeatureSource","imageExtent","imageSize","setSource","dynamicOverlayParams","FORMAT","BEHAVIOR","staticOverlayParams","MAPDEFINITION","CLIENTAGENT","VERSION","selectionOverlayParams","getTileUrlFunctionForGroup","zOrigin","urlTemplate","tileCoord","create","isNotForOverviewMap","tileWidth","tileHeight","tileGrid","getTopLeft","tileSize","group","tileSource","tileUrlFunction","wrapX","tileLayer","Tiled","createMgOverlayLayer","Overlay","SelectionOverlay","ActiveFeatureSelectionOverlay","groupOpts","createExternalBaseLayer","MgLayerSetInner","extSource","createExternalSource","tl","useImageOverlayOp","overlaySource","useOverlay","ratio","displayDpi","floor","mainSet","overviewSet","_customLayers","MgInnerLayerSetFactory","registerSourceEvents","scratchLayer","addFeature","RenderPlaceholder","setImageLoadFunction","DoNotRender","defaultImageLoadFunction","isMapGuideImageSource","ovMapControl","bSetLayers","insertAt","customLayers","order","allLayers","ovLayers","isSelectable","reverse","bAllow","layersByName","oll","cCurrentLayers","currentLayers","isGroup","bReorder","toRemove","toAdd","createMapGuideSource","sourceCtor","setPopupCloseHandler","closerEl","closePopup","wmsLayer","getFeatureInfoUrl","srcProj","properties","readFeatures","featureProjection","generateFeatureHtml","table","getProperties","pc","getGeometryName","mRedlineMessageEnabled","parent","Event","FusionEventApiShim","xml2json","responseText","onSuccess","ajaxRequest","reqUrl","fail","onFailure","onException","_r","transport","getMapByName","FusionWidgetApiShim","getWidgetById","getWidgetsByType","registerForEvent","eventID","obj_this","OL2FunctionHelper","i18n","getVertices","g","getLinearRing","AjaxViewerMapActionCode","processFeatureInfo","o","norm","selXml","Message","legendLabel","getExtentFromPoint","OL2Bounds","setExtents","setActiveLayer","_activeLayer","fusionAPI","getFusionAPI","triggerFusionEvent","MAP_ACTIVE_LAYER_CHANGED","getActiveLayer","qmo","selectionType","maxFeatures","zoomTo","bw","bh","ZoomToView","getSelectedLayers","fl","ml","isBusy","isMapLoaded","redraw","Refresh","reloadMap","msg","_activeToast","dangerouslySetInnerHTML","__html","isRedlineMessagePromptEnabled","findLayerByAttribute","pixToGeoMeasure","tolerance","drawMap","deregisterForEvent","toOL2Circle","circ","_options","pt","OL2Geom","lstr","OL2Rect","AjaxViewerLineStringOrPolygon","onFormFrameMounted","form","formFrame","GetMapName","GetSessionId","us","userSelectionHandlers","fusionEventHandlers","ol2API","OL2Shim","FusionApiShim","funcs","cb","arguments","fusionSelectionHandler","isEmptySelection","MAP_SELECTION_OFF","MAP_SELECTION_ON","ExecuteMapAction","cmdName","PanMode","PrevView","SelectionMode","ZoomMode","ZoomRect","ZoomSelection","DigitizeCircle","Center","Radius","DigitizeLine","DigitizePoint","DigitizePolygon","DigitizeLineString","DigitizeRectangle","Point1","Point2","GetCenter","GetLayers","onlyVisible","onlySelectable","selLayers","ids","legend","objectid","GetMetersPerUnit","GetMapHeight","GetMapUnitsType","GetMapWidth","GetScale","GetSelectedLayers","GetSelectionXML","GetSelectedBounds","minx","miny","maxx","maxy","GetSelectedCount","GetSelectedFeatures","sl","values","IsDigitizing","IsEnglishUnits","IsLatLongDisplayUnits","MapUnitsToLatLon","legendRefresh","ScreenToMapUnits","SetEnglishUnits","usEnglish","SetLatLongDisplayUnits","SetSelectionXML","xmlSet","SetStatusMsg","ZoomToScale","Submit","frameTarget","submit","RegisterSelectionHandler","UnregisterSelectionHandler","installShims","Fusion","OpenLayers","GetMapFrame","mapFrame","GotoHomePage","GetViewerInterface","_mapName","MAP_BUSY_CHANGED","FormFrameShim","ViewerApiShimInner","onFormMounted","_form","encType","fields","registerDefaultComponents","PoweredByMapGuide","BaseMapSwitcher","ShareLinkToView","UL_LIST_STYLE","listStyle","marginTop","LI_LIST_STYLE","ROW_ITEM_ELEMENT_STYLE","CHK_STYLE","legendCtx","toLocaleLowerCase","idx","getIconUri","iconMimeType","iconBase64","EmptyNode","RuleNode","rule","isLayerVisibleAtScale","sr","isGroupVisibleAtScale","tree","groupChildren","child","itemTextFilter","setupTree","Layers","Groups","LayerMap","GroupMap","remainingGroups","itemCount","objId","removeIds","LayerNode","chkbox","layerVisible","setLayerVisible","getExpanded","onToggleExpansion","bs","nodeStyle","whiteSpace","overflow","scaleRange","ruleElements","totalRuleCount","ftsRuleCount","bCompressed","GroupNode","groupVisible","setGroupVisible","isExpanded","setIsFiltering","filterText","setFilterText","filteredTree","setFilteredTree","onExitFilterMode","onFilterUpdate","_tree","buildFilteredTree","filtered","oid","rootStyle","baseIconSize","objectId","daTree","rootItems","InputGroup","autoFocus","leftIcon","placeholder","rightElement","minimal","bGroupVisAtScale","bGroupVisFilter","processMenuItems","processed","appStateSelector","appStateEqualityFn","onNewState","formatCoordinates","sfmt","LN9","log","calculatePosForScale","calculateScaleForPos","previewPos","setPreviewPos","setPos","isDragging","setIsDragging","shape","alt","IMG_SLIDER_SCALE","useMap","GIF_SPINNER","axis","handle","onStart","onDrag","deltaY","onStop","newScale","IMG_SLIDER","dragLabel","textAlign","localScale","setLocalScale","fiScale","onKeyPress","featureSet","subTotal","layerCount","DefaultSelectedFeature","selectedFeature","selectedLayer","featureProps","lp","fp","prop","SELECTION_TOOLBAR_STYLE","float","SELECTION_PANEL_TOOLBAR_STYLE","LAYER_COMBO_STYLE","FloatClear","selectedLayerIndex","setSelectedLayerIndex","featureIndex","setFeatureIndex","meta","selBodyStyle","getCurrentLayer","getFeatureAt","getCurrentFeature","canGoPrev","canGoNext","canZoomSelectedFeature","prevFeature","sKey","nextFeature","zoomSelectedFeature","onSelectedLayerChanged","selLayer","overflowY","selectionToolbarItems","buildToolbarItems","selPanel","currentUrlDoesNotMatchMapName","normUrl","onFrameMounted","iframe","_iframe","taskPaneId","onFrameLoaded","frame","contentWindow","frameContentLoaded","taskButtons","activeComponent","invalidated","loadUrl","compUri","activeComponentProps","navUrl","taskMenu","taskBarStyle","taskBodyStyle","taskFrameStyle","taskComponentContainerStyle","cpp","onLoad","Spinner","NONE","SIZE_LARGE","reload","_measurements","onTypeChanged","newType","drawType","measuring","activeMeasure","handleDrawTypeChange","onClearMeasurements","clearMeasurements","onStartMeasure","startMeasure","onEndMeasure","endMeasure","updateSegments","segments","activeType","segmentTotal","clearSegments","getCurrentDrawType","context","MeasureContext","setParent","componentWillUnmount","detachParent","oldMeasure","newMeasure","disabled","segment","MeasureContainerInner","onDrawStart","evt","sketch","tooltipCoord","listener","output","getInteriorPoint","getLastCoordinate","measureTooltipElement","measureTooltip","onDrawEnd","setOffset","createMeasureTooltip","olObservable","unByKey","helpMsg","helpTooltipElement","helpTooltip","measureOverlays","measureLayer","createMeasureStyle","formatLength","sourceProj","c1","c2","dist","olSphere","getDistance","formatArea","area","getArea","createDrawInteraction","lineDash","removeElement","createHelpTooltip","BOTTOM_CENTER","setActiveInteraction","getPrintSize","showAdvanced","orientation","paperRatio","viewSize","viewRatio","margins","buttom","_mapCapturers","getActiveCapturer","activeCapturer","setTitle","subTitle","setSubTitle","showLegend","setShowLegend","showNorthBar","setShowNorthBar","showCoordinates","setShowCoordinates","showScaleBar","setShowScaleBar","showDisclaimer","setShowDisclaimer","setShowAdvanced","setOrientation","setPaperSize","setDpi","setBox","normalizedBox","setNormalizedBox","onDpiChanged","prevShowAdvanced","toggleMapCapturerLayer","bVisible","ppSize","capturer","hasExternalBaseLayers","prSize","normBox","theBox","tokens","random","dir","maxLength","OpenPanel","ManageLayerItem","canMoveUp","canMoveDown","wmsLegendUrl","setWmsLegendUrl","openPanel","setOpenPanel","toggleOpenPanel","EditVectorStyle","MoreLayerOptions","WmsLegend","canZoom","extraActions","isWms","onToggleWmsLegend","isWmsLegendOpen","Switch","labelElement","cannotMoveUp","cannotMoveDown","tabName","AddLayerKind","ADD_URL_LAYER_TYPES","AddWmsLayer","AddWfsLayer","AddFileLayer","isAddingLayer","setIsAddingLayer","addLayerError","setAddLayerError","loadedFile","setLoadedFile","addLayerName","setAddLayerName","addProjection","setAddProjection","parsedFeaturesRef","setParsedFile","defaultProjection","EditableText","inline","layerProjection","layerProj","FileInput","buttonText","onInputChange","files","AddUrlLayer","selectedUrlType","setSelectedUrlType","lt","it","cprops","addLayerKind","setAddLayerKind","RadioGroup","selectedValue","Radio","File","Url","wmsUrl","setWmsUrl","loadingCapabilities","setLoadingCapabilities","caps","setCaps","setError","isTiled","LAYERS","STYLE","TILED","Capability","GetMap","DCPType","HTTP","Get","OnlineResource","legendUrl","LegendURL","started","finished","ControlGroup","readOnly","read","WmsCapabilitiesPanel","extractWmsLayers","rootLayer","Style","Service","Abstract","styles","alignText","queryable","wfsUrl","setWfsUrl","wfsWgs84Bounds","resolvedProj","typeNameKey","sourceUrl","vectorFmt","strategy","WfsCapabilitiesParser","tryGetElementContent","textContent","getElements","tagName","els","getElementsByTagName","elements","trySetProperty","obj","setter","parser","DOMParser","xmlDoc","parseFromString","getServiceInfo","op","getAttribute","parm","allowedValues","av","oc","fel","fmts","llParts","urParts","ViewSizeContent","showSession","setShowSession","shareUrl","TextArea","rows","Checkbox","CopyToClipboard","onCopy","Papa","aliases","header","complete","xc","xColumn","yc","yColumn","first","firstX","firstY","isNaN","d","webpackContext","webpackContextResolve","__webpack_require__","webpackContextKeys","exports","testSelSheboygan","MapStoryFrame","includeSelect","doTestSelect","q","getQueryMapFeaturesResponse","mgMockMode","doClearSelection","storiesOf","addDecorator","withKnobs","storyFn","FakeApp","testMapSheboygan","testMapRedding","testMapMelbourne","testAppDef","endsWith","FakeMapAgent","_agentConf","initState","Sheboygan","_store","store","fusionRoot","initialElementVisibility","agent","layout","templateLayout","_getMiddleware","middleware","applyMiddleware","configureStore","initialState","extraReducers","combineReducers","compose","_getEnhancers","enhancers","__REDUX_DEVTOOLS_EXTENSION__","createStore","_enableHotLoader","promiseMiddleware","next","isPromise","promise","types","PENDING","FULFILLED","REJECTED","p2","p3","createLogger","stateTransformer","predicate","rootReducer","initErrorReducer","mapStateReducer","viewerReducer","toolbarReducer","taskPaneReducer","modalReducer","mouseReducer","lastAction","mergeFlyoutState","flyoutPayload","flyoutUpdateAction","closeOtherFlyouts","updateSpec","flyoutUpdateSpec","mergeFlyoutCloseState","TOOLBAR_INITIAL_STATE","toolbars","mergeNavigatedUrl","nav","splice","TASK_PANE_INITIAL_STATE","NULL_ACTION","MODAL_INITIAL_STATE","newData","INIT_ERROR_INITIAL_STATE","INIT_ACKNOWLEDGE_WARNINGS","INIT_ERROR","setLayerAction","selector","subState","mergeSubState","MAP_STATE_INITIAL_STATE","MAP_STATE_INITIAL_SUB_STATE","layerIndex","mapKeys","mapNameToApplyInitialState","cv","isel","initialSelections","sg","hl","hg","rtm","isl","initialShowLayers","isg","initialShowGroups","ihl","initialHideLayers","ihg","initialHideGroups","newMapState","view1","newSubState","currentIdx","theLayer","VIEWER_INITIAL_STATE","initialActiveTool","MOUSE_INITIAL_STATE","initErrorRenderer","configuredLocale","initOptions","renderErrorMessage","isLoading","selectionSettings","getHtmlCleaner","cleanHtml","onInit","setElementVisibility","initLayout","resource","ftArgs","urlFeatureTooltip","amArgs","urlMap","initialActiveMap","ivArgs","urlX","urlY","urlScale","slArgs","urlShowLayers","hlArgs","urlHideLayers","sgArgs","urlShowGroups","hgArgs","urlHideGroups","urlResource","urlLocale","urlSession","curUrlState","getStateFromUrl","nextUrlState","updateUrl","layoutEl","ftEnabled","AppInner","InitActions","isUIWidget","widget","convertFlexLayoutUIItems","widgetsByKey","noToolbarLabels","convertWidget","convertWebLayoutUIItems","cmdsByKey","commonParams","convertToCommandTarget","fusionCmdTarget","prepareSubMenus","tbConf","prepared","bFoundContextMenu","isFlyoutSpec","tryDescribeRuntimeMapAsync","targetMapName","createRuntimeMapsAsync","mapDefSelector","projectionSelector","sessionWasReused","mapDefs","mapPromises","all","fetchEpsgs","extraEpsgs","mapsByName","initFromWebLayoutAsync","webLayout","wl","lastSlash","lastDot","mainToolbar","taskBar","contextMenu","MenuItem","firstMapName","firstSessionId","menus","initFromAppDefAsync","appDef","getMapDefinitionsFromFlexLayout","configs","getMapGuideConfiguration","mg","getExtraProjectionsFromFlexLayout","epsgs","DisplayProjection","hasStatus","taskPane","cont","tbName","Precision","Template","setupMaps","dict","mgGroup","ImageFormat","SelectionFormat","Options","bAdd","imagerySet","BingMapKey","urls","initialTask","containerName","sessionAcquiredAsync","initAsync","initSelections","sset","initPayload","processAndDispatchInitError","acknowledgeInitWarnings","Factor","Direction","replaceState","act","setColor","boolean","PANELS","contentRenderer","dim","Accordion","onActivePanelChanged","panels","activePanelId","activeId","validatePanelId","setDim","onTogglePanel","attributes","ResizeSensor","contentRect","api","__esModule","exported","locals","___CSS_LOADER_API_IMPORT___","___CSS_LOADER_AT_RULE_IMPORT_0___","___CSS_LOADER_AT_RULE_IMPORT_1___","___CSS_LOADER_AT_RULE_IMPORT_2___","___CSS_LOADER_AT_RULE_IMPORT_3___","___CSS_LOADER_GET_URL_IMPORT___","___CSS_LOADER_URL_IMPORT_0___","___CSS_LOADER_URL_REPLACEMENT_0___"],"mappings":"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sECAzC,2CAAe,kDAA0B,gD,sECAzC,2CAAe,kDAA0B,+C,sECAzC,2CAAe,kDAA0B,6C,sECAzC,2CAAe,kDAA0B,4C,sECAzC,2CAAe,kDAA0B,sC,sECAzC,2CAAe,kDAA0B,kC,sECAzC,2CAAe,kDAA0B,oC,sECAzC,2CAAe,kDAA0B,yC,sECAzC,2CAAe,kDAA0B,qC,sECAzC,2CAAe,kDAA0B,oC,sECAzC,2CAAe,kDAA0B,0C,sECAzC,2CAAe,kDAA0B,mC,sECAzC,2CAAe,kDAA0B,iD,sECAzC,2CAAe,kDAA0B,kC,sECAzC,2CAAe,kDAA0B,oC,sECAzC,2CAAe,kDAA0B,yC,sECAzC,2CAAe,kDAA0B,8C,sECAzC,2CAAe,kDAA0B,0C,sECAzC,2CAAe,kDAA0B,qC,sECAzC,2CAAe,kDAA0B,gD,sECAzC,2CAAe,kDAA0B,uC,sECAzC,2CAAe,kDAA0B,sC,sECAzC,2CAAe,kDAA0B,4C,sECAzC,2CAAe,kDAA0B,wC,sECAzC,2CAAe,kDAA0B,sC,sECAzC,2CAAe,kDAA0B,0C,sECAzC,2CAAe,kDAA0B,wC,sECAzC,2CAAe,kDAA0B,uC,sECAzC,2CAAe,kDAA0B,oD,sECAzC,2CAAe,kDAA0B,+C,sECAzC,2CAAe,kDAA0B,qC,sECAzC,2CAAe,kDAA0B,yC,sECAzC,2CAAe,kDAA0B,kC,sECAzC,2CAAe,kDAA0B,uC,sECAzC,2CAAe,kDAA0B,qD,sECAzC,2CAAe,kDAA0B,4C,sECAzC,2CAAe,kDAA0B,uD,sECAzC,2CAAe,kDAA0B,8C,sECAzC,2CAAe,kDAA0B,6C,sECAzC,2CAAe,kDAA0B,oC,sECAzC,2CAAe,kDAA0B,6C,sECAzC,2CAAe,kDAA0B,2C,sECAzC,2CAAe,kDAA0B,kC,sECAzC,2CAAe,kDAA0B,4C,sECAzC,2CAAe,kDAA0B,2C,sECAzC,2CAAe,kDAA0B,wC,sECAzC,2CAAe,kDAA0B,yC,sECAzC,2CAAe,kDAA0B,wC,sECAzC,2CAAe,kDAA0B,0C,sECAzC,2CAAe,kDAA0B,wC,sECAzC,2CAAe,kDAA0B,2C,sECAzC,2CAAe,kDAA0B,0C,sECA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","file":"main.621ae6ab925f276c7ec3.bundle.js","sourcesContent":["import * as logger from \"../utils/logger\";\nimport STRINGS_EN from \"../strings/en\";\nimport { ILocalizedMessages } from \"../strings/msgdef\";\n\nexport const DEFAULT_LOCALE = \"en\";\n\nconst STRINGS: { [locale: string]: ILocalizedMessages } = {\n    \"en\": STRINGS_EN\n};\n\n/**\n * Registers a string bundle for the given locale\n *\n * @export\n * @param {string} locale\n * @param {ILocalizedMessages} bundle\n */\nexport function registerStringBundle(locale: string, bundle: ILocalizedMessages) {\n    STRINGS[locale] = bundle;\n}\n\n/**\n * Formats the specified string and substitutes any placeholders (enclosed in {})\n * with the specified arguments\n *\n * @export\n * @param {string} format\n * @param {*} [args]\n * @returns {string}\n */\nexport function fmt(format: string, args?: any): string {\n    let str = format;\n    if (args != null) {\n        for (const p in args) {\n            //str = str.replace(new RegExp(`\\{${p}\\}`, \"g\"), `${args[p]}`);\n            str = str.split(`{${p}}`).join(args[p]);\n        }\n        return str;\n    };\n    return str;\n}\n\n\n/**\n * Returns the localized string for the given key\n * \n * @export\n * @param {keyof ILocalizedMessages} key Any property name of {@link ILocalizedMessages}\n * @param {string} [locale=\"en\"] \n * @param {*} [args] If a localized string has placeholders, they will be replaced with the values defined here\n * @returns {string} \n */\nexport function tr(key: keyof ILocalizedMessages, locale = DEFAULT_LOCALE, args?: any): string {\n    const bundle = STRINGS[locale];\n    if (!bundle) {\n        logger.warn(`No such string bundle for locale: ${locale}`);\n        return key;\n    } else {\n        let str = bundle[key];\n        if (!str) {\n            logger.warn(`String bundle for locale (${locale}) is missing localized string for key: ${key}`);\n            return key;\n        } else {\n            if (args != null) {\n                return fmt(str, args);\n            }\n            return str;\n        }\n    }\n}","import { ResultColumnSet } from \"./contracts/weblayout\";\nimport { RuntimeMap } from \"./contracts/runtime-map\";\nimport { FeatureSet, QueryMapFeaturesResponse } from \"./contracts/query\";\nimport { IQueryMapFeaturesOptions } from './request-builder';\n\nimport olPoint from \"ol/geom/Point\";\nimport olLineString from \"ol/geom/LineString\";\nimport olCircle from \"ol/geom/Circle\";\nimport olPolygon from \"ol/geom/Polygon\";\nimport olGeometry from \"ol/geom/Geometry\";\n\nimport olLayerBase from \"ol/layer/Base\";\nimport olInteraction from \"ol/interaction/Interaction\";\nimport olOverlay from \"ol/Overlay\";\n\nimport { IOLFactory } from \"./ol-factory\";\nimport { ViewerAction } from '../actions/defs';\nimport { ProjectionLike } from 'ol/proj';\nimport { LoadFunction } from 'ol/Image';\nimport { IToolbarAppState } from './registry';\nimport { IVectorFeatureStyle } from './ol-style-helpers';\nimport { IParsedFeatures } from './layer-manager/parsed-features';\nimport Collection from 'ol/Collection';\nimport Feature from 'ol/Feature';\nimport { ISubscriberProps } from '../containers/subscriber';\n\n// Event boilerplate\nexport type GenericEvent = any;\n\nexport type GenericEventHandler = (e: GenericEvent) => void;\n\n/**\n * @deprecated Use UnitOfMeasure enum instead\n */\nexport type UnitName = 'Unknown' | 'Inches' | 'Feet' | 'Yards' | 'Miles' | 'Nautical Miles'\n    | 'Millimeters' | 'Centimeters' | 'Meters' | 'Kilometers'\n    | 'Degrees' | 'Decimal Degrees' | 'Degrees Minutes Seconds' | 'Pixels';\nexport enum UnitOfMeasure {\n    /**\n     * An unknown unit\n     */\n    Unknown = 0,\n    /**\n     * Inch unit\n     */\n    Inches = 1,\n    /**\n     * Feet unit\n     */\n    Feet = 2,\n    /**\n     * Yard unit\n     */\n    Yards = 3,\n    /**\n     * Mile unit\n     */\n    Miles = 4,\n    /**\n     * Nautical Mile unit\n     */\n    NauticalMiles = 5,\n    /**\n     * Millimeter unit\n     */\n    Millimeters = 6,\n    /**\n     * Centimeter unit\n     */\n    Centimeters = 7,\n    /**\n     * Meter unit\n     */\n    Meters = 8,\n    /**\n     * Kilometer unit\n     */\n    Kilometers = 9,\n    /**\n     * Degree unit\n     */\n    Degrees = 10,\n    /**\n     * Decimal Degree unit\n     */\n    DecimalDegrees = 11,\n    /**\n     * DMS unit\n     */\n    DMS = 12,\n    /**\n     * Pixel unit\n     */\n    Pixels = 13,\n}\n\nexport interface UnitInfo {\n    unitsPerMeter: number;\n    metersPerUnit: number;\n    name: UnitName;\n    /**\n     * @since 0.12.2\n     */\n    localizedName: (locale?: string) => string;\n    abbreviation: (locale?: string) => string;\n}\n\n/**\n * Describes a map view\n * @export\n * @interface IMapView\n */\nexport interface IMapView {\n    /**\n     * The x coordinate\n     *\n     * @type {number}\n     * @memberof IMapView\n     */\n    x: number;\n    /**\n     * The Y coordinate\n     *\n     * @type {number}\n     * @memberof IMapView\n     */\n    y: number;\n    /**\n     * The scale\n     *\n     * @type {number}\n     * @memberof IMapView\n     */\n    scale: number;\n    /**\n     * The view resolution\n     * \n     * @type {number | undefined}\n     * @memberof IMapView\n     */\n    resolution?: number;\n}\n\n/**\n * Describes a function that is called when a command is invoked\n */\nexport type DispatcherFunc = (dispatch: ReduxDispatch, getState: () => Readonly<IApplicationState>, viewer?: IMapViewer, parameters?: any) => any;\n\n/**\n * Describes a viewer command\n *\n * @export\n * @interface ICommand\n */\nexport interface ICommand {\n    /**\n     * The icon for this command\n     *\n     * @type {string}\n     * @memberof ICommand\n     */\n    icon?: string;\n    iconClass?: string;\n    //tooltip?: string;\n    /**\n     * @since 0.12.8\n     */\n    title?: string;\n    /**\n     * Indicates if this command is enabled based on the given application state\n     *\n     *\n     * @memberof ICommand\n     */\n    enabled: (state: Readonly<IToolbarAppState>, parameters?: any) => boolean;\n    /**\n     * Indicates if this command is enabled based on the given application state\n     *\n     *\n     * @memberof ICommand\n     */\n    selected: (state: Readonly<IToolbarAppState>) => boolean;\n    /**\n     * Invokes the command\n     *\n     * @type {DispatcherFunc}\n     * @memberof ICommand\n     */\n    invoke: DispatcherFunc;\n}\n\n/**\n * Valid command targets for an InvokeURL command\n */\nexport type CommandTarget = \"TaskPane\" | \"NewWindow\" | \"SpecifiedFrame\";\n\n/**\n * An InvokeURL command parameter\n *\n * @export\n * @interface IInvokeUrlCommandParameter\n */\nexport interface IInvokeUrlCommandParameter {\n    /**\n     * The name of the parameter\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommandParameter\n     */\n    name: string;\n    /**\n     * The value of the parameter\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommandParameter\n     */\n    value: string;\n}\n\n/**\n * Describes a command that will run in a pre-defined target frame or window\n *\n * @export\n * @interface ITargetedCommand\n */\nexport interface ITargetedCommand {\n    /**\n     * Specifies the target which the URL should be invoked in\n     *\n     * @type {CommandTarget}\n     * @memberof IInvokeUrlCommand\n     */\n    target: CommandTarget;\n    /**\n     * The name of the frame to run this command in. Only applies if the target is\n     * \"SpecifiedFrame\"\n     */\n    targetFrame?: string;\n}\n\n/**\n * Describes a command that invokes a URL into a specified target\n *\n * @export\n * @interface IInvokeUrlCommand\n */\nexport interface IInvokeUrlCommand extends ITargetedCommand {\n    /**\n     * The icon for this command\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommand\n     */\n    icon?: string;\n    iconClass?: string;\n    /**\n     * @since 0.12.8\n     */\n    title?: string;\n    /**\n     * The URL to invoke\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommand\n     */\n    url: string;\n    /**\n     * Indicates whether to disable this command if there is no map selection\n     *\n     * @type {boolean}\n     * @memberof IInvokeUrlCommand\n     */\n    disableIfSelectionEmpty?: boolean;\n    /**\n     * Additional command parameters\n     * @memberof IInvokeUrlCommand\n     */\n    parameters: IInvokeUrlCommandParameter[];\n}\n\n/**\n * Describes a search command\n *\n * @export\n * @interface ISearchCommand\n */\nexport interface ISearchCommand extends ITargetedCommand {\n    /**\n     * The icon for this command\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    icon?: string;\n    iconClass?: string;\n    /**\n     * The name of the map layer this commmand applies to\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    layer: string;\n    /**\n     * The prompt to display in the search command UI\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    prompt: string;\n    /**\n     * The title to display in the search command UI\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    title: string;\n    /**\n     * The set of feature properties to show in the search results\n     *\n     * @type {ResultColumnSet}\n     * @memberof ISearchCommand\n     */\n    resultColumns: ResultColumnSet;\n    /**\n     * The search filter to apply based on user input\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    filter?: string;\n    /**\n     * The maximum number of results to return\n     *\n     * @type {number}\n     * @memberof ISearchCommand\n     */\n    matchLimit: number;\n}\n\n/**\n * Type alias for a dictionary-like structure\n */\nexport type Dictionary<T> = { [key: string]: T };\n\n/**\n * A 2d coordinate (renamed to Coordinate2D from Coordinate in 0.13)\n */\nexport type Coordinate2D = [number, number];\n\n/**\n * A size quantity\n * @since 0.13\n */\nexport type Size2 = [number, number];\n\n/**\n * A bounding box array\n */\nexport type Bounds = [number, number, number, number];\n\n/**\n * An active map viewer tool\n *\n * @export\n * @enum {number}\n */\nexport enum ActiveMapTool {\n    /**\n     * Zoom tool\n     */\n    Zoom,\n    /**\n     * Selection tool\n     */\n    Select,\n    /**\n     * Pan tool\n     */\n    Pan,\n    /**\n     * None\n     */\n    None,\n    /**\n     * Query WMS layers via GetFeatureInfo\n     * @since 0.13\n     */\n    WmsQueryFeatures\n}\n\n/**\n * Describes an external base layer\n *\n * @export\n * @interface IExternalBaseLayer\n */\nexport interface IExternalBaseLayer {\n    /**\n     * The name of the external base layer\n     *\n     * @type {string}\n     * @memberof IExternalBaseLayer\n     */\n    name: string;\n    /**\n     * The kind of external base layer\n     *\n     * @type {string}\n     * @memberof IExternalBaseLayer\n     */\n    kind: string;\n    /**\n     * Indicates if this external base layer is visible\n     *\n     * @type {boolean}\n     * @memberof IExternalBaseLayer\n     */\n    visible?: boolean;\n    /**\n     * Additional options for initializing the external base layer\n     *\n     * @type {*}\n     * @memberof IExternalBaseLayer\n     */\n    options?: any;\n}\n\n\n/**\n * Describes a menu entry on the Map Menu component\n *\n * @export\n * @interface IMapMenuEntry\n */\nexport interface IMapMenuEntry {\n    /**\n     * The runtime map name\n     *\n     * @type {string}\n     * @memberof IMapMenuEntry\n     */\n    mapName: string;\n    /**\n     * The menu entry label\n     *\n     * @type {string}\n     * @memberof IMapMenuEntry\n     */\n    label: string;\n}\n\n/**\n * A bit mask indicating how a map viewer should refresh\n *\n * @export\n * @enum {number}\n */\nexport enum RefreshMode {\n    /**\n     * Refresh only the layers\n     */\n    LayersOnly = 1,\n    /**\n     * Refresh only the selection\n     */\n    SelectionOnly = 2\n}\n\nexport type SelectionVariant = \"INTERSECTS\" | \"TOUCHES\" | \"WITHIN\" | \"ENVELOPEINTERSECTS\";\n\n/**\n * Describes the API for interacting with the map viewer\n *\n * @export\n * @interface IMapViewer\n */\nexport interface IMapViewer {\n    /**\n     * Gets the projection of the map\n     *\n     * @returns {ol.ProjectionLike}\n     *\n     * @memberof IMapViewer\n     */\n    getProjection(): ProjectionLike;\n    /**\n     * Gets the view for the given extent\n     *\n     * @param {Bounds} extent\n     * @returns {IMapView}\n     *\n     * @memberof IMapViewer\n     */\n    getViewForExtent(extent: Bounds): IMapView;\n    /**\n     * Gets the current extent\n     *\n     * @returns {Bounds}\n     *\n     * @memberof IMapViewer\n     */\n    getCurrentExtent(): Bounds;\n    /**\n     * Gets the current map view\n     *\n     * @returns {IMapView}\n     *\n     * @memberof IMapViewer\n     */\n    getCurrentView(): IMapView;\n    /**\n     * Gets the current physical size of the map\n     *\n     * @returns {[number, number]}\n     *\n     * @memberof IMapViewer\n     */\n    getSize(): [number, number];\n    /**\n     * Zooms to the specified map view\n     *\n     * @param {number} x\n     * @param {number} y\n     * @param {number} scale\n     *\n     * @memberof IMapViewer\n     */\n    zoomToView(x: number, y: number, scale: number): void;\n    /**\n     * Sets the selection XML\n     *\n     * @param {string} xml\n     * @param {IQueryMapFeaturesOptions} [queryOpts]\n     * @param {(res: QueryMapFeaturesResponse) => void} [success]\n     * @param {(err: Error) => void} [failure]\n     *\n     * @memberof IMapViewer\n     */\n    setSelectionXml(xml: string, queryOpts?: Partial<IQueryMapFeaturesOptions>, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void;\n    /**\n     * Refreshes the map\n     *\n     * @param {RefreshMode} [mode]\n     *\n     * @memberof IMapViewer\n     */\n    refreshMap(mode?: RefreshMode): void;\n    /**\n     * Gets the meters per unit value\n     *\n     * @returns {number}\n     *\n     * @memberof IMapViewer\n     */\n    getMetersPerUnit(): number;\n    /**\n     * Sets the active tool\n     *\n     * @param {ActiveMapTool} tool\n     *\n     * @memberof IMapViewer\n     */\n    setActiveTool(tool: ActiveMapTool): void;\n    /**\n     * Gets the active tool\n     *\n     * @returns {ActiveMapTool}\n     *\n     * @memberof IMapViewer\n     */\n    getActiveTool(): ActiveMapTool;\n    /**\n     * Sets the initial map view\n     *\n     *\n     * @memberof IMapViewer\n     */\n    initialView(): void;\n    /**\n     * Clears the map selection\n     *\n     *\n     * @memberof IMapViewer\n     */\n    clearSelection(): void;\n    /**\n     * Zooms in or out by the specified delta\n     *\n     * @param {number} delta\n     *\n     * @memberof IMapViewer\n     */\n    zoomDelta(delta: number): void;\n    /**\n     * Gets whether the viewer is currently in the state of digitizing\n     *\n     * @returns {boolean}\n     *\n     * @memberof IMapViewer\n     */\n    isDigitizing(): boolean;\n    /**\n     * Cancels active digitization\n     *\n     * @memberof IMapViewer\n     */\n    cancelDigitization(): void;\n    /**\n     * Starts the digitization process for a point\n     *\n     * @param {DigitizerCallback<olPoint>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizePoint(handler: DigitizerCallback<olPoint>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a line\n     *\n     * @param {DigitizerCallback<olLineString>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeLine(handler: DigitizerCallback<olLineString>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a line string\n     *\n     * @param {DigitizerCallback<olLineString>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeLineString(handler: DigitizerCallback<olLineString>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a circle\n     *\n     * @param {DigitizerCallback<olCircle>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeCircle(handler: DigitizerCallback<olCircle>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a rectangle\n     *\n     * @param {DigitizerCallback<olPolygon>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeRectangle(handler: DigitizerCallback<olPolygon>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a polygon\n     *\n     * @param {DigitizerCallback<olPolygon>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizePolygon(handler: DigitizerCallback<olPolygon>, prompt?: string): void;\n    /**\n     * Performs a map selection by the given geometry\n     *\n     * @param {olGeometry} geom The geometry to select with\n     * @param {SelectionVariant} selectionMethod The selection method\n     * @memberof IMapViewer\n     */\n    selectByGeometry(geom: olGeometry, selectionMethod?: SelectionVariant): void;\n    /**\n     * Performs a map selection by the given query options\n     *\n     * @param {IQueryMapFeaturesOptions} options\n     * @param {(res: QueryMapFeaturesResponse) => void} [success]\n     * @param {(err: Error) => void} [failure]\n     *\n     * @memberof IMapViewer\n     */\n    queryMapFeatures(options: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void;\n    /**\n     * Zooms to the specified extent\n     *\n     * @param {Bounds} extent\n     *\n     * @memberof IMapViewer\n     */\n    zoomToExtent(extent: Bounds): void;\n    /**\n     * Gets whether feature tooltips are enabled\n     *\n     * @returns {boolean}\n     *\n     * @memberof IMapViewer\n     */\n    isFeatureTooltipEnabled(): boolean;\n    /**\n     * Enables/disables feature tooltips\n     *\n     * @param {boolean} enabled\n     *\n     * @memberof IMapViewer\n     */\n    setFeatureTooltipEnabled(enabled: boolean): void;\n    /**\n     * Gets the current selection model\n     *\n     * @returns {QueryMapFeaturesResponse}\n     *\n     * @memberof IMapViewer\n     */\n    getSelection(): QueryMapFeaturesResponse | null;\n    /**\n     * Gets the current selection model as a selection XML string\n     *\n     * @param {FeatureSet} selection\n     * @param {string[]} [layerIds]\n     * @returns {string}\n     *\n     * @memberof IMapViewer\n     */\n    getSelectionXml(selection: FeatureSet, layerIds?: string[]): string;\n    /**\n     * Gets the layer manager for the given map. If map name is not specifed\n     * it will get the layer manager for the currently active map.\n     *\n     * @param {string} [mapName]\n     * @returns {ILayerManager}\n     * @memberof IMapViewer\n     * @since 0.12\n     */\n    getLayerManager(mapName?: string): ILayerManager;\n    /**\n     * Adds an OpenLayers interaction\n     *\n     * @template T\n     * @param {T} interaction\n     * @returns {T}\n     *\n     * @memberof IMapViewer\n     */\n    addInteraction<T extends olInteraction>(interaction: T): T;\n    /**\n     * Removes the given OpenLayers interaction\n     *\n     * @template T\n     * @param {T} interaction\n     *\n     * @memberof IMapViewer\n     */\n    removeInteraction<T extends olInteraction>(interaction: T): void;\n    /**\n     * Adds an OpenLayers overlay\n     *\n     * @param {olOverlay} overlay\n     *\n     * @memberof IMapViewer\n     */\n    addOverlay(overlay: olOverlay): void;\n    /**\n     * Removes the given OpenLayers overlay\n     *\n     * @param {olOverlay} overlay\n     *\n     * @memberof IMapViewer\n     */\n    removeOverlay(overlay: olOverlay): void;\n    /**\n     * Adds an event handler for the specified event\n     *\n     * @param {string} eventName\n     * @param {Function} handler\n     *\n     * @memberof IMapViewer\n     */\n    addHandler(eventName: string, handler: Function): void;\n    /**\n     * Removes an event handler for the specified event\n     *\n     * @param {string} eventName\n     * @param {Function} handler\n     *\n     * @memberof IMapViewer\n     */\n    removeHandler(eventName: string, handler: Function): void;\n    /**\n     * Gets the OL object factory\n     */\n    getOLFactory(): IOLFactory;\n    /**\n     * Gets the view resolution\n     *\n     * @returns {number}\n     *\n     * @memberof IMapViewer\n     */\n    getResolution(): number;\n    /**\n     * Gets the resolution for the given scale\n     *\n     * @returns {number}\n     *\n     * @memberof IMapViewer\n     */\n    scaleToResolution(scale: number): number;\n    /**\n     * Gets the name of the current runtime map\n     * \n     * @returns {string} \n     * @memberof IMapViewer\n     */\n    getMapName(): string;\n    /**\n     * Gets the current session id\n     * \n     * @returns {string}\n     * @memberof IMapViewer\n     */\n    getSessionId(): string;\n    /**\n     * Sets the current view rotation\n     * \n     * @param {number} rotation \n     * @memberof IMapViewer\n     */\n    setViewRotation(rotation: number): void;\n    /**\n     * Gets the current view rotation\n     * \n     * @returns {number} \n     * @memberof IMapViewer\n     */\n    getViewRotation(): number;\n    /**\n     * Gets whether view rotation is enabled\n     * \n     * @returns {boolean} \n     * @memberof IMapViewer\n     */\n    isViewRotationEnabled(): boolean;\n    /**\n     * Sets whether view rotation is enabled or not\n     * \n     * @param {boolean} enabled \n     * @memberof IMapViewer\n     */\n    setViewRotationEnabled(enabled: boolean): void;\n    /**\n     * \n     * @since 0.11\n     * @param {number} x \n     * @param {number} y \n     * @returns {[number, number]} \n     * @memberof IMapViewer\n     */\n    screenToMapUnits(x: number, y: number): [number, number];\n\n    toastSuccess(icon: string, message: string | JSX.Element): string | undefined;\n    toastWarning(icon: string, message: string | JSX.Element): string | undefined;\n    toastError(icon: string, message: string | JSX.Element): string | undefined;\n    toastPrimary(icon: string, message: string | JSX.Element): string | undefined;\n    dismissToast(key: string): void;\n    updateSize(): void;\n\n    /**\n     * Returns the collection of selected client-side vector features. This collection\n     * is observable, so you may hold onto a reference to this collection and subscribe\n     * to events on this collection for when new features are added or removed from this collection\n     * \n     * @returns {Collection<Feature>}\n     * @memberof IMapViewer\n     * @since 0.13\n     */\n    getSelectedFeatures(): Collection<Feature>;\n\n    /**\n     * INTERNAL API. Not for public use\n     * @hidden\n     */\n    addImageLoading(): void;\n    /**\n     * INTERNAL API. Not for public use\n     * @hidden\n     */\n    addImageLoaded(): void;\n    /**\n     * EXPERIMENTAL:\n     * Adds the given application state subscribers\n     * \n     * NOTE: Calling this method will trigger a re-render of the component. Due to this quirk, \n     * calling this method again while a re-render is taking place may cause the subscriber to\n     * not actually be registered. Calling this method multiple times in succession is therefore\n     * not advised. If you need to add multiple subscribers, pass an array of the subscribers to\n     * register in a single method call.\n     * \n     * @param props \n     * @since 0.13\n     */\n    addSubscribers(props: ISubscriberProps[]): string[];\n    /**\n     * EXPERIMENTAL:\n     * Removes application state subscribers of the given names\n     * \n     * @param name \n     * @since 0.13\n     */\n    removeSubscribers(names: string[]): boolean;\n    /**\n     * EXPERIMENTAL:\n     * Gets all application state subscriber names\n     * \n     * @since 0.13\n     */\n    getSubscribers(): string[];\n    /**\n     * Dispatches the given action\n     * \n     * @since 0.13\n     */\n    dispatch(action: any): void;\n}\n\n/**\n * WMS layer extension data\n * \n * @since 0.13\n */\nexport interface IWmsLayerExtensions {\n    type: \"WMS\";\n    getLegendUrl?: (resolution?: number) => string;\n}\n\n/**\n * Layer extension data\n * \n * @since 0.13\n */\nexport type LayerExtensions = IWmsLayerExtensions;\n\nexport interface ILayerInfo {\n    /**\n     * The name of the layer\n     * \n     * @type {string}\n     * @memberof ILayerInfo\n    * */\n    name: string;\n    /**\n     * The type of layer\n     * \n     * @type {string}\n     * @memberof ILayerInfo\n     */\n    type: string;\n    /**\n     * Indicates if this layer is an external layer\n     * \n     * @since 0.13\n     */\n    isExternal: boolean;\n    /** \n     * Indicates if this layer is visible\n     * \n     * @since 0.13\n     */\n    visible: boolean;\n    /**\n     * Indicates if this layer is selectable by the select tool\n     * \n     * @since 0.13\n     */\n    selectable: boolean;\n    /**\n     * The opacity of this layer\n     * \n     * @since 0.13\n     * @type {number}\n     * @memberof ILayerInfo\n     */\n    opacity: number;\n    /**\n     * Extension data for this layer\n     * \n     * @since 0.13\n     */\n    extensions?: LayerExtensions;\n    /**\n     * The vector style for this layer. Not applicable for raster layers.\n     * \n     * @since 0.13\n     */\n    vectorStyle?: IVectorFeatureStyle;\n    /**\n     * The busy worker count of this layer. If greater than 0, the layer\n     * is considered to be in the process of loading\n     * \n     * @since 0.13\n     */\n    busyWorkerCount: number;\n}\n\n/**\n * Options to add a new layer from parsed features\n * \n * @export\n * @interface IAddLayerFromParsedFeaturesOptions\n * @since 0.13\n */\nexport interface IAddLayerFromParsedFeaturesOptions {\n    projection?: ProjectionLike;\n    features: IParsedFeatures;\n}\n\n/**\n * Options for parsing features from a file\n * \n * @export\n * @interface IParseFeaturesFromFileOptions\n * @since 0.13\n */\nexport interface IParseFeaturesFromFileOptions {\n    file: File;\n    name: string;\n    locale: string;\n}\n\n/**\n * Manages custom layers for a map\n * \n * @export\n * @interface ILayerManager\n */\nexport interface ILayerManager {\n    /**\n     * Gets all custom layers on this map, sorted by draw order (First item is top-most layer. Last item is bottom-most layer.)\n     * \n     * @returns {ILayerInfo[]} \n     * @memberof ILayerManager\n    * */\n    getLayers(): ILayerInfo[];\n    /**\n     * Gets whether the specified custom layer exists on the map\n     */\n    hasLayer(name: string): boolean;\n    /**\n     * Adds a layer to the map\n     * \n     * @template T \n     * @param {string} name The name of the layer\n     * @param {T} layer The layer object\n     * @param {boolean} [allowReplace] If false or not set, this method will throw an error if a layer of the specified name already exists. Otherwise that layer will be replaced with the given layer\n     * @returns {T} The added layer\n     * @memberof ILayerManager\n     */\n    addLayer<T extends olLayerBase>(name: string, layer: T, allowReplace?: boolean): T;\n    /**\n     * Removes a layer by the given name\n     *\n     * @param {string} name\n     * @returns {(olLayerBase | undefined)}\n     *\n     * @memberof IMapViewer\n     */\n    removeLayer(name: string): olLayerBase | undefined;\n    /**\n     * Gets a layer by the given name\n     *\n     * @template T\n     * @param {string} name\n     * @returns {T}\n     *\n     * @memberof IMapViewer\n     */\n    getLayer<T extends olLayerBase>(name: string): T | undefined;\n\n    /**\n     * Attempts to parse features for the given input file. A failed attempt is when\n     * calling hasFeatures() on the returned parsed features returns false.\n     * \n     * @param {IParseFeaturesFromFileOptions} options\n     * @returns {Promise<IParsedFeatures>}\n     * @memberof ILayerManager\n     * @since 0.13\n     */\n    parseFeaturesFromFile(options: IParseFeaturesFromFileOptions): Promise<IParsedFeatures>;\n\n    /**\n     * Adds the given parsed features as a new external layer\n     * \n     * @param {IAddLayerFromParsedFeaturesOptions} options\n     * @returns {Promise<ILayerInfo>}\n     * @memberof ILayerManager\n     * @since 0.13\n     */\n    addLayerFromParsedFeatures(options: IAddLayerFromParsedFeaturesOptions): Promise<ILayerInfo>;\n\n    /**\n     * Applies draw order/opacity/visibility\n     * @hidden\n     */\n    apply(layers: ILayerInfo[]): void;\n}\n\n/**\n * Function signature for a digitization callback\n */\nexport type DigitizerCallback<T extends olGeometry> = (geom: T) => void;\n\n/**\n * Valid image formats\n */\nexport type ImageFormat = \"PNG\" | \"PNG8\" | \"JPG\" | \"GIF\";\n\n/**\n * The type of client\n */\nexport type ClientKind = \"mapagent\" | \"mapguide-rest\";\n\nexport interface IModalParameters {\n    title: string;\n    backdrop: boolean;\n    size: [number, number];\n    overflowYScroll?: boolean;\n}\n\n/**\n * The default modal dialog size\n */\nexport const DEFAULT_MODAL_SIZE: [number, number] = [350, 500];\n\n/**\n * Base modal display options\n *\n * @export\n * @interface IModalDisplayOptionsBase\n */\nexport interface IModalDisplayOptionsBase {\n    modal: IModalParameters;\n    name: string;\n}\n\n/**\n * Modal display options for URL content\n *\n * @export\n * @interface IModalDisplayOptions\n * @extends {IModalDisplayOptionsBase}\n */\nexport interface IModalDisplayOptions extends IModalDisplayOptionsBase {\n    /**\n     * The URL of the content to load in the modal dialog\n     *\n     * @type {string}\n     * @memberof IModalDisplayOptions\n     */\n    url: string;\n}\n\nexport interface IModalComponentDisplayOptions extends IModalDisplayOptionsBase {\n    /**\n     * The id of the component to display\n     *\n     * @type {string}\n     * @memberof IModalComponentDisplayOptions\n     */\n    component: string;\n    /**\n     * Component properties\n     *\n     * @type {*}\n     * @memberof IModalComponentDisplayOptions\n     */\n    componentProps?: any;\n}\n\nexport type IToolbarReducerState = any;\n\n/*\nexport interface IToolbarReducerState {\n\n}\n*/\n\n/**\n * Describes the reducer state branch for Task Pane component\n *\n * @export\n * @interface ITaskPaneReducerState\n */\nexport interface ITaskPaneReducerState {\n    /**\n     * The current navigation index\n     *\n     * @type {number}\n     * @memberof ITaskPaneReducerState\n     */\n    navIndex: number;\n    /**\n     * The current navigation history stack\n     *\n     * @type {string[]}\n     * @memberof ITaskPaneReducerState\n     */\n    navigation: string[];\n    /**\n     * The initial URL\n     *\n     * @type {(string | undefined)}\n     * @memberof ITaskPaneReducerState\n     */\n    initialUrl: string | undefined;\n    /**\n     * The last pushed URL\n     *\n     * @type {boolean}\n     * @memberof ITaskPaneReducerState\n     */\n    lastUrlPushed: boolean;\n}\n\nexport type IModalReducerState = {\n    /**\n     * Gets the modal parameters for the given key\n     */\n    [key: string]: IModalDisplayOptions | IModalComponentDisplayOptions;\n};\n\n/*\nexport interface IModalReducerState {\n\n}\n*/\n\nexport type LayerTransparencySet = { [layerName: string]: number };\n\nexport interface ActiveSelectedFeature {\n    /**\n     * The selected layer id\n     * \n     * @type {string}\n     */\n    layerId: string;\n    /**\n     * The selection key of the feature\n     * \n     * @type {string}\n     */\n    selectionKey: string;\n}\n\n/**\n * Describes the reducer state branch for a runtime map\n *\n * @export\n * @interface IBranchedMapSubState\n */\nexport interface IBranchedMapSubState {\n    /**\n     * The external base layers for the runtime map\n     *\n     * @type {IExternalBaseLayer[]}\n     * @memberof IBranchedMapSubState\n     */\n    externalBaseLayers: IExternalBaseLayer[];\n    /**\n     * The layers in this viewer. First item is top-most layer. Last item is bottom-most layer.\n     * @since 0.13\n     */\n    layers: ILayerInfo[];\n    /**\n     * The current map view\n     *\n     * @type {(IMapView | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    currentView: IMapView | undefined;\n    /**\n     * The initial map view\n     *\n     * @type {(IMapView | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    initialView: IMapView | undefined;\n    /**\n     * The view navigation history stack\n     *\n     * @type {IMapView[]}\n     * @memberof IBranchedMapSubState\n     */\n    history: IMapView[];\n    /**\n     * The current position in the view navigation history stack\n     *\n     * @type {number}\n     * @memberof IBranchedMapSubState\n     */\n    historyIndex: number;\n    /**\n     * The runtime map state\n     *\n     * @type {(RuntimeMap | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    runtimeMap: RuntimeMap | undefined;\n    /**\n     * A set of selectable layer ids\n     *\n     * @type {*}\n     * @memberof IBranchedMapSubState\n     */\n    selectableLayers: any;\n    /**\n     * A set of expanded group ids\n     *\n     * @type {*}\n     * @memberof IBranchedMapSubState\n     */\n    expandedGroups: any;\n    /**\n     * The current selection state\n     *\n     * @type {(QueryMapFeaturesResponse | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    selectionSet: QueryMapFeaturesResponse | undefined;\n    /**\n     * The current selected layer index\n     *\n     * @type {number}\n     * @memberof IBranchedMapSubState\n     */\n    layerIndex: number;\n    /**\n     * The current selected feature index\n     *\n     * @type {number}\n     * @memberof IBranchedMapSubState\n     */\n    featureIndex: number;\n    /**\n     * The array of ids of layers to show\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    showLayers: string[];\n    /**\n     * The array of ids of groups to show\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    showGroups: string[];\n    /**\n     * The array of ids of layers to hide\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    hideLayers: string[];\n    /**\n     * The array of ids of groups to hide\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    hideGroups: string[];\n    /**\n     * Layer transparency settings\n     * \n     * @type {{ [layerName: string]: number }}\n     * @memberof IBranchedMapSubState\n     */\n    layerTransparency: LayerTransparencySet;\n    /**\n     * The active selected feature to highlight\n     * \n     * @type {(ActiveSelectedFeature | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    activeSelectedFeature: ActiveSelectedFeature | undefined\n}\n\n/**\n * The reducer state branch for runtime map state. Map-specific state is keyed on\n * their respective runtime map name as sub-branches on this branch\n *\n * @export\n * @interface IBranchedMapState\n */\nexport interface IBranchedMapState {\n    [mapName: string]: IBranchedMapSubState;\n}\n\n/**\n * Coordinate display configuration\n *\n * @export\n * @interface ICoordinateConfiguration\n */\nexport interface ICoordinateConfiguration {\n    /**\n     * The number of decimal places to show\n     *\n     * @type {number}\n     * @memberof ICoordinateConfiguration\n     */\n    decimals: number;\n    /**\n     * The display projection for these coordinates\n     * \n     * @type {string}\n     * @memberof ICoordinateConfiguration\n     */\n    projection: string;\n    /**\n     * Display format string\n     * \n     * @type {string}\n     * @memberof ICoordinateConfiguration\n     */\n    format?: string;\n}\n\n/**\n * Describes the capabilities of the current view\n *\n * @export\n * @interface IViewerCapabilities\n */\nexport interface IViewerCapabilities {\n    /**\n     * Indicates if this viewer as a Task Pane component mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasTaskPane: boolean;\n    /**\n     * Indicates if the Task Pane on this viewer has a Task Bar\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasTaskBar: boolean;\n    /**\n     * Indicates if this viewer has a status bar\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasStatusBar: boolean;\n    /**\n     * Indicates if this viewer has a zoom slider\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasNavigator: boolean;\n    /**\n     * Indicates if this viewer has a selection panel component mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasSelectionPanel: boolean;\n    /**\n     * Indicates if this viewer has a legend component mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasLegend: boolean;\n    /**\n     * Indicates if this viewer has a primary toolbar mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasToolbar: boolean;\n    /**\n     * Indicates if this viewer has the view size mounted\n     * \n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasViewSize: boolean;\n}\n\n/**\n * Describes a name/value pair\n *\n * @export\n * @interface INameValuePair\n */\nexport interface INameValuePair {\n    /**\n     * The name\n     *\n     * @type {string}\n     * @memberof INameValuePair\n     */\n    name: string;\n    /**\n     * The value\n     *\n     * @type {string}\n     * @memberof INameValuePair\n     */\n    value: string;\n}\n\n/**\n * Describes a redux reducer function\n */\nexport type ReducerFunction<TState> = (state: TState, action: ViewerAction) => TState;\n\n/**\n * Describes the reducer state branch for the current viewer template\n *\n * @export\n * @interface ITemplateReducerState\n */\nexport interface ITemplateReducerState {\n    /**\n     * The initial width of the information pane. Only certain templates will recognise this setting\n     * \n     * @type {number}\n     * @memberof ITemplateReducerState\n     */\n    initialInfoPaneWidth: number;\n    /**\n     * The initial width of the task pane. Only certain templates will recognise this setting\n     * \n     * @type {number}\n     * @memberof ITemplateReducerState\n     */\n    initialTaskPaneWidth: number;\n    /**\n     * Indicates if the task pane is visible\n     *\n     * @type {boolean}\n     * @memberof ITemplateReducerState\n     */\n    taskPaneVisible: boolean;\n    /**\n     * Indicates if the legend is visible\n     *\n     * @type {boolean}\n     * @memberof ITemplateReducerState\n     */\n    legendVisible: boolean;\n    /**\n     * Indicates if the selection panel is visible\n     *\n     * @type {boolean}\n     * @memberof ITemplateReducerState\n     */\n    selectionPanelVisible: boolean;\n    /**\n     * If true, the selection panel will auto-display when a selection is made\n     * and there are results to show\n     * \n     * @since 0.13\n     */\n    autoDisplaySelectionPanelOnSelection: boolean;\n}\n\n/**\n * Signature for a template state reducer function\n * \n * @since 0.13\n */\nexport type TemplateReducerFunction = (origState: ITemplateReducerState, currentState: ITemplateReducerState, action: ViewerAction) => ITemplateReducerState;\n\nexport const KC_ESCAPE = 27;\nexport const KC_U = 85;\n\nexport type MapLoadIndicatorPositioning = \"top\" | \"bottom\";\n\n/**\n * Describes the reducer state branch for various configuration properties\n *\n * @export\n * @interface IConfigurationReducerState\n */\nexport interface IConfigurationReducerState {\n    /**\n     * The agent URI\n     *\n     * @type {(string | undefined)}\n     * @memberof IConfigurationReducerState\n     */\n    agentUri: string | undefined;\n    /**\n     * The type of agent\n     *\n     * @type {ClientKind}\n     * @memberof IConfigurationReducerState\n     */\n    agentKind: ClientKind;\n    /**\n     * The current locale\n     *\n     * @type {string}\n     * @memberof IConfigurationReducerState\n     */\n    locale: string;\n    /**\n     * The current active map name\n     *\n     * @type {(string | undefined)}\n     * @memberof IConfigurationReducerState\n     */\n    activeMapName: string | undefined;\n    /**\n     * The array of available runtime maps\n     *\n     * @type {(INameValuePair[] | undefined)}\n     * @memberof IConfigurationReducerState\n     */\n    availableMaps: INameValuePair[] | undefined;\n    /**\n     * Coordinate display configuration\n     *\n     * @type {ICoordinateConfiguration}\n     * @memberof IConfigurationReducerState\n     */\n    coordinates: ICoordinateConfiguration;\n    /**\n     * Viewer capabilities\n     *\n     * @type {IViewerCapabilities}\n     * @memberof IConfigurationReducerState\n     */\n    capabilities: IViewerCapabilities;\n    /**\n     * Viewer configuration\n     *\n     * @type {{\n     *         imageFormat: ImageFormat;\n     *         selectionImageFormat: ImageFormat;\n     *         selectionColor: string;\n     *         pointSelectionBuffer: number;\n     *     }}\n     * @memberof IConfigurationReducerState\n     */\n    viewer: {\n        /**\n         * The current image format\n         *\n         * @type {ImageFormat}\n         */\n        imageFormat: ImageFormat;\n        /**\n         * The current selection image format\n         *\n         * @type {ImageFormat}\n         */\n        selectionImageFormat: ImageFormat;\n        /**\n         * The current selection color\n         *\n         * @type {string}\n         */\n        selectionColor: string;\n        /**\n         * The color to use for highlighting active selected features\n         * \n         * @type {string}\n         */\n        activeSelectedFeatureColor: string;\n        /**\n         * The current point selection pixel tolerance\n         *\n         * @type {number}\n         */\n        pointSelectionBuffer: number;\n        /**\n         * The position of the map loading indicator\n         * \n         * @type {MapLoadIndicatorPositioning}\n         */\n        loadIndicatorPositioning: MapLoadIndicatorPositioning;\n        /**\n         * The color of the map loading indicator. This is an valid CSS color expression\n         * \n         * @type {string}\n         */\n        loadIndicatorColor: string;\n    },\n    /**\n     * Indicates if view rotation is enabled\n     * \n     * @type {boolean}\n     * @memberof IConfigurationReducerState\n     */\n    viewRotationEnabled: boolean;\n    /**\n     * The current view rotation\n     * \n     * @type {number}\n     * @memberof IConfigurationReducerState\n     */\n    viewRotation: number;\n    /**\n     * The unit to display view size in\n     * \n     * @type {UnitOfMeasure}\n     * @memberof IConfigurationReducerState\n     */\n    viewSizeUnits: UnitOfMeasure;\n    /**\n     * If specified and true and the MapTip component is active, then feature tooltips are activated\n     * by mouse click instead of idle mouse cursor at a given point on the map for a certain period of time. \n     * \n     * An active MapTip component with this setting enabled will override normal click-based selection.\n     * \n     * @type {boolean}\n     * @memberof IConfigurationReducerState\n     */\n    manualFeatureTooltips: boolean;\n    /**\n     * The key code to listen for cancelling an active digitization\n     * \n     * @type {number}\n     * @memberof IKeyBindingConfiguration\n     */\n    cancelDigitizationKey: number;\n    /**\n     * The key code to listen for undoing the last drawn point of an active digitization\n     * \n     * @type {number}\n     * @memberof IKeyBindingConfiguration\n     */\n    undoLastPointKey: number;\n}\n\n/**\n * Describes an error thrown during initialization\n *\n * @export\n * @interface InitError\n */\nexport interface InitError {\n    /**\n     * The error message\n     *\n     * @type {string}\n     * @memberof InitError\n     */\n    message: string;\n    /**\n     * The error stack trace\n     *\n     * @type {string[]}\n     * @memberof InitError\n     */\n    stack: string[];\n}\n\n/**\n * Describes the reducer state branch for initialization errors\n *\n * @export\n * @interface IInitErrorReducerState\n */\nexport interface IInitErrorReducerState {\n    /**\n     * The caught initialization error\n     *\n     * @type {(InitError | undefined)}\n     * @memberof IInitErrorReducerState\n     */\n    error: InitError | undefined;\n    /**\n     * The initialization options\n     *\n     * @type {*}\n     * @memberof IInitErrorReducerState\n     */\n    options: any;\n    /**\n     * Indicates if the stack trace should be shown\n     *\n     * @type {boolean}\n     * @memberof IInitErrorReducerState\n     */\n    includeStack: boolean;\n    /**\n     * Any warnings that were encountered during initialization\n     * \n     * @type {string[]}\n     * @memberof IInitErrorReducerState\n     */\n    warnings: string[];\n}\n\n/**\n * Describes the reducer state branch for viewer state\n *\n * @export\n * @interface IViewerReducerState\n */\nexport interface IViewerReducerState {\n    /**\n     * The current size of the map viewport (in pixels)\n     * \n     * @type {([number, number] | undefined)}\n     * @memberof IViewerReducerState\n     */\n    size: [number, number] | undefined;\n    /**\n     * The number of active busy actions. Zero indicates no busy activity. One or more\n     * indicates busy activity.\n     *\n     * @type {number}\n     * @memberof IViewerReducerState\n     */\n    busyCount: number;\n    /**\n     * The active map tool\n     *\n     * @type {ActiveMapTool}\n     * @memberof IViewerReducerState\n     */\n    tool: ActiveMapTool;\n    /**\n     * Indicates if feature tooltips are enabled\n     *\n     * @type {boolean}\n     * @memberof IViewerReducerState\n     */\n    featureTooltipsEnabled: boolean;\n}\n\n/**\n * Describes the reducer state branch for tracked mouse coordinates\n *\n * @export\n * @interface IMouseReducerState\n */\nexport interface IMouseReducerState {\n    /**\n     * The last tracked mouse coordinate\n     *\n     * @type {(Coordinate2D | undefined)}\n     * @memberof IMouseReducerState\n     */\n    coords: Coordinate2D | undefined;\n}\n\n/**\n * Describes the full application state tree. Redux-aware components can connect and subscribe to\n * various properties and branches of this tree and be automatically notified of any changes and\n * update and re-render themselves accordingly\n *\n * @export\n * @interface IApplicationState\n */\nexport interface IApplicationState {\n    /**\n     * Initialization errors\n     *\n     * @type {Readonly<IInitErrorReducerState>}\n     * @memberof IApplicationState\n     */\n    initError: Readonly<IInitErrorReducerState>;\n    /**\n     * Viewer configuration\n     *\n     * @type {Readonly<IConfigurationReducerState>}\n     * @memberof IApplicationState\n     */\n    config: Readonly<IConfigurationReducerState>;\n    /**\n     * Current template state\n     *\n     * @type {Readonly<ITemplateReducerState>}\n     * @memberof IApplicationState\n     */\n    template: Readonly<ITemplateReducerState>;\n    /**\n     * Viewer state\n     *\n     * @type {Readonly<IViewerReducerState>}\n     * @memberof IApplicationState\n     */\n    viewer: Readonly<IViewerReducerState>;\n    /**\n     * Runtime map state\n     *\n     * @type {Readonly<IBranchedMapState>}\n     * @memberof IApplicationState\n     */\n    mapState: Readonly<IBranchedMapState>;\n    /**\n     * Toolbar state\n     *\n     * @type {Readonly<IToolbarReducerState>}\n     * @memberof IApplicationState\n     */\n    toolbar: Readonly<IToolbarReducerState>;\n    /**\n     * Task Pane component state\n     *\n     * @type {Readonly<ITaskPaneReducerState>}\n     * @memberof IApplicationState\n     */\n    taskpane: Readonly<ITaskPaneReducerState>;\n    /**\n     * Modal dialog state\n     *\n     * @type {Readonly<IModalReducerState>}\n     * @memberof IApplicationState\n     */\n    modal: Readonly<IModalReducerState>;\n    /**\n     * Tracked mouse coordinate state\n     *\n     * @type {Readonly<IMouseReducerState>}\n     * @memberof IApplicationState\n     */\n    mouse: Readonly<IMouseReducerState>;\n    /**\n     * Tracks the last dispatched action\n     *\n     * @type {*}\n     * @memberof IApplicationState\n     */\n    lastaction: any;\n}\n\n// Redux typedefs to tighten up our redux code\n\n/**\n * Describes the redux store\n *\n * @export\n * @interface ReduxStore\n */\nexport interface ReduxStore {\n    /**\n     * Gets the application state\n     *\n     * @returns {Readonly<IApplicationState>}\n     *\n     * @memberof ReduxStore\n     */\n    getState(): Readonly<IApplicationState>;\n}\n\n/**\n * Describes a thunked redux action. Thunked redux actions are generally used for actions that push state\n * asynchronously (eg. In response to an AJAX request)\n */\nexport type ReduxThunkedAction = (dispatch: ReduxDispatch, getState: () => Readonly<IApplicationState>) => any;\n\n/**\n * Describes a redux dispatcher function. A redux dispatch pushes new state to the redux store\n */\nexport type ReduxDispatch = (action: ViewerAction | ReduxThunkedAction) => void;\n\n/**\n * A function that does nothing\n *\n * @export\n */\nexport function NOOP() { }\n\n/**\n * A function that always returns false\n *\n * @export\n * @returns false\n */\nexport function ALWAYS_FALSE() { return false; }\n\n/**\n * A function that always returns true\n *\n * @export\n * @returns true\n */\nexport function ALWAYS_TRUE() { return true; }\n\n/**\n * Describe the size/dimensions of a DOM element in a toolbar or flyout menu\n *\n * @export\n * @interface IDOMElementMetrics\n */\nexport interface IDOMElementMetrics {\n    /**\n     * The X position of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    posX: number;\n    /**\n     * The Y position of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    posY: number;\n    /**\n     * The width of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    width: number;\n    /**\n     * The height of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    height: number;\n    /**\n     * Indicates of this toolbar is vertically-oriented\n     *\n     * @type {boolean}\n     * @memberof IDOMElementMetrics\n     */\n    vertical?: boolean;\n}\n\n/**\n * Helper function to get the initial map view from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(IMapView | undefined)}\n */\nexport function getInitialView(state: Readonly<IApplicationState>): IMapView | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].initialView;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the current selection set from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(QueryMapFeaturesResponse | undefined)}\n */\nexport function getSelectionSet(state: Readonly<IApplicationState>): QueryMapFeaturesResponse | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].selectionSet;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the current runtime map state from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(RuntimeMap | undefined)}\n */\nexport function getRuntimeMap(state: Readonly<IApplicationState>): RuntimeMap | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].runtimeMap;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the current view from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(IMapView | undefined)}\n */\nexport function getCurrentView(state: Readonly<IApplicationState>): IMapView | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].currentView;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the current set of available external base layers from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(IExternalBaseLayer[] | undefined)}\n */\nexport function getExternalBaseLayers(state: Readonly<IApplicationState>): IExternalBaseLayer[] | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].externalBaseLayers;\n    }\n    return undefined;\n}\n\n/**\n * Defines the visibility of flyout menus\n */\nexport type FlyoutVisibilitySet = { [flyoutId: string]: boolean | undefined };\n\n/**\n * Defines the capabilities of a WMS service\n * \n * @since 0.11\n */\nexport interface WmsCapabilitiesDocument {\n    /**\n     * WMS service version\n     * \n     * @type {string}\n     * @memberof WmsCapabilitiesDocument\n     */\n    version: string;\n    Service: WMSServiceDescription;\n    Capability: WMSServiceCapabilities;\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSServiceCapabilities {\n    Request: any;\n    Exception: string[];\n    Layer: WMSRootPublishedLayer;\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSLayerBoundingBox {\n    crs: string;\n    extent: [number, number, number, number],\n    res: [any, any]\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSPublishedLayer {\n    Name: string;\n    Title: string;\n    Abstract: string;\n    KeywordList: string;\n    CRS: string[];\n    EX_GeographicBoundingBox: [number, number, number, number];\n    BoundingBox: WMSLayerBoundingBox[];\n    Style: WMSLayerStyle[];\n    queryable: boolean;\n    opaque: boolean;\n    noSubsets: boolean;\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSRootPublishedLayer extends WMSPublishedLayer {\n    Layer: WMSPublishedLayer[];\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSLegendURLDefinition {\n    Format: string;\n    OnlineResource: string;\n    size: [number, number];\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSLayerStyle {\n    Name: string;\n    Title: string;\n    Abstract: string;\n    LegendURL: WMSLegendURLDefinition[];\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSContactAddress {\n    AddressType: string,\n    Address: string,\n    City: string,\n    StateOrProvince: string,\n    PostCode: string,\n    Country: string\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSContact {\n    ContactPerson: string;\n    ContactOrganization: string;\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSContactInformation {\n    ContactPersonPrimary: WMSContact,\n    ContactPosition: string,\n    ContactAddress: WMSContactAddress,\n    ContactVoiceTelephone: string,\n    ContactFacsimileTelephone: string,\n    ContactElectronicMailAddress: string\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSServiceDescription {\n    Name: string;\n    Title: string;\n    Abstract: string;\n    KeywordList: string[];\n    OnlineResource: string;\n    ContactInformation: WMSContactInformation,\n    Fees: string;\n    AccessConstraints: string;\n}\n\nexport interface IMapGuideImageSource {\n    on(event: string, handler: Function): void;\n    updateParams(params: any): void;\n}\n\nexport interface MapGuideImageSourceOptions {\n    /**\n     * The mapagent url.\n     */\n    url?: string;\n    /**\n     * The display resolution. Default is `96`.\n     */\n    displayDpi?: number;\n    /**\n     * The meters-per-unit value. Default is `1`.\n     */\n    metersPerUnit?: number;\n    /**\n     * Use the `ol.Map#pixelRatio` value when requesting the image from the remote\n     * server. Default is `true`.\n     */\n    hidpi?: boolean;\n    /**\n     * If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n     */\n    useOverlay?: boolean;\n    /**\n     * Projection.\n     */\n    projection?: ProjectionLike;\n    /**\n     * Ratio. `1` means image requests are the size of the map viewport, `2` means\n     * twice the width and height of the map viewport, and so on. Must be `1` or\n     * higher. Default is `1`.\n     */\n    ratio?: number;\n    /**\n     * Resolutions. If specified, requests will be made for these resolutions only.\n     */\n    resolutions?: number[];\n    /**\n     * Optional function to load an image given a URL.\n     */\n    imageLoadFunction?: LoadFunction;\n    /**\n     * Additional parameters.\n     */\n    params?: any;\n    crossOrigin?: string;\n    defaultImageLoadFunction?: LoadFunction;\n}\n\n/**\n * Custom properties that can be attached to OpenLayers layer instances\n * \n * @since 0.13\n */\nexport enum LayerProperty {\n    LAYER_TYPE = \"layer_type\",\n    LAYER_NAME = \"name\",\n    IS_GROUP = \"is_group\",\n    IS_EXTERNAL = \"is_external\",\n    IS_SELECTABLE = \"is_selectable\",\n    IS_SCRATCH = \"is_scratch\",\n    HAS_WMS_LEGEND = \"has_wms_legend\",\n    VECTOR_STYLE = \"vector_style\",\n    WGS84_BBOX = \"wgs84_bbox\",\n    BUSY_WORKER_COUNT = \"busy_worker_count\"\n}\n\n/**\n * Custom properties that can be attached to OpenLayers image source instances\n * \n * @since 0.13\n */\nexport enum SourceProperty {\n    SUPPRESS_LOAD_EVENTS = \"suppress_load_events\"\n}\n\n/**\n * MapGuide layer types\n * \n * @since 0.13\n */\nexport enum MgLayerType {\n    Untiled = \"MapGuide_Untiled\",\n    Tiled = \"MapGuide_Tiled\"\n}\n\n/**\n * The type name for a MapGuide layer\n * \n * @since 0.13\n */\nexport const MG_LAYER_TYPE_NAME = \"MapGuide\";\n\n/**\n * The default group name for MapGuide tiled layers. This value\n * is not meant for localized display\n * \n * @since 0.13\n */\nexport const MG_BASE_LAYER_GROUP_NAME = \"Base Tile Layers\";\n\n/**\n * Default names for MapGuide built-in layer types. These value\n * are not meant for localized display\n * \n * @since 0.13\n */\nexport enum MgBuiltInLayers {\n    Overlay = \"MapGuide Dynamic Overlay\",\n    SelectionOverlay = \"MapGuide Selection Overlay\",\n    ActiveFeatureSelectionOverlay = \"MapGuide Active Feature Selection Overlay\"\n}","/**\n * All valid action types\n * \n * @since 0.12\n */\nexport enum ActionType {\n    SET_LOCALE = 'MapGuide/SET_LOCALE',\n    \n    INIT_APP = 'MapGuide/INIT_APP',\n    INIT_ERROR = 'MapGuide/INIT_ERROR',\n    INIT_ACKNOWLEDGE_WARNINGS = 'MapGuide/INIT_ACKNOWLEDGE_WARNINGS',\n\n    LEGEND_SET_GROUP_VISIBILITY = 'Legend/SET_GROUP_VISIBILITY',\n    LEGEND_SET_LAYER_VISIBILITY = 'Legend/SET_LAYER_VISIBILITY',\n    LEGEND_SET_LAYER_SELECTABLE = 'Legend/SET_LAYER_SELECTABLE',\n    LEGEND_SET_GROUP_EXPANDABLE = 'Legend/SET_GROUP_EXPANDABLE',\n\n    MAP_SET_ACTIVE_MAP = 'Map/SET_ACTIVE_MAP',\n    MAP_REFRESH = 'Map/REFRESH',\n    MAP_SET_VIEW = 'Map/SET_VIEW',\n    MAP_SET_SCALE = 'Map/SET_SCALE',\n    MAP_SET_ACTIVE_TOOL = 'Map/SET_ACTIVE_TOOL',\n    MAP_SET_MAPTIP = 'Map/SET_MAPTIP',\n    MAP_SET_MANUAL_MAPTIP = 'Map/MAP_SET_MANUAL_MAPTIP',\n    MAP_SET_SELECTION = 'Map/SET_SELECTION',\n    MAP_SET_BUSY_COUNT = 'Map/SET_BUSY_COUNT',\n    MAP_SET_BASE_LAYER = 'Map/SET_BASE_LAYER',\n    MAP_ZOOM_IN = 'Map/ZOOM_IN',\n    MAP_ZOOM_OUT = 'Map/ZOOM_OUT',\n    MAP_PREVIOUS_VIEW = 'Map/PREVIOUS_VIEW',\n    MAP_NEXT_VIEW = 'Map/NEXT_VIEW',\n    MAP_SET_LAYER_TRANSPARENCY = 'Map/SET_LAYER_TRANSPARENCY',\n    MAP_SET_VIEW_SIZE_UNITS = 'Map/SET_VIEW_SIZE_UNITS',\n    MAP_SET_VIEW_ROTATION = 'Map/SET_VIEW_ROTATION',\n    MAP_SET_VIEW_ROTATION_ENABLED = 'Map/SET_VIEW_ROTATION_ENABLED',\n    MAP_RESIZED = 'Map/RESIZED',\n    MAP_SHOW_SELECTED_FEATURE = 'Map/SHOW_SELECTED_FEATURE',\n\n    TASK_INVOKE_URL = 'TaskPane/INVOKE_URL',\n    TASK_PANE_HOME = 'TaskPane/HOME',\n    TASK_PANE_FORWARD = 'TaskPane/FORWARD',\n    TASK_PANE_BACK = 'TaskPane/BACK',\n    TASK_PANE_PUSH_URL = 'TaskPane/PUSH_URL',\n\n    FUSION_SET_ELEMENT_STATE = 'Fusion/SET_ELEMENT_STATE',\n    FUSION_SET_TASK_PANE_VISIBILITY = 'Fusion/SET_TASK_PANE_VISIBILITY',\n    FUSION_SET_LEGEND_VISIBILITY = 'Fusion/SET_LEGEND_VISIBILITY',\n    FUSION_SET_SELECTION_PANEL_VISIBILITY = 'Fusion/SET_SELECTION_PANEL_VISIBILITY',\n    //FUSION_SET_OVERVIEW_MAP_VISIBILITY = 'Fusion/SET_OVERVIEW_MAP_VISIBILITY',\n    FLYOUT_OPEN = 'Flyout/OPEN',\n    FLYOUT_CLOSE = 'Flyout/CLOSE',\n    CONTEXT_MENU_OPEN  = 'ContextMenu/OPEN',\n    CONTEXT_MENU_CLOSE = 'ContextMenu/CLOSE',\n    COMPONENT_OPEN = 'Flyout/COMPONENT_OPEN',\n    COMPONENT_CLOSE = 'Flyout/COMPONENT_CLOSE',\n    UPDATE_MOUSE_COORDINATES = 'Status/UPDATE_MOUSE_COORDINATES',\n    MODAL_SHOW_COMPONENT = 'Modal/SHOW_COMPONENT',\n    MODAL_SHOW_URL = 'Modal/SHOW_URL',\n    MODAL_CLOSE = 'Modal/CLOSE',\n\n    /**\n     * @since 0.13\n     */\n    LAYER_ADDED = 'Map/LAYER_ADDED',\n    /**\n     * @since 0.13\n     */\n    REMOVE_LAYER = 'Map/REMOVE_LAYER',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_INDEX = 'Map/SET_LAYER_INDEX',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_OPACITY = 'Map/SET_LAYER_OPACITY',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_VISIBILITY = 'Map/SET_LAYER_VISIBILITY',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_VECTOR_STYLE = 'Map/SET_LAYER_VECTOR_STYLE',\n    /**\n     * @since 0.13\n     */\n    ADD_LAYER_BUSY_WORKER = 'Map/ADD_LAYER_BUSY_WORKER',\n    /**\n     * @since 0.13\n     */\n    REMOVE_LAYER_BUSY_WORKER = 'Map/REMOVE_LAYER_BUSY_WORKER'\n}","import { IApplicationState, IMapView, UnitOfMeasure, getRuntimeMap, getCurrentView, IExternalBaseLayer, Coordinate2D } from '../api/common';\nimport { useSelector } from 'react-redux';\nimport { RuntimeMap, getExternalBaseLayers, INameValuePair, ActiveSelectedFeature, LayerTransparencySet, QueryMapFeaturesResponse, ActiveMapTool, ClientKind, ImageFormat, MapLoadIndicatorPositioning, getSelectionSet, IViewerCapabilities, InitError, IBranchedMapState, IBranchedMapSubState, IToolbarAppState, reduceAppToToolbarState, ILayerInfo } from '../api';\nimport { WEBLAYOUT_CONTEXTMENU } from '../constants';\nimport { useRef, useEffect } from \"react\";\nimport { areArraysDifferent } from \"../utils/array\";\n\n// From: https://usehooks.com/usePrevious/\n\nexport function usePrevious<T>(value: T) {\n    // The ref object is a generic container whose current property is mutable ...\n    // ... and can hold any value, similar to an instance property on a class\n    const ref = useRef<T>();\n\n    // Store current value in ref\n    useEffect(() => {\n        ref.current = value;\n    }, [value]); // Only re-run if value changes\n\n    // Return previous value (happens before update in useEffect above)\n    return ref.current;\n}\n\nexport function useActiveMapName() {\n    return useSelector<IApplicationState, string | undefined>(state => state.config.activeMapName);\n}\n\nexport function useActiveMapSessionId() {\n    return useSelector<IApplicationState, string | undefined>(state => getRuntimeMap(state)?.SessionId);\n}\n\nexport function useActiveMapLayers() {\n    return useSelector<IApplicationState, ILayerInfo[] | undefined>(state => {\n        if (state.config.activeMapName) {\n            return state.mapState[state.config.activeMapName].layers;\n        }\n        return undefined;\n    }, (left, right) => !areArraysDifferent(left, right, (l, r) => {\n        return l.name == r.name\n            && l.opacity == r.opacity\n            && l.visible == r.visible\n            && l.vectorStyle == r.vectorStyle;\n    }));\n}\n\nexport function useViewerLocale() {\n    return useSelector<IApplicationState, string>(state => state.config.locale);\n}\n\nexport function useActiveMapView() {\n    return useSelector<IApplicationState, IMapView | undefined>(state => {\n        return getCurrentView(state);\n    });\n}\n\nexport function useActiveMapWidth() {\n    return useSelector<IApplicationState, number | undefined>(state => state.viewer?.size?.[0]);\n}\n\nexport function useActiveMapHeight() {\n    return useSelector<IApplicationState, number | undefined>(state => state.viewer?.size?.[1]);\n}\n\nexport function useViewerSizeUnits() {\n    return useSelector<IApplicationState, UnitOfMeasure>(state => state.config.viewSizeUnits);\n}\n\nexport function useActiveMapMetersPerUnit() {\n    return useSelector<IApplicationState, number | undefined>(state => {\n        let mpu = 1.0;\n        if (state.config.activeMapName) {\n            const ms = state.mapState[state.config.activeMapName];\n            if (ms.runtimeMap) {\n                mpu = ms.runtimeMap.CoordinateSystem.MetersPerUnit;\n            }\n        }\n        return mpu;\n    });\n}\n\nexport function useActiveMapFiniteScales() {\n    return useSelector<IApplicationState, number[] | undefined>(state => {\n        const map = getRuntimeMap(state);\n        return map != null ? map.FiniteDisplayScale : undefined;\n    });\n}\n\nexport function useActiveMapExternalBaseLayers() {\n    return useSelector<IApplicationState, IExternalBaseLayer[] | undefined>(state => getExternalBaseLayers(state));\n}\n\nexport function useActiveMapProjection() {\n    return useSelector<IApplicationState, string | undefined>(state => {\n        let proj;\n        if (state.config.activeMapName) {\n            const map = state.mapState[state.config.activeMapName].runtimeMap;\n            if (map) {\n                proj = `EPSG:${map.CoordinateSystem.EpsgCode}`;\n            }\n        }\n        return proj;\n    });\n}\n\nexport function useCurrentMouseCoordinates() {\n    return useSelector<IApplicationState, Coordinate2D | undefined>(state => state.mouse.coords);\n}\n\nexport function useViewerFlyouts() {\n    return useSelector<IApplicationState, any>(state => state.toolbar.flyouts);\n}\n\nexport function useInitWarnings() {\n    return useSelector<IApplicationState, string[]>(state => state.initError.warnings);\n}\n\nexport function useInitError() {\n    return useSelector<IApplicationState, InitError | undefined>(state => state.initError.error);\n}\n\nexport function useInitErrorStack() {\n    return useSelector<IApplicationState, boolean>(state => state.initError.includeStack)\n}\n\nexport function useInitErrorOptions() {\n    return useSelector<IApplicationState, any>(state => state.initError.options);\n}\n\nfunction getActiveMapBranch(state: IApplicationState) {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName];\n    }\n    return undefined;\n}\n\nexport function useActiveMapBranch() {\n    return useSelector<IApplicationState, IBranchedMapSubState | undefined>(state => getActiveMapBranch(state));\n}\n\nexport function useActiveMapExpandedGroups() {\n    return useSelector<IApplicationState, string[]>(state => getActiveMapBranch(state)?.expandedGroups);\n}\n\nexport function useActiveMapSelectableLayers() {\n    return useSelector<IApplicationState, any>(state => getActiveMapBranch(state)?.selectableLayers);\n}\n\nexport function useActiveMapShowGroups() {\n    return useSelector<IApplicationState, string[] | undefined>(state => getActiveMapBranch(state)?.showGroups);\n}\n\nexport function useActiveMapShowLayers() {\n    return useSelector<IApplicationState, string[] | undefined>(state => getActiveMapBranch(state)?.showLayers);\n}\n\nexport function useActiveMapHideGroups() {\n    return useSelector<IApplicationState, string[] | undefined>(state => getActiveMapBranch(state)?.hideGroups);\n}\n\nexport function useActiveMapHideLayers() {\n    return useSelector<IApplicationState, string[] | undefined>(state => getActiveMapBranch(state)?.hideLayers);\n}\n\nexport function useActiveMapSelectableLayerNames() {\n    const map = useActiveMapState();\n    const selectableLayers = useActiveMapSelectableLayers();\n    if (map) {\n        const selectableLayerNames = (map.Layer || [])\n            .filter(layer => layer.Selectable && selectableLayers[layer.ObjectId] !== false)\n            .map(layer => layer.Name);\n        return selectableLayerNames;\n    }\n    return [];\n}\n\nexport function useActiveMapLayerTransparency() {\n    return useSelector<IApplicationState, LayerTransparencySet | undefined>(state => getActiveMapBranch(state)?.layerTransparency);\n}\n\nexport function useActiveMapActiveSelectedFeature() {\n    return useSelector<IApplicationState, ActiveSelectedFeature | undefined>(state => getActiveMapBranch(state)?.activeSelectedFeature);\n}\n\nexport function useActiveMapSelectionSet() {\n    return useSelector<IApplicationState, QueryMapFeaturesResponse | null>(state => getSelectionSet(state) ?? null);\n}\n\nexport function useActiveMapInitialView() {\n    return useSelector<IApplicationState, IMapView | undefined>(state => getActiveMapBranch(state)?.initialView);\n}\n\nexport function useActiveMapState() {\n    return useSelector<IApplicationState, RuntimeMap | undefined>(state => getRuntimeMap(state));\n}\n\nexport function useAvailableMaps() {\n    return useSelector<IApplicationState, INameValuePair[] | undefined>(state => state.config.availableMaps);\n}\n\nexport function useViewerBusyCount() {\n    return useSelector<IApplicationState, number>(state => state.viewer.busyCount);\n}\n\nexport function useViewerViewRotation() {\n    return useSelector<IApplicationState, number>(state => state.config.viewRotation);\n}\n\nexport function useViewerActiveTool() {\n    return useSelector<IApplicationState, ActiveMapTool>(state => state.viewer.tool);\n}\n\nexport function useViewerViewRotationEnabled() {\n    return useSelector<IApplicationState, boolean>(state => state.config.viewRotationEnabled);\n}\n\nexport function useConfiguredCoordinateProjection() {\n    return useSelector<IApplicationState, string>(state => state.config.coordinates.projection);\n}\n\nexport function useConfiguredCoordinateDecimals() {\n    return useSelector<IApplicationState, number>(state => state.config.coordinates.decimals);\n}\n\nexport function useConfiguredCoordinateFormat() {\n    return useSelector<IApplicationState, string | undefined>(state => state.config.coordinates.format);\n}\n\nexport function useConfiguredAgentUri() {\n    return useSelector<IApplicationState, string | undefined>(state => state.config.agentUri);\n}\n\nexport function useConfiguredAgentKind() {\n    return useSelector<IApplicationState, ClientKind>(state => state.config.agentKind);\n}\n\nexport function useIsContextMenuOpen() {\n    return useSelector<IApplicationState, boolean>(state => {\n        let isContextMenuOpen = false;\n        if (state?.toolbar?.flyouts?.[WEBLAYOUT_CONTEXTMENU]?.open === true) {\n            isContextMenuOpen = true;\n        }\n        return isContextMenuOpen;\n    })\n}\n\nexport function useViewerImageFormat() {\n    return useSelector<IApplicationState, ImageFormat>(state => state.config.viewer.imageFormat);\n}\n\nexport function useViewerSelectionImageFormat() {\n    return useSelector<IApplicationState, ImageFormat>(state => state.config.viewer.selectionImageFormat);\n}\n\nexport function useViewerSelectionColor() {\n    return useSelector<IApplicationState, string>(state => state.config.viewer.selectionColor);\n}\n\nexport function useViewerActiveFeatureSelectionColor() {\n    return useSelector<IApplicationState, string>(state => state.config.viewer.activeSelectedFeatureColor);\n}\n\nexport function useViewerPointSelectionBuffer() {\n    return useSelector<IApplicationState, number>(state => state.config.viewer.pointSelectionBuffer);\n}\n\nexport function useViewerFeatureTooltipsEnabled() {\n    return useSelector<IApplicationState, boolean>(state => state.viewer.featureTooltipsEnabled);\n}\n\nexport function useConfiguredManualFeatureTooltips() {\n    return useSelector<IApplicationState, boolean>(state => state.config.manualFeatureTooltips);\n}\n\nexport function useConfiguredLoadIndicatorPositioning() {\n    return useSelector<IApplicationState, MapLoadIndicatorPositioning>(state => state.config.viewer.loadIndicatorPositioning);\n}\n\nexport function useConfiguredLoadIndicatorColor() {\n    return useSelector<IApplicationState, string>(state => state.config.viewer.loadIndicatorColor);\n}\n\nexport function useConfiguredCancelDigitizationKey() {\n    return useSelector<IApplicationState, number>(state => state.config.cancelDigitizationKey);\n}\n\nexport function useConfiguredUndoLastPointKey() {\n    return useSelector<IApplicationState, number>(state => state.config.undoLastPointKey);\n}\n\nexport function useConfiguredCapabilities() {\n    return useSelector<IApplicationState, IViewerCapabilities>(state => state.config.capabilities);\n}\n\nexport function useTemplateLegendVisible() {\n    return useSelector<IApplicationState, boolean>(state => state.template.legendVisible);\n}\n\nexport function useTemplateTaskPaneVisible() {\n    return useSelector<IApplicationState, boolean>(state => state.template.taskPaneVisible);\n}\n\nexport function useTemplateSelectionVisible() {\n    return useSelector<IApplicationState, boolean>(state => state.template.selectionPanelVisible);\n}\n\nexport function useTemplateInitialInfoPaneWidth() {\n    return useSelector<IApplicationState, number>(state => state.template.initialInfoPaneWidth);\n}\n\nexport function useTemplateInitialTaskPaneWidth() {\n    return useSelector<IApplicationState, number>(state => state.template.initialTaskPaneWidth);\n}\n\nexport function useTaskPaneInitialUrl() {\n    return useSelector<IApplicationState, string | undefined>(state => state.taskpane.initialUrl);\n}\n\nexport function useTaskPaneNavigationIndex() {\n    return useSelector<IApplicationState, number>(state => state.taskpane.navIndex);\n}\n\nexport function useTaskPaneLastUrlPushed() {\n    return useSelector<IApplicationState, boolean>(state => state.taskpane.lastUrlPushed);\n}\n\nexport function useTaskPaneNavigationStack() {\n    return useSelector<IApplicationState, string[]>(state => state.taskpane.navigation);\n}\n\nexport function useLastDispatchedAction() {\n    return useSelector<IApplicationState, any>(state => state.lastaction);\n}\n\nexport function useReducedToolbarAppState() {\n    return useSelector<IApplicationState, IToolbarAppState>(state => reduceAppToToolbarState(state), (left, right) => {\n        return left?.busyWorkerCount == right?.busyWorkerCount\n            && left?.hasNextView == right?.hasNextView\n            && left?.hasPreviousView == right?.hasPreviousView\n            && left?.hasSelection == right?.hasSelection\n            && left?.featureTooltipsEnabled == right?.featureTooltipsEnabled\n            && left?.activeTool == right?.activeTool;\n    });\n}","/**\n * Console wrappers that are only active in development mode\n */\n\n/**\n * Log an informational message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function info(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.info(message, optionalParams);\n    }\n}\n\n/**\n * Log a warning message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function warn(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.warn(message, optionalParams);\n    }\n}\n\n/**\n * Log an error message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function error(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.error(message, optionalParams);\n    }\n}\n\n/**\n * Log a debug message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function debug(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.debug(message, optionalParams);\n    }\n}","/**\n * runtime.ts\n *\n * This represents a runtime environment where components can interact with the map viewer\n * in the traditional way. This module is mainly for servicing the AJAX viewer API emulation.\n *\n * Where possible, use actions instead of this module\n */\nimport { IMapViewer } from \"../api/common\";\nimport * as logger from \"../utils/logger\";\n\nlet _fusionRoot: string | undefined;\nlet _viewer: IMapViewer | undefined;\n\n/**\n * Sets the Fusion base URL\n *\n * @export\n * @param {string} root\n */\nexport function setFusionRoot(root: string): void {\n    _fusionRoot = root;\n    logger.debug(`Fusion root set to: ${root}. Access to Fusion backend services and widget content will be relative to this value`);\n}\n\n/**\n * Gets the Fusion base URL\n *\n * @export\n * @returns {string}\n */\nexport function getFusionRoot(): string {\n    return _fusionRoot || \"../fusion\";\n}\n\n/**\n * Sets the viewer instance. Called by the map viewer component when it has mounted.\n *\n * DO NOT CALL DIRECTLY\n *\n * @hidden\n * @param {IMapViewer} viewer\n */\nexport function setViewer(viewer: IMapViewer): void {\n    _viewer = viewer;\n}\n\n/**\n * Gets whether the runtime environment is ready\n *\n * @export\n * @returns {boolean}\n */\nexport function isReady(): boolean {\n    return _viewer != null;\n}\n\n/**\n * Gets the map viewer in this runtime environment\n *\n * @export\n * @returns {IMapViewer}\n */\nexport function getViewer(): IMapViewer | undefined {\n    return _viewer;\n}","import {\n    ActiveMapTool,\n    ICommand,\n    IMapView,\n    ReduxThunkedAction,\n    getCurrentView,\n    getRuntimeMap,\n    getSelectionSet,\n    UnitOfMeasure,\n    ILayerInfo\n} from \"../api/common\";\nimport { getViewer } from \"../api/runtime\";\nimport { areViewsCloseToEqual } from \"../components/map-viewer-base\";\nimport { getFiniteScaleIndexForScale } from '../utils/number';\nimport { Client } from \"../api/client\";\nimport { QueryMapFeaturesResponse, FeatureSet, SelectedFeature, SelectedFeatureSet } from '../api/contracts/query';\nimport { IQueryMapFeaturesOptions } from '../api/request-builder';\nimport { buildSelectionXml } from '../api/builders/deArrayify';\nimport { makeUnique } from \"../utils/array\";\nimport { ActionType } from '../constants/actions';\nimport {\n    IMapSetBusyCountAction,\n    IMapSetBaseLayerAction,\n    IMapSetScaleAction,\n    IMapSetMouseCoordinatesAction,\n    IMapSetLayerTransparencyAction,\n    IMapSetViewSizeUnitsAction,\n    IMapPreviousViewAction,\n    IMapNextViewAction,\n    ISetActiveMapToolAction,\n    ISetActiveMapAction,\n    ISetManualFeatureTooltipsEnabledAction,\n    ISetFeatureTooltipsEnabledAction,\n    IMapSetViewRotationAction,\n    IMapSetViewRotationEnabledAction,\n    IShowSelectedFeatureAction,\n    IMapSetSelectionAction,\n    IMapResizedAction,\n    IAddedLayerAction,\n    IRemoveLayerAction,\n    ISetLayerIndexAction,\n    ISetLayerOpacityAction,\n    ISetLayerVisibilityAction,\n    ISetMapLayerVectorStyle,\n    IAddMapLayerBusyWorkerAction,\n    IRemoveMapLayerBusyWorkerAction\n} from './defs';\nimport { storeSelectionSet } from '../api/session-store';\nimport { getSiteVersion, canUseQueryMapFeaturesV4 } from '../utils/site-version';\nimport { IVectorFeatureStyle } from '../api/ol-style-helpers';\n\nfunction combineSelectedFeatures(oldRes: SelectedFeature[], newRes: SelectedFeature[]): SelectedFeature[] {\n    const merged: SelectedFeature[] = [];\n    for (const feat of oldRes) {\n        merged.push(feat);\n    }\n    for (const feat of newRes) {\n        //NOTE: Due to lack of identity property information, we have to\n        //check all property values\n        const matches = merged.filter(f => {\n            for (const p of f.Property) {\n                for (const np of feat.Property) {\n                    if (p.Name == np.Name) {\n                        if (p.Value != np.Value) {\n                            return false;\n                        }\n                    }\n                }\n            }\n            return true;\n        });\n        if (matches.length == 0) {\n            merged.push(feat);\n        }\n    }\n    return merged;\n}\n\nfunction combineSelectedFeatureSets(oldRes: SelectedFeatureSet | undefined, newRes: SelectedFeatureSet | undefined): SelectedFeatureSet | undefined {\n    if (oldRes == null) {\n        return newRes;\n    }\n    const merged: SelectedFeatureSet = {\n        SelectedLayer: []\n    };\n    for (const layer of oldRes.SelectedLayer) {\n        merged.SelectedLayer.push(layer);\n    }\n    if (newRes) {\n        for (const layer of newRes.SelectedLayer) {\n            const layerId = layer[\"@id\"];\n            const layerName = layer[\"@name\"];\n            const existing = merged.SelectedLayer.filter(l => l[\"@id\"] == layerId && l[\"@name\"] == layerName);\n            if (existing.length == 0) {\n                merged.SelectedLayer.push(layer);\n            } else {\n                existing[0].Feature = combineSelectedFeatures(existing[0].Feature, layer.Feature);\n            }\n        }\n    }\n    return merged;\n}\n\nfunction combineFeatureSets(oldRes: FeatureSet | undefined, newRes: FeatureSet | undefined): FeatureSet | undefined {\n    if (oldRes == null) {\n        return newRes;\n    }\n    const merged: FeatureSet = {\n        Layer: []\n    };\n    for (const layer of oldRes.Layer) {\n        merged.Layer.push(layer);\n    }\n    if (newRes) {\n        for (const layer of newRes.Layer) {\n            const layerId = layer[\"@id\"];\n            const existing = merged.Layer.filter(l => l[\"@id\"] == layerId);\n            if (existing.length == 0) {\n                merged.Layer.push(layer);\n            } else {\n                existing[0].Class.ID = makeUnique(existing[0].Class.ID.concat(layer.Class.ID));\n            }\n        }\n    }\n    return merged;\n}\n\nfunction combineSelections(oldRes: QueryMapFeaturesResponse | undefined, newRes: QueryMapFeaturesResponse): QueryMapFeaturesResponse {\n    if (oldRes) {\n        const merged: QueryMapFeaturesResponse = {\n            SelectedFeatures: combineSelectedFeatureSets(oldRes.SelectedFeatures, newRes.SelectedFeatures),\n            FeatureSet: combineFeatureSets(oldRes.FeatureSet, newRes.FeatureSet),\n            Hyperlink: undefined,\n            InlineSelectionImage: undefined\n        };\n        return merged;\n    } else {\n        return newRes;\n    }\n}\n\n/**\n * Options for map querying\n *\n * @export\n * @interface QueryMapFeatureActionOptions\n */\nexport interface QueryMapFeatureActionOptions {\n    /**\n     * The main set of map querying options\n     *\n     * @type {IQueryMapFeaturesOptions}\n     * @memberof QueryMapFeatureActionOptions\n     */\n    options: IQueryMapFeaturesOptions;\n    /**\n     * If true, the selection changes will be appended to the current selection set. False otherwise\n     *\n     * @type {boolean}\n     * @memberof QueryMapFeatureActionOptions\n     */\n    append?: boolean;\n    /**\n     * An optional callback to invoke on successful operation\n     *\n     * @memberof QueryMapFeatureActionOptions\n     */\n    callback?: (res: QueryMapFeaturesResponse) => void;\n    /**\n     * An optional callback to invoke on failure\n     *\n     * @memberof QueryMapFeatureActionOptions\n     */\n    errBack?: (err: any) => void;\n}\n\n/**\n * Queries map features\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {QueryMapFeatureActionOptions} opts query options\n * @returns {ReduxThunkedAction}\n */\nexport function queryMapFeatures(mapName: string, opts: QueryMapFeatureActionOptions): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        const state = getState();\n        const args = state.config;\n        const map = getRuntimeMap(state);\n        const selectionSet = getSelectionSet(state);\n        if (map && args.agentKind && args.agentUri) {\n            const client = new Client(args.agentUri, args.agentKind);\n            const success = (res: QueryMapFeaturesResponse) => {\n                if (opts.callback != null) {\n                    opts.callback(res);\n                }\n            };\n            const failure = (err: Error) => {\n                if (opts.errBack != null) {\n                    opts.errBack(err);\n                }\n            };\n            //We want v4.0.0 QUERYMAPFEATURES if available\n            const sv = getSiteVersion(map);\n            const queryOp = canUseQueryMapFeaturesV4(sv)\n                ? (opts: IQueryMapFeaturesOptions) => client.queryMapFeatures_v4(opts)\n                : (opts: IQueryMapFeaturesOptions) => client.queryMapFeatures(opts);\n            queryOp(opts.options).then(res => {\n                if (opts.options.persist === 1) {\n                    if (opts.append === true) {\n                        const combined = combineSelections(selectionSet, res);\n                        const mergedXml = buildSelectionXml(combined.FeatureSet);\n                        //Need to update the server-side selection with the merged result\n                        queryOp({\n                            session: map.SessionId,\n                            mapname: map.Name,\n                            persist: 1,\n                            featurefilter: mergedXml\n                        }).then(() => {\n                            storeSelectionSet(map.SessionId, mapName, combined); // set and forget\n                            dispatch(setSelection(mapName, combined));\n                            success(combined);\n                        });\n                    } else {\n                        storeSelectionSet(map.SessionId, mapName, res); // set and forget\n                        dispatch(setSelection(mapName, res));\n                        success(res);\n                    }\n                } else {\n                    success(res);\n                }\n            }).catch(failure);\n        }\n    };\n}\n\n/**\n * Sets the current map view.\n *\n * NOTE: Subscribing components are not guaranteed to receive every new view change sent by\n * calling this method. For purposes of optimization, views passed in that are \"close enough\"\n * to the current view are not dispatched to subscribing components.\n * \n * @export\n * @param {IMapView} view The map view to set\n * @returns {ReduxThunkedAction}\n */\nexport function setCurrentView(view: IMapView): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        // HACK-y:\n        //\n        // We don't want to dispatch SET_VIEW actions with redundant view\n        // states if the one we're about to dispatch is the same as the\n        // previous one\n        const state = getState();\n        const currentView = getCurrentView(state);\n        const newView = { ...view };\n        const mapName = state.config.activeMapName;\n        let dispatchThis = true;\n        if (currentView && mapName) {\n            //If the current map is tiled (has finite scales), \"snap\" the view's scale\n            //to the closest applicable finite scale then do the test \n            const mapState = state.mapState[mapName];\n            if (mapState.runtimeMap &&\n                mapState.runtimeMap.FiniteDisplayScale &&\n                mapState.runtimeMap.FiniteDisplayScale.length > 0) {\n\n                const fi = getFiniteScaleIndexForScale(mapState.runtimeMap.FiniteDisplayScale, newView.scale);\n                newView.scale = mapState.runtimeMap.FiniteDisplayScale[fi];\n            }\n            if (areViewsCloseToEqual(currentView, newView)) {\n                dispatchThis = false;\n            }\n        }\n        if (dispatchThis && mapName) {\n            dispatch({\n                type: ActionType.MAP_SET_VIEW,\n                payload: {\n                    mapName,\n                    view: newView\n                }\n            });\n        }\n    };\n}\n\n/**\n * Sends a map resized notification\n * \n * @export\n * @param {number} width \n * @param {number} height \n * @returns {IMapResizedAction} \n */\nexport function mapResized(width: number, height: number): IMapResizedAction {\n    return {\n        type: ActionType.MAP_RESIZED,\n        payload: {\n            width,\n            height\n        }\n    }\n}\n\n/**\n * Sets the selection set for the given map\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {*} selectionSet The selection set to apply\n * @returns {IMapSetSelectionAction}\n */\nexport function setSelection(mapName: string, selectionSet: any): IMapSetSelectionAction {\n    return {\n        type: ActionType.MAP_SET_SELECTION,\n        payload: {\n            mapName,\n            selection: selectionSet\n        }\n    };\n}\n\n/**\n * Invokes the specified command\n *\n * @export\n * @param {ICommand} cmd\n * @param {*} [parameters]\n * @returns {ReduxThunkedAction}\n */\nexport function invokeCommand(cmd: ICommand, parameters?: any): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        return cmd.invoke(dispatch, getState, getViewer(), parameters);\n    };\n}\n\n/**\n * Sets the busy count of the viewer. A value greater than zero signifies that the viewer is currently\n * busy performing various actions (eg. Loading/Rendering the current map image)\n *\n * @export\n * @param {number} busyCount The current busy count\n * @returns {IMapSetBusyCountAction}\n */\nexport function setBusyCount(busyCount: number): IMapSetBusyCountAction {\n    return {\n        type: ActionType.MAP_SET_BUSY_COUNT,\n        payload: busyCount\n    };\n}\n\n/**\n * Set the given external base layer as the active base layer\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {string} layerName The name of the external base layer to set as active\n * @returns\n */\nexport function setBaseLayer(mapName: string, layerName: string): IMapSetBaseLayerAction {\n    return {\n        type: ActionType.MAP_SET_BASE_LAYER,\n        payload: {\n            mapName,\n            layerName\n        }\n    };\n}\n\n/**\n * Sets the view scale\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {number} scale The scale to set\n * @returns\n */\nexport function setScale(mapName: string, scale: number): IMapSetScaleAction {\n    const viewer = getViewer();\n    let resolution;\n    if (viewer) {\n        resolution = viewer.scaleToResolution(scale);\n    }\n    return {\n        type: ActionType.MAP_SET_SCALE,\n        payload: {\n            mapName,\n            scale,\n            resolution\n        }\n    };\n}\n\n/**\n * Sets the current mouse coordinates\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {*} coord The current mouse coordinates\n * @returns\n */\nexport function setMouseCoordinates(mapName: string, coord: any): IMapSetMouseCoordinatesAction {\n    return {\n        type: ActionType.UPDATE_MOUSE_COORDINATES,\n        payload: {\n            mapName,\n            coord\n        }\n    };\n}\n\n/**\n * Set the transparency for the given OL layer\n * \n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {string} layerName The name of the OL layer\n * @param {number} opacity A value between 0 and 1. 1 - Fully Opaque, 0 - Fully Transparent\n * @returns \n */\nexport function setLayerTransparency(mapName: string, layerName: string, opacity: number): IMapSetLayerTransparencyAction {\n    return {\n        type: ActionType.MAP_SET_LAYER_TRANSPARENCY,\n        payload: {\n            mapName,\n            layerName,\n            opacity\n        }\n    };\n}\n\n/**\n * Sets the units for the map view size display\n * \n * @export\n * @param {UnitOfMeasure} unit \n * @returns {IMapSetViewSizeUnitsAction} \n */\nexport function setViewSizeUnits(unit: UnitOfMeasure): IMapSetViewSizeUnitsAction {\n    return {\n        type: ActionType.MAP_SET_VIEW_SIZE_UNITS,\n        payload: unit\n    };\n}\n\n/**\n * Goes back to the previous view on the navigation stack\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @returns\n */\nexport function previousView(mapName: string): IMapPreviousViewAction {\n    return {\n        type: ActionType.MAP_PREVIOUS_VIEW,\n        payload: {\n            mapName\n        }\n    };\n}\n\n/**\n * Goes to the next view on the navigation stack\n *\n * @export\n * @param {string} mapName The name of the current runtime amp\n * @returns\n */\nexport function nextView(mapName: string): IMapNextViewAction {\n    return {\n        type: ActionType.MAP_NEXT_VIEW,\n        payload: {\n            mapName\n        }\n    };\n}\n\n/**\n * Sets the active map tool\n *\n * @export\n * @param {ActiveMapTool} tool The active map tool command\n * @returns\n */\nexport function setActiveTool(tool: ActiveMapTool): ISetActiveMapToolAction {\n    return {\n        type: ActionType.MAP_SET_ACTIVE_TOOL,\n        payload: tool\n    };\n}\n\n/**\n * Sets the active runtime map\n *\n * @export\n * @param {string} mapName The name of the runtime map to set as active\n * @returns\n */\nexport function setActiveMap(mapName: string): ISetActiveMapAction {\n    return {\n        type: ActionType.MAP_SET_ACTIVE_MAP,\n        payload: mapName\n    };\n}\n\n/**\n * Sets whether feature tooltips (aka. Map Tips) are enabled\n *\n * @export\n * @param {boolean} enabled\n * @returns\n */\nexport function setFeatureTooltipsEnabled(enabled: boolean): ISetFeatureTooltipsEnabledAction {\n    return {\n        type: ActionType.MAP_SET_MAPTIP,\n        payload: enabled\n    };\n}\n\n/**\n * Sets whether manual feature tooltips (aka. Map Tips) are enabled\n *\n * @export\n * @param {boolean} enabled\n * @returns\n */\nexport function setManualFeatureTooltipsEnabled(enabled: boolean): ISetManualFeatureTooltipsEnabledAction {\n    return {\n        type: ActionType.MAP_SET_MANUAL_MAPTIP,\n        payload: enabled\n    };\n}\n\n/**\n * Sets the rotation of the current view\n * \n * @export\n * @param {number} rotation \n * @returns \n */\nexport function setViewRotation(rotation: number): IMapSetViewRotationAction {\n    return {\n        type: ActionType.MAP_SET_VIEW_ROTATION,\n        payload: rotation\n    };\n}\n\n/**\n * Sets whether view rotation is enabled or not\n * \n * @export\n * @param {boolean} enabled \n */\nexport function setViewRotationEnabled(enabled: boolean): IMapSetViewRotationEnabledAction {\n    return {\n        type: ActionType.MAP_SET_VIEW_ROTATION_ENABLED,\n        payload: enabled\n    };\n}\n\n/**\n * Shows the selected feature on the map\n * \n * @export\n * @param {string} mapName \n * @param {string} layerId \n * @param {string} selectionKey \n * @returns {IShowSelectedFeatureAction} \n */\nexport function showSelectedFeature(mapName: string, layerId: string, selectionKey: string): IShowSelectedFeatureAction {\n    return {\n        type: ActionType.MAP_SHOW_SELECTED_FEATURE,\n        payload: {\n            mapName,\n            layerId,\n            selectionKey\n        }\n    };\n}\n\n/**\n * NOTE: Dispatching this action does not add the layer to the map. This is a means to notify others\n * that a new layer has been added. It is expected to be dispatched by any component that is managing\n * layers\n * \n * @export\n * @param {string} mapName\n * @param {ILayerInfo} layer\n * @returns {IAddedLayerAction}\n * @since 0.13\n */\nexport function mapLayerAdded(mapName: string, layer: ILayerInfo): IAddedLayerAction {\n    return {\n        type: ActionType.LAYER_ADDED,\n        payload: {\n            mapName,\n            layer\n        }\n    };\n}\n\n/**\n * Removes a given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @returns {IRemoveLayerAction}\n * @since 0.13\n */\nexport function removeMapLayer(mapName: string, layerName: string): IRemoveLayerAction {\n    return {\n        type: ActionType.REMOVE_LAYER,\n        payload: {\n            mapName,\n            layerName\n        }\n    };\n}\n\n/**\n * Sets the display order index for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {number} index\n * @returns {ISetLayerIndexAction}\n * @since 0.13\n */\nexport function setMapLayerIndex(mapName: string, layerName: string, index: number): ISetLayerIndexAction {\n    return {\n        type: ActionType.SET_LAYER_INDEX,\n        payload: {\n            mapName,\n            layerName,\n            index\n        }\n    };\n}\n\n/**\n * Sets the opacity for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {number} opacity\n * @returns {ISetLayerOpacityAction}\n * @since 0.13\n */\nexport function setMapLayerOpacity(mapName: string, layerName: string, opacity: number): ISetLayerOpacityAction {\n    return {\n        type: ActionType.SET_LAYER_OPACITY,\n        payload: {\n            mapName,\n            layerName,\n            opacity\n        }\n    };\n}\n\n/**\n * Sets the visibility for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {boolean} visible\n * @returns {ISetLayerVisibilityAction}\n * @since 0.13\n */\nexport function setMapLayerVisibility(mapName: string, layerName: string, visible: boolean): ISetLayerVisibilityAction {\n    return {\n        type: ActionType.SET_LAYER_VISIBILITY,\n        payload: {\n            mapName,\n            layerName,\n            visible\n        }\n    };\n}\n\n/**\n * Sets the vector style for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {IVectorFeatureStyle} style\n * @returns {ISetMapLayerVectorStyle}\n * @since 0.13\n */\nexport function setMapLayerVectorStyle(mapName: string, layerName: string, style: IVectorFeatureStyle): ISetMapLayerVectorStyle {\n    return {\n        type: ActionType.SET_LAYER_VECTOR_STYLE,\n        payload: {\n            mapName,\n            layerName,\n            style\n        }\n    };\n}\n\n/**\n * Adds a busy worker for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @returns {IAddMapLayerBusyWorkerAction}\n * @since 0.13\n */\nexport function addMapLayerBusyWorker(mapName: string, layerName: string): IAddMapLayerBusyWorkerAction {\n    return {\n        type: ActionType.ADD_LAYER_BUSY_WORKER,\n        payload: {\n            mapName,\n            layerName\n        }\n    }\n}\n\n/**\n * Removes a busy worker for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @returns {IRemoveMapLayerBusyWorkerAction}\n * @since 0.13\n */\nexport function removeMapLayerBusyWorker(mapName: string, layerName: string): IRemoveMapLayerBusyWorkerAction {\n    return {\n        type: ActionType.REMOVE_LAYER_BUSY_WORKER,\n        payload: {\n            mapName,\n            layerName\n        }\n    }\n}","/**\n * Non-breaking space\n */\nexport const NBSP = String.fromCharCode(160);\n\nexport const DEG = String.fromCharCode(176);\n\nexport const EMPTY_OBJECT = {};\n\nexport const MDF_INFINITY = 1000000000000.0;\n\nexport const WEBLAYOUT_TOOLBAR = \"Toolbar\";\nexport const WEBLAYOUT_TASKMENU = \"TaskMenu\";\nexport const WEBLAYOUT_CONTEXTMENU = \"MapContextMenu\";\n\nexport const FUSION_TASKPANE_NAME = \"TaskPane\";\nexport const FUSION_MAP_NAME = \"Map\";\nexport const FUSION_REDLINE_NAME = \"Redline\";\n\nexport const LAYER_ID_BASE = \"LAYER_ID_BASE\";\nexport const LAYER_ID_MG_BASE = \"LAYER_ID_MG_BASE\";\nexport const LAYER_ID_MG_SEL_OVERLAY = \"LAYER_ID_MG_SEL_OVERLAY\";\n\nexport const BLANK_GIF_DATA_URI = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n\nexport * from \"./assets\";","/**\n * The base of any viewer-related error\n *\n * @export\n * @class MgError\n * @extends {Error}\n */\nexport class MgError extends Error {\n    constructor(public message: string) {\n        super(message);\n        this.name = \"MgError\";\n        this.message = message;\n        this.stack = (<any>new Error()).stack;\n    }\n}\n\n/**\n * Indicates if this error is a session expired error\n *\n * @export\n * @param {MgError} err\n * @returns {boolean}\n */\nexport function isSessionExpiredError(err: MgError): boolean {\n    return err.message.indexOf(\"MgSessionExpiredException\") >= 0;\n}","/**\n * Indicates if the given string ends with the given suffix\n *\n * @export\n * @param {string} str\n * @param {string} suffix\n * @returns {boolean}\n */\nexport function strEndsWith(str: string, suffix: string): boolean {\n    return str.indexOf(suffix, str.length - suffix.length) !== -1;\n}\n\n/**\n * Replaces all occurrences of the given string with the specified replacement in the target\n * string\n * \n * @param str \n * @param find \n * @param replace \n * @since 0.12\n */\nexport function strReplaceAll(str: string, find: string, replace: string): string {\n    return str.split(find).join(replace);\n}\n\n/**\n * Empty string constant\n */\nexport const STR_EMPTY = \"\";\n\n/**\n * Indicates if the given string is null or empty\n *\n * @export\n * @param {(string | null | undefined)} str\n * @returns {boolean}\n */\nexport function strIsNullOrEmpty(str: string | null | undefined): str is null | undefined {\n    return null == str || \"\" === str;\n}\n\n/**\n * Returns a trimmed version of the given string\n * \n * @param str The string to trim\n * @since 0.12.5\n */\nexport function strTrim(str: string): string {\n    if (!String.prototype.trim) {\n        return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n    }\n    return str.trim();\n}","import * as Request from './request-builder';\nimport { MgError } from './error';\nimport { MapAgentRequestBuilder, isErrorResponse, serialize } from './builders/mapagent';\nimport * as Common from \"./contracts/common\";\nimport * as RtMap from './contracts/runtime-map';\nimport * as Query from \"./contracts/query\";\nimport { ClientKind } from './common';\nimport { createRequestBuilder } from './builders/factory';\n\n/**\n * The MapGuide HTTP client\n *\n * @export\n * @class Client\n * @implements {Request.IMapGuideClient}\n */\nexport class Client implements Request.IMapGuideClient {\n    private builder: Request.RequestBuilder;\n    constructor(agentUri: string, kind: ClientKind) {\n        this.builder = createRequestBuilder(agentUri, kind);\n    }\n    public async getText(url: string): Promise<string> {\n        const r = await fetch(url);\n        if (!r.ok)\n            throw new MgError(r.statusText);\n        const text = await r.text();\n        return text;\n    }\n\n    /**\n     * Performs a generic GET request at the specified URL\n     *\n     * @template T The type of the object you are expecting to receive\n     * @param {string} url The url to make the request to\n     * @returns {Promise<T>} A promise for the value of the requested type\n     *\n     * @memberOf Client\n     */\n    public get<T>(url: string): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            fetch(url, {\n                headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                } as any,\n                method: \"GET\"\n            })\n            .then(response => {\n                if (isErrorResponse(response)) {\n                    throw new MgError(response.statusText);\n                } else {\n                    resolve(response.json());\n                }\n            })\n            .catch(reject);\n        });\n    }\n\n    /**\n     * Performs a generic POST request at the specified URL\n     *\n     * @template T The type of the object you are expecting to receive\n     * @param {string} url The url to make the request to\n     * @param {*} data The POST form data\n     * @returns {Promise<T>} A promise for the value of the requested type\n     *\n     * @memberOf Client\n     */\n    public post<T>(url: string, data: any): Promise<T> {\n        if (!data.format) {\n            data.format = \"application/json\";\n        }\n        //const form = new FormData();\n        //for (const key in data) {\n        //    form.append(key.toUpperCase(), data[key]);\n        //}\n        return new Promise<T>((resolve, reject) => {\n            fetch(url, {\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n                } as any,\n                method: \"POST\",\n                body: serialize(data) //form\n            })\n            .then(response => {\n                if (isErrorResponse(response)) {\n                    throw new MgError(response.statusText);\n                } else {\n                    resolve(response.json());\n                }\n            })\n            .catch(reject);\n        });\n    }\n\n    /**\n     * Creates a new MapGuide session\n     *\n     * @param {string} username\n     * @param {string} password\n     * @returns {Promise<string>}\n     *\n     * @memberOf Client\n     */\n    public createSession(username: string, password: string): Promise<string> {\n        return this.builder.createSession(username, password);\n    }\n\n    /**\n     * Gets the server session timeout for the given session id\n     *\n     * @param {string} session\n     * @returns {Promise<number>}\n     *\n     * @memberOf Client\n     */\n    public getServerSessionTimeout(session: string): Promise<number> {\n        return this.builder.getServerSessionTimeout(session);\n    }\n\n    /**\n     * Retrieves the requested resource\n     *\n     * @template T\n     * @param {Common.ResourceIdentifier} resourceId\n     * @param {*} [args]\n     * @returns {Promise<T>}\n     *\n     * @memberOf Client\n     */\n    public getResource<T extends Common.ResourceBase>(resourceId: Common.ResourceIdentifier, args?: any): Promise<T> {\n        return this.builder.getResource<T>(resourceId, args);\n    }\n\n    /**\n     * Creates a runtime map from the specified map definition\n     *\n     * @param {Request.ICreateRuntimeMapOptions} options\n     * @returns {Promise<RtMap.RuntimeMap>}\n     *\n     * @memberOf Client\n     */\n    public createRuntimeMap(options: Request.ICreateRuntimeMapOptions): Promise<RtMap.RuntimeMap> {\n        return this.builder.createRuntimeMap(options);\n    }\n\n    /**\n     * Describes a runtime map\n     *\n     * @param {Request.IDescribeRuntimeMapOptions} options\n     * @returns {Promise<RtMap.RuntimeMap>}\n     *\n     * @memberOf Client\n     */\n    public describeRuntimeMap(options: Request.IDescribeRuntimeMapOptions): Promise<RtMap.RuntimeMap> {\n        return this.builder.describeRuntimeMap(options);\n    }\n\n    /**\n     * Performs a map selection query on the current map\n     *\n     * @param {Request.IQueryMapFeaturesOptions} options\n     * @returns {Promise<Query.QueryMapFeaturesResponse>}\n     *\n     * @memberOf Client\n     */\n    public queryMapFeatures(options: Request.IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse> {\n        return this.builder.queryMapFeatures(options);\n    }\n\n    /**\n     * Performs a map selection query on the current map. Only applicable for use in MapGuide Open Source\n     * 4.0 and higher\n     *\n     * @param {Request.IQueryMapFeaturesOptions} options\n     * @returns {Promise<Query.QueryMapFeaturesResponse>}\n     *\n     * @memberOf Client\n     */\n    public queryMapFeatures_v4(options: Request.IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse> {\n        return this.builder.queryMapFeatures_v4(options);\n    }\n\n    /**\n     * Gets the tile template URL used by the viewer to send tile requests\n     *\n     * @param {string} resourceId\n     * @param {string} groupName\n     * @param {string} xPlaceholder\n     * @param {string} yPlaceholder\n     * @param {string} zPlaceholder\n     * @returns {string}\n     *\n     * @memberOf Client\n     */\n    public getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string {\n        return this.builder.getTileTemplateUrl(resourceId, groupName, xPlaceholder, yPlaceholder, zPlaceholder);\n    }\n}","import queryString = require(\"qs\");\nimport { IInvokeUrlCommandParameter } from \"../api/common\";\nconst parse = require(\"url-parse\");\n\nconst DEFAULT_PARSE_OPTIONS = { ignoreQueryPrefix: true };\n\n/**\n * Indicates if the given arrays are equal\n *\n * @param {(string[]|null)} a\n * @param {(string[]|null)} b\n * @returns {boolean}\n */\nfunction arraysEqual(a: string[] | null, b: string[] | null): boolean {\n    if (a === b) return true;\n    if (a == null || b == null) return false;\n    if (a.length != b.length) return false;\n\n    // If you don't care about the order of the elements inside\n    // the array, you should sort both arrays here.\n\n    for (let i = 0; i < a.length; ++i) {\n        if (a[i] !== b[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n\n/**\n * Indicates if the given sets of parameterse are the same\n *\n * @param {*} params1\n * @param {*} params2\n * @returns {boolean}\n */\nfunction areParamsEqual(params1: any, params2: any): boolean {\n    //HACK: locale is an optional part of the mapname/session/locale triplet\n    //For the purpose of the same url test, the presence (or lack thereof) of\n    //this parameter should not break the url equality test\n    const keys1 = Object.keys(params1).filter(k => k.toLowerCase() != \"locale\").sort();\n    const keys2 = Object.keys(params2).filter(k => k.toLowerCase() != \"locale\").sort();\n    if (arraysEqual(keys1, keys2)) {\n        for (const key of keys1) {\n            if (params1[key] != params2[key]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n}\n\n/**\n * Indicates if the given URLs are the same\n *\n * @export\n * @param {string} url1\n * @param {string} url2\n * @returns {boolean}\n */\nexport function areUrlsSame(url1: string, url2: string): boolean {\n    const parsed1 = parse(url1);\n    const parsed2 = parse(url2);\n    const params1 = queryString.parse(parsed1.query, DEFAULT_PARSE_OPTIONS);\n    const params2 = queryString.parse(parsed2.query, DEFAULT_PARSE_OPTIONS);\n\n    const same = parsed1.protocol == parsed2.protocol\n        && parsed1.slashes == parsed2.slashes\n        && parsed1.auth == parsed2.auth\n        && parsed1.username == parsed2.username\n        && parsed1.password == parsed2.password\n        && parsed1.host == parsed2.host\n        && parsed1.hostname == parsed2.hostname\n        && parsed1.port == parsed2.port\n        && parsed1.pathname == parsed2.pathname\n        && parsed1.hash == parsed2.hash\n        && parsed1.host == parsed2.host\n        && areParamsEqual(params1, params2);\n\n    return same;\n}\n\n/**\n * A parsed component URI\n * \n * @export\n * @interface ParsedComponentUri\n */\nexport interface ParsedComponentUri {\n    name: string;\n    props: any;\n}\n\n/**\n * Indicates if the given URI is a component URI\n * \n * @export\n * @param {string} uri \n * @returns {boolean} \n */\nexport function isComponentUri(uri: string): boolean {\n    return uri.indexOf(\"component://\") >= 0;\n}\n\n/**\n * Parses the given component URI. If it not a valid component URI returns undefined\n * \n * @export\n * @param {string} uri \n * @returns {(ParsedComponentUri | undefined)} \n */\nexport function parseComponentUri(uri: string): ParsedComponentUri | undefined {\n    if (isComponentUri(uri)) {\n        const qi = uri.lastIndexOf(\"?\");\n        const name = qi < 0 ? uri.substring(12) : uri.substring(12, qi);\n        const props = qi < 0 ? {} : queryString.parse(uri.substring(qi), DEFAULT_PARSE_OPTIONS);\n        return {\n            name,\n            props\n        };\n    }\n}\n\n/**\n * Normalizes the given URL to ensure it has the baseline set of required parameters for invoking any server-side script that uses the MapGuide Web API\n * \n * @export\n * @param {string} url The url to normalize\n * @param {string} mapName The name of the current runtime map\n * @param {string} session The current session id\n * @param {string} [locale] An optional locale\n * @param {boolean} [uppercase=true] If true, will uppercase all parameter names\n * @param {IInvokeUrlCommandParameter[]} [extraParameters=[]] Any extra parameters to append to the URL\n * @returns {string} \n */\nexport function ensureParameters(url: string, mapName: string, session: string, locale?: string, uppercase = true, extraParameters: IInvokeUrlCommandParameter[] = []): string {\n    //If this is a component URL, let it be\n    if (isComponentUri(url)) {\n        return url;\n    }\n    const parsed = parseUrl(url);\n    const params: any = parsed.query != null ? queryString.parse(parsed.query, DEFAULT_PARSE_OPTIONS) : {};\n    let bNeedMapName = true;\n    let bNeedSession = true;\n    let bNeedLocale = true;\n    for (const key in params) {\n        const name = key.toLowerCase();\n        switch (name) {\n            case \"session\":\n                bNeedSession = false;\n                break;\n            case \"mapname\":\n                bNeedMapName = false;\n                break;\n            case \"locale\":\n                bNeedLocale = false;\n                break;\n        }\n    }\n    if (bNeedMapName) {\n        if (uppercase) {\n            params.MAPNAME = mapName;\n        } else {\n            params.mapname = mapName;\n        }\n    }\n    if (bNeedSession) {\n        if (uppercase) {\n            params.SESSION = session;\n        } else {\n            params.session = session;\n        }\n    }\n    if (bNeedLocale) {\n        if (uppercase) {\n            params.LOCALE = locale;\n        } else {\n            params.locale = locale;\n        }\n    }\n\n    for (const p of extraParameters) {\n        params[p.name] = p.value;\n    }\n\n    /*\n    parsed.query = queryString.stringify(params);\n    const result = parsed.toString();\n\n    if (url.indexOf(parsed.protocol) >= 0 || url.indexOf(\"/\") == 0) {\n        return result;\n    }\n\n    return result;\n    */\n    //Don't uppercase the parameters here if true, uppercasing is only for filling in\n    //missing parameters\n    return appendParameters(url, params, true, false /*uppercase*/);\n}\n\n/**\n * Represents a parsed URL with query string separated\n *\n * @export\n * @interface IParsedUrl\n * @since 0.12\n */\nexport interface IParsedUrl {\n    url: string;\n    query: any;\n}\n\n/**\n * Parses the given URL and separates out the query string parameters\n *\n * @export\n * @param {string} url The URL to parse\n * @returns {IParsedUrl}\n * @since 0.12\n */\nexport function parseUrl(url: string): IParsedUrl {\n    //return queryString.parseUrl(url);\n    const qi = url.lastIndexOf(\"?\");\n    const parsedUrl = qi < 0 ? url : url.substring(0, qi);\n    const query = qi < 0 ? {} : queryString.parse(url.substring(qi), DEFAULT_PARSE_OPTIONS);\n    return {\n        url: parsedUrl,\n        query\n    };\n}\n\n/**\n * Converts the given object to a query string fragment\n *\n * @export\n * @param {*} parameters The object to stringify\n * @returns {string} The query string fragment\n */\nexport function stringifyQuery(parameters: any): string {\n    return queryString.stringify(parameters);\n}\n\n/**\n * Appends the specified parameters to the given URL\n *\n * @export\n * @param {string} url The URL to append parameters to\n * @param {*} parameters The parameters to append\n * @param {boolean} [bOverwriteExisting=true] If true, will overwrite any existing parameters if the URL already has them\n * @param {boolean} [bConvertToUppercase=true] If true, will ensure all parameter names are uppercase\n * @param {boolean} [bDiscardExistingParams=true] If true, will discard existing query string params before appending\n * @since 0.12\n */\nexport function appendParameters(url: string, parameters: any, bOverwriteExisting: boolean = true, bConvertToUppercase: boolean = false, bDiscardExistingParams: boolean = false) {\n    const parsed = parse(url);\n    let currentParams: any;\n    if (!bDiscardExistingParams) {\n        currentParams = parsed.query != null ? queryString.parse(parsed.query, DEFAULT_PARSE_OPTIONS) : {};\n    } else {\n        currentParams = {};\n    }\n\n    const paramNames: any = {};\n    for (const key in currentParams) {\n        paramNames[key.toUpperCase()] = key;\n    }\n\n    for (const name in parameters) {\n        //See if this parameter name was normalized\n        const key = paramNames[name.toUpperCase()] || name;\n        //If it was and we've got an existing value there, skip if not overwriting\n        if (key && currentParams[key] && !bOverwriteExisting) {\n            continue;\n        }\n        //Put the parameter value\n        currentParams[key] = parameters[name];\n    }\n\n    if (bConvertToUppercase) {\n        let params2: any = {};\n        for (const name in currentParams) {\n            params2[name.toUpperCase()] = currentParams[name];\n        }\n        currentParams = params2;\n    }\n\n    parsed.query = queryString.stringify(currentParams);\n    const result = parsed.toString();\n\n    if (url.indexOf(parsed.protocol) >= 0 || url.indexOf(\"/\") == 0) {\n        return result;\n    }\n\n    return result;\n}\n\n/**\n * Parses the query string section of the given URL and returns the parsed\n * parameters as an object\n * @param url The URL to parse\n * @since 0.13\n */\nexport function parseUrlParameters(url: string): any {\n    const parsed = parse(url);\n    const currentParams: any = parsed.query != null ? queryString.parse(parsed.query, DEFAULT_PARSE_OPTIONS) : {};\n    return currentParams;\n}","const SHIM_EPSILON = Math.pow(2, -52);\n\nfunction epsilon(): number {\n    const num: any = Number;\n    return num.EPSILON || SHIM_EPSILON;\n}\n\n/**\n * Restricts the given number to the given range\n * \n * @export\n * @param {number} val \n * @param {number} lower \n * @param {number} upper \n */\nexport function restrictToRange(val: number, lower: number, upper: number) {\n    return Math.min(Math.max(val, lower), upper);\n}\n\n/**\n * Indicates if the given numbers are equal\n *\n * @export\n * @param {number} a\n * @param {number} b\n * @returns {boolean}\n */\nexport function areNumbersEqual(a: number, b: number): boolean {\n    return Math.abs(a - b) < epsilon();\n}\n\n/**\n * Indicates if the given scale is within the specified range\n *\n * @export\n * @param {number} scale\n * @param {number} minScale\n * @param {number} maxScale\n * @returns {boolean}\n */\nexport function scaleRangeBetween(scale: number, minScale: number, maxScale: number): boolean {\n    //Note the '<'. This is the same range check used in MapGuide Server\n    return scale >= minScale && scale < maxScale;\n}\n\n/**\n * Gets the closest scale index for the given scale and scale array pair\n *\n * @export\n * @param {[number, number]} scales\n * @param {number} scale\n * @returns {number}\n */\nexport function getClosestScaleIndex(scales: [number, number], scale: number): number {\n    const d1 = Math.abs(scales[0] - scale);\n    const d2 = Math.abs(scales[1] - scale);\n    if (d1 < d2)\n        return 0;\n    else\n        return 1;\n}\n\n/**\n * Gets the applicable finite scale index for the given scale and finite scale array\n *\n * @export\n * @param {number[]} finiteScaleList\n * @param {number} scale\n * @returns {number}\n */\nexport function getFiniteScaleIndexForScale(finiteScaleList: number[], scale: number): number {\n    for (let i = 0; i < finiteScaleList.length; i++) {\n        if (scale >= finiteScaleList[i]) { //Found the lower bound\n            if ((i + 1) < finiteScaleList.length) { //There is a possible upper bound\n                if (scale <= finiteScaleList[i+1]) { //It is the upper bound\n                    const test: [number, number] = [finiteScaleList[i], finiteScaleList[i+1]];\n                    //Snap to the scale with lowest difference\n                    const testIndex = getClosestScaleIndex(test, scale);\n                    if (testIndex == 0) {\n                        return i;\n                    } else {\n                        return i+1;\n                    }\n                }\n            } else { //There is no upper bound (we're at the end), snap to it\n                return i;\n            }\n        } else if (scale <= finiteScaleList[i]) {\n            if (i > 0) {\n                const test: [number, number] = [finiteScaleList[i-1], finiteScaleList[i]];\n                const testIndex = getClosestScaleIndex(test, scale);\n                if (testIndex == 0) {\n                    return i-1;\n                } else {\n                    return i;\n                }\n            } else {\n                return i;\n            }\n        }\n    }\n    return 0;\n}\n\n/**\n * Converts the given angle in degrees to radians\n * @param deg The angle in degrees\n */\nexport function deg2rad(deg: number): number {\n    return deg * (Math.PI / 180);\n}\n\n/**\n * Computes the sum of the given array\n * \n * @since 0.11\n * @export\n * @template T \n * @param {T[]} array \n * @param {(item: T) => number} numSelector \n * @returns {number} \n */\nexport function sum<T>(array: T[], numSelector: (item: T) => number): number {\n    let total = 0;\n    for (const item of array) {\n        total += numSelector(item);\n    }\n    return total;\n}\n\n/**\n * Rounds the given number to the specified number of decimals\n * \n * @since 0.11\n * @export\n * @param {number} num \n * @param {number} [decimals=2] \n * @returns {number} \n */\nexport function roundTo(num: number, decimals: number = 2): number {\n    const a = Math.pow(10, decimals);\n    return Math.round(num * a) / a;\n}","/**\n * deArrayify.ts\n *\n * This module provides JSON sanitization of JSON responses from the mapagent\n *\n * Being a transformation of the XML form, and taking a lowest-common-denominator\n * approach to JSON conversion, the JSON responses from MapGuide are un-wieldy to\n * use from the client-side due to:\n *\n *  a) All properties being arrays\n *  b) All property values being strings\n *\n * These functions help \"clean\" those responses to be of the form we expect (and prefer)\n */\nimport * as RtMap from \"../contracts/runtime-map\";\nimport * as Query from \"../contracts/query\";\nimport * as WebLayout from \"../contracts/weblayout\";\nimport * as Fusion from \"../contracts/fusion\";\nimport * as Constants from \"../../constants\";\nimport { MgError } from \"../error\";\nimport { ActiveSelectedFeature } from \"../common\";\n\ntype ElementType = \"string\" | \"boolean\" | \"int\" | \"float\";\n\nfunction buildPropertyGetter<T>() {\n    return (el: any, name: keyof T, type: ElementType = \"string\") => {\n        return tryGetAsProperty<T>(el, name, type);\n    }\n}\n\nfunction tryGetAsProperty<T>(el: any, name: keyof T, type: ElementType = \"string\"): any {\n    if (!el[name]) {\n        return null;\n    } else if (el[name].length === 1) {\n        const val: string = el[name][0];\n        switch (type) {\n            case \"int\":\n                return parseInt(val, 10);\n            case \"float\":\n                return parseFloat(val);\n            case \"boolean\":\n                return val.toLowerCase() === \"true\";\n            default:\n                return val;\n        }\n    }\n}\n\nfunction deArrayifyRules(rules: any[]): RtMap.RuleInfo[] {\n    const getter = buildPropertyGetter<RtMap.RuleInfo>();\n    return rules.map(r => {\n        const rule: RtMap.RuleInfo = {\n            LegendLabel: getter(r, \"LegendLabel\"),\n            Filter: getter(r, \"Filter\"),\n            Icon: getter(r, \"Icon\")\n        };\n        return rule;\n    });\n}\n\nfunction deArrayifyFeatureStyles(fts: any[]): RtMap.FeatureStyleInfo[] {\n    if (!fts) {\n        return [];\n    }\n    const getter = buildPropertyGetter<RtMap.FeatureStyleInfo>();\n    return fts.map(ft => {\n        const featureStyle: RtMap.FeatureStyleInfo = {\n            Type: getter(ft, \"Type\", \"int\"),\n            Rule: deArrayifyRules(ft.Rule)\n        };\n        return featureStyle;\n    });\n}\n\nfunction deArrayifyScaleRanges(scales: any[]): RtMap.ScaleRangeInfo[] {\n    if (!scales) { //Happens with raster layers (this is probably a bug in CREATERUNTIMEMAP)\n        const defaultRange: RtMap.ScaleRangeInfo = {\n            MinScale: 0,\n            MaxScale: Constants.MDF_INFINITY,\n            FeatureStyle: []\n        };\n        return [defaultRange];\n    }\n    \n    const getter = buildPropertyGetter<RtMap.ScaleRangeInfo>();\n    return scales.map(sc => {\n        const scale: RtMap.ScaleRangeInfo = {\n            MinScale: getter(sc, \"MinScale\", \"float\"),\n            MaxScale: getter(sc, \"MaxScale\", \"float\"),\n            FeatureStyle: deArrayifyFeatureStyles(sc.FeatureStyle)\n        };\n        return scale;\n    });\n}\n\nfunction deArrayifyFeatureSourceInfo(fs: any[]): RtMap.FeatureSourceInfo | undefined {\n    if (!fs || fs.length !== 1) {\n        return undefined;\n    }\n    const getter = buildPropertyGetter<RtMap.FeatureSourceInfo>();\n    return {\n        ResourceId: getter(fs[0], \"ResourceId\"),\n        ClassName: getter(fs[0], \"ClassName\"),\n        Geometry: getter(fs[0], \"Geometry\")\n    };\n}\n\nfunction deArrayifyLayers(layers: any[]): RtMap.MapLayer[] {\n    if (!layers)\n        return layers;\n\n    const getter = buildPropertyGetter<RtMap.MapLayer>();\n    return layers.map(lyr => {\n        const layer: RtMap.MapLayer = {\n            Type: getter(lyr, \"Type\", \"int\"),\n            Selectable: getter(lyr, \"Selectable\", \"boolean\"),\n            LayerDefinition: getter(lyr, \"LayerDefinition\"),\n            Name: getter(lyr, \"Name\"),\n            LegendLabel: getter(lyr, \"LegendLabel\"),\n            ObjectId: getter(lyr, \"ObjectId\"),\n            ParentId: getter(lyr, \"ParentId\"),\n            DisplayInLegend: getter(lyr, \"DisplayInLegend\", \"boolean\"),\n            ExpandInLegend: getter(lyr, \"ExpandInLegend\", \"boolean\"),\n            Visible: getter(lyr, \"Visible\", \"boolean\"),\n            ActuallyVisible: getter(lyr, \"ActuallyVisible\", \"boolean\"),\n            FeatureSource: deArrayifyFeatureSourceInfo(lyr.FeatureSource),\n            ScaleRange: deArrayifyScaleRanges(lyr.ScaleRange)\n        };\n        //This is either a raster or drawing layer, in this case disregard the\n        //selectability flag (and set it to false). This is to prevent false positive\n        //errors trying to do tooltip/selections against raster/drawing layers\n        if (!lyr.ScaleRange) {\n            layer.Selectable = false;\n        }\n        return layer;\n    });\n}\n\nfunction deArrayifyGroups(groups: any[]): RtMap.MapGroup[] | undefined {\n    if (!groups)\n        return undefined;\n\n    const getter = buildPropertyGetter<RtMap.MapGroup>();\n    return groups.map(grp => {\n        const group: RtMap.MapGroup = {\n            Type: getter(grp, \"Type\", \"int\"),\n            Name: getter(grp, \"Name\"),\n            LegendLabel: getter(grp, \"LegendLabel\"),\n            ObjectId: getter(grp, \"ObjectId\"),\n            ParentId: getter(grp, \"ParentId\"),\n            DisplayInLegend: getter(grp, \"DisplayInLegend\", \"boolean\"),\n            ExpandInLegend: getter(grp, \"ExpandInLegend\", \"boolean\"),\n            Visible: getter(grp, \"Visible\", \"boolean\"),\n            ActuallyVisible: getter(grp, \"ActuallyVisible\", \"boolean\")\n        };\n        return group;\n    });\n}\n\nfunction deArrayifyCoordinateSystem(cs: any[]): RtMap.CoordinateSystemType {\n    if (!cs || cs.length !== 1) {\n        throw new MgError(\"Malformed input. Expected CoordinateSystem element\");\n    }\n    const getter = buildPropertyGetter<RtMap.CoordinateSystemType>();\n    const res: RtMap.CoordinateSystemType = {\n        Wkt: getter(cs[0], \"Wkt\"),\n        MentorCode: getter(cs[0], \"MentorCode\"),\n        EpsgCode: getter(cs[0], \"EpsgCode\"),\n        MetersPerUnit: getter(cs[0], \"MetersPerUnit\", \"float\")\n    };\n    return res;\n}\n\nfunction deArrayifyCoordinate(coord: any[]): RtMap.EnvCoordinate {\n    if (!coord || coord.length !== 1) {\n        throw new MgError(\"Malformed input. Expected coordinate array\");\n    }\n    const getter = buildPropertyGetter<RtMap.EnvCoordinate>();\n    return {\n        X: getter(coord[0], \"X\", \"float\"),\n        Y: getter(coord[0], \"Y\", \"float\")\n    };\n}\n\nfunction deArrayifyExtents(extents: any[]): RtMap.Envelope {\n    if (!extents || extents.length !== 1) {\n        throw new MgError(\"Malformed input. Expected extent element\");\n    }\n    const env: RtMap.Envelope = {\n        LowerLeftCoordinate: deArrayifyCoordinate(extents[0].LowerLeftCoordinate),\n        UpperRightCoordinate: deArrayifyCoordinate(extents[0].UpperRightCoordinate)\n    };\n    return env;\n}\n\nfunction deArrayifyFiniteDisplayScales(fds: any[]): number[] | undefined {\n    if (!fds)\n        return undefined;\n\n    return fds.map(parseFloat);\n}\n\nfunction deArrayifyRuntimeMap(json: any): RtMap.RuntimeMap {\n    const root = json;\n    const getter = buildPropertyGetter<RtMap.RuntimeMap>();\n    const rtMap: RtMap.RuntimeMap = {\n        SessionId: getter(root, \"SessionId\"),\n        SiteVersion: getter(root, \"SiteVersion\"),\n        Name: getter(root, \"Name\"),\n        MapDefinition: getter(root, \"MapDefinition\"),\n        TileSetDefinition: getter(root, \"TileSetDefinition\"),\n        TileWidth: getter(root, \"TileWidth\", \"int\"),\n        TileHeight: getter(root, \"TileHeight\", \"int\"),\n        BackgroundColor: getter(root, \"BackgroundColor\"),\n        DisplayDpi: getter(root, \"DisplayDpi\", \"int\"),\n        IconMimeType: getter(root, \"IconMimeType\"),\n        CoordinateSystem: deArrayifyCoordinateSystem(root.CoordinateSystem),\n        Extents: deArrayifyExtents(root.Extents),\n        Group: deArrayifyGroups(root.Group),\n        Layer: deArrayifyLayers(root.Layer),\n        FiniteDisplayScale: deArrayifyFiniteDisplayScales(root.FiniteDisplayScale)\n    };\n    return rtMap;\n}\n\nfunction deArrayifyFeatureSetClass(json: any): Query.FeatureSetClass {\n    const root = json;\n    const getter = buildPropertyGetter<Query.FeatureSetClass>();\n    if (root.length != 1) {\n        throw new MgError(\"Malformed input. Expected Class element\");\n    }\n    const cls = {\n        \"@id\": getter(root[0], \"@id\"),\n        ID: root[0].ID\n    };\n    return cls;\n}\n\nfunction deArrayifyFeatureSetLayers(json: any[]): Query.FeatureSetLayer[] {\n    const getter = buildPropertyGetter<Query.FeatureSetLayer>();\n    return (json || []).map(root => {\n        const layer = {\n            \"@id\": getter(root, \"@id\"),\n            \"@name\": getter(root, \"@name\"),\n            Class: deArrayifyFeatureSetClass(root.Class)\n        };\n        return layer;\n    });\n}\n\nfunction deArrayifyFeatureSet(json: any): Query.FeatureSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const fs = {\n        Layer: deArrayifyFeatureSetLayers(root[0].Layer)\n    };\n    return fs;\n}\n\nfunction deArrayifyInlineSelectionImage(json: any): Query.SelectionImage | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const getter = buildPropertyGetter<Query.SelectionImage>();\n    const img = {\n        MimeType: getter(root[0], \"MimeType\"),\n        Content: getter(root[0], \"Content\")\n    };\n    return img;\n}\n\nfunction deArrayifyFeatureProperties(json: any[]): Query.FeatureProperty[] {\n    const getter = buildPropertyGetter<Query.FeatureProperty>();\n    return (json || []).map(root => {\n        const prop = {\n            Name: getter(root, \"Name\"),\n            Value: getter(root, \"Value\")\n        };\n        return prop;\n    });\n}\n\nfunction deArrayifyFeatures(json: any[]): Query.SelectedFeature[] {\n    const getter = buildPropertyGetter<Query.SelectedFeature>();\n    return (json || []).map(root => {\n        const feat = {\n            Bounds: getter(root, \"Bounds\"),\n            Property: deArrayifyFeatureProperties(root.Property),\n            SelectionKey: getter(root, \"SelectionKey\")\n        };\n        return feat;\n    });\n}\n\nfunction deArrayifyLayerMetadataProperties(json: any[]): Query.LayerPropertyMetadata[] {\n    const getter = buildPropertyGetter<Query.LayerPropertyMetadata>();\n    return (json || []).map(root => {\n        const prop = {\n            DisplayName: getter(root, \"DisplayName\"),\n            Name: getter(root, \"Name\"),\n            Type: getter(root, \"Type\", \"int\")\n        };\n        return prop;\n    });\n}\n\nfunction deArrayifyLayerMetadata(json: any): Query.LayerMetadata | undefined {\n    const root = json;\n    //NOTE: root could be null if the layer selected has no properties beyond id/geom\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const meta = {\n        Property: deArrayifyLayerMetadataProperties(root[0].Property)\n    };\n    return meta;\n}\n\nfunction deArrayifySelectedLayer(json: any[]): Query.SelectedLayer[] {\n    const getter = buildPropertyGetter<Query.SelectedLayer>();\n    return (json || []).map(root => {\n        const layer = {\n            \"@id\": getter(root, \"@id\"),\n            \"@name\": getter(root, \"@name\"),\n            Feature: deArrayifyFeatures(root.Feature),\n            LayerMetadata: deArrayifyLayerMetadata(root.LayerMetadata)\n        };\n        return layer;\n    });\n}\n\nfunction deArrayifySelectedFeatures(json: any): Query.SelectedFeatureSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const sf = {\n        SelectedLayer: deArrayifySelectedLayer(root[0].SelectedLayer)\n    };\n    return sf;\n}\n\nfunction deArrayifyFeatureInformation(json: any): Query.QueryMapFeaturesResponse {\n    const root = json;\n    const getter = buildPropertyGetter<Query.QueryMapFeaturesResponse>();\n    const resp = {\n        FeatureSet: deArrayifyFeatureSet(root.FeatureSet),\n        Hyperlink: getter(root, \"Hyperlink\"),\n        InlineSelectionImage: deArrayifyInlineSelectionImage(root.InlineSelectionImage),\n        SelectedFeatures: deArrayifySelectedFeatures(root.SelectedFeatures),\n        Tooltip: getter(root, \"Tooltip\")\n    };\n    return resp;\n}\n\nfunction deArrayifyWebLayoutControl<T extends WebLayout.WebLayoutControl>(json: any): T {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected control element\");\n    }\n    const getter = buildPropertyGetter<T>();\n    const control: any = {\n        Visible: getter(root[0], \"Visible\", \"boolean\")\n    };\n    return control;\n}\n\nfunction deArrayifyWebLayoutInfoPane(json: any): WebLayout.WebLayoutInfoPane {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected InformationPane element\");\n    }\n    const getter = buildPropertyGetter<WebLayout.WebLayoutInfoPane>();\n    const infoPane = {\n        Visible: getter(root[0], \"Visible\", \"boolean\"),\n        Width: getter(root[0], \"Width\", \"int\"),\n        LegendVisible: getter(root[0], \"LegendVisible\", \"boolean\"),\n        PropertiesVisible: getter(root[0], \"PropertiesVisible\", \"boolean\")\n    };\n    return infoPane;\n}\n\nfunction deArrayifyWebLayoutInitialView(json: any): WebLayout.MapView | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const getter = buildPropertyGetter<WebLayout.MapView>();\n    const view = {\n        CenterX: getter(root[0], \"CenterX\", \"float\"),\n        CenterY: getter(root[0], \"CenterY\", \"float\"),\n        Scale: getter(root[0], \"Scale\", \"float\")\n    };\n    return view;\n}\n\nfunction deArrayifyWebLayoutMap(json: any): WebLayout.WebLayoutMap {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected Map element\");\n    }\n    const getter = buildPropertyGetter<WebLayout.WebLayoutMap>();\n    const map = {\n        ResourceId: getter(root[0], \"ResourceId\"),\n        InitialView: deArrayifyWebLayoutInitialView(root[0].InitialView),\n        HyperlinkTarget: getter(root[0], \"HyperlinkTarget\"),\n        HyperlinkTargetFrame: getter(root[0], \"HyperlinkTargetFrame\")\n    };\n    return map;\n}\n\nfunction deArrayifyTaskButton(json: any): WebLayout.TaskButton {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected TaskButton element\");\n    }\n    const getter = buildPropertyGetter<WebLayout.TaskButton>();\n    const button = {\n        Name: getter(root[0], \"Name\"),\n        Tooltip: getter(root[0], \"Tooltip\"),\n        Description: getter(root[0], \"Description\"),\n        ImageURL: getter(root[0], \"ImageURL\"),\n        DisabledImageURL: getter(root[0], \"DisabledImageURL\")\n    };\n    return button;\n}\n\nfunction deArrayifyWebLayoutTaskBar(json: any): WebLayout.WebLayoutTaskBar {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected TaskBar element\");\n    }\n    const getter = buildPropertyGetter<WebLayout.WebLayoutTaskBar>();\n    const taskbar = {\n        Visible: getter(root[0], \"Visible\", \"boolean\"),\n        Home: deArrayifyTaskButton(root[0].Home),\n        Forward: deArrayifyTaskButton(root[0].Forward),\n        Back: deArrayifyTaskButton(root[0].Back),\n        Tasks: deArrayifyTaskButton(root[0].Tasks),\n        MenuButton: [] as WebLayout.UIItem[]\n    };\n    if (root[0].MenuButton) {\n        for (const mb of root[0].MenuButton) {\n            taskbar.MenuButton.push(deArrayifyUIItem(mb));\n        }\n    }\n    return taskbar;\n}\n\nfunction deArrayifyWebLayoutTaskPane(json: any): WebLayout.WebLayoutTaskPane {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected TaskPane element\");\n    }\n    const getter = buildPropertyGetter<WebLayout.WebLayoutTaskPane>();\n    const taskPane = {\n        Visible: getter(root[0], \"Visible\", \"boolean\"),\n        InitialTask: getter(root[0], \"InitialTask\"),\n        Width: getter(root[0], \"Width\", \"int\"),\n        TaskBar: deArrayifyWebLayoutTaskBar(root[0].TaskBar)\n    };\n    return taskPane;\n}\n\nfunction deArrayifyUIItem(json: any): WebLayout.UIItem {\n    const root = json;\n    const getter = buildPropertyGetter<WebLayout.UIItem & WebLayout.CommandUIItem & WebLayout.FlyoutUIItem>();\n    const func: string = getter(root, \"Function\");\n    //Wouldn't it be nice if we could incrementally build up a union type that then becomes a specific\n    //type once certain properties are set?\n    //\n    //Well, that's currently not possible. So we have to resort to \"any\"\n    const item: any = {\n        Function: func\n    };\n    switch (func) {\n        case \"Command\":\n            item.Command = getter(root, \"Command\");\n            break;\n        case \"Flyout\":\n            item.Label = getter(root, \"Label\");\n            item.Tooltip = getter(root, \"Tooltip\");\n            item.Description = getter(root, \"Description\");\n            item.ImageURL = getter(root, \"ImageURL\");\n            item.DisabledImageURL = getter(root, \"DisabledImageURL\");\n            item.SubItem = [];\n            for (const si of root.SubItem) {\n                item.SubItem.push(deArrayifyUIItem(si));\n            }\n            break;\n    }\n    return item;\n}\n\nfunction deArrayifyItemContainer<T extends WebLayout.WebLayoutControl>(json: any, name: string): T {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected container element\");\n    }\n    const getter = buildPropertyGetter<T>();\n    const container: any = {};\n    container[name] = [];\n    for (const item of root[0][name]) {\n        container[name].push(deArrayifyUIItem(item));\n    }\n    if (typeof (root[0].Visible) != 'undefined') {\n        container.Visible = getter(root[0], \"Visible\", \"boolean\");\n    }\n    return container;\n}\n\nfunction deArrayifyWebLayoutSearchResultColumnSet(json: any): WebLayout.ResultColumnSet {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected ResultColumns element\");\n    }\n    const getter = buildPropertyGetter<WebLayout.ResultColumn>();\n    const res = {\n        Column: [] as WebLayout.ResultColumn[]\n    };\n    for (const col of root[0].Column) {\n        res.Column.push({\n            Name: getter(col, \"Name\"),\n            Property: getter(col, \"Property\")\n        });\n    }\n    return res;\n}\n\nfunction deArrayifyWebLayoutInvokeURLLayerSet(json: any): WebLayout.LayerSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const layerset = {\n        Layer: root[0].Layer\n    };\n    return layerset;\n}\n\nfunction deArrayifyWebLayoutParameterPairs(json: any): WebLayout.ParameterPair[] {\n    const root = json;\n    const pairs = [] as WebLayout.ParameterPair[]\n    if (!root) {\n        return pairs;\n    }\n    const getter = buildPropertyGetter<WebLayout.ParameterPair>();\n    for (const kvp of root) {\n        pairs.push({\n            Key: getter(kvp, \"Key\"),\n            Value: getter(kvp, \"Value\")\n        });\n    }\n    return pairs;\n}\n\nfunction deArrayifyCommand(json: any): WebLayout.CommandDef {\n    const root = json;\n    const getter = buildPropertyGetter<WebLayout.CommandDef & WebLayout.BasicCommandDef & WebLayout.InvokeScriptCommandDef & WebLayout.InvokeURLCommandDef & WebLayout.SearchCommandDef>();\n    const cmd: any = {\n        \"@xsi:type\": getter(root, \"@xsi:type\"),\n        Name: getter(root, \"Name\"),\n        Label: getter(root, \"Label\"),\n        Tooltip: getter(root, \"Tooltip\"),\n        Description: getter(root, \"Description\"),\n        ImageURL: getter(root, \"ImageURL\"),\n        DisabledImageURL: getter(root, \"DisabledImageURL\"),\n        TargetViewer: getter(root, \"TargetViewer\")\n    };\n    //Basic\n    if (typeof (root.Action) != 'undefined') {\n        cmd.Action = getter(root, \"Action\");\n    }\n    //Targeted\n    if (typeof (root.Target) != 'undefined') {\n        cmd.Target = getter(root, \"Target\");\n    }\n    if (typeof (root.TargetFrame) != 'undefined') {\n        cmd.TargetFrame = getter(root, \"TargetFrame\");\n    }\n    //Search\n    if (typeof (root.Layer) != 'undefined') {\n        cmd.Layer = getter(root, \"Layer\");\n        cmd.Prompt = getter(root, \"Prompt\");\n        cmd.ResultColumns = deArrayifyWebLayoutSearchResultColumnSet(root.ResultColumns);\n        cmd.Filter = getter(root, \"Filter\");\n        cmd.MatchLimit = getter(root, \"MatchLimit\", \"int\");\n    }\n    //InvokeURL | Help\n    if (typeof (root.URL) != 'undefined') {\n        cmd.URL = getter(root, \"URL\");\n    }\n    if (typeof (root.DisableIfSelectionEmpty) != 'undefined') {\n        cmd.LayerSet = deArrayifyWebLayoutInvokeURLLayerSet(root.LayerSet);\n        cmd.AdditionalParameter = deArrayifyWebLayoutParameterPairs(root.AdditionalParameter);\n        cmd.DisableIfSelectionEmpty = getter(root, \"DisableIfSelectionEmpty\", \"boolean\");\n    }\n    //InvokeScript\n    if (typeof (root.Script) != 'undefined') {\n        cmd.Script = getter(root, \"Script\");\n    }\n    return cmd;\n}\n\nfunction deArrayifyWebLayoutCommandSet(json: any): WebLayout.WebLayoutCommandSet {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected CommandSet element\");\n    }\n    const set = {\n        Command: [] as WebLayout.CommandDef[]\n    };\n    if (root[0].Command) {\n        for (const cmd of root[0].Command) {\n            set.Command.push(deArrayifyCommand(cmd));\n        }\n    }\n    return set;\n}\n\nfunction deArrayifyWebLayout(json: any): WebLayout.WebLayout {\n    const root = json;\n    const getter = buildPropertyGetter<WebLayout.WebLayout>();\n    const resp = {\n        Title: getter(root, \"Title\"),\n        Map: deArrayifyWebLayoutMap(root.Map),\n        EnablePingServer: getter(root, \"EnablePingServer\", \"boolean\"),\n        SelectionColor: getter(root, \"SelectionColor\"),\n        PointSelectionBuffer: getter(root, \"PointSelectionBuffer\", \"int\"),\n        MapImageFormat: getter(root, \"MapImageFormat\"),\n        SelectionImageFormat: getter(root, \"SelectionImageFormat\"),\n        StartupScript: getter(root, \"StartupScript\"),\n        ToolBar: deArrayifyItemContainer<WebLayout.WebLayoutToolbar>(root.ToolBar, \"Button\"),\n        InformationPane: deArrayifyWebLayoutInfoPane(root.InformationPane),\n        ContextMenu: deArrayifyItemContainer<WebLayout.WebLayoutContextMenu>(root.ContextMenu, \"MenuItem\"),\n        TaskPane: deArrayifyWebLayoutTaskPane(root.TaskPane),\n        StatusBar: deArrayifyWebLayoutControl<WebLayout.WebLayoutStatusBar>(root.StatusBar),\n        ZoomControl: deArrayifyWebLayoutControl<WebLayout.WebLayoutZoomControl>(root.ZoomControl),\n        CommandSet: deArrayifyWebLayoutCommandSet(root.CommandSet)\n    };\n    return resp;\n}\n\nfunction deArrayifyMapGroup(json: any): Fusion.MapSetGroup {\n    const root = json;\n    if (root == null) {\n        throw new MgError(\"Malformed input. Expected MapGroup element\");\n    }\n    const getter = buildPropertyGetter<Fusion.MapSetGroup & Fusion.MapInitialView & Fusion.MapConfiguration>();\n    const mapGroup: Fusion.MapSetGroup = {\n        \"@id\": getter(root, \"@id\", \"string\"),\n        InitialView: undefined,\n        Map: [] as Fusion.MapConfiguration[]\n    };\n    if (root.InitialView) {\n        const iview = root.InitialView[0];\n        mapGroup.InitialView = {\n            CenterX: getter(iview, \"CenterX\", \"float\"),\n            CenterY: getter(iview, \"CenterY\", \"float\"),\n            Scale: getter(iview, \"Scale\", \"float\")\n        };\n    }\n    if (root.Map) {\n        for (const m of root.Map) {\n            mapGroup.Map.push({\n                Type: getter(m, \"Type\", \"string\"),\n                SingleTile: getter(m, \"SingleTile\", \"boolean\"),\n                Extension: deArrayifyExtension(m.Extension)\n            });\n        }\n    }\n    return mapGroup;\n}\n\nfunction deArrayifyMapSet(json: any): Fusion.MapSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected MapSet element\");\n    }\n    const set = {\n        MapGroup: [] as Fusion.MapSetGroup[]\n    };\n    if (root[0].MapGroup) {\n        for (const map of root[0].MapGroup) {\n            set.MapGroup.push(deArrayifyMapGroup(map));\n        }\n    }\n    return set;\n}\n\nfunction deArrayifyContainerItems(json: any[]): Fusion.ContainerItem[] {\n    const items = [] as Fusion.ContainerItem[];\n    const getter = buildPropertyGetter<Fusion.ContainerItem & Fusion.FlyoutItem & Fusion.WidgetItem>();\n    if (json && json.length) {\n        for (const i of json) {\n            const func = getter(i, \"Function\", \"string\");\n            switch (func) {\n                case \"Separator\":\n                    items.push({\n                        Function: \"Separator\"\n                    });\n                    break;\n                case \"Widget\":\n                    items.push({\n                        Function: \"Widget\",\n                        Widget: getter(i, \"Widget\", \"string\")\n                    })\n                    break;\n                case \"Flyout\":\n                    items.push({\n                        Function: \"Flyout\",\n                        Label: getter(i, \"Label\", \"string\"),\n                        Tooltip: getter(i, \"Tooltip\", \"string\"),\n                        ImageUrl: getter(i, \"ImageUrl\", \"string\"),\n                        ImageClass: getter(i, \"ImageClass\", \"string\"),\n                        Item: deArrayifyContainerItems(i.Item || [])\n                    })\n                    break;\n            }\n        }\n    }\n    return items;\n}\n\nfunction deArrayifyContainer(json: any[]): Fusion.ContainerDefinition[] {\n    const containers = [] as Fusion.ContainerDefinition[];\n    const getter = buildPropertyGetter<Fusion.ContainerDefinition>();\n    for (const c of json) {\n        containers.push({\n            Name: getter(c, \"Name\", \"string\"),\n            Type: getter(c, \"Type\", \"string\"),\n            Position: getter(c, \"Position\", \"string\"),\n            Extension: deArrayifyExtension(c.Extension),\n            Item: deArrayifyContainerItems(c.Item)\n        });\n    }\n    return containers;\n}\n\nfunction deArrayifyWidgets(json: any[]): Fusion.Widget[] {\n    const widgets = [] as Fusion.Widget[];\n    for (const w of json) {\n        if (w[\"@xsi:type\"] == \"UiWidgetType\") {\n            const uiw = deArrayifyUiWidget(w);\n            widgets.push(uiw);\n        } else {\n            widgets.push(deArrayifyWidget(w));\n        }\n    }\n    return widgets;\n}\n\nfunction deArrayifyWidget(json: any): Fusion.Widget {\n    const root = json;\n    if (root == null) {\n        throw new MgError(\"Malformed input. Expected Widget element\");\n    }\n    const getter = buildPropertyGetter<Fusion.Widget & { \"@xsi:type\": string }>();\n    const w = {\n        WidgetType: getter(root, \"@xsi:type\", \"string\"),\n        Name: getter(root, \"Name\", \"string\"),\n        Type: getter(root, \"Type\", \"string\"),\n        Location: getter(root, \"Location\", \"string\"),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return w;\n}\n\nfunction deArrayifyExtension(json: any, arrayCheck: boolean = true): any {\n    const root = json;\n    if (root == null) {\n        return null;\n    }\n    if (arrayCheck && root.length != 1) {\n        throw new MgError(\"Malformed input. Expected Extension element\");\n    }\n    const getter = buildPropertyGetter<{ Key: string, Value: string, [key: string]: string}>();\n    const ext: any = {};\n    for (const key in root[0]) {\n        if (Array.isArray(root[0][key])) {\n            //Special case handling\n            switch (key) {\n                case \"AdditionalParameter\":\n                    {\n                        const params = [];\n                        for (const p of root[0][key]) {\n                            params.push({\n                                Key: getter(p, \"Key\", \"string\"),\n                                Value: getter(p, \"Value\", \"string\")\n                            });\n                        }\n                        ext[key] = params;\n                    }\n                    break;\n                case \"Projection\":\n                    {\n                        ext[key] = root[0][key];\n                    }\n                    break;\n                default:\n                    ext[key] = getter(root[0], key, \"string\");\n                    break;\n            }\n        } else {\n            ext[key] = deArrayifyExtension(root[0][key], false);\n        }\n    }\n    return ext;\n}\n\nfunction deArrayifyUiWidget(json: any): Fusion.UIWidget {\n    const root = json;\n    if (root == null) {\n        throw new MgError(\"Malformed input. Expected Widget element\");\n    }\n    const getter = buildPropertyGetter<Fusion.UIWidget & { \"@xsi:type\": string }>();\n    const w = {\n        WidgetType: getter(root, \"@xsi:type\", \"string\"),\n        ImageUrl: getter(root, \"ImageUrl\", \"string\"),\n        ImageClass: getter(root, \"ImageClass\", \"string\"),\n        Label: getter(root, \"Label\", \"string\"),\n        Tooltip: getter(root, \"Tooltip\", \"string\"),\n        StatusText: getter(root, \"StatusText\", \"string\"),\n        Disabled: getter(root, \"Disabled\", \"boolean\"),\n        Name: getter(root, \"Name\", \"string\"),\n        Type: getter(root, \"Type\", \"string\"),\n        Location: getter(root, \"Location\", \"string\"),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return w;\n}\n\nfunction deArrayifyMapWidget(json: any): Fusion.MapWidget {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected MapWidget element\");\n    }\n    const getter = buildPropertyGetter<Fusion.MapWidget & { \"@xsi:type\": string }>();\n    const mw = {\n        WidgetType: getter(root, \"@xsi:type\", \"string\"),\n        MapId: getter(root, \"MapId\", \"string\"),\n        Name: getter(root, \"Name\", \"string\"),\n        Type: getter(root, \"Type\", \"string\"),\n        Location: getter(root, \"Location\", \"string\"),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return mw;\n}\n\nfunction deArrayifyWidgetSet(json: any): Fusion.WidgetSet[] {\n    const widgetSet = [] as Fusion.WidgetSet[];\n    for (const ws of json) {\n        widgetSet.push({\n            Container: deArrayifyContainer(ws.Container),\n            MapWidget: deArrayifyMapWidget(ws.MapWidget),\n            Widget: deArrayifyWidgets(ws.Widget)\n        })\n    }\n    return widgetSet;\n}\n\nfunction deArrayifyFlexibleLayout(json: any): Fusion.ApplicationDefinition {\n    const root = json;\n    const getter = buildPropertyGetter<Fusion.ApplicationDefinition>();\n    const resp = {\n        Title: getter(root, \"Title\"),\n        TemplateUrl: getter(root, \"TemplateUrl\"),\n        MapSet: deArrayifyMapSet(root.MapSet),\n        WidgetSet: deArrayifyWidgetSet(root.WidgetSet),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return resp;\n}\n\n/**\n * Normalizes the given JSON object to match the content model of its original XML form\n *\n * @export\n * @param {*} json The JSON object to normalize\n * @returns {*} The normalized JSON object\n */\nexport function deArrayify(json: any): any {\n    if (json[\"RuntimeMap\"]) {\n        return deArrayifyRuntimeMap(json.RuntimeMap);\n    }\n    if (json[\"FeatureInformation\"]) {\n        return deArrayifyFeatureInformation(json.FeatureInformation);\n    }\n    if (json[\"WebLayout\"]) {\n        return deArrayifyWebLayout(json.WebLayout);\n    }\n    if (json[\"ApplicationDefinition\"]) {\n        return deArrayifyFlexibleLayout(json.ApplicationDefinition);\n    }\n    const keys = [] as string[];\n    for (const k in json) {\n        keys.push(k);\n    }\n    throw new MgError(`Unsure how to process JSON response. Root elements are: (${keys.join(\", \")})`);\n}\n\n/**\n * Builds an XML selection string from the given selection set.\n *\n * @export\n * @param {(Query.FeatureSet | undefined)} selection The selection set\n * @param {string[]} [layerIds] If specified, the selection XML will only include selections from the specified layers\n * @returns {string} The selection XML string\n */\nexport function buildSelectionXml(selection: Query.FeatureSet | undefined, layerIds?: string[]): string {\n    let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>';\n    xml += '<FeatureSet xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"FeatureSet-1.0.0.xsd\">';\n    if (selection) {\n        const selLayers = selection.Layer;\n        for (const layer of selLayers) {\n            const layerId = layer[\"@id\"];\n            if (layerIds != null && layerIds.indexOf(layerId) < 0) {\n                continue;\n            }\n            xml += `<Layer id=\"${layerId}\">`;\n            const cls = layer.Class;\n            xml += `<Class id=\"${cls[\"@id\"]}\">`;\n            for (const id of cls.ID) {\n                xml += `<ID>${id}</ID>`;\n            }\n            xml += '</Class>';\n            xml += '</Layer>';\n        }\n    }\n    xml += '</FeatureSet>';\n    return xml;\n}\n\n/**\n * Can only be used for a v4.0.0 or higher QUERYMAPFEATURES request\n * @param selection Current selection set\n * @param feat The active selected feature\n */\nexport function getActiveSelectedFeatureXml(selection: Query.FeatureSet, feat: ActiveSelectedFeature): string | undefined {\n    for (const layer of selection.Layer) {\n        const layerId = layer[\"@id\"];\n        if (layerId == feat.layerId) {\n            const key = feat.selectionKey;\n            let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>';\n            xml += '<FeatureSet xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"FeatureSet-1.0.0.xsd\">';\n            xml += `<Layer id=\"${layerId}\">`;\n            xml += `<Class id=\"${layer.Class[\"@id\"]}\">`;\n            xml += `<ID>${key}</ID>`;\n            xml += '</Class>';\n            xml += '</Layer>';\n            xml += '</FeatureSet>';\n            return xml;\n        }\n    }\n}","export const STD_CSS_SPRITE_RELPATH = \"images/icons.png\";\n\nexport { default as CURSOR_DIGITIZE_POINT } from \"../../stdassets/cursors/digitizePoint.cur\";\nexport { default as CURSOR_DIGITIZE_LINE } from \"../../stdassets/cursors/digitizeLine.cur\";\nexport { default as CURSOR_DIGITIZE_LINESTRING } from \"../../stdassets/cursors/digitizeLineString.cur\";\nexport { default as CURSOR_DIGITIZE_RECT } from \"../../stdassets/cursors/digitizeRectangle.cur\";\nexport { default as CURSOR_DIGITIZE_POLYGON } from \"../../stdassets/cursors/digitizePolygon.cur\";\nexport { default as CURSOR_DIGITIZE_CIRCLE } from \"../../stdassets/cursors/digitizeCircle.cur\";\nexport { default as CURSOR_GRABBING } from \"../../stdassets/cursors/grabbing.cur\";\nexport { default as CURSOR_GRAB } from \"../../stdassets/cursors/grab.cur\";\nexport { default as CURSOR_ZOOM_IN } from \"../../stdassets/cursors/zoomin.cur\";\n\nexport { default as IMG_SLIDER_SCALE } from \"../../stdassets/images/res/sliderscale.png\";\nexport { default as GIF_SPINNER } from \"../../stdassets/images/res/spinner.gif\";\nexport { default as IMG_SLIDER } from \"../../stdassets/images/res/slider.png\";\n\nexport { default as IMG_PBMG } from \"../../stdassets/images/icons/PoweredBy_en.png\";\n\nexport { default as ICON_ABOUT } from \"../../stdassets/images/icons/about.png\";\nexport { default as ICON_APPLICATION_BROWSER } from \"../../stdassets/images/icons/application-browser.png\";\nexport { default as ICON_BACK } from \"../../stdassets/images/icons/back.png\";\nexport { default as ICON_BUFFER } from \"../../stdassets/images/icons/buffer.png\";\nexport { default as ICON_CONTROL_180 } from \"../../stdassets/images/icons/control-180.png\";\nexport { default as ICON_CONTROL_STOP_180 } from \"../../stdassets/images/icons/control-stop-180.png\";\nexport { default as ICON_CONTROL_STOP } from \"../../stdassets/images/icons/control-stop.png\";\nexport { default as ICON_CONTROL } from \"../../stdassets/images/icons/control.png\";\nexport { default as ICON_COORDINATE_TRACKER } from \"../../stdassets/images/icons/coordinate-tracker.png\";\nexport { default as ICON_EDIT_COPY } from \"../../stdassets/images/icons/edit-copy.png\";\nexport { default as ICON_EDIT_CUT } from \"../../stdassets/images/icons/edit-cut.png\";\nexport { default as ICON_EDIT_DUPLICATE } from \"../../stdassets/images/icons/edit-duplicate.png\";\nexport { default as ICON_EDIT_PASTE } from \"../../stdassets/images/icons/edit-paste.png\";\nexport { default as ICON_EDIT_XML } from \"../../stdassets/images/icons/edit-xml.png\";\nexport const ICON_ERROR = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA31JREFUeNpc01tMUwcAxvH/ubWnFEohtBSYKJciCHJTsojOZS4mi9HswcwlZmaMBUMW2QOZMwvJnvewLSNLMDHGLXtmLpvRZS44QDYWqgWDrSBjsIGWcm1LaU8v55w9uRi/5y//t5/wXkcHAKZpYhgGCAL5LnddWUnp0dpqb6PVoggT/vuBX3+7Mzo2NDTNCxOeBTLpNPnu4r3NNbWfVSYTJ3OWl2R9fR3dMLC4XJh7KoyAINzu//abTx5O+qeeBaSW5may2SylFZVvvF5Rfav6z99bJL9PzITDZLa3ycRiJJ4ssT01Kbg2N6pPd77/zroszc0Gg0EAqbGhAUeRy3usouq2+5dbBVooRMaWg6ZpZESBtGGQSmfQrVaiKyts3btneau7+03/0tLPT5eXQ6IpCDRWeb8sGL6Tv7O2hvvMGZouDyCXl5OIRknEYrBrF7aeHoS2NqKRCNNf9Vs/On/+a0lRJNFR5Kot29w4oS39Q9I0yWlsRNq9m/KLF8HlxvR4sJ49S8LhYLuoiKSmsRwMoM7PH2o6cPBlqfXAwdP7NzZOpcIh0obB07Ex8HgwPB4yL5Wh19SwrSisDg0RGxiASAR9ZwdZ10nt2/evWFtZWa+thtGyOmkgvr6Gr7OThRs3iMoKMUVh6+5dEv39qKkUsixjlSSyK2EK7bleURRFMaPrpHQdbWeH+MwsptVKQlWJx+MkNQ2cTuweD7JuYJVlVEXBKokYuiFKRZ6SyqZc+4nIX3MkFhaQvV6cfX0knU5iIyMY4TC2lhYKjhxBWVxE2tzEAhTU7MWnqjdFn//+sFhZZcbn/yadyZBz7hzJwkK2RkdJXrkCV69in5uj+vhx9vT2ogIOw8BW34A/GByW5x4FAwuqddjm8by2FgoRunYNsb0dbXCQXFFENk0yA5eJWixErl/HKYrkl5Yy6XY/mp1+MCoANLS2Nn/xbsf4xKWP1aSmYQFURcFmsWCTJOyCgJpOkyfLOO12Uhc+pOv7wZMzk/6bEsBqKLQSzc2df/tCz6nNqSk5HouhmCZWSUIVRXJME4dpUlRWRrr7Az4dH+/1jQ5/ByA8L6vt8OH2S11dn+c8fnxo449xzPAKdlGisNiNpb6BQHHJw/4ff+gL+CZ++l/jizyRJKH9laOv7q+rO+bKy6s2dF16srm1ODUTHHng890hm9Wev/83AKQ+gKOX5raoAAAAAElFTkSuQmCC\"; //require(\"../../stdassets/images/icons/icon_error.png\");\nexport { default as ICON_FEATURE_INFO } from \"../../stdassets/images/icons/feature-info.png\";\nexport { default as ICON_FILE_PRINT } from \"../../stdassets/images/icons/file-print.png\";\nexport { default as ICON_FILE_SAVE } from \"../../stdassets/images/icons/file-save.png\";\nexport { default as ICON_FOLDER_HORIZONTAL_OPEN } from \"../../stdassets/images/icons/folder-horizontal-open.png\";\nexport { default as ICON_FOLDER_HORIZONTAL } from \"../../stdassets/images/icons/folder-horizontal.png\";\nexport { default as ICON_FORWARD } from \"../../stdassets/images/icons/forward.png\";\nexport { default as ICON_GEOLOCATION } from \"../../stdassets/images/icons/geolocation.png\";\nexport { default as ICON_HELP } from \"../../stdassets/images/icons/help.png\";\nexport { default as ICON_HOME } from \"../../stdassets/images/icons/icon_home.png\";\nexport { default as ICON_MENUARROW_DISABLED } from \"../../stdassets/images/icons/icon_menuarrow_disabled.png\";\nexport { default as ICON_MENUARROW } from \"../../stdassets/images/icons/icon_menuarrow.png\";\nexport { default as ICON_MENUARROWUP_DISABLED } from \"../../stdassets/images/icons/icon_menuarrowup_disabled.png\";\nexport { default as ICON_MENUARROWUP } from \"../../stdassets/images/icons/icon_menuarrowup.png\";\nexport { default as ICON_REFRESHMAP } from \"../../stdassets/images/icons/icon_refreshmap.png\";\nexport { default as ICON_SELECT } from \"../../stdassets/images/icons/select.png\";\nexport { default as ICON_ZOOMSELECT } from \"../../stdassets/images/icons/icon_zoomselect.png\";\nexport { default as ICON_NAVIGATOR } from \"../../stdassets/images/icons/iconNavigator.png\";\nexport { default as ICON_INFO } from \"../../stdassets/images/icons/info.png\";\nexport { default as ICON_INITIAL_CENTER } from \"../../stdassets/images/icons/initial-center.png\";\nexport { default as ICON_INVOKE_SCRIPT } from \"../../stdassets/images/icons/invoke-script.png\";\nexport { default as ICON_INVOKE_URL } from \"../../stdassets/images/icons/invoke-url.png\";\nexport { default as ICON_UNSELECT } from \"../../stdassets/images/icons/lc_unselect.png\";\nexport { default as ICON_LEGEND_DWF } from \"../../stdassets/images/icons/legend-DWF.png\";\nexport { default as ICON_LEGEND_LAYER } from \"../../stdassets/images/icons/legend-layer.png\";\nexport { default as ICON_LEGEND_MAP } from \"../../stdassets/images/icons/legend-map.png\";\nexport { default as ICON_LEGEND_RASTER } from \"../../stdassets/images/icons/legend-raster.png\";\nexport { default as ICON_LEGEND_THEME } from \"../../stdassets/images/icons/legend-theme.png\";\nexport { default as ICON_MAPTIP } from \"../../stdassets/images/icons/maptip.png\";\nexport { default as ICON_MEASURE } from \"../../stdassets/images/icons/measure.png\";\nexport { default as ICON_OPTIONS } from \"../../stdassets/images/icons/options.png\";\nexport { default as ICON_OUT_OF_RANGE } from \"../../stdassets/images/icons/out-of-range.png\";\nexport { default as ICON_OVERVIEW_MAP } from \"../../stdassets/images/icons/overview-map.png\";\nexport { default as ICON_PAN_EAST } from \"../../stdassets/images/icons/pan-east.png\";\nexport { default as ICON_PAN_NORTH } from \"../../stdassets/images/icons/pan-north.png\";\nexport { default as ICON_PAN_SOUTH } from \"../../stdassets/images/icons/pan-south.png\";\nexport { default as ICON_PAN_WEST } from \"../../stdassets/images/icons/pan-west.png\";\nexport { default as ICON_PAN } from \"../../stdassets/images/icons/pan.png\";\nexport { default as ICON_PREVIEW } from \"../../stdassets/images/icons/preview.png\";\nexport { default as ICON_PRINT } from \"../../stdassets/images/icons/print.png\";\nexport { default as ICON_PROPERTY } from \"../../stdassets/images/icons/property.png\";\nexport { default as ICON_QUERY } from \"../../stdassets/images/icons/query.png\";\nexport { default as ICON_REDLINE } from \"../../stdassets/images/icons/redline.png\";\nexport { default as ICON_SEARCH } from \"../../stdassets/images/icons/search.png\";\nexport { default as ICON_SELECT_CENTRE } from \"../../stdassets/images/icons/select-centre.png\";\nexport { default as ICON_SELECT_CLEAR } from \"../../stdassets/images/icons/select-clear.png\";\nexport { default as ICON_SELECT_FEATURES } from \"../../stdassets/images/icons/select-features.png\";\nexport { default as ICON_SELECT_POLYGON } from \"../../stdassets/images/icons/select-polygon.png\";\nexport { default as ICON_SELECT_RADIUS } from \"../../stdassets/images/icons/select-radius.png\";\nexport { default as ICON_SELECT_ZOOM } from \"../../stdassets/images/icons/select-zoom.png\";\nexport { default as ICON_THEME } from \"../../stdassets/images/icons/theme.png\";\nexport { default as ICON_TOGGLE_EXPAND } from \"../../stdassets/images/icons/toggle-expand.png\";\nexport { default as ICON_TOGGLE } from \"../../stdassets/images/icons/toggle.png\";\nexport { default as ICON_UI_MENU } from \"../../stdassets/images/icons/ui-menu.png\";\nexport { default as ICON_VIEW_BACK } from \"../../stdassets/images/icons/view-back.png\";\nexport { default as ICON_VIEW_FORWARD } from \"../../stdassets/images/icons/view-forward.png\";\nexport { default as ICON_VIEW_REFRESH } from \"../../stdassets/images/icons/view-refresh.png\";\nexport { default as ICON_WARNING } from \"../../stdassets/images/icons/icon_warning.png\";\nexport { default as ICON_ZOOM_DYNAMIC } from \"../../stdassets/images/icons/zoom-dynamic.png\";\nexport { default as ICON_ZOOM_FULL } from \"../../stdassets/images/icons/zoom-full.png\";\nexport { default as ICON_ZOOM_IN_FIXED } from \"../../stdassets/images/icons/zoom-in-fixed.png\";\nexport { default as ICON_ZOOM_IN } from \"../../stdassets/images/icons/zoom-in.png\";\nexport { default as ICON_ZOOM_OUT_FIXED } from \"../../stdassets/images/icons/zoom-out-fixed.png\";\nexport { default as ICON_LAYER_ADD } from \"../../stdassets/images/icons/layer_add.png\";\nexport { default as ICON_GLOBE_ADD } from \"../../stdassets/images/icons/globe_add.png\";\n/** \n * @since 0.11\n */\nexport { default as ICON_GLOBE_SHARE } from \"../../stdassets/images/icons/globe-share.png\";\n\nexport const SPRITE_GLOBE_ADD = \"globe_add\";\nexport const SPRITE_LAYER_ADD = \"layer_add\";\nexport const SPRITE_COORDINATE_TRACKER = \"coordinate-tracker\";\nexport const SPRITE_CONTROL_180 = \"control-180\";\nexport const SPRITE_CONTROL = \"control\";\nexport const SPRITE_ICON_ZOOMSELECT = \"icon_zoomselect\";\nexport const SPRITE_LEGEND_LAYER = \"legend-layer\";\nexport const SPRITE_ICON_SELECT = \"icon_select\";\nexport const SPRITE_LC_UNSELECT = \"lc_unselect\";\nexport const SPRITE_LEGEND_THEME = \"legend-theme\";\nexport const SPRITE_LEGEND_RASTER = \"legend-raster\";\nexport const SPRITE_LEGEND_TOGGLE = \"toggle\";\nexport const SPRITE_LEGEND_TOGGLE_EXPAND = \"toggle-expand\";\nexport const SPRITE_FOLDER_HORIZONTAL = \"folder-horizontal\";\nexport const SPRITE_ICON_ERROR = \"icon_error\";\nexport const SPRITE_ICON_HOME = \"icon_home\";\nexport const SPRITE_BACK = \"back\";\nexport const SPRITE_FORWARD = \"forward\";\nexport const SPRITE_ICON_MENUARROWUP = \"icon_menuarrowup\";\nexport const SPRITE_ICON_MENUARROW = \"icon_menuarrow\";\nexport const SPRITE_SELECT = \"select\";\nexport const SPRITE_PAN = \"pan\";\nexport const SPRITE_ZOOM_IN = \"zoom-in\";\nexport const SPRITE_ZOOM_IN_FIXED = \"zoom-in-fixed\";\nexport const SPRITE_ZOOM_OUT_FIXED = \"zoom-out-fixed\";\nexport const SPRITE_ZOOM_FULL = \"zoom-full\";\nexport const SPRITE_MAPTIP = \"maptip\";\nexport const SPRITE_PAN_WEST = \"pan-west\";\nexport const SPRITE_PAN_EAST = \"pan-east\";\nexport const SPRITE_PAN_NORTH = \"pan-north\";\nexport const SPRITE_PAN_SOUTH = \"pan-south\";\nexport const SPRITE_ABOUT = \"about\";\nexport const SPRITE_HELP = \"help\";\nexport const SPRITE_MEASURE = \"measure\";\nexport const SPRITE_PRINT = \"print\";\nexport const SPRITE_OPTIONS = \"options\";\nexport const SPRITE_SELECT_RADIUS = \"select-radius\";\nexport const SPRITE_SELECT_POLYGON = \"select-polygon\";\nexport const SPRITE_INITIAL_CENTER = \"initial-center\";\nexport const SPRITE_SELECT_CLEAR = \"select-clear\";\nexport const SPRITE_ICON_REFRESHMAP = \"icon_refreshmap\";\nexport const SPRITE_VIEW_BACK = \"view-back\";\nexport const SPRITE_VIEW_FORWARD = \"view-forward\";\nexport const SPRITE_GEOLOCATION = \"geolocation\";\nexport const SPRITE_BUFFER = \"buffer\";\nexport const SPRITE_SELECT_FEATURES = \"select-features\";\nexport const SPRITE_REDLINE = \"redline\";\nexport const SPRITE_FEATURE_INFO = \"feature-info\";\nexport const SPRITE_QUERY = \"query\";\nexport const SPRITE_THEME = \"theme\";\nexport const SPRITE_INVOKE_SCRIPT = \"invoke-script\";\nexport const SPRITE_INVOKE_URL = \"invoke-url\";\nexport const SPRITE_SELECT_CENTRE = \"select-centre\";\n/** \n * @since 0.11\n */\nexport const SPRITE_GLOBE_SHARE = \"globe-share\";\n\n/**\n * Blueprint SVG icon names used by this viewer\n * @since 0.13\n */\nexport type BlueprintSvgIconNames =\n    \"arrow-left\" |\n    \"arrow-right\" |\n    \"arrows-horizontal\" |\n    \"application\" |\n    \"caret-down\" |\n    \"caret-up\" |\n    \"chevron-down\" |\n    \"chevron-right\" |\n    \"chevron-up\" |\n    \"cross\" |\n    \"delete\" |\n    \"disable\" |\n    \"double-caret-vertical\" |\n    \"error\" |\n    \"folder-close\" |\n    \"geosearch\" |\n    \"home\" |\n    \"info-sign\" |\n    \"issue\" |\n    \"layer\" |\n    \"layers\" |\n    \"media\" |\n    \"menu-closed\" |\n    \"menu-open\" |\n    \"multi-select\" |\n    \"new-layer\" |\n    \"path-search\" |\n    \"play\" |\n    \"print\" |\n    \"search\" |\n    \"select\" |\n    \"small-cross\" |\n    \"stop\" |\n    \"tag\" |\n    \"th\" |\n    \"warning-sign\";","import {\n    IMapViewer,\n    ICommand,\n    Dictionary,\n    IInvokeUrlCommand,\n    ISearchCommand,\n    ITargetedCommand,\n    IApplicationState,\n    ReduxDispatch,\n    ReduxStore,\n    getSelectionSet,\n    getRuntimeMap,\n    DEFAULT_MODAL_SIZE,\n    NOOP,\n    ALWAYS_FALSE,\n    IInvokeUrlCommandParameter,\n    ActiveMapTool\n} from \"../../api/common\";\nimport * as ModalActions from \"../../actions/modal\";\nimport { getFusionRoot } from \"../../api/runtime\";\nimport { IItem, IInlineMenu, IFlyoutMenu, IComponentFlyoutItem } from \"../../components/toolbar\";\nimport { tr } from \"../i18n\";\nimport { getAssetRoot } from \"../../utils/asset\";\nimport {\n    SPRITE_ICON_ERROR\n} from \"../../constants/assets\";\nimport { assertNever } from \"../../utils/never\";\nimport * as logger from \"../../utils/logger\";\nimport { ensureParameters } from \"../../utils/url\";\nimport { ActionType } from '../../constants/actions';\n\nconst FUSION_ICON_REGEX = /images\\/icons\\/[a-zA-Z\\-]*.png/\n\nfunction fixIconPath(path: string): string {\n    if (FUSION_ICON_REGEX.test(path)) {\n        return `${getAssetRoot()}/${path}`.replace(/\\/\\//g, \"/\");\n    }\n    return path;\n}\n\nfunction fusionFixSpriteClass(tb: any, cmd?: ICommand): string | undefined {\n    if (tb.spriteClass) {\n        return tb.spriteClass;\n    }\n    if (cmd && cmd.iconClass) {\n        return cmd.iconClass;\n    }\n    return undefined;\n}\n\n/**\n * @hidden\n */\nexport function mergeInvokeUrlParameters(currentParameters: IInvokeUrlCommandParameter[], extraParameters?: any) {\n    const currentP = currentParameters.reduce<any>((prev, current, i, arr) => {\n        prev[current.name] = current.value;\n        return prev;\n    }, {});\n    if (extraParameters) {\n        const keys = Object.keys(extraParameters);\n        for (const k of keys) {\n            currentP[k] = extraParameters[k];\n        }\n    }\n    const merged: IInvokeUrlCommandParameter[] = [];\n    const mkeys = Object.keys(currentP);\n    for (const k of mkeys) {\n        merged.push({ name: k, value: currentP[k] });\n    }\n    return merged;\n}\n\nfunction fixChildItems(childItems: any[], state: IToolbarAppState, commandInvoker: (cmd: ICommand, parameters?: any) => void): IItem[] {\n    return childItems\n        .map(tb => mapToolbarReference(tb, state, commandInvoker))\n        .filter(tb => tb != null) as IItem[];\n}\n\n//TODO: This function should be its own react hook that layers on top of the\n//useDispatch() and useSelector() hooks provided by react-redux\n/**\n * @hidden\n */\nexport function mapToolbarReference(tb: any, state: IToolbarAppState, commandInvoker: (cmd: ICommand, parameters?: any) => void): IItem|IInlineMenu|IFlyoutMenu|IComponentFlyoutItem|null {\n    if (tb.error) {\n        const cmdItem: IItem = {\n            iconClass: SPRITE_ICON_ERROR,\n            tooltip: tb.error,\n            label: tr(\"ERROR\"),\n            selected: ALWAYS_FALSE,\n            enabled: ALWAYS_FALSE,\n            invoke: NOOP\n        };\n        return cmdItem;\n    } else if (tb.componentName) {\n        return {\n            icon: tb.icon,\n            iconClass: fusionFixSpriteClass(tb),\n            flyoutId: tb.flyoutId,\n            tooltip: tb.tooltip,\n            label: tb.label,\n            componentName: tb.componentName,\n            componentProps: tb.componentProps\n        };\n    } else if (tb.isSeparator === true) {\n        return { isSeparator: true };\n    } else if (tb.command) {\n        const cmd = getCommand(tb.command);\n        if (cmd != null) {\n            const cmdItem: IItem = {\n                icon: fixIconPath(tb.icon || cmd.icon),\n                iconClass: fusionFixSpriteClass(tb, cmd),\n                tooltip: tb.tooltip,\n                label: tb.label,\n                selected: () => cmd.selected(state),\n                enabled: () => cmd.enabled(state, tb.parameters),\n                invoke: () => commandInvoker(cmd, tb.parameters)\n            };\n            return cmdItem;\n        }\n    } else if (tb.children) {\n        const childItems: any[] = tb.children;\n        return {\n            icon: fixIconPath(tb.icon),\n            iconClass: fusionFixSpriteClass(tb),\n            label: tb.label,\n            tooltip: tb.tooltip,\n            childItems: fixChildItems(childItems, state, commandInvoker)\n        };\n    } else if (tb.label && tb.flyoutId) {\n        return {\n            icon: fixIconPath(tb.icon),\n            iconClass: fusionFixSpriteClass(tb),\n            label: tb.label,\n            tooltip: tb.tooltip,\n            flyoutId: tb.flyoutId\n        }\n    }\n    return null;\n}\n\n/**\n * A subset of IApplicationState that's only relevant for toolbar items\n * @since 0.13\n */\nexport interface IToolbarAppState {\n    visibleAndSelectableWmsLayerCount: number;\n    busyWorkerCount: number;\n    hasSelection: boolean;\n    hasPreviousView: boolean;\n    hasNextView: boolean;\n    featureTooltipsEnabled: boolean;\n    activeTool: ActiveMapTool;\n}\n\n/**\n * Helper function to reduce full application state to state relevant for toolbar items\n * \n * @param state The full application state\n * @since 0.13\n */\nexport function reduceAppToToolbarState(state: Readonly<IApplicationState>): Readonly<IToolbarAppState> {\n    let hasSelection = false;\n    let hasPreviousView = false;\n    let hasNextView = false;\n    let visibleWmsLayerCount = 0;\n    const selection = getSelectionSet(state);\n    hasSelection = (selection != null && selection.SelectedFeatures != null);\n    if (state.config.activeMapName) {\n        hasPreviousView = state.mapState[state.config.activeMapName].historyIndex > 0;\n        hasNextView = state.mapState[state.config.activeMapName].historyIndex < state.mapState[state.config.activeMapName].history.length - 1;\n        visibleWmsLayerCount = state.mapState[state.config.activeMapName].layers.filter(l => l.visible && l.selectable && l.type == \"WMS\").length;\n    }\n    return {\n        visibleAndSelectableWmsLayerCount: visibleWmsLayerCount,\n        busyWorkerCount: state.viewer.busyCount,\n        hasSelection,\n        hasPreviousView,\n        hasNextView,\n        activeTool: state.viewer.tool,\n        featureTooltipsEnabled: state.viewer.featureTooltipsEnabled\n    }\n}\n\n/**\n * Common command condition evaluators\n *\n * @export\n * @class CommandConditions\n */\nexport class CommandConditions {\n    /**\n     * The viewer is not busy\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static isNotBusy(state: Readonly<IToolbarAppState>): boolean {\n        return state.busyWorkerCount == 0;\n    }\n    /**\n     * The viewer has a selection set\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static hasSelection(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasSelection;\n    }\n    /**\n     * The command is set to be disabled if selection is empty\n     *\n     * @static\n     * @param {*} [parameters]\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static disabledIfEmptySelection(state: Readonly<IToolbarAppState>, parameters?: any): boolean {\n        if (!state.hasSelection) {\n            return (parameters != null && (parameters.DisableIfSelectionEmpty == \"true\" || parameters.DisableIfSelectionEmpty == true));\n        } else\n            return false;\n    }\n    /**\n     * The viewer has a previous view in the view navigation stack\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static hasPreviousView(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasPreviousView;\n    }\n    /**\n     * The viewer has a next view in the view navigation stack\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static hasNextView(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasNextView;\n    }\n}\n\n/**\n * The set of default command names\n *\n * @export\n * @class DefaultCommands\n */\nexport enum DefaultCommands {\n    Select = \"Select\",\n    Pan = \"Pan\",\n    Zoom = \"Zoom\",\n    MapTip = \"MapTip\",\n    ZoomIn = \"ZoomIn\",\n    ZoomOut = \"ZoomOut\",\n    RestoreView = \"RestoreView\",\n    ZoomExtents = \"ZoomExtents\",\n    SelectRadius = \"SelectRadius\",\n    SelectPolygon = \"SelectPolygon\",\n    ClearSelection = \"ClearSelection\",\n    ZoomToSelection = \"ZoomToSelection\",\n    PanLeft = \"PanLeft\",\n    PanRight = \"PanRight\",\n    PanUp = \"PanUp\",\n    PanDown = \"PanDown\",\n    RefreshMap = \"RefreshMap\",\n    PreviousView = \"PreviousView\",\n    NextView = \"NextView\",\n    About = \"About\",\n    Help = \"Help\",\n    Measure = \"Measure\",\n    ViewerOptions = \"ViewerOptions\",\n    Buffer = \"Buffer\",\n    SelectWithin = \"SelectWithin\",\n    QuickPlot = \"QuickPlot\",\n    Redline = \"Redline\",\n    FeatureInfo = \"FeatureInfo\",\n    Theme = \"Theme\",\n    Query = \"Query\",\n    Geolocation = \"Geolocation\",\n    CoordinateTracker = \"CoordinateTracker\",\n    /**\n     * @since 0.11\n     */\n    AddManageLayers = \"AddManageLayers\",\n    /**\n     * @since 0.11\n     */\n    CenterSelection = \"CenterSelection\",\n    /**\n     * @since 0.13\n     */\n    WmsQuery = \"WmsQuery\"\n}\n\nconst commands: Dictionary<ICommand> = {};\n\nfunction isInvokeUrlCommand(cmdDef: any): cmdDef is IInvokeUrlCommand {\n    return typeof cmdDef.url !== 'undefined';\n}\n\nfunction isSearchCommand(cmdDef: any): cmdDef is ISearchCommand {\n    return typeof cmdDef.layer !== 'undefined';\n}\n\nfunction openModalUrl(name: string, dispatch: ReduxDispatch, url: string, modalTitle?: string) {\n    dispatch(ModalActions.showModalUrl({\n        modal: {\n            title: modalTitle || tr(name as any),\n            backdrop: false,\n            size: DEFAULT_MODAL_SIZE,\n            overflowYScroll: true\n        },\n        name: name,\n        url: url\n    }));\n}\n\n/**\n * Opens the given URL in the specified target\n *\n * @hidden\n * @param name\n * @param cmdDef\n * @param dispatch\n * @param url\n */\nexport function openUrlInTarget(name: string, cmdDef: ITargetedCommand, hasTaskPane: boolean, dispatch: ReduxDispatch, url: string, modalTitle?: string): void {\n    const target = cmdDef.target;\n    if (target == \"TaskPane\") {\n        //If there's no actual task pane, fallback to modal dialog\n        if (!hasTaskPane) {\n            openModalUrl(name, dispatch, url, modalTitle);\n        } else {\n            dispatch({\n                type: ActionType.TASK_INVOKE_URL,\n                payload: {\n                    url: url\n                }\n            });\n        }\n    } else if (target == \"NewWindow\") {\n        openModalUrl(name, dispatch, url, modalTitle);\n    } else if (target == \"SpecifiedFrame\") {\n        if (cmdDef.targetFrame) {\n            const frames = (window as any).frames as any[];\n            let bInvoked = false;\n            for (let i = 0; i < frames.length; i++) {\n                if (frames[i].name == cmdDef.targetFrame) {\n                    frames[i].location = url;\n                    bInvoked = true;\n                    break;\n                }\n            }\n            if (!bInvoked) {\n                logger.error(`Frame not found: ${cmdDef.targetFrame}`);\n            }\n        } else {\n            logger.error(`Command ${name} has a target of \"SpecifiedFrame\", but does not specify a target frame`);\n        }\n    } else {\n        assertNever(target);\n    }\n}\n\n/**\n * Registers a viewer command\n *\n * @export\n * @param {string} name\n * @param {(ICommand | IInvokeUrlCommand | ISearchCommand)} cmdDef\n */\nexport function registerCommand(name: string, cmdDef: ICommand | IInvokeUrlCommand | ISearchCommand) {\n    let cmd: ICommand;\n    if (isInvokeUrlCommand(cmdDef)) {\n        cmd = {\n            icon: cmdDef.icon,\n            iconClass: cmdDef.iconClass,\n            title: cmdDef.title,\n            enabled: (state) => {\n                if (cmdDef.disableIfSelectionEmpty === true) {\n                    return CommandConditions.hasSelection(state);\n                }\n                return true;\n            },\n            selected: () => false,\n            invoke: (dispatch: ReduxDispatch, getState: () => IApplicationState, viewer: IMapViewer, parameters?: any) => {\n                const state = getState();\n                const config = state.config;\n                const map = getRuntimeMap(state);\n                if (map) {\n                    const params = mergeInvokeUrlParameters(cmdDef.parameters, parameters);\n                    const url = ensureParameters(cmdDef.url, map.Name, map.SessionId, config.locale, true, params);\n                    openUrlInTarget(name, cmdDef, config.capabilities.hasTaskPane, dispatch, url, cmd.title);\n                }\n            }\n        };\n    } else if (isSearchCommand(cmdDef)) {\n        cmd = {\n            icon: cmdDef.icon,\n            iconClass: cmdDef.iconClass,\n            title: cmdDef.title,\n            enabled: () => true,\n            selected: () => false,\n            invoke: (dispatch: ReduxDispatch, getState: () => IApplicationState, viewer: IMapViewer, parameters?: any) => {\n                const state = getState();\n                const config = state.config;\n                const map = getRuntimeMap(state);\n                if (map) {\n                    const url = ensureParameters(`${getFusionRoot()}/widgets/Search/SearchPrompt.php`, map.Name, map.SessionId, config.locale, false)\n                        + `&popup=0`\n                        + `&target=TaskPane`\n                        + `&title=${encodeURIComponent(cmdDef.title)}`\n                        + `&prompt=${encodeURIComponent(cmdDef.prompt)}`\n                        + `&layer=${encodeURIComponent(cmdDef.layer)}`\n                        + `&pointZoomLevel=${parameters.PointZoomLevel}`\n                        + (cmdDef.filter ? `&filter=${encodeURIComponent(cmdDef.filter)}` : '')\n                        + `&limit=${cmdDef.matchLimit}`\n                        + `&properties=${(cmdDef.resultColumns.Column || []).map(col => col.Property).join(\",\")}`\n                        + `&propNames=${(cmdDef.resultColumns.Column || []).map(col => col.Name).join(\",\")}`;\n                    openUrlInTarget(name, cmdDef, config.capabilities.hasTaskPane, dispatch, url, cmd.title);\n                }\n            }\n        };\n    } else {\n        cmd = cmdDef;\n    }\n    commands[name] = cmd;\n}\n\n/**\n * Gets a registered viewer command by its name\n *\n * @export\n * @param {string} name\n * @returns {(ICommand | undefined)}\n */\nexport function getCommand(name: string): ICommand | undefined {\n    return commands[name];\n}","import {\n    InitError,\n    IMapView,\n    IModalDisplayOptions,\n    IModalComponentDisplayOptions\n} from \"../api/common\";\nimport { MapLayer } from \"../api/contracts/runtime-map\";\nimport { IInlineMenu, IFlyoutMenu, IComponentFlyoutItem } from \"../components/toolbar\";\nimport { ViewerAction } from '../actions/defs';\n\n/**\n * Indicates if the given argument is an IModalDisplayOptions\n *\n * @export\n * @param {*} arg\n * @returns {arg is IModalDisplayOptions}\n */\nexport function isModalDisplayOptions(arg: any): arg is IModalDisplayOptions {\n    return typeof(arg.url) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is an IModalComponentDisplayOptions\n *\n * @export\n * @param {*} arg\n * @returns {arg is IModalComponentDisplayOptions}\n */\nexport function isModalComponentDisplayOptions(arg: any): arg is IModalComponentDisplayOptions {\n    return typeof(arg.component) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is an Error object\n *\n * @export\n * @param {*} err\n * @returns {err is Error}\n */\nexport function isError(err: any): err is Error {\n    return err instanceof Error;\n}\n\n/**\n * Indicates if the given argument is an InitError object\n *\n * @export\n * @param {*} item\n * @returns {item is InitError}\n */\nexport function isInitError(item: any): item is InitError {\n    return typeof (item.message) != 'undefined' && typeof (item.stack) != undefined;\n}\n\n/**\n * Indicates if the given arguemnt has the shape of an IFlyoutMenu\n *\n * @export\n * @param {*} item\n * @returns {item is IFlyoutMenu}\n */\nexport function isMenuRef(item: any): item is IFlyoutMenu {\n    return typeof (item.flyoutId) != 'undefined';\n}\n\n/**\n * Indicates if the given argument has the shape of an IComponentFlyoutItem\n *\n * @export\n * @param {*} item\n * @returns {item is IComponentFlyoutItem}\n */\nexport function isComponentFlyout(item: any): item is IComponentFlyoutItem {\n    return typeof (item.componentName) != 'undefined';\n}\n\n/**\n * Indicates if the given argument has the shape of an IInlineMenu\n *\n * @export\n * @param {*} item\n * @returns {item is IInlineMenu}\n */\nexport function isMenu(item: any): item is IInlineMenu {\n    return typeof (item.childItems) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is a MapLayer object\n *\n * @export\n * @param {*} layer\n * @returns {layer is MapLayer}\n */\nexport function isLayer(layer: any): layer is MapLayer {\n    return layer.LayerDefinition !== undefined;\n}\n\n/**\n * Indicates if the given argument has the shape of an IMapView\n *\n * @export\n * @param {*} view\n * @returns {view is IMapView}\n */\nexport function isMapView(view: any): view is IMapView {\n    return typeof (view.x) == 'number'\n        && typeof (view.y) == 'number'\n        && typeof (view.scale) == 'number';\n}\n\n/**\n * Indicates if the given argument is a coordinate pair\n *\n * @export\n * @param {*} coord\n * @returns {coord is [number, number]}\n */\nexport function isCoordinate(coord: any): coord is [number, number] {\n    return coord instanceof Array\n        && coord.length == 2\n        && typeof (coord[0]) == 'number'\n        && typeof (coord[1]) == 'number';\n}\n\n/**\n * Indicates if the given argument has the shape of a ViewerAction\n *\n * @export\n * @param {*} action\n * @returns {action is ViewerAction}\n */\nexport function isAction(action: any): action is ViewerAction {\n    return typeof (action.type) != 'undefined'\n        && typeof (action.payload) != 'undefined';\n}","import * as React from \"react\";\nimport { Error } from \"../../components/error\";\nimport { tr } from \"../i18n\";\n\n/**\n * The default set of component names\n *\n * @export\n * @class DefaultComponentNames\n */\nexport enum DefaultComponentNames {\n    Legend = \"Legend\",\n    SelectionPanel = \"SelectionPanel\",\n    Map = \"Map\",\n    Navigator = \"Navigator\",\n    MouseCoordinates = \"MouseCoordinates\",\n    ScaleDisplay = \"ScaleDisplay\",\n    SelectedFeatureCount = \"SelectedFeatureCount\",\n    PoweredByMapGuide = \"PoweredByMapGuide\",\n    TaskPane = \"TaskPane\",\n    About = \"About\",\n    SessionExpired = \"SessionExpired\",\n    Measure = \"Measure\",\n    ViewerOptions = \"ViewerOptions\",\n    QuickPlot = \"QuickPlot\",\n    BaseMapSwitcher = \"BaseMapSwitcher\",\n    MapMenu = \"MapMenu\",\n    ViewSize = \"ViewSize\",\n    CoordinateTracker = \"CoordinateTracker\",\n    AddManageLayers = \"AddManageLayers\",\n    ShareLinkToView = \"ShareLinkToView\"\n}\n\n/**\n * A react component factory function signature\n */\nexport type ComponentFactory = (props: any) => JSX.Element;\n\nconst components: { [id: string]: ComponentFactory } = {};\n\n/**\n * Registers a react component factory function for the given component id\n *\n * @export\n * @param {string} id\n * @param {ComponentFactory} factory\n */\nexport function registerComponentFactory(id: string, factory: ComponentFactory): void {\n    components[id] = factory;\n}\n\n/**\n * Gets the registered component factory function for the given component id\n *\n * @export\n * @param {string} id\n * @returns {ComponentFactory}\n */\nexport function getComponentFactory(id: string): ComponentFactory | undefined {\n    return components[id];\n}\n\n/**\n * Placeholder component properties\n *\n * @export\n * @interface IPlaceholderComponentProps\n */\nexport interface IPlaceholderComponentProps {\n    /**\n     * The id of the component this placeholder is for\n     *\n     * @type {string}\n     * @memberOf IPlaceholderComponentProps\n     */\n    id: string;\n    /**\n     * The locale\n     *\n     * @type {string}\n     * @memberOf IPlaceholderComponentProps\n     */\n    locale?: string;\n    /**\n     * The props of the underlying component\n     *\n     * @type {*}\n     * @memberOf IPlaceholderComponentProps\n     */\n    componentProps?: any;\n}\n\n/**\n * A component placeholder\n *\n * @export\n * @class PlaceholderComponent\n * @extends {React.Component<IPlaceholderComponentProps, any>}\n */\nexport class PlaceholderComponent extends React.Component<IPlaceholderComponentProps, any> {\n    constructor(props: IPlaceholderComponentProps) {\n        super(props);\n    }\n    render(): JSX.Element {\n        const { id, componentProps } = this.props;\n        const factory = getComponentFactory(id);\n        if (factory) {\n            return factory(componentProps);\n        } else {\n            return <Error error={tr(\"ERR_UNREGISTERED_COMPONENT\", this.props.locale, { componentId: id })} />;\n        }\n    }\n}","\n/**\n * Returns a unique array of strings from the given array\n * @param items The array of strings to make unique\n * @since 0.13\n */\nexport function makeUnique(arr: string[]): string[] {\n    const a = [];\n    for (let i = 0, l = arr.length; i < l; i++) {\n        if (a.indexOf(arr[i]) === -1 && arr[i] !== '')\n            a.push(arr[i]);\n    }\n    return a;\n}\n\n/**\n * Indicates if the given arrays are different (content-wise)\n * @param arr \n * @param other \n * @since 0.13\n */\nexport function areArraysDifferent<T>(arr: T[] | undefined, other: T[] | undefined, equalityFn?: (left: T, right: T) => boolean): boolean {\n    if (arr && other) {\n        if (arr.length != other.length) {\n            return true;\n        } else {\n            for (let i = 0; i < arr.length; i++) {\n                if (equalityFn) {\n                    if (!equalityFn(arr[i], other[i])) {\n                        return true;\n                    }\n                } else if (arr[i] !== other[i]) {\n                    return true;\n                }\n            }\n            return false;\n        }\n    } else {\n        return true;\n    }\n}","import * as Common from \"./contracts/common\";\nimport * as RtMap from \"./contracts/runtime-map\";\nimport * as Query from \"./contracts/query\";\nimport { SelectionVariant } from './common';\n\n/**\n * Describes a request that takes either a session or username/password pair\n *\n * @export\n * @interface IAuthenticatedRequest\n */\nexport interface IAuthenticatedRequest {\n    /**\n     * The session id\n     *\n     * @type {string}\n     * @memberOf IAuthenticatedRequest\n     */\n    session?: string;\n    /**\n     * The username\n     *\n     * @type {string}\n     * @memberOf IAuthenticatedRequest\n     */\n    username?: string;\n    /**\n     * The password\n     *\n     * @type {string}\n     * @memberOf IAuthenticatedRequest\n     */\n    password?: string;\n}\n\n/**\n * Bitmask describing what data to return when creating a runtime map\n *\n * @export\n * @enum {number}\n */\nexport enum RuntimeMapFeatureFlags {\n    /**\n     * Include data about layers and groups\n     */\n    LayersAndGroups = 1,\n    /**\n     * Include layer icons\n     */\n    LayerIcons = 2,\n    /**\n     * Include data about layer feature sources\n     */\n    LayerFeatureSources = 4\n}\n\n/**\n * Describes options for creating a runtime map\n *\n * @export\n * @interface ICreateRuntimeMapOptions\n * @extends {IAuthenticatedRequest}\n */\nexport interface ICreateRuntimeMapOptions extends IAuthenticatedRequest {\n    /**\n     * The map definition id\n     *\n     * @type {Common.ResourceIdentifier}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    mapDefinition: Common.ResourceIdentifier;\n    /**\n     * A bitmask indicating what data to return\n     *\n     * @type {(number | RuntimeMapFeatureFlags)}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    requestedFeatures: number | RuntimeMapFeatureFlags;\n    /**\n     * If requesting icons, the number of icons per scale range\n     *\n     * @type {number}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconsPerScaleRange?: number;\n    /**\n     * The image format for requested icons\n     *\n     * @type {(\"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\")}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconFormat?: \"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\";\n    /**\n     * The width of requested icons\n     *\n     * @type {number}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconWidth?: number;\n    /**\n     * The height of requested icons\n     *\n     * @type {number}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconHeight?: number;\n    /**\n     * The target map name to assign. Otherwise the map name will be computed from the map definition id\n     *\n     * @type {string}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    targetMapName?: string;\n}\n\n/**\n * Describes operations requiring a session id\n *\n * @export\n * @interface ISessionBasedRequest\n */\nexport interface ISessionBasedRequest {\n    /**\n     * The session id\n     *\n     * @type {string}\n     * @memberOf ISessionBasedRequest\n     */\n    session: string;\n}\n\n/**\n * Describes operations against a runtime map\n *\n * @export\n * @interface IRuntimeMapRequest\n * @extends {ISessionBasedRequest}\n */\nexport interface IRuntimeMapRequest extends ISessionBasedRequest {\n    /**\n     * The name of the runtime map\n     *\n     * @type {string}\n     * @memberOf IRuntimeMapRequest\n     */\n    mapname: string;\n}\n\n/**\n * A bitmask indicating what to return when querying map features\n *\n * @export\n * @enum {number}\n */\nexport enum QueryFeaturesSet {\n    /**\n     * Include attributes of selected features\n     */\n    Attributes = 1,\n    /**\n     * Include an inline image of the selected features\n     */\n    InlineSelection = 2,\n    /**\n     * Include tooltips for the first matching feature\n     */\n    Tooltip = 4,\n    /**\n     * Include hyperlink for the first matching feature\n     */\n    Hyperlink = 8\n}\n\n\n\n/**\n * Options for querying map features\n *\n * @export\n * @interface IQueryMapFeaturesOptions\n * @extends {IRuntimeMapRequest}\n */\nexport interface IQueryMapFeaturesOptions extends IRuntimeMapRequest {\n    /**\n     * A comma-seperated list of layer name to restrict the query on. Omit to\n     * cover all selectable layers\n     *\n     * @type {string}\n     */\n    layernames?: string;\n    /**\n     * The WKT of the query geometry\n     *\n     * @type {string}\n     */\n    geometry?: string;\n    /**\n     * The spatial query operator to use with the input geometry\n     *\n     * @type {SelectionVariant}\n     */\n    selectionvariant?: SelectionVariant;\n    /**\n     * A bitmask containing what features to ask for\n     *\n     * @type {QueryFeaturesSet}\n     */\n    requestdata?: QueryFeaturesSet;\n    /**\n     * The color of the selection\n     *\n     * @type {string}\n     */\n    selectioncolor?: string;\n    /**\n     * The image format of the requested selection image\n     *\n     * @type {(\"PNG\" | \"JPG\" | \"GIF\" | \"PNG8\")}\n     */\n    selectionformat?: \"PNG\" | \"JPG\" | \"GIF\" | \"PNG8\";\n    /**\n     * The maximum number of features to select. Use -1 for no limit.\n     *\n     * @type {number}\n     */\n    maxfeatures?: number;\n    /**\n     * 1 = Persist the query selection changes to the current selection set\n     * 0 = The query selection does not modify the current selection set\n     *\n     * @type {number}\n     */\n    persist?: number;\n    /**\n     * An optional selection XML string. If specified, the rendering/query will be based off of\n     * a selection initialized with this selection XML\n     */\n    featurefilter?: string;\n    layerattributefilter?: number;\n}\n\n/**\n * Options for describing a runtime map\n *\n * @export\n * @interface IDescribeRuntimeMapOptions\n * @extends {IRuntimeMapRequest}\n */\nexport interface IDescribeRuntimeMapOptions extends IRuntimeMapRequest {\n    /**\n     * A bitmask of data to return about a runtime map\n     *\n     * @type {(number | RuntimeMapFeatureFlags)}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    requestedFeatures?: number | RuntimeMapFeatureFlags;\n    /**\n     * If requesting icons, the number of icons per scale range\n     *\n     * @type {number}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconsPerScaleRange?: number;\n    /**\n     * The image format for requested icons\n     *\n     * @type {(\"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\")}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconFormat?: \"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\";\n    /**\n     * The width of requested icons\n     *\n     * @type {number}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconWidth?: number;\n    /**\n     * The height of requested icons\n     *\n     * @type {number}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconHeight?: number;\n}\n\n/**\n * Provides client services for a MapGuide map viewer\n *\n * @export\n * @interface IMapGuideClient\n */\nexport interface IMapGuideClient {\n    /**\n     * Creates a new MapGuide session\n     *\n     * @param {string} username\n     * @param {string} password\n     * @returns {Promise<string>}\n     */\n    createSession(username: string, password: string): Promise<string>;\n\n    /**\n     * Retrieves the requested resource\n     *\n     * @abstract\n     * @template T\n     * @param {string} resourceId\n     * @returns {PromiseLike<T>}\n     */\n    getResource<T extends Common.ResourceBase>(resourceId: Common.ResourceIdentifier, args?: any): Promise<T>;\n\n    /**\n     * Creates a runtime map from the specified map definition\n     *\n     * @abstract\n     * @param {ICreateRuntimeMapOptions} options\n     * @returns {PromiseLike<RtMap.RuntimeMap>}\n     */\n    createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RtMap.RuntimeMap>;\n\n    /**\n     * Performs a map selection query on the current map\n     *\n     * @abstract\n     * @param {IQueryMapFeaturesOptions} options\n     * @returns {PromiseLike<Query.QueryMapFeaturesResponse>}\n     */\n    queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse>;\n\n    /**\n     * Performs a map selection query on the current map. Only applicable for use with MapGuide\n     * Open Source 4.0 and higher\n     *\n     * @abstract\n     * @param {IQueryMapFeaturesOptions} options\n     * @returns {PromiseLike<Query.QueryMapFeaturesResponse>}\n     */\n    queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse>;\n\n    /**\n     * Describes a runtime map\n     *\n     * @abstract\n     * @param {IDescribeRuntimeMapOptions} options\n     * @returns {PromiseLike<RtMap.RuntimeMap>}\n     */\n    describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RtMap.RuntimeMap>;\n\n    /**\n     * Gets the tile template URL used by the viewer to send tile requests\n     *\n     * @param {string} resourceId\n     * @param {string} groupName\n     * @param {string} xPlaceholder\n     * @param {string} yPlaceholder\n     * @param {string} zPlaceholder\n     * @returns {string}\n     */\n    getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string;\n}\n\n/**\n * An abstract MapGuide service client\n *\n * @export\n * @abstract\n * @class RequestBuilder\n * @implements {IMapGuideClient}\n */\nexport abstract class RequestBuilder implements IMapGuideClient {\n    protected agentUri: string;\n    constructor(agentUri: string) {\n        this.agentUri = agentUri;\n    }\n\n    public abstract createSession(username: string, password: string): Promise<string>;\n\n    public abstract getServerSessionTimeout(session: string): Promise<number>;\n\n    public abstract getResource<T extends Common.ResourceBase>(resourceId: Common.ResourceIdentifier, args?: any): Promise<T>;\n\n    public abstract createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RtMap.RuntimeMap>;\n\n    public abstract queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse>;\n\n    public abstract queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse>;\n\n    public abstract describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RtMap.RuntimeMap>;\n\n    public abstract getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string;\n}","import olLayerVector from \"ol/layer/Vector\";\nimport olStyle from \"ol/style/Style\";\nimport olCircleStyle from \"ol/style/Circle\";\nimport { Color, asString, asArray } from \"ol/color\";\nimport { ColorLike } from \"ol/colorlike\";\nimport olStroke from \"ol/style/Stroke\";\nimport olFill from \"ol/style/Fill\";\nimport olFeature from \"ol/Feature\";\nimport { LayerProperty } from './common';\nimport * as shortid from \"shortid\";\n\n/**\n * Defines a style for a vector layer\n * @since 0.13\n */\nexport interface IVectorFeatureStyle {\n    point?: IBasicVectorPointStyle;\n    line?: IBasicVectorLineStyle;\n    polygon?: IBasicVectorPolygonStyle;\n}\n\n/**\n * Point circle style settings\n * @since 0.13\n */\nexport interface IBasicPointCircleStyle {\n    fill: IBasicFill;\n    radius: number;\n    stroke: IBasicStroke;\n}\n\n/**\n * Point style settings\n * @since 0.13\n */\nexport type IBasicVectorPointStyle = IBasicPointCircleStyle;\n\n/**\n * Line style settings\n * @since 0.13\n */\nexport type IBasicVectorLineStyle = IBasicStroke;\n\n/**\n * Polygon style settings\n * @since 0.13\n */\nexport interface IBasicVectorPolygonStyle {\n    fill: IBasicFill;\n    stroke: IBasicStroke;\n}\n\n/**\n * Line stroke settings\n * @since 0.13\n */\nexport interface IBasicStroke {\n    color: string;\n    alpha: number;\n    width: number;\n}\n\n/**\n * Color fill settings\n * @since 0.13\n */\nexport interface IBasicFill {\n    color: string;\n    alpha: number;\n}\n\n/**\n * The default style for point features\n * @since 0.13\n */\nexport const DEFAULT_POINT_STYLE: IBasicVectorPointStyle = {\n    fill: {\n        color: \"#ff0000\",\n        alpha: 255\n    },\n    radius: 5,\n    stroke: {\n        color: \"#0000ff\",\n        alpha: 255,\n        width: 1\n    }\n};\n\n/**\n * The default color\n * @since 0.13\n */\nexport const DEFAULT_COLOR = \"#000000\";\n\n/**\n * The default style for line features\n * @since 0.13\n */\nexport const DEFAULT_LINE_STYLE: IBasicVectorLineStyle = {\n    color: \"#0000ff\",\n    alpha: 255,\n    width: 1\n};\n\n/**\n * The default style for polygon features\n * @since 0.13\n */\nexport const DEFAULT_POLY_STYLE: IBasicVectorPolygonStyle = {\n    fill: {\n        color: \"#00ff00\",\n        alpha: 255\n    },\n    stroke: {\n        color: DEFAULT_COLOR,\n        alpha: 255,\n        width: 1\n    }\n};\n\n/**\n * An OpenLayers style map\n * \n * @export\n * @interface IOlStyleMap\n * @since 0.13\n */\nexport interface IOlStyleMap {\n    id: string;\n    \"Point\": olStyle;\n    \"LineString\": olStyle;\n    \"MultiLineString\": olStyle;\n    \"MultiPoint\": olStyle;\n    \"MultiPolygon\": olStyle;\n    \"Polygon\": olStyle;\n    \"GeometryCollection\": olStyle;\n    \"Circle\": olStyle;\n}\n\nfunction lpad(inStr: string | number, len: number,  padChar: string = '0') {\n    return (new Array(len || 2).join( padChar) + inStr).slice(-len)\n}\n\nfunction num2hex(n: number) {\n    return lpad(n.toString(16), 2);\n}\n\nfunction toHtmlColor(c: Color | ColorLike): [string, number] {\n    if (typeof (c) == 'string') {\n        const ca = asArray(c);\n        return [`#${num2hex(ca[0])}${num2hex(ca[1])}${num2hex(ca[2])}`, ca[3] ?? 255];\n    }\n    if (Array.isArray(c)) {\n        return [`#${num2hex(c[0])}${num2hex(c[1])}${num2hex(c[2])}`, c[3]];\n    }\n    return [DEFAULT_COLOR, 0];\n}\n\nfunction toBasicFill(f: olFill): IBasicFill {\n    const [c, alpha] = toHtmlColor(f.getColor());\n    const fi: IBasicFill = {\n        color: c,\n        alpha: (alpha ?? 0) * 255\n    };\n    return fi;\n}\n\nfunction toBasicStroke(s: olStroke): IBasicStroke {\n    const [c, alpha] = toHtmlColor(s.getColor());\n    const bs: IBasicStroke = {\n        color: c,\n        width: s.getWidth(),\n        alpha: (alpha ?? 0) * 255\n    };\n    return bs;\n}\n\n/**\n * Converts an OpenLayers style map to a vector style\n * \n * @export\n * @param {IOlStyleMap} os\n * @returns {IVectorFeatureStyle}\n * @since 0.13\n */\nexport function olStyleMapToVectorStyle(os: IOlStyleMap): IVectorFeatureStyle {\n    const style: IVectorFeatureStyle = {};\n    const pi = os.Point.getImage();\n    if (pi instanceof olCircleStyle) {\n        style.point = {\n            fill: toBasicFill(pi.getFill()),\n            radius: pi.getRadius(),\n            stroke: toBasicStroke(pi.getStroke())\n        };\n    }\n    style.line = toBasicStroke(os.LineString.getStroke());\n    style.polygon = {\n        fill: toBasicFill(os.Polygon.getFill()),\n        stroke: toBasicStroke(os.Polygon.getStroke())\n    };\n    return style;\n}\n\nfunction toOLColor(color: string, alpha: number) {\n    const c = asArray(color);\n    c[3] = (alpha / 255);\n    return c;\n}\n\n/**\n * Converts a vector style to an OpenLayers style map\n * \n * @export\n * @param {IVectorFeatureStyle} style\n * @returns {IOlStyleMap}\n * @since 0.13\n */\nexport function vectorStyleToOLStyleMap(style: IVectorFeatureStyle): IOlStyleMap {\n    const ptStyle = style.point ?? DEFAULT_POINT_STYLE;\n    const pts = new olStyle({\n        image: new olCircleStyle({\n            radius: ptStyle.radius,\n            fill: new olFill({\n                color: toOLColor(ptStyle.fill.color, ptStyle.fill.alpha)\n            }),\n            stroke: new olStroke({\n                color: toOLColor(ptStyle.stroke.color, ptStyle.stroke.alpha),\n                width: ptStyle.stroke.width\n            })\n        })\n    });\n    const lnStyle = style.line ?? DEFAULT_LINE_STYLE;\n    const lns = new olStyle({\n        stroke: new olStroke({\n            color: toOLColor(lnStyle.color, lnStyle.alpha),\n            width: lnStyle.width\n        })\n    });\n    const plStyle = style.polygon ?? DEFAULT_POLY_STYLE;\n    const pls = new olStyle({\n        stroke: new olStroke({\n            color: toOLColor(plStyle.stroke.color, plStyle.stroke.alpha),\n            width: plStyle.stroke.width\n        }),\n        fill: new olFill({\n            color: toOLColor(plStyle.fill.color, plStyle.fill.alpha)\n        })\n    });\n    //For GeometryCollection, combine point and polygon styles\n    const cpts = pts.clone();\n    const cpls = pls.clone();\n    const gcs = new olStyle({\n        image: cpts.getImage(),\n        stroke: cpls.getStroke(),\n        fill: cpls.getFill()\n    });\n    return {\n        id: shortid.generate(),\n        Point: pts,\n        MultiPoint: pts,\n        LineString: lns,\n        MultiLineString: lns,\n        Polygon: pls,\n        MultiPolygon: pls,\n        Circle: pls,\n        GeometryCollection: gcs\n    }\n}\n\n/**\n * Sets the vector style for the given OpenLayers vector layer\n * \n * @since 0.13\n */\nexport function setOLVectorLayerStyle(layer: olLayerVector, style: IVectorFeatureStyle) {\n    const ols = vectorStyleToOLStyleMap(style);\n    layer.set(LayerProperty.VECTOR_STYLE, ols);\n    const layerStyleFunc = function (feature: olFeature) {\n        const gt = feature.getGeometry().getType();\n        const st = this[gt];\n        return st;\n    }.bind(ols);\n    layer.setStyle(layerStyleFunc);\n}","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\nimport { DEG } from \"../constants\";\nimport { UnitInfo, UnitOfMeasure, UnitName, IMapView } from \"../api/common\";\n\nconst mUnits: UnitInfo[] = [\n    { name: \"Unknown\", localizedName: (locale) => tr(\"UNIT_UNKNOWN\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_UNKNOWN\", locale), unitsPerMeter: 1.0, metersPerUnit: 1.0 },\n    { name: \"Inches\", localizedName: (locale) => tr(\"UNIT_INCHES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_INCHES\", locale), unitsPerMeter: 39.370079, metersPerUnit: 0.0254 },\n    { name: \"Feet\", localizedName: (locale) => tr(\"UNIT_FEET\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_FEET\", locale), unitsPerMeter: 3.2808, metersPerUnit: 0.3048 },\n    { name: \"Yards\", localizedName: (locale) => tr(\"UNIT_YARDS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_YARDS\", locale), unitsPerMeter: 1.0936133, metersPerUnit: 0.9144 },\n    { name: \"Miles\", localizedName: (locale) => tr(\"UNIT_MILES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_MILES\", locale), unitsPerMeter: 0.00062137, metersPerUnit: 1609.344 },\n    { name: \"Nautical Miles\", localizedName: (locale) => tr(\"UNIT_NAUT_MILES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_NAUT_MILES\", locale), unitsPerMeter: 0.000539956803, metersPerUnit: 1852 },\n    { name: \"Millimeters\", localizedName: (locale) => tr(\"UNIT_MILLIMETERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_MILLIMETERS\", locale), unitsPerMeter: 1000.0, metersPerUnit: 0.001 },\n    { name: \"Centimeters\", localizedName: (locale) => tr(\"UNIT_CENTIMETERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_CENTIMETERS\", locale), unitsPerMeter: 100.0, metersPerUnit: 0.01 },\n    { name: \"Meters\", localizedName: (locale) => tr(\"UNIT_METERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_METERS\", locale), unitsPerMeter: 1.0, metersPerUnit: 1.0 },\n    { name: \"Kilometers\", localizedName: (locale) => tr(\"UNIT_KILOMETERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_KILOMETERS\", locale), unitsPerMeter: 0.001, metersPerUnit: 1000.0 },\n    { name: \"Degrees\", localizedName: (locale) => tr(\"UNIT_DEGREES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_DEGREES\", locale), unitsPerMeter: 0.000009044, metersPerUnit: 111061.75033 },\n    { name: \"Decimal Degrees\", localizedName: (locale) => tr(\"UNIT_DEC_DEGREES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_DEC_DEGREES\", locale), unitsPerMeter: 0.000009044, metersPerUnit: 111061.75033 },\n    { name: \"Degrees Minutes Seconds\", localizedName: (locale) => tr(\"UNIT_DMS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_DMS\", locale), unitsPerMeter: 0.000009044, metersPerUnit: 111061.75033 },\n    { name: \"Pixels\", localizedName: (locale) => tr(\"UNIT_PIXELS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_PIXELS\", locale), unitsPerMeter: 1.0, metersPerUnit: 1.0 }\n];\n\n/**\n * Gets all available units of measure\n * @since 0.12.2\n */\nexport function getUnitsOfMeasure(): UnitOfMeasure[] {\n    return [\n        UnitOfMeasure.Centimeters,\n        UnitOfMeasure.DecimalDegrees,\n        UnitOfMeasure.Degrees,\n        UnitOfMeasure.DMS,\n        UnitOfMeasure.Feet,\n        UnitOfMeasure.Inches,\n        UnitOfMeasure.Kilometers,\n        UnitOfMeasure.Meters,\n        UnitOfMeasure.Miles,\n        UnitOfMeasure.Millimeters,\n        UnitOfMeasure.NauticalMiles,\n        UnitOfMeasure.Pixels,\n        UnitOfMeasure.Unknown,\n        UnitOfMeasure.Yards\n    ]\n}\n\n/**\n * @deprecated Use getUnitsOfMeasure() instead\n */\nexport function getUnits(): [UnitOfMeasure, UnitName][] {\n    return [\n        [UnitOfMeasure.Centimeters, \"Centimeters\"],\n        [UnitOfMeasure.DecimalDegrees, \"Decimal Degrees\"],\n        [UnitOfMeasure.Degrees, \"Degrees\"],\n        [UnitOfMeasure.DMS, \"Degrees Minutes Seconds\"],\n        [UnitOfMeasure.Feet, \"Feet\"],\n        [UnitOfMeasure.Inches, \"Inches\"],\n        [UnitOfMeasure.Kilometers, \"Kilometers\"],\n        [UnitOfMeasure.Meters, \"Meters\"],\n        [UnitOfMeasure.Miles, \"Miles\"],\n        [UnitOfMeasure.Millimeters, \"Millimeters\"],\n        [UnitOfMeasure.NauticalMiles, \"Nautical Miles\"],\n        [UnitOfMeasure.Pixels, \"Pixels\"],\n        [UnitOfMeasure.Unknown, \"Unknown\"],\n        [UnitOfMeasure.Yards, \"Yards\"]\n    ];\n}\n\nexport function getUnitOfMeasure(unit: UnitOfMeasure): UnitInfo {\n    const u = mUnits[unit];\n    return u || mUnits[0]; //The unknown unit\n}\n\n/**\n * Utility function to compute the physical map size based on the given display size and various display settings\n * \n * @since 0.11\n * @export\n * @param {[number, number]} displaySize \n * @param {number} metersPerUnit \n * @param {UnitOfMeasure} units \n * @param {number} [resolution] \n * @param {number} [precision] \n * @returns {[number, number]} \n */\nexport function getMapSize(displaySize: [number, number], metersPerUnit: number, units: UnitOfMeasure, resolution?: number, precision?: number): [number, number] {\n    const [width, height] = displaySize;\n    let gw = width;\n    let gh = height;\n    const uom = getUnitOfMeasure(units);\n    if (resolution && units != UnitOfMeasure.Pixels) {\n        gw = resolution * width;\n        gh = resolution * height;\n        if (units != UnitOfMeasure.Unknown) {\n            gw = uom.unitsPerMeter * gw * metersPerUnit;\n            gh = uom.unitsPerMeter * gh * metersPerUnit;\n        }\n        let prec = precision || 2;\n        if (prec >= 0) {\n            const factor = Math.pow(10, prec);\n            gw = Math.round(gw * factor) / factor;\n            gh = Math.round(gh * factor) / factor;\n        }\n    }\n    return [gw, gh];\n}","export function getAssetPath(url: string | undefined): string | undefined {\n    return url;\n}\n\nimport { ICON_ZOOM_OUT_FIXED } from \"../constants/assets\";\n\n//HACK: url-loader has done some breaking things to how our icon asset imports are handled\n//while this has been addressed for the main bundle build, this import is still undefined in\n//the context of our jest tests. Since nothing in our jest test suite cares that this value\n//be set at the moment, just use ?. as a workaround ($DEITY bless TS 3.7 for this wonderful\n//syntactic addition!)\nlet mRoot = ICON_ZOOM_OUT_FIXED?.replace(\"/zoom-out-fixed.png\", \"/../../\");\n\nexport function getAssetRoot(): string {\n    return mRoot;\n}\n\nexport function setAssetRoot(root: string): void {\n    mRoot = root;\n}\n\nexport function getRelativeIconPath(iconName: string): string {\n    return `images/icons/${iconName}.png`;\n}","/**\n * Asserts that this function should never be called. The common usage is to call this as the\n * \"else\" case in a series of if/else blocks or the default case in a switch statement when\n * testing cases of an enum or union type. This is a compile-time way to ensure that your code properly\n * tests for all possible cases of a given enum or union type\n *\n * @export\n * @param {never} value\n */\nexport function assertNever(value: never) {\n    throw new Error(\"Should never get here\");\n}","import * as React from \"react\";\nimport { InitError } from \"../api/common\";\nimport { isError, isInitError } from \"../utils/type-guards\";\nimport { Intent, Callout } from '@blueprintjs/core';\n\n/**\n * Error component props\n *\n * @export\n * @interface IErrorProps\n */\nexport interface IErrorProps {\n    error: Error|InitError|string;\n    errorRenderer?: (err: Error|InitError) => JSX.Element;\n}\n\n/**\n * Returns a normalized stack trace for the given error object\n *\n * @export\n * @param {(Error|InitError)} err\n * @returns {string[]}\n */\nexport function normalizeStack(err: Error|InitError): string[] {\n    let stack: string[];\n    if (err.stack instanceof Array) {\n        stack = err.stack || [];\n    } else if (typeof(err.stack) == 'string') {\n        stack = (err.stack || \"\").split(\"\\n\");\n    } else {\n        stack = [];\n    }\n    return stack;\n}\n\n/**\n * The Error component displays an error object in a nicely formatted manner\n * @param props\n */\nexport const Error = (props: IErrorProps) => {\n    const err = props.error;\n    if (isError(err) || isInitError(err)) {\n        if (props.errorRenderer) {\n            return props.errorRenderer(err);\n        } else {\n            const message = err.message;\n            const stack = normalizeStack(err);\n            return <Callout intent={Intent.DANGER} icon=\"error\">\n                <h5 className=\"error-header\">{err.message}</h5>\n                <ul className=\"error-stack\">\n                    {stack.map((ln, i) => <li key={`stack-line-${i}`}>{ln}</li>)}\n                </ul>\n            </Callout>;\n        }\n    } else {\n        return <Callout intent={Intent.DANGER} icon=\"error\">\n            <h5 className=\"error-header\">{err}</h5>\n        </Callout>;\n    }\n};","import {\n    GenericEvent,\n    Bounds,\n    RefreshMode,\n    ClientKind,\n    Dictionary,\n    Coordinate2D,\n    ImageFormat,\n    IExternalBaseLayer,\n    ILayerManager,\n    IMapViewer,\n    CommandTarget\n} from \"../api/common\";\nimport { Client } from '../api/client';\nimport { RuntimeMap } from \"../api/contracts/runtime-map\";\nimport { tr } from \"../api/i18n\";\nimport * as ReactDOM from \"react-dom\";\nimport olMap from \"ol/Map\";\nimport olView from \"ol/View\";\nimport olOverviewMap from \"ol/control/OverviewMap\";\nimport { BLANK_GIF_DATA_URI } from \"../constants/index\";\nimport { Size, BLANK_SIZE } from \"../containers/map-capturer-context\";\nimport { getSiteVersion, canUseQueryMapFeaturesV4 } from '../utils/site-version';\nimport { createContext } from \"react\";\nimport { MouseTrackingTooltip } from './tooltips/mouse';\nimport { FeatureQueryTooltip } from './tooltips/feature';\nimport { MgLayerSet } from '../api/layer-set';\nimport Collection from 'ol/Collection';\nimport Feature from 'ol/Feature';\nimport { SelectedFeaturesTooltip } from './tooltips/selected-features';\n\n/**\n * @since 0.13\n */\nexport enum MapGuideMockMode {\n    /**\n     * Render a placeholder image showing the key mapagent parameters\n     */\n    RenderPlaceholder,\n    /**\n     * Do not render anything\n     */\n    DoNotRender\n}\n\n/**\n * The map debug context, used to check if request mocking should be enabled or not\n * @since 0.13\n */\nexport interface IMapDebugContext {\n    mock?: MapGuideMockMode;\n}\n\nexport const MapDebugContext = createContext<IMapDebugContext>({});\n\nexport interface IMapViewerContextProps {\n    map: RuntimeMap;\n    imageFormat: ImageFormat;\n    selectionImageFormat?: ImageFormat;\n    selectionColor?: string;\n    agentUri: string;\n    externalBaseLayers?: IExternalBaseLayer[];\n    locale?: string;\n    showGroups?: string[];\n    showLayers?: string[];\n    hideGroups?: string[];\n    hideLayers?: string[];\n}\n\nexport interface IMapViewerContextCallback {\n    getMockMode(): MapGuideMockMode | undefined;\n    incrementBusyWorker(): void;\n    decrementBusyWorker(): void;\n    addImageLoading(): void;\n    addImageLoaded(): void;\n    onImageError(e: GenericEvent): void;\n    onSessionExpired(): void;\n    getSelectableLayers(): string[];\n    getClient(): Client;\n    isContextMenuOpen(): boolean;\n    getAgentUri(): string;\n    getAgentKind(): ClientKind;\n    getMapName(): string;\n    getSessionId(): string;\n    getLocale(): string | undefined;\n    isFeatureTooltipEnabled(): boolean;\n    getPointSelectionBox(point: Coordinate2D): Bounds;\n    openTooltipLink(url: string): void;\n    addFeatureToHighlight(feat: Feature | undefined, bAppend: boolean): void;\n}\n\n/**\n * Provides contextual information for a map viewer\n *\n * @export\n * @class MapViewerContext\n */\nexport class MapViewerContext {\n    private _activeMapName: string;\n    private _layerSets: Dictionary<MgLayerSet>;\n    private _mouseTooltip: MouseTrackingTooltip;\n    private _featureTooltip: FeatureQueryTooltip;\n    private _selectTooltip: SelectedFeaturesTooltip;\n    private _map: olMap;\n    private _ovMap: olOverviewMap;\n    private callback: IMapViewerContextCallback;\n    constructor(map: olMap, callback: IMapViewerContextCallback, initTooltipEnabled: boolean) {\n        this.callback = callback;\n        this._map = map;\n        this._layerSets = {};\n        this._mouseTooltip = new MouseTrackingTooltip(this._map, this.callback.isContextMenuOpen);\n        this._featureTooltip = new FeatureQueryTooltip(this._map, callback);\n        this._selectTooltip = new SelectedFeaturesTooltip(this._map);\n        this._featureTooltip.setEnabled(initTooltipEnabled);\n    }\n    public initLayerSet(props: IMapViewerContextProps): MgLayerSet {\n        const layerSet = new MgLayerSet(props, this.callback);\n        this._layerSets[props.map.Name] = layerSet;\n        if (!this._activeMapName) {\n            this._activeMapName = props.map.Name;\n        }\n        layerSet.update(props.showGroups, props.showLayers, props.hideGroups, props.hideLayers);\n        return layerSet;\n    }\n    public initContext(layerSet: MgLayerSet, locale?: string, overviewMapElementSelector?: () => (Element | null)) {\n        // HACK: className property not documented. This needs to be fixed in OL api doc.\n        const overviewMapOpts: any = {\n            className: 'ol-overviewmap ol-custom-overviewmap',\n            layers: layerSet.getLayersForOverviewMap(),\n            view: new olView({\n                projection: layerSet.getProjection()\n            }),\n            tipLabel: tr(\"OL_OVERVIEWMAP_TIP\", locale),\n            collapseLabel: String.fromCharCode(187), //'\\u00BB',\n            label: String.fromCharCode(171) //'\\u00AB'\n        };\n\n        if (overviewMapElementSelector) {\n            const el = overviewMapElementSelector();\n            if (el) {\n                overviewMapOpts.target = ReactDOM.findDOMNode(el);\n                overviewMapOpts.collapsed = false;\n                overviewMapOpts.collapsible = false;\n            }\n        }\n        this._ovMap = new olOverviewMap(overviewMapOpts);\n        this._map.addControl(this._ovMap);\n        layerSet.setMapGuideMocking(this.callback.getMockMode());\n        layerSet.attach(this._map, this._ovMap, false);\n    }\n    public updateOverviewMapElement(overviewMapElementSelector: () => (Element | null)) {\n        const el = overviewMapElementSelector();\n        if (el) {\n            this._ovMap.setCollapsed(false);\n            this._ovMap.setCollapsible(false);\n            this._ovMap.setTarget(ReactDOM.findDOMNode(el) as any);\n        } else {\n            this._ovMap.setCollapsed(true);\n            this._ovMap.setCollapsible(true);\n            this._ovMap.setTarget(null as any);\n        }\n    }\n    public getOverviewMap(): olOverviewMap {\n        return this._ovMap;\n    }\n    public getLayerSet(name: string, bCreate: boolean = false, props?: IMapViewerContextProps): MgLayerSet {\n        let layerSet = this._layerSets[name];\n        if (!layerSet && props && bCreate) {\n            layerSet = this.initLayerSet(props);\n            this._layerSets[props.map.Name] = layerSet;\n            this._activeMapName = props.map.Name;\n        }\n        return layerSet;\n    }\n    public get isMouseOverTooltip() { return this._featureTooltip.isMouseOver || this._selectTooltip.isMouseOver; }\n    public clearMouseTooltip(): void {\n        this._mouseTooltip.clear();\n    }\n    public setMouseTooltip(text: string) {\n        this._mouseTooltip.setText(text);\n    }\n    public handleMouseTooltipMouseMove(e: GenericEvent) {\n        this._mouseTooltip?.onMouseMove?.(e);\n    }\n    public hideSelectedVectorFeaturesTooltip() {\n        this._selectTooltip?.hide();\n    }\n    public showSelectedVectorFeatures(features: Collection<Feature>, pixel: [number, number], locale?: string) {\n        this._selectTooltip?.showSelectedVectorFeatures(features, pixel, locale);\n    }\n    public queryWmsFeatures(map: olMap, layerMgr: ILayerManager, coord: Coordinate2D) {\n        const res = map.getView().getResolution();\n        this._selectTooltip?.queryWmsFeatures(layerMgr, coord, res, this.callback);\n    }\n    public queryFeatureTooltip(pixel: [number, number]) {\n        if (this._featureTooltip && this._featureTooltip.isEnabled()) {\n            this._featureTooltip.raiseQueryFromPoint(pixel);\n        }\n    }\n    public handleFeatureTooltipMouseMove(e: GenericEvent) {\n        if (this._featureTooltip && this._featureTooltip.isEnabled()) {\n            this._featureTooltip.onMouseMove(e);\n        }\n    }\n    public isFeatureTooltipEnabled(): boolean {\n        return this._featureTooltip.isEnabled();\n    }\n    public enableFeatureTooltips(enabled: boolean): void {\n        this._featureTooltip.setEnabled(enabled);\n    }\n    public refreshOnStateChange(map: RuntimeMap, showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined): void {\n        const layerSet = this.getLayerSet(map.Name);\n        layerSet.setMapGuideMocking(this.callback.getMockMode());\n        layerSet.update(showGroups, showLayers, hideGroups, hideLayers);\n    }\n    public refreshMap(name: string, mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void {\n        const layerSet = this.getLayerSet(name);\n        layerSet.refreshMap(mode);\n    }\n    public async showSelectedFeature(mapExtent: Bounds, size: Size, map: RuntimeMap, selectionColor: string, featureXml: string | undefined) {\n        const sv = getSiteVersion(map);\n        // This operation requires v4.0.0 QUERYMAPFEATURES, so bail if this ain't the right version\n        if (!canUseQueryMapFeaturesV4(sv)) {\n            return;\n        }\n        const layerSet = this.getLayerSet(map.Name);\n        try {\n            if (featureXml) {\n                const r = await this.callback.getClient().queryMapFeatures_v4({\n                    mapname: map.Name,\n                    session: map.SessionId,\n                    selectionformat: \"PNG\",\n                    featurefilter: featureXml,\n                    selectioncolor: selectionColor,\n                    requestdata: 2, //Inline selection\n                    layerattributefilter: 0,\n                    persist: 0 //IMPORTANT: This is a transient selection\n                });\n                if (r.InlineSelectionImage) {\n                    const dataUri = `data:${r.InlineSelectionImage.MimeType};base64,${r.InlineSelectionImage.Content}`;\n                    layerSet.showActiveSelectedFeature(mapExtent, size, dataUri);\n                } else {\n                    layerSet.showActiveSelectedFeature(mapExtent, BLANK_SIZE, BLANK_GIF_DATA_URI);\n                }\n            } else {\n                layerSet.showActiveSelectedFeature(mapExtent, BLANK_SIZE, BLANK_GIF_DATA_URI);\n            }\n        } catch (e) {\n            layerSet.showActiveSelectedFeature(mapExtent, BLANK_SIZE, BLANK_GIF_DATA_URI);\n        }\n    }\n}","import { LayerProperty, ILayerManager, ILayerInfo, IParseFeaturesFromFileOptions, IAddLayerFromParsedFeaturesOptions, SourceProperty, IWmsLayerExtensions, LayerExtensions } from './common';\nimport olSourceVector from \"ol/source/Vector\";\nimport olMap from \"ol/Map\";\nimport olLayerBase from \"ol/layer/Base\";\nimport { setOLVectorLayerStyle, DEFAULT_POINT_STYLE, DEFAULT_LINE_STYLE, DEFAULT_POLY_STYLE, olStyleMapToVectorStyle, IVectorFeatureStyle, IOlStyleMap } from './ol-style-helpers';\nimport olTileLayer from \"ol/layer/Tile\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olWmsSource from \"ol/source/ImageWMS\";\nimport olTileWmsSource from \"ol/source/TileWMS\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport { getFormatDrivers } from './layer-manager/driver-registry';\nimport { IFormatDriver } from './layer-manager/format-driver';\nimport { tr } from './i18n';\nimport { MgLayerSet } from './layer-set';\nimport { IParsedFeatures } from './layer-manager/parsed-features';\n\nexport function getLayerInfo(layer: olLayerBase, isExternal: boolean): ILayerInfo {\n    let vectorStyle: IVectorFeatureStyle | undefined;\n    let ext: LayerExtensions | undefined;\n    if (layer instanceof olImageLayer || layer instanceof olTileLayer) {\n        const source = layer.getSource();\n        if (layer.get(LayerProperty.HAS_WMS_LEGEND) == true && (source instanceof olWmsSource || source instanceof olTileWmsSource)) {\n            ext = {\n                type: \"WMS\",\n                getLegendUrl: (res?: number) => source.getLegendUrl(res)\n            } as IWmsLayerExtensions;\n        }\n    }\n    if (layer instanceof olVectorLayer) {\n        const vs: IOlStyleMap | undefined = layer.get(LayerProperty.VECTOR_STYLE);\n        if (vs) {\n            vectorStyle = olStyleMapToVectorStyle(vs);\n        }\n    }\n    return {\n        visible: layer.getVisible(),\n        selectable: layer.get(LayerProperty.IS_SELECTABLE) == true,\n        name: layer.get(LayerProperty.LAYER_NAME),\n        type: layer.get(LayerProperty.LAYER_TYPE),\n        opacity: layer.getOpacity(),\n        isExternal: isExternal,\n        extensions: ext,\n        vectorStyle,\n        busyWorkerCount: layer.get(LayerProperty.BUSY_WORKER_COUNT) ?? 0\n    }\n}\n\nexport class MgLayerManager implements ILayerManager {\n    private _olFormats: IFormatDriver[];\n    constructor(private map: olMap, private layerSet: MgLayerSet) {\n        this._olFormats = getFormatDrivers();\n    }\n    getLayers(): ILayerInfo[] {\n        return this.layerSet.getCustomLayers(this.map);\n    }\n    hasLayer(name: string): boolean {\n        return this.layerSet.hasLayer(name);\n    }\n    addLayer<T extends olLayerBase>(name: string, layer: T, allowReplace?: boolean | undefined): T {\n        return this.layerSet.addLayer(this.map, name, layer, allowReplace);\n    }\n    removeLayer(name: string): olLayerBase | undefined {\n        return this.layerSet.removeLayer(this.map, name);\n    }\n    getLayer<T extends olLayerBase>(name: string): T | undefined {\n        return this.layerSet.getLayer(name);\n    }\n    apply(layers: ILayerInfo[]): void {\n        this.layerSet.apply(this.map, layers);\n    }\n    parseFeaturesFromFile(options: IParseFeaturesFromFileOptions): Promise<IParsedFeatures> {\n        const { file, name: layerName, locale } = options;\n        const that = this;\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            const handler = async function (e: ProgressEvent<FileReader>) {\n                const result = e.target?.result;\n                if (result && typeof (result) == 'string') {\n                    const formats = that._olFormats;\n                    if (formats.length == 0) {\n                        reject(new Error(tr(\"ADD_LOCAL_FILE_LAYER_FAILURE_NO_FORMATS\", locale)));\n                    }\n                    let loadedType: IParsedFeatures | undefined;\n                    let bLoaded = false;\n                    for (let i = 0, ii = formats.length; i < ii; ++i) {\n                        const format = formats[i];\n                        try {\n                            loadedType = await format.tryParse(file.size, result);\n                        } catch (e) {\n\n                        }\n                        if (loadedType && loadedType.hasFeatures()) {\n                            loadedType.name = layerName;\n                            bLoaded = true;\n                            break;\n                        }\n                    }\n                    if (bLoaded) {\n                        resolve(loadedType);\n                    } else {\n                        reject(new Error(tr(\"ADD_LOCAL_FILE_LAYER_FAILURE\", locale)));\n                    }\n                } else {\n                    reject(new Error(tr(\"ADD_LOCAL_FILE_LAYER_FAILURE_NOT_TEXT\", locale)));\n                }\n            };\n            reader.addEventListener(\"load\", handler);\n            reader.readAsText(file);\n        });\n    }\n    addLayerFromParsedFeatures(options: IAddLayerFromParsedFeaturesOptions): Promise<ILayerInfo> {\n        const { features, projection } = options;\n        const that = this;\n        return new Promise((resolve, reject) => {\n            try {\n                let proj = projection;\n                if (!proj) {\n                    const view = that.map.getView();\n                    proj = view.getProjection();\n                }\n                const source = new olSourceVector();\n                source.set(SourceProperty.SUPPRESS_LOAD_EVENTS, true);\n                const layer = new olVectorLayer({\n                    source: source,\n                    className: \"external-vector-layer\" //This is to avoid false positives for map.forEachLayerAtPixel\n                });\n                features.addTo(source, that.map.getView().getProjection(), proj);\n                layer.set(LayerProperty.LAYER_NAME, features.name);\n                layer.set(LayerProperty.LAYER_TYPE, features.type);\n                layer.set(LayerProperty.IS_SELECTABLE, true);\n                layer.set(LayerProperty.IS_EXTERNAL, true);\n                layer.set(LayerProperty.IS_GROUP, false);\n                setOLVectorLayerStyle(layer, {\n                    point: DEFAULT_POINT_STYLE,\n                    line: DEFAULT_LINE_STYLE,\n                    polygon: DEFAULT_POLY_STYLE\n                });\n                that.addLayer(features.name, layer);\n                resolve(getLayerInfo(layer, true));\n            } catch (e) {\n                reject(e);\n            }\n        });\n    }\n}","/**\n * context.ts\n *\n * This module holds various React component contexts and validation maps\n */\nimport * as React from \"react\";\nimport { IDOMElementMetrics } from \"../api/common\";\nimport { MapLayer, MapGroup } from \"../api/contracts/runtime-map\";\nimport { STR_EMPTY } from '../utils';\nimport { DEFAULT_LOCALE } from '../api/i18n';\n\nconst VOID_NOOP = () => {}\n\nexport interface IApplicationContext {\n    /**\n     * Gets whether to display HTML property values in the selection panel (provided via mount option)\n     * \n     * @since 0.11\n     * @memberof IApplicationContext\n     */\n    allowHtmlValuesInSelection: () => boolean;\n    /**\n     * Gets a HTML sanitization function (if provided via mount option)\n     * \n     * @since 0.11\n     * @memberof IApplicationContext\n     */\n    getHTMLCleaner: () => (((value: string) => string) | undefined);\n}\n\nexport const AppContext = React.createContext<IApplicationContext>({\n    allowHtmlValuesInSelection: () => false,\n    getHTMLCleaner: () => v => v\n});\n\nexport interface ILegendContext {\n    isFiltering(): boolean;\n    getFilterText(): string;\n    getLocale(): string;\n    getBaseIconSize(): number;\n    getIconMimeType(): string | undefined;\n    getChildren(objectId: string): (MapLayer | MapGroup)[];\n    getCurrentScale(): number;\n    getTree(): any;\n    getLayerVisibility(layer: MapLayer): boolean;\n    getGroupVisibility(group: MapGroup): boolean;\n    setGroupVisibility(groupId: string, visible: boolean): void;\n    setLayerVisibility(layerId: string, visible: boolean): void;\n    getLayerSelectability(layerId: string): boolean;\n    setLayerSelectability(layerId: string, selectable: boolean): void;\n    getGroupExpanded(groupId: string): boolean;\n    setGroupExpanded(groupId: string, expanded: boolean): void;\n    getLayerExpanded(layerId: string): boolean;\n    setLayerExpanded(layerId: string, expanded: boolean): void;\n}\n\nexport const LegendContext = React.createContext<ILegendContext>({\n    isFiltering: () => false,\n    getFilterText: () => STR_EMPTY,\n    getLocale: () => DEFAULT_LOCALE,\n    getBaseIconSize: () => 0,\n    getIconMimeType: () => STR_EMPTY,\n    getChildren: () => [],\n    getCurrentScale: () => -1,\n    getTree: VOID_NOOP,\n    getLayerVisibility: () => false,\n    getGroupVisibility: () => false,\n    setGroupVisibility: VOID_NOOP,\n    setLayerVisibility: VOID_NOOP,\n    getLayerSelectability: () => false,\n    setLayerSelectability: () => false,\n    getGroupExpanded: () => false,\n    setGroupExpanded: VOID_NOOP,\n    getLayerExpanded: () => false,\n    setLayerExpanded: VOID_NOOP,\n});\n\nexport interface IToolbarContext {\n    openFlyout(id: string, metrics: IDOMElementMetrics): void;\n    closeFlyout(id: string): void;\n    openComponent(id: string, metrics: IDOMElementMetrics, name: string, props?: any): void;\n    closeComponent(id: string): void;\n}\n\nexport const ToolbarContext = React.createContext<IToolbarContext>({\n    openFlyout: VOID_NOOP,\n    closeFlyout: VOID_NOOP,\n    openComponent: VOID_NOOP,\n    closeComponent: VOID_NOOP\n});","import * as Request from '../request-builder';\nimport * as Common from \"../contracts/common\";\nimport * as RtMap from '../contracts/runtime-map';\nimport * as Query from \"../contracts/query\";\nimport { MgError } from '../error';\nimport { deArrayify } from './deArrayify';\nimport { DEFAULT_LOCALE } from \"../i18n\";\n\nconst MG_MAPAGENT_ERROR_CODE = 559;\n\n/**\n * Indicates if the given response is an error response\n *\n * @export\n * @param {Response} response\n * @returns {boolean}\n */\nexport function isErrorResponse(response: Response): boolean {\n    return !response.ok || response.status === MG_MAPAGENT_ERROR_CODE;\n}\n\n/**\n * Encodes the given object for a POST submission\n *\n * @export\n * @param {*} data\n * @returns {string}\n */\nexport function serialize(data: any, uppercase: boolean = true): string {\n    return Object.keys(data).map((keyName) => {\n        return encodeURIComponent(uppercase ? keyName.toUpperCase() : keyName) + '=' + encodeURIComponent(data[keyName])\n    }).join('&');\n}\n\n/**\n * The mapagent client\n *\n * @export\n * @class MapAgentRequestBuilder\n * @extends {Request.RequestBuilder}\n */\nexport class MapAgentRequestBuilder extends Request.RequestBuilder {\n    private locale: string;\n    constructor(agentUri: string, locale: string = DEFAULT_LOCALE) {\n        super(agentUri);\n        this.locale = locale;\n    }\n\n    public async get<T>(url: string): Promise<T> {\n        const response = await fetch(url, {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            } as any,\n            method: \"GET\"\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            const json = await response.json();\n            return deArrayify(json) as T;\n        }\n    }\n\n    public async post<T>(url: string, data: any): Promise<T> {\n        if (!data.format) {\n            data.format = \"application/json\";\n        }\n        //const form = new FormData();\n        //for (const key in data) {\n        //    form.append(key.toUpperCase(), data[key]);\n        //}\n        const response = await fetch(url, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            } as any,\n            method: \"POST\",\n            body: serialize(data) //form\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            const json = await response.json();\n            return deArrayify(json) as T;\n        }\n    }\n\n    private stringifyGetUrl(options: any): string {\n        if (!options.version) {\n            options.version = \"1.0.0\";\n        }\n        if (!options.locale) {\n            options.locale = this.locale;\n        }\n        if (!options.format) {\n            options.format = \"application/json\";\n        }\n        let url = this.agentUri;\n        let bFirst = true;\n        for (const key in options) {\n            if (bFirst) {\n                url += `?${key.toUpperCase()}=${options[key]}`;\n                bFirst = false;\n            } else {\n                url += `&${key.toUpperCase()}=${options[key]}`;\n            }\n        }\n        return url;\n    }\n\n    public async createSession(username: string, password: string): Promise<string> {\n        const url = this.agentUri;\n        const data = { operation: \"CREATESESSION\", version: \"1.0.0\", USERNAME: username, PASSWORD: password };\n        const response = await fetch(url, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            } as any,\n            method: \"POST\",\n            body: serialize(data) //form\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            return await response.text();\n        }\n    }\n\n    public async getServerSessionTimeout(session: string): Promise<number> {\n        const url = this.agentUri;\n        const data = { operation: \"GETSESSIONTIMEOUT\", version: \"1.0.0\", SESSION: session };\n        const response = await fetch(url, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            } as any,\n            method: \"POST\",\n            body: serialize(data) //form\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            const val = await response.text();\n            return parseInt(val, 10);\n        }\n    }\n\n    public getResource<T extends Common.ResourceBase>(resourceId: Common.ResourceIdentifier, args?: any): Promise<T> {\n        if (args != null) {\n            const p1 = { operation: \"GETRESOURCECONTENT\", resourceId: resourceId };\n            const url = this.stringifyGetUrl({ ...args, ...p1 });\n            return this.get<T>(url);\n        } else {\n            const url = this.stringifyGetUrl({ operation: \"GETRESOURCE\", resourceId: resourceId });\n            return this.get<T>(url);\n        }\n    }\n\n    public createRuntimeMap(options: Request.ICreateRuntimeMapOptions): Promise<RtMap.RuntimeMap> {\n        const p1 = { operation: \"CREATERUNTIMEMAP\", version: \"3.0.0\" };\n        const url = this.stringifyGetUrl({ ...options, ...p1 });\n        return this.get<RtMap.RuntimeMap>(url);\n    }\n\n    public queryMapFeatures(options: Request.IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse> {\n        const p1 = { operation: \"QUERYMAPFEATURES\", version: \"2.6.0\" };\n        return this.post<Query.QueryMapFeaturesResponse>(this.agentUri, { ...options, ...p1 });\n    }\n\n    public queryMapFeatures_v4(options: Request.IQueryMapFeaturesOptions): Promise<Query.QueryMapFeaturesResponse> {\n        const p1 = { operation: \"QUERYMAPFEATURES\", version: \"4.0.0\" };\n        return this.post<Query.QueryMapFeaturesResponse>(this.agentUri, { ...options, ...p1 });\n    }\n\n    public describeRuntimeMap(options: Request.IDescribeRuntimeMapOptions): Promise<RtMap.RuntimeMap> {\n        const p1 = { operation: \"DESCRIBERUNTIMEMAP\", version: \"3.0.0\" };\n        const url = this.stringifyGetUrl({ ...options, ...p1 });\n        return this.get<RtMap.RuntimeMap>(url);\n    }\n\n    public getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string {\n        const urlTemplate = `${this.agentUri}?OPERATION=GETTILEIMAGE&VERSION=1.2.0&USERNAME=Anonymous&MAPDEFINITION=${resourceId}&BASEMAPLAYERGROUPNAME=${groupName}&TILECOL=${xPlaceholder}&TILEROW=${yPlaceholder}&SCALEINDEX=${zPlaceholder}`;\n        return urlTemplate;\n    }\n}","import {\n    IModalComponentDisplayOptions,\n    IModalDisplayOptions\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ICloseModalAction, IShowModalUrlAction, IShowComponentInModalAction } from './defs';\n\n/**\n * Displays the specified component in a modal dialog\n *\n * @export\n * @param {*} options Modal dialog display options\n * @returns {IShowComponentInModalAction}\n */\nexport function showModalComponent(options: IModalComponentDisplayOptions): IShowComponentInModalAction {\n    return {\n        type: ActionType.MODAL_SHOW_COMPONENT,\n        payload: {\n            ...options\n        }\n    };\n}\n\n/**\n * Displays the specified URL in a modal dialog\n *\n * @export\n * @param {*} options Modal dialog display options\n * @returns {IShowModalUrlAction}\n */\nexport function showModalUrl(options: IModalDisplayOptions): IShowModalUrlAction {\n    return {\n        type: ActionType.MODAL_SHOW_URL,\n        payload: {\n            ...options\n        }\n    };\n}\n\n/**\n * Hides an open modal dialog\n *\n * @export\n * @param {*} options Modal dialog hide options\n * @returns {ICloseModalAction}\n */\nexport function hideModal(options: any): ICloseModalAction {\n    return {\n        type: ActionType.MODAL_CLOSE,\n        payload: options.name\n    };\n}","/**\n * A react layout template component factory function signature\n */\nexport type LayoutFactory = (() => JSX.Element);\n\nconst layouts: { [key: string]: LayoutFactory } = {};\n\n/**\n * Register the given react layout template component factory function for the given\n * template name\n *\n * @export\n * @param {string} name\n * @param {LayoutFactory} factory\n */\nexport function registerLayout(name: string, factory: LayoutFactory) {\n    layouts[name] = factory;\n}\n\n/**\n * Gets the registerd react layout template component factory function for the given\n * template name\n *\n * @export\n * @param {string} name\n * @returns {LayoutFactory}\n */\nexport function getLayout(name: string): LayoutFactory {\n    return layouts[name];\n}","import { Client } from \"../api/client\";\nimport { RuntimeMapFeatureFlags } from \"../api/request-builder\";\nimport {\n    ReduxThunkedAction,\n    getRuntimeMap\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ILegendSetGroupVisibilityAction, ILegendSetGroupExpandedAction, ILegendSetLayerVisibilityAction, ILegendSetGroupSelectableAction } from './defs';\n\n/**\n * Sets the visibility for the given map group\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setGroupVisibility(mapName: string, options: { id: string, value: boolean }): ILegendSetGroupVisibilityAction {\n    return {\n        type: ActionType.LEGEND_SET_GROUP_VISIBILITY,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Sets the visibility for the given map layer\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setLayerVisibility(mapName: string, options: { id: string, value: boolean }): ILegendSetLayerVisibilityAction {\n    return {\n        type: ActionType.LEGEND_SET_LAYER_VISIBILITY,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Sets the expanded/collapsed state of the given group\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setGroupExpanded(mapName: string, options: { id: string, value: boolean }): ILegendSetGroupExpandedAction {\n    return {\n        type: ActionType.LEGEND_SET_GROUP_EXPANDABLE,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Sets the selectability state for the given map layer\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setLayerSelectable(mapName: string, options: { id: string, value: boolean }): ILegendSetGroupSelectableAction {\n    return {\n        type: ActionType.LEGEND_SET_LAYER_SELECTABLE,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Perform a full refresh with a requery of the layer/group structure\n *\n * @export\n * @returns {ReduxThunkedAction}\n */\nexport function refresh(): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        const state = getState();\n        const args = state.config;\n        const map = getRuntimeMap(state);\n        if (map && args.agentUri && args.agentKind) {\n            const client = new Client(args.agentUri, args.agentKind);\n            client.describeRuntimeMap({\n                mapname: map.Name,\n                session: map.SessionId,\n                requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups\n            }).then(res => {\n                if (args.activeMapName) {\n                    dispatch({\n                        type: ActionType.MAP_REFRESH,\n                        payload: {\n                            mapName: args.activeMapName,\n                            map: res\n                        }\n                    });\n                }\n            });\n        }\n    };\n}","import { IMapViewer, Coordinate2D } from \"../api/common\";\nimport * as logger from \"../utils/logger\";\nimport { deg2rad } from \"../utils/number\";\nimport * as olExtent from \"ol/extent\";\nimport olFeature from \"ol/Feature\";\nimport olCollection from \"ol/Collection\";\nimport olPolygon from \"ol/geom/Polygon\";\nimport olVectorSource from \"ol/source/Vector\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport olInteractionTranslate from \"ol/interaction/Translate\";\n\nexport type Size = { w: number, h: number };\nexport const BLANK_SIZE: Size = { w: 1, h: 1 };\n\nexport interface IMapCapturerContextCallback {\n    updateBoxCoords(box: string, normalizedBox: string): void;\n}\n\nexport class MapCapturerContext {\n    private mapCapturerSource: olVectorSource;\n    private mapCapturerLayer: olVectorLayer;\n    private layerName: string;\n    private intTranslate: olInteractionTranslate;\n    private features: olCollection<olFeature>;\n    private activeCallback: IMapCapturerContextCallback | undefined;\n    constructor(private viewer: IMapViewer, private mapName: string, private rotation: number = 0) {\n        this.features = new olCollection<olFeature>();\n        this.mapCapturerSource = new olVectorSource({\n            features: this.features\n        });\n        this.mapCapturerLayer = new olVectorLayer({\n            source: this.mapCapturerSource\n        });\n        this.intTranslate = new olInteractionTranslate({\n            features: this.features\n        });\n        this.intTranslate.on(\"translateend\", this.onTranslateEnd.bind(this))\n        this.layerName = `${mapName}_MapCapturer`;\n    }\n    private getRing(origin: { x: number, y: number }, paperSize: Size, scaleDenominator: number): [number, number][][] {\n        const ring: Coordinate2D[] = [];\n        const factor = scaleDenominator / (this.viewer.getMetersPerUnit() * 1000 * 2);\n        ring.push([origin.x - paperSize.w * factor, origin.y - paperSize.h * factor]);\n        ring.push([origin.x + paperSize.w * factor, origin.y - paperSize.h * factor]);\n        ring.push([origin.x + paperSize.w * factor, origin.y + paperSize.h * factor]);\n        ring.push([origin.x - paperSize.w * factor, origin.y + paperSize.h * factor]);\n        return [ ring ];\n    }\n    private onTranslateEnd() {\n        if (this.features.getLength() == 1 && this.activeCallback) {\n            const box = this.features.item(0);\n            const poly = box.getGeometry() as olPolygon;\n            const coords = poly.getCoordinates()[0];\n            const boxCoords = coords.map((c: any) => `${c[0]},${c[1]}`).join(\",\");\n            //Process normalized one\n            const npoly = poly.clone() as olPolygon;\n            const ncenter = olExtent.getCenter(npoly.getExtent());\n            npoly.rotate(deg2rad(this.rotation), ncenter);\n            //HACK: Missing getCoordinates() from type defn\n            const ncoords = npoly.getCoordinates()[0];\n            const nBoxCoords = ncoords.map((c: any) => `${c[0]},${c[1]}`).join(\",\");\n            this.activeCallback.updateBoxCoords(boxCoords, nBoxCoords);\n        }\n    }\n    public updateBox(paperSize: Size, scaleDenominator: number, rotation: number): void {\n        if (this.activeCallback) {\n            this.rotation = rotation;\n            let poly: olPolygon;\n            if (this.features.getLength() == 0) {\n                poly = this.createCaptureBox(paperSize, scaleDenominator, this.rotation);\n            } else {\n                const box = this.features.item(0);\n                poly = box.getGeometry() as olPolygon;\n                const center = olExtent.getCenter(poly.getExtent());\n                const origin = {\n                    x: center[0],\n                    y: center[1]\n                };\n                const ring = this.getRing(origin, paperSize, scaleDenominator);\n                poly.setCoordinates(ring);\n                poly.rotate(-deg2rad(this.rotation), center);\n            }\n            const coords = poly.getCoordinates()[0];\n            const boxCoords = coords.map((c: any) => `${c[0]},${c[1]}`).join(\",\");\n            //Process normalized one\n            const npoly = poly.clone() as olPolygon;\n            const ncenter = olExtent.getCenter(npoly.getExtent());\n            npoly.rotate(deg2rad(this.rotation), ncenter);\n            const ncoords = npoly.getCoordinates()[0];\n            const nBoxCoords = ncoords.map((c: any) => `${c[0]},${c[1]}`).join(\",\");\n            this.activeCallback.updateBoxCoords(boxCoords, nBoxCoords);\n        }\n    }\n    private createCaptureBox(paperSize: Size, scaleDenominator: number, rotation: number): olPolygon {\n        const origin = this.viewer.getCurrentView();\n        const ring = this.getRing(origin, paperSize, scaleDenominator);\n        const poly = new olPolygon(ring);\n        poly.rotate(-deg2rad(rotation), [ origin.x, origin.y ]);\n        const box = new olFeature(poly);\n        this.features.clear();\n        this.features.push(box);\n        return poly;\n    }\n    public getMapName(): string { return this.mapName; }\n    public activate(callback: IMapCapturerContextCallback, paperSize: Size, scaleDenominator: number, rotation: number): void {\n        this.activeCallback = callback;\n        logger.debug(`Activating map capturer context for ${this.mapName}`);\n        this.viewer.getLayerManager().addLayer(this.layerName, this.mapCapturerLayer, true);\n        this.updateBox(paperSize, scaleDenominator, rotation);\n        this.viewer.addInteraction(this.intTranslate);\n    }\n    public deactivate(): void {\n        this.activeCallback = undefined;\n        logger.debug(`De-activating map capturer context for ${this.mapName}`);\n        this.features.clear();\n        this.viewer.getLayerManager().removeLayer(this.layerName);\n        this.viewer.removeInteraction(this.intTranslate);\n    }\n}","import * as React from \"react\";\nimport { IWfsServiceCapabilities, IWfsServiceInfo, IWfsLayerInfo } from './wfs-capabilities-parser';\nimport { tr } from '../../api/i18n';\nimport { Card, Icon, ButtonGroup, Button, Intent } from '@blueprintjs/core';\nimport { Bounds } from '../../api/common';\n\n/**\n * Attempts to extract an EPSG code from the given CRS identifier\n * \n * @export\n * @param {string | undefined} crs\n * @returns {(number | undefined)}\n * @since 0.13\n */\nexport function parseEpsgCodeFromCRS(crs: string | undefined): number | undefined {\n    if (crs == \"urn:ogc:def:crs:OGC:1.3:CRS84\") {\n        return 4326;\n    }\n    let res = crs?.match(/urn:ogc:def:crs:EPSG::(\\d+)/);\n    if (res?.length == 2) {\n        return parseInt(res[1], 10);\n    }\n    res = crs?.match(/EPSG:(\\d+)/);\n    if (res?.length == 2) {\n        return parseInt(res[1], 10);\n    }\n    return undefined;\n}\n\nfunction isGeoJsonMimeType(mimeType: string): boolean {\n    const lmt = mimeType?.toLowerCase() ?? \"\";\n    if (lmt.indexOf(\"application/vnd.geo+json\") >= 0 ||\n        lmt.indexOf(\"application/json\") >= 0) {\n        return true;\n    }\n    return false;\n}\n\nfunction getGeoJsonFormat(serviceInfo: IWfsServiceInfo, layer: IWfsLayerInfo): string | undefined {\n    const lformats = (layer.formats ?? []).filter(f => isGeoJsonMimeType(f))?.[0];\n    // NOTE: Some WFS services advertise GeoJSON support as an allowed outputFormat parameter at the service-level, \n    // but not as an advertised outputFormat for the layer in question. Without fully reading the spec, I don't know\n    // if using GetFeature for a layer with a service-level outputFormat for such layers is formally allowed. Based\n    // on my sample WFS services, this appears to be allowed, so if geojson is supported at the service-level, but\n    // not at the layer level, we'll still consider geojson as being \"supported\"\n    const sformats = (serviceInfo.allowedOutputFormats ?? []).filter(f => isGeoJsonMimeType(f))?.[0];\n    return lformats ?? sformats;\n}\n\nfunction getLayerCrs(layer: IWfsLayerInfo): [number | undefined, string] {\n    let pdc: [number | undefined, string] = [parseEpsgCodeFromCRS(layer.defaultCrs), layer.defaultCrs];\n    // We strongly prefer 4326/3857 projections over others\n    if (!(pdc[0] == 4326 || pdc[0] == 3857)) {\n        if (layer.otherCrs) {\n            const matches = layer.otherCrs.filter(c => {\n                const poc = parseEpsgCodeFromCRS(c);\n                return (poc == 4326 || poc == 3857);\n            });\n            if (matches.length > 0) {\n                pdc = [parseEpsgCodeFromCRS(matches[0]), matches[0]];\n            }\n        }\n    }\n    return pdc;\n}\n\n/**\n * @hidden\n */\nexport interface IWfsCapabilitiesPanelProps {\n    capabilities: IWfsServiceCapabilities;\n    locale: string;\n    onAddLayer: (name: string, version: string, format: string, origCrs: string, epsgCode: number, wfsWgs84Bounds?: Bounds) => void;\n}\n\n/**\n * @hidden\n */\nexport const WfsCapabilitiesPanel = (props: IWfsCapabilitiesPanelProps) => {\n    const { locale, capabilities, onAddLayer } = props;\n    const { layers, info } = capabilities;\n    return <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WFS_SERVICE_INFO\", locale)}</a></h5>\n            <p>{tr(\"WFS_VERSION\", locale, { version: info.version })}</p>\n            <p>{tr(\"OWS_SERVICE_TITLE\", locale, { title: info.title })}</p>\n            <p>{tr(\"OWS_SERVICE_ABSTRACT\", locale, { abstract: info.abstract })}</p>\n        </Card>\n        <Card style={{ marginBottom: 10 }}>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WFS_AVAILABLE_LAYERS\", locale)}</a></h5>\n            {layers.map(layer => {\n                const geoJsonFmt = getGeoJsonFormat(info, layer);\n                const [epsgCode, origCrs] = getLayerCrs(layer);\n                //Only include layers whose CRS was able to be parsed into an epsg code\n                if (epsgCode && geoJsonFmt) {\n                    const otherActions = <></>;\n                    return <Card key={layer.name} style={{ padding: 15, paddingTop: 5 }}>\n                        <h4><Icon icon=\"layer\" /> {layer.name}</h4>\n                        <p>{tr(\"OWS_LAYER_TITLE\", locale, { title: layer.title })}</p>\n                        <p>{tr(\"OWS_LAYER_CRS\", locale, { crs: `EPSG:${epsgCode}` })}</p>\n                        {/*<p>{tr(\"OWS_LAYER_ABSTRACT\", locale, { abstract: layer.abstract })}</p>*/}\n                        <ButtonGroup fill>\n                            <Button onClick={() => onAddLayer(layer.name, info.version, geoJsonFmt, origCrs, epsgCode, layer.wgs84Bounds)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER\", locale)}</Button>\n                            {otherActions}\n                        </ButtonGroup>\n                    </Card>\n                }\n            }).filter(c => c)}\n        </Card>\n    </>\n}","/**\n * @hidden\n */\n\n/** */\n\nexport * from \"./asset\";\nexport * from \"./logger\";\nexport * from \"./menu\";\nexport * from \"./never\";\nexport * from \"./number\";\nexport * from \"./string\";\nexport * from \"./type-guards\";\nexport * from \"./units\";\nexport * from \"./url\";","import * as React from \"react\";\nimport { getAssetPath } from \"../utils/asset\";\nimport { STD_CSS_SPRITE_RELPATH, ICON_ERROR } from \"../constants/assets\";\nimport { GenericEventHandler } from \"../api/common\";\n\nexport interface IIconProps {\n    style?: React.CSSProperties;\n    onClick?: GenericEventHandler;\n    otherProps?: any;\n    baseSize: number;\n    children: (baseSize: number) => React.ReactElement;\n}\n\nexport const Icon = (props: IIconProps) => {\n    const spStyle = { ...(props.style || {}) };\n    if (!spStyle.display) {\n        spStyle.display = \"inline-block\";\n    }\n    return <div style={spStyle} onClick={props.onClick} {...props.otherProps}>\n        {props.children(props.baseSize)}\n    </div>;\n};\n\nexport interface IImageIconProps {\n    /**\n     * The icon path relative to the standard asset path\n     *\n     * @type {string}\n     * @memberof IIconProps\n     */\n    url?: string;\n    spriteClass?: string;\n    style?: React.CSSProperties;\n    onClick?: GenericEventHandler;\n    otherProps?: any;\n}\n\n/**\n * An image icon component\n * @param props\n * @since 0.13\n */\nexport const ImageIcon = (props: IImageIconProps) => {\n    if (!props.url && !props.spriteClass) {\n        return <noscript />;\n    }\n    let url;\n    let spriteClass = props.spriteClass;\n    if (props.url && props.url != STD_CSS_SPRITE_RELPATH) {\n        url = getAssetPath(props.url);\n        spriteClass = undefined;\n    }\n    if (spriteClass) {\n        const spStyle = { ...(props.style || {}) };\n        if (!spStyle.display) {\n            spStyle.display = \"inline-block\";\n        }\n        return <div style={spStyle} onClick={props.onClick} className={`icon ${spriteClass}`} {...props.otherProps} />;\n    }\n    return <img className=\"icon\" style={props.style} src={url} onClick={props.onClick} {...props.otherProps} onError={e => e.currentTarget.src = ICON_ERROR} />;\n};","import proj4 from \"proj4\";\nimport * as logger from \"../../utils/logger\";\nimport { MgError } from '../error';\nimport { tr } from '../i18n';\nimport { strIsNullOrEmpty } from '../../utils/string';\nimport { register } from 'ol/proj/proj4';\n\n/**\n * Performs a projection definiiton lookup at epsg.io for the given EPSG code\n *\n * @export\n * @param {string | number} epsg\n * @param {string} locale\n * @param {string} mapDef\n * @returns {Promise<any>}\n * @since 0.13\n */\nexport async function resolveProjectionFromEpsgIoAsync(epsg: string | number, locale: string, mapDef: string): Promise<any> {\n    const r = await fetch(`//epsg.io?format=json&q=${epsg}`);\n    const resp = await r.json();\n    if (resp.results && resp.results.length > 0) {\n        proj4.defs(`EPSG:${epsg}`, resp.results[0].proj4);\n        logger.debug(`Registered projection EPSG:${epsg} from epsg.io`);\n        return proj4.defs[`EPSG:${epsg}`];\n    } else {\n        throw new MgError(tr(\"INIT_ERROR_UNREGISTERED_EPSG_CODE\", locale, { epsg: epsg, mapDefinition: mapDef }));\n    }\n}\n\n/**\n * Ensures the given projection (by EPSG code) exists and if not invokes the given factory function (or does an epsg.io lookup)\n * to fetch the definition to be registered.\n * \n * Once registered, it will update the projection set within OpenLayers\n * \n * @export\n * @param {number} epsgCode\n * @param {() => Promise<string>} [factoryIfNotFound] A custom factory function to provide the required proj4js string for this projection. If not specified, a lookup to epsg.io will be done instead\n * @param {string} alias\n * @returns {Promise<string>}\n * @since 0.13\n */\nexport async function ensureProjection(epsgCode: number, locale: string, alias?: string, factoryIfNotFound?: () => Promise<string>): Promise<[number, string]> {\n    let resolvedName: string;\n    let bAdded = false;\n    const name = `EPSG:${epsgCode}`;\n    if (proj4.defs[name]) {\n        resolvedName = name;\n    } else {\n        if (factoryIfNotFound) {\n            proj4.defs[name] = factoryIfNotFound();\n            bAdded = true;\n            resolvedName = name;\n        } else {\n            await resolveProjectionFromEpsgIoAsync(epsgCode, locale, \"\");\n            resolvedName = name;\n        }\n    }\n    //Register the alias if specified\n    if (!strIsNullOrEmpty(alias) && !proj4.defs[alias]) {\n        proj4.defs[alias] = proj4.defs[resolvedName];\n        bAdded = true;\n    }\n    //Need to call re-register if proj4.defs got changed so OL can pick it up\n    if (bAdded) {\n        register(proj4);\n    }\n    return [epsgCode, resolvedName];\n}","/**\n * @hidden\n */\n\n/** */\n\nexport * from \"./builders\";\nexport * from \"./contracts\";\nexport * from \"./registry\";\nexport * from \"./bootstrap\";\nexport * from \"./client\";\nexport * from \"./common\";\nexport * from \"./default-commands\";\nexport * from \"./default-components\";\nexport * from \"./error\";\nexport * from \"./i18n\";\nexport * from \"./ol-factory\";\nexport * from \"./request-builder\";\nexport * from \"./runtime\";","//TODO: When TypeScript 2.0 drops, some of these interfaces can be converted to discriminated unions\n\nimport { ResourceBase } from \"./common\";\n\nexport interface ResourceReference {\n    ResourceId: string;\n}\n\nexport interface MapView {\n    CenterX: number;\n    CenterY: number;\n    Scale: number;\n}\n\nexport type TargetType = \"TaskPane\" | \"NewWindow\" | \"SpecifiedFrame\";\n\nexport interface WebLayoutMap extends ResourceReference {\n    InitialView?: MapView | undefined;\n    HyperlinkTarget: TargetType;\n    HyperlinkTargetFrame?: string | undefined;\n}\n\nexport interface WebLayoutControl {\n    Visible: boolean;\n}\n\nexport interface WebLayoutResizableControl extends WebLayoutControl {\n    Width: number;\n}\n\nexport interface FlyoutUIItem {\n    Function: \"Flyout\";\n    Label: string;\n    Tooltip?: string | undefined;\n    Description?: string | undefined;\n    ImageURL?: string | undefined;\n    DisabledImageURL?: string | undefined;\n    SubItem?: UIItem[] | undefined;\n}\n\nexport interface SeparatorUIItem {\n    Function: \"Separator\";\n}\n\nexport interface CommandUIItem {\n    Function: \"Command\";\n    Command: string;\n}\n\nexport type UIItem = FlyoutUIItem | SeparatorUIItem | CommandUIItem;\n\nexport function isCommandItem(item: UIItem): item is CommandUIItem {\n    return item.Function === \"Command\";\n}\n\nexport function isFlyoutItem(item: UIItem): item is FlyoutUIItem {\n    return item.Function === \"Flyout\";\n}\n\nexport function isSeparatorItem(item: UIItem): item is SeparatorUIItem {\n    return item.Function === \"Separator\";\n}\n\nexport interface WebLayoutToolbar extends WebLayoutControl {\n    Button: UIItem[];\n}\n\nexport interface WebLayoutContextMenu extends WebLayoutControl {\n    MenuItem: UIItem[];\n}\n\nexport interface TaskButton {\n    Name: string;\n    Tooltip: string;\n    Description: string;\n    ImageURL: string;\n    DisabledImageURL: string;\n}\n\nexport interface WebLayoutTaskBar extends WebLayoutControl {\n    Home: TaskButton;\n    Forward: TaskButton;\n    Back: TaskButton;\n    Tasks: TaskButton;\n    MenuButton: UIItem[];\n}\n\nexport interface WebLayoutTaskPane extends WebLayoutResizableControl {\n    InitialTask: string;\n    TaskBar: WebLayoutTaskBar;\n}\n\nexport interface WebLayoutStatusBar extends WebLayoutControl {\n\n}\n\nexport interface WebLayoutZoomControl extends WebLayoutControl {\n\n}\n\nexport interface WebLayoutInfoPane extends WebLayoutResizableControl {\n    LegendVisible: boolean;\n    PropertiesVisible: boolean;\n}\n\nexport type TargetViewerType = \"Dwf\" | \"Ajax\" | \"All\";\n\nexport interface CommandDef {\n    \"@xsi:type\": string;\n    Name: string;\n    Label: string;\n    Tooltip?: string | undefined;\n    Description?: string | undefined;\n    ImageURL?: string | undefined;\n    DisabledImageURL?: string | undefined;\n    TargetViewer: TargetViewerType;\n}\n\nexport type BasicCommandActionType =\n    \"Pan\" |\n    \"PanUp\" |\n    \"PanDown\" |\n    \"PanRight\" |\n    \"PanLeft\" |\n    \"Zoom\" |\n    \"ZoomIn\" |\n    \"ZoomOut\" |\n    \"ZoomRectangle\" |\n    \"ZoomToSelection\" |\n    \"FitToWindow\" |\n    \"PreviousView\" |\n    \"NextView\" |\n    \"RestoreView\" |\n    \"Select\" |\n    \"SelectRadius\" |\n    \"SelectPolygon\" |\n    \"ClearSelection\" |\n    \"Refresh\" |\n    \"CopyMap\" |\n    \"About\" |\n    \"MapTip\";\n\nexport interface BasicCommandDef extends CommandDef {\n    Action: BasicCommandActionType;\n}\n\nexport function isBasicCommand(cmd: any): cmd is BasicCommandDef {\n    return typeof(cmd.Action) != 'undefined';\n}\n\nexport function isTargetedCommand(cmd: any): cmd is TargetedCommandDef {\n    return typeof(cmd.Target) != 'undefined';\n}\n\nexport interface CustomCommandDef extends CommandDef {\n\n}\n\nexport interface TargetedCommandDef extends CustomCommandDef {\n    Target: TargetType;\n    TargetFrame?: string | undefined;\n}\n\nexport interface ParameterPair {\n    Key: string;\n    Value: string;\n}\n\nexport interface LayerSet {\n    Layer?: string[] | undefined;\n}\n\nexport function isInvokeURLCommand(cmd: any): cmd is InvokeURLCommandDef {\n    return typeof(cmd.URL) != 'undefined' && typeof(cmd.DisableIfSelectionEmpty) != 'undefined';\n}\n\nexport function isSearchCommand(cmd: CommandDef): cmd is SearchCommandDef {\n    return cmd[\"@xsi:type\"] == \"SearchCommandType\";\n}\n\nexport interface InvokeURLCommandDef extends TargetedCommandDef {\n    URL: string;\n    LayerSet?: LayerSet | undefined;\n    AdditionalParameter?: ParameterPair[] | undefined;\n    DisableIfSelectionEmpty: boolean;\n}\n\nexport interface InvokeScriptCommandDef extends TargetedCommandDef {\n    Script: string;\n}\n\nexport interface ResultColumn {\n    Name: string;\n    Property: string;\n}\n\nexport interface ResultColumnSet {\n    Column?: ResultColumn[] | undefined;\n}\n\nexport interface SearchCommandDef extends TargetedCommandDef {\n    Layer: string;\n    Prompt: string;\n    ResultColumns: ResultColumnSet;\n    Filter?: string;\n    MatchLimit: number;\n}\n\nexport interface BufferCommandDef extends TargetedCommandDef { }\n\nexport interface SelectWithinCommandDef extends TargetedCommandDef { }\n\nexport interface PrintCommandDef extends TargetedCommandDef {\n    PrintLayout?: ResourceReference[];\n}\n\nexport interface GetPrintablePageCommandDef extends TargetedCommandDef { }\n\nexport interface MeasureCommandDef extends TargetedCommandDef { }\n\nexport interface ViewOptionsCommandDef extends TargetedCommandDef { }\n\nexport interface HelpCommandDef extends TargetedCommandDef {\n    URL: string;\n}\n\nexport interface WebLayoutCommandSet {\n    Command: CommandDef[];\n}\n\nexport interface WebLayout extends ResourceBase {\n    Title: string;\n    Map: WebLayoutMap;\n    EnablePingServer?: boolean;\n    SelectionColor?: string;\n    PointSelectionBuffer?: number;\n    MapImageFormat?: string;\n    SelectionImageFormat?: string;\n    StartupScript?: string;\n    ToolBar: WebLayoutToolbar;\n    InformationPane: WebLayoutInfoPane;\n    ContextMenu: WebLayoutContextMenu;\n    TaskPane: WebLayoutTaskPane;\n    StatusBar: WebLayoutStatusBar;\n    ZoomControl: WebLayoutZoomControl;\n    CommandSet: WebLayoutCommandSet;\n}","import { RequestBuilder } from '../request-builder';\nimport { MgError } from '../error';\nimport { ClientKind } from '../common';\nimport { MapAgentRequestBuilder } from './mapagent';\n\n/**\n * A factory method for creating request builders\n * \n * @since 0.13\n */\nexport type RequestBuilderFactory = (agentUri: string, locale?: string) => RequestBuilder;\n\nconst _builders: { [kind: string]: RequestBuilderFactory } = {};\n\n/**\n * Registers a factory for creating request builders for the given kind\n * \n * @param kind \n * @param factory \n * @since 0.13\n */\nexport function registerRequestBuilder(kind: ClientKind, factory: RequestBuilderFactory): void {\n    _builders[kind] = factory;\n}\n\n/**\n * Creates the request builder for the given kind\n * \n * @param agentUri \n * @param kind \n * @since 0.13\n */\nexport function createRequestBuilder(agentUri: string, kind: ClientKind): RequestBuilder {\n    if (_builders[kind]) {\n        return _builders[kind](agentUri);\n    }\n    throw new MgError(`Unknown or unsupported client kind: ${kind}`);\n}","/**\n * map-viewer-base.tsx\n *\n * This is the main map viewer component that wraps the OpenLayers map viewer and its various APIs\n *\n * This component is designed to be as \"dumb\" as possible, taking as much of its viewer directives from\n * the props given to it. It carries minimal component state. Where possible, relevant state is farmed off and\n * managed by a higher level parent component\n *\n * This component is usually wrapped by its \"smart\" sibling (src/containers/map-viewer.tsx), which is\n * redux aware and is responsible for flowing map state to the redux store (so any other interested\n * components will properly update) and flowing updated props back to this component to actually\n * carry out the requested actions\n *\n * NOTE: This component does not perfectly implement uni-directional data flow (sadly OpenLayers is fighting\n * against us in some parts, and is prone to out-of-band updates to map state that we are not properly flowing back),\n * thus it breaks certain debugging capabilities of redux such as \"time travel\"\n */\n\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport {\n    GenericEvent,\n    IMapView,\n    ILayerManager,\n    DigitizerCallback,\n    ActiveMapTool,\n    Bounds,\n    Coordinate2D,\n    RefreshMode,\n    ClientKind,\n    LayerTransparencySet,\n    MapLoadIndicatorPositioning,\n    KC_ESCAPE,\n    KC_U,\n    SelectionVariant,\n    Size2,\n    LayerProperty\n} from \"../api/common\";\nimport * as RtMap from '../api/contracts/runtime-map';\nimport debounce = require(\"lodash.debounce\");\nimport { areNumbersEqual } from '../utils/number';\nimport * as logger from '../utils/logger';\nimport { isSessionExpiredError } from '../api/error';\nimport { Client } from '../api/client';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { IQueryMapFeaturesOptions } from '../api/request-builder';\nimport {\n    CURSOR_DIGITIZE_POINT,\n    CURSOR_DIGITIZE_LINE,\n    CURSOR_DIGITIZE_LINESTRING,\n    CURSOR_DIGITIZE_RECT,\n    CURSOR_DIGITIZE_POLYGON,\n    CURSOR_DIGITIZE_CIRCLE,\n    CURSOR_GRABBING,\n    CURSOR_GRAB,\n    CURSOR_ZOOM_IN\n} from \"../constants/assets\";\nimport { tr } from \"../api/i18n\";\nimport isMobile from \"ismobilejs\";\nimport { IMapViewerContextCallback, IMapViewerContextProps, MapViewerContext, MapGuideMockMode } from \"./map-viewer-context\";\n\nimport * as olExtent from \"ol/extent\";\nimport * as olEasing from \"ol/easing\";\n\nimport { MapOptions } from \"ol/PluggableMap\";\nimport Map from \"ol/Map\";\nimport View from \"ol/View\";\nimport Feature from \"ol/Feature\";\nimport Overlay from \"ol/Overlay\";\nimport WKTFormat from \"ol/format/WKT\";\n\nimport Interaction from \"ol/interaction/Interaction\";\nimport Draw, { GeometryFunction } from \"ol/interaction/Draw\";\nimport DragBox from \"ol/interaction/DragBox\";\nimport DragRotate from \"ol/interaction/DragRotate\";\nimport DragPan from \"ol/interaction/DragPan\";\nimport PinchRotate from \"ol/interaction/PinchRotate\";\nimport PinchZoom from \"ol/interaction/PinchZoom\";\nimport KeyboardPan from \"ol/interaction/KeyboardPan\";\nimport KeyboardZoom from \"ol/interaction/KeyboardZoom\";\nimport MouseWheelZoom from \"ol/interaction/MouseWheelZoom\";\nimport Attribution from \"ol/control/Attribution\";\nimport Rotate from \"ol/control/Rotate\";\n\nimport Geometry from \"ol/geom/Geometry\";\nimport Polygon, { fromExtent } from \"ol/geom/Polygon\";\nimport Point from \"ol/geom/Point\";\nimport LineString from \"ol/geom/LineString\";\nimport Circle from \"ol/geom/Circle\";\nimport { areArraysDifferent } from '../utils/array';\nimport GeometryType from 'ol/geom/GeometryType';\nimport { ProjectionLike } from 'ol/proj';\nimport Select from 'ol/interaction/Select';\nimport { MgLayerSet } from '../api/layer-set';\nimport { MgLayerManager } from '../api/layer-manager';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport Collection from 'ol/Collection';\n\n/**\n * MapViewerBase component props\n *\n * @export\n * @interface IMapViewerBaseProps\n * @extends {IMapViewerContextProps}\n */\nexport interface IMapViewerBaseProps extends IMapViewerContextProps {\n    mock?: MapGuideMockMode;\n    tool: ActiveMapTool;\n    view?: IMapView;\n    agentKind: ClientKind;\n    viewRotationEnabled: boolean;\n    viewRotation: number;\n    featureTooltipsEnabled: boolean;\n    stateChangeDebounceTimeout?: number;\n    pointSelectionBuffer?: number;\n    selectableLayerNames: string[];\n    onRequestZoomToView?: (view: IMapView) => void;\n    onQueryMapFeatures?: (options: Partial<IQueryMapFeaturesOptions>, callback?: (res: QueryMapFeaturesResponse) => void, errBack?: (err: any) => void) => void;\n    onMouseCoordinateChanged?: (coords: number[]) => void;\n    onBusyLoading: (busyCount: number) => void;\n    onRotationChanged: (newRotation: number) => void;\n    onSessionExpired?: () => void;\n    onBeginDigitization: (callback: (cancelled: boolean) => void) => void;\n    onMapResized?: (size: [number, number]) => void;\n    overviewMapElementSelector?: () => (Element | null);\n    showGroups: string[] | undefined;\n    showLayers: string[] | undefined;\n    hideGroups: string[] | undefined;\n    hideLayers: string[] | undefined;\n    layerTransparency: LayerTransparencySet;\n    loadIndicatorPosition: MapLoadIndicatorPositioning;\n    loadIndicatorColor: string;\n    activeSelectedFeatureXml?: string;\n    activeSelectedFeatureColor: string;\n    manualFeatureTooltips: boolean;\n    cancelDigitizationKey?: number;\n    undoLastPointKey?: number;\n    isContextMenuOpen: boolean;\n    onHideContextMenu?: () => void;\n    onContextMenu?: (pos: [number, number]) => void;\n    onOpenTooltipLink: (url: string) => void;\n}\n\n/**\n * Determines if the given IMapView instances are equal or close to it\n *\n * @export\n * @param {(IMapView | undefined)} view\n * @param {(IMapView | undefined)} otherView\n * @returns {boolean}\n */\nexport function areViewsCloseToEqual(view: IMapView | undefined, otherView: IMapView | undefined): boolean {\n    if (view && otherView) {\n        return areNumbersEqual(view.x, otherView.x) &&\n            areNumbersEqual(view.y, otherView.y) &&\n            areNumbersEqual(view.scale, otherView.scale);\n    } else {\n        return false;\n    }\n}\n\n/**\n * Indicates if the given runtime map instances are the same or have the same name\n *\n * @export\n * @param {RtMap.RuntimeMap} map\n * @param {RtMap.RuntimeMap} other\n * @returns {boolean}\n */\nexport function areMapsSame(map: RtMap.RuntimeMap, other: RtMap.RuntimeMap): boolean {\n    if (map != other) {\n        return map.Name == other.Name;\n    }\n    return true;\n}\n\n/**\n * Indicates if the given layer transparency sets are different\n * @param set \n * @param other \n */\nexport function layerTransparencyChanged(set: LayerTransparencySet, other: LayerTransparencySet): boolean {\n    if ((!set && other) || (set && !other)) {\n        return true;\n    }\n    const setLayers = Object.keys(set);\n    const otherLayers = Object.keys(other);\n    if (areArraysDifferent(setLayers, otherLayers))\n        return true;\n\n    for (const name of setLayers) {\n        if (set[name] != other[name]) {\n            return true;\n        }\n    }\n    return false;\n}\n\nclass SessionKeepAlive {\n    private getSession: () => string;\n    private client: Client;\n    private interval: number;\n    private timeoutID: any;\n    constructor(getSession: () => string, client: Client, onSessionExpired: () => void) {\n        this.getSession = getSession;\n        this.client = client;\n        this.client.getServerSessionTimeout(this.getSession()).then(tm => {\n            this.interval = tm / 5 * 1000;  //Ping server 5 times each period. Timeout is returned in seconds.\n            this.timeoutID = setTimeout(this.tick.bind(this), this.interval);\n        });\n    }\n    private tick(): void {\n        this.client.getServerSessionTimeout(this.getSession()).then(tm => {\n            this.timeoutID = setTimeout(this.tick.bind(this), this.interval);\n        });\n    }\n    public lastTry(): Promise<number> {\n        return this.client.getServerSessionTimeout(this.getSession());\n    }\n}\n\ninterface IMapLoadIndicatorProps {\n    loading: number;\n    loaded: number;\n    color: string;\n    position: MapLoadIndicatorPositioning;\n}\n\nconst MapLoadIndicator = (props: IMapLoadIndicatorProps) => {\n    const { loaded, loading, color, position } = props;\n    let visibility: \"visible\" | \"hidden\" = \"visible\";\n    let width = (loaded / loading * 100).toFixed(1) + \"%\";\n    if (loaded === loading) {\n        visibility = \"hidden\";\n        width = \"0\";\n    }\n    const style: React.CSSProperties = {\n        position: \"absolute\",\n        zIndex: 10,\n        visibility: visibility,\n        left: 0,\n        height: 5,\n        width: width,\n        background: color,\n        transition: \"width 250ms\"\n    };\n    if (position == \"top\") {\n        style.top = 0;\n    } else {\n        style.bottom = 0;\n    }\n    return <div style={style} />;\n}\n\nfunction isMiddleMouseDownEvent(e: MouseEvent): boolean {\n    return (e && (e.which == 2 || e.button == 4));\n}\n\nexport interface IMapViewerBaseState {\n    shiftKey: boolean;\n    isMouseDown: boolean;\n    digitizingType: string;\n    loading: number;\n    loaded: number;\n}\n\n/**\n * The base map viewer component\n *\n * Since 0.12, this no longer implements ILayerManager\n * \n * @export\n * @class MapViewerBase\n * @extends {React.Component<IMapViewerBaseProps, any>}\n */\nexport class MapViewerBase extends React.Component<IMapViewerBaseProps, Partial<IMapViewerBaseState>> {\n    /**\n     * Indicates if touch events are supported.\n     */\n    private _supportsTouch: boolean;\n    /**\n     * The internal OpenLayers map instance\n     *\n     * @private\n     * @type {Map}\n     */\n    private _map: Map;\n    private _wktFormat: WKTFormat;\n    private _zoomSelectBox: DragBox;\n    private _mapContext: MapViewerContext;\n    private _client: Client;\n    private _busyWorkers: number;\n    private _triggerZoomRequestOnMoveEnd: boolean;\n    private _keepAlive: SessionKeepAlive;\n    private _select: Select;\n\n    /**\n     * This is a throttled version of _refreshOnStateChange(). Call this on any\n     * modifications to pendingStateChanges\n     *\n     * @private\n     */\n    private refreshOnStateChange: (props: IMapViewerBaseProps) => void;\n\n    constructor(props: IMapViewerBaseProps) {\n        super(props);\n        this.refreshOnStateChange = debounce(this._refreshOnStateChange.bind(this), props.stateChangeDebounceTimeout || 500);\n        this._wktFormat = new WKTFormat();\n        this._busyWorkers = 0;\n        this._triggerZoomRequestOnMoveEnd = true;\n        const ism = isMobile(navigator.userAgent);\n        this._supportsTouch = ism.phone || ism.tablet;\n        this.state = {\n            shiftKey: false,\n            isMouseDown: false,\n            digitizingType: undefined,\n            loaded: 0,\n            loading: 0\n        };\n    }\n    /**\n     * DO NOT CALL DIRECTLY, call this.refreshOnStateChange() instead, which is a throttled version\n     * of this method\n     * @private\n     */\n    private _refreshOnStateChange(props: IMapViewerBaseProps) {\n        const { map, showGroups, showLayers, hideGroups, hideLayers } = props;\n        if (showGroups || showLayers || hideGroups || hideLayers) {\n            this._mapContext.refreshOnStateChange(map, showGroups, showLayers, hideGroups, hideLayers);\n        }\n    }\n    public scaleToResolution(scale: number): number {\n        const activeLayerSet = this._mapContext.getLayerSet(this.props.map.Name);\n        return activeLayerSet.scaleToResolution(scale);\n    }\n    public resolutionToScale(resolution: number): number {\n        const activeLayerSet = this._mapContext.getLayerSet(this.props.map.Name);\n        return activeLayerSet.resolutionToScale(resolution);\n    }\n    public getPointSelectionBox(point: Coordinate2D, ptBuffer: number): Bounds {\n        const ll = this._map.getCoordinateFromPixel([point[0] - ptBuffer, point[1] - ptBuffer]);\n        const ur = this._map.getCoordinateFromPixel([point[0] + ptBuffer, point[1] + ptBuffer]);\n        return [ll[0], ll[1], ur[0], ur[1]];\n    }\n    public getResolution(): number {\n        return this._map.getView().getResolution();\n    }\n    private onMapClick(e: MapBrowserEvent) {\n        if (this.props.isContextMenuOpen) {\n            // We're going on the assumption that due to element placement\n            // if this event is fired, it meant that the user clicked outside\n            // the context menu, otherwise the context menu itself would've handled\n            // the event\n            this.props.onHideContextMenu?.();\n        }\n        if (this.isDigitizing()) {\n            return;\n        }\n        if (this.props.tool == ActiveMapTool.WmsQueryFeatures) {\n            this._mapContext.queryWmsFeatures(this._map, this.getLayerManager(), e.coordinate as Coordinate2D);\n        } else {\n            let vfSelected = 0;\n            if (this.props.tool == ActiveMapTool.Select) {\n                /*\n                //Shift+Click is the default OL selection append mode, so if no shift key\n                //pressed, clear the existing selection\n                if (!this.state.shiftKey) {\n                    this._select.getFeatures().clear();\n                }\n                */\n                //TODO: Our selected feature tooltip only shows properties of a single feature\n                //and displays upon said feature being selected. As a result, although we can\n                //(and should) allow for multiple features to be selected, we need to figure\n                //out the proper UI for such a case before we enable multiple selection.\n                this._select.getFeatures().clear();\n                this._map.forEachFeatureAtPixel(e.pixel, (feature, layer) => {\n                    if (vfSelected == 0) { //See TODO above\n                        if (layer.get(LayerProperty.IS_SELECTABLE) == true && feature instanceof Feature) {\n                            this._select.getFeatures().push(feature);\n                            vfSelected++;\n                        }\n                    }\n                });\n            }\n            // We'll only fall through the normal map selection query route if no \n            // vector features were selected as part of this click\n            const px = e.pixel as [number, number];\n            if (vfSelected == 0) {\n                this._mapContext.hideSelectedVectorFeaturesTooltip();\n                if (this.props.manualFeatureTooltips && this.props.featureTooltipsEnabled) {\n                    this._mapContext.queryFeatureTooltip(px);\n                } else if (this.props.tool === ActiveMapTool.Select) {\n                    const ptBuffer = this.props.pointSelectionBuffer || 2;\n                    const box = this.getPointSelectionBox(px, ptBuffer);\n                    const geom = fromExtent(box);\n                    const options = this.buildDefaultQueryOptions(geom);\n                    options.maxfeatures = 1;\n                    this.sendSelectionQuery(options);\n                }\n            } else {\n                this._mapContext.showSelectedVectorFeatures(this._select.getFeatures(), px, this.props.locale);\n            }\n        }\n    }\n    private getSelectableLayers(): string[] {\n        return this.props.selectableLayerNames || [];\n    }\n    private buildDefaultQueryOptions(geom: Geometry | string, reqQueryFeatures: number = 1 /* Attributes */): IQueryMapFeaturesOptions {\n        const names = this.getSelectableLayers();\n        let wkt: string;\n        if (typeof geom === 'string') {\n            wkt = geom;\n        } else {\n            wkt = this._wktFormat.writeGeometry(geom);\n        }\n        return {\n            mapname: this.props.map.Name,\n            session: this.props.map.SessionId,\n            geometry: wkt,\n            requestdata: reqQueryFeatures,\n            layernames: names.length > 0 ? names.join(\",\") : undefined,\n            persist: 1\n        };\n    }\n    private onZoomSelectBox(e: GenericEvent) {\n        const extent = this._zoomSelectBox.getGeometry();\n        switch (this.props.tool) {\n            case ActiveMapTool.Zoom:\n                {\n                    const ext: any = extent.getExtent();\n                    this.onRequestZoomToView(this.getViewForExtent(ext));\n                }\n                break;\n            case ActiveMapTool.Select:\n                {\n                    this.sendSelectionQuery(this.buildDefaultQueryOptions(extent));\n                }\n                break;\n        }\n    }\n    private sendSelectionQuery(queryOpts?: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void) {\n        if (queryOpts != null && (queryOpts.layernames ?? []).length == 0) {\n            return;\n        }\n        this.incrementBusyWorker();\n        const qOrig: Partial<IQueryMapFeaturesOptions> = {\n            mapname: this.props.map.Name,\n            session: this.props.map.SessionId,\n            persist: 1,\n            selectionvariant: \"INTERSECTS\",\n            selectioncolor: this.props.selectionColor,\n            selectionformat: this.props.selectionImageFormat || \"PNG8\",\n            maxfeatures: -1\n        };\n        const queryOptions: Partial<IQueryMapFeaturesOptions> = { ...qOrig, ...queryOpts };\n        this.props.onQueryMapFeatures?.(queryOptions, res => {\n            this.decrementBusyWorker();\n            if (success) {\n                success(res);\n            }\n        }, err => {\n            this.decrementBusyWorker();\n            if (failure) {\n                failure(err);\n            }\n        });\n    }\n    private zoomByDelta(delta: number) {\n        const view = this._map.getView();\n        if (!view) {\n            return;\n        }\n        const currentZoom = view.getZoom();\n        if (currentZoom !== undefined) {\n            const newZoom = view.getConstrainedZoom(currentZoom + delta);\n            if (view.getAnimating()) {\n                view.cancelAnimations();\n            }\n            view.animate({\n                zoom: newZoom,\n                duration: 250,\n                easing: olEasing.easeOut\n            });\n        }\n    }\n    private _activeDrawInteraction: Draw | null;\n    private removeActiveDrawInteraction() {\n        if (this._activeDrawInteraction) {\n            this._map.removeInteraction(this._activeDrawInteraction);\n            this._activeDrawInteraction = null;\n            this.setState({ digitizingType: undefined });\n        }\n    }\n    public cancelDigitization(): void {\n        if (this.isDigitizing()) {\n            this.removeActiveDrawInteraction();\n            this._mapContext.clearMouseTooltip();\n            //this._mouseTooltip.clear();\n        }\n    }\n    private pushDrawInteraction<T extends Geometry>(digitizingType: string, draw: Draw, handler: DigitizerCallback<T>, prompt?: string): void {\n        this.props.onBeginDigitization(cancel => {\n            if (!cancel) {\n                this.removeActiveDrawInteraction();\n                //this._mouseTooltip.clear();\n                this._mapContext.clearMouseTooltip();\n                if (prompt) {\n                    //this._mouseTooltip.setText(prompt);\n                    this._mapContext.setMouseTooltip(prompt);\n                }\n                this._activeDrawInteraction = draw;\n                this._activeDrawInteraction.once(\"drawend\", (e: GenericEvent) => {\n                    const drawnFeature: Feature = e.feature;\n                    const geom: T = drawnFeature.getGeometry() as T;\n                    this.cancelDigitization();\n                    handler(geom);\n                })\n                this._map.addInteraction(this._activeDrawInteraction);\n                this.setState({ digitizingType: digitizingType });\n            }\n        });\n    }\n    private onResize = (e: GenericEvent) => this.props.onMapResized?.(this._map.getSize() as Size2);\n    private onKeyDown = (e: GenericEvent) => {\n        const cancelKey = this.props.cancelDigitizationKey || KC_ESCAPE;\n        const undoKey = this.props.undoLastPointKey || KC_U;\n        if (e.keyCode == cancelKey) {\n            this.cancelDigitization();\n        } else if (e.keyCode == undoKey && this._activeDrawInteraction) {\n            this._activeDrawInteraction.removeLastPoint();\n        }\n        this.setState({ shiftKey: e.shiftKey });\n    }\n    private onKeyUp = (e: GenericEvent) => {\n        this.setState({ shiftKey: e.shiftKey });\n    }\n    private onMouseDown = (e: GenericEvent) => {\n        if (!this.state.isMouseDown) {\n            this.setState({\n                isMouseDown: true\n            });\n        }\n    }\n    private onMouseUp = (e: GenericEvent) => {\n        if (this.state.isMouseDown) {\n            this.setState({\n                isMouseDown: false\n            });\n        }\n    }\n    private onMouseMove(e: GenericEvent) {\n        this._mapContext.handleMouseTooltipMouseMove(e);\n        if (this.props.isContextMenuOpen) {\n            return;\n        }\n        if (!this.props.manualFeatureTooltips) {\n            this._mapContext.handleFeatureTooltipMouseMove(e);\n        }\n        this.props.onMouseCoordinateChanged?.(e.coordinate);\n    }\n    /**\n     * @hidden\n     */\n    public addImageLoading() {\n        const { loading } = this.state;\n        const newLoading = (loading || 0) + 1;\n        this.setState({ loading: newLoading });\n        this.incrementBusyWorker();\n    }\n    /**\n     * @hidden\n     */\n    public addImageLoaded() {\n        const { loaded, loading } = this.state;\n        const newLoadedCount = (loaded || 0) + 1;\n        if (loading === newLoadedCount) {\n            this.setState({ loaded: 0, loading: 0 });\n        } else {\n            this.setState({ loaded: newLoadedCount });\n        }\n        this.decrementBusyWorker();\n    }\n    private incrementBusyWorker() {\n        this._busyWorkers++;\n        this.props.onBusyLoading(this._busyWorkers);\n    }\n    private decrementBusyWorker() {\n        this._busyWorkers--;\n        this.props.onBusyLoading(this._busyWorkers);\n    }\n    private onRequestZoomToView(view: IMapView): void {\n        this.props.onRequestZoomToView?.({\n            x: view.x,\n            y: view.y,\n            scale: view.scale,\n            resolution: view.resolution\n        });\n    }\n    private onImageError(e: GenericEvent) {\n        this._keepAlive.lastTry().catch(err => {\n            if (isSessionExpiredError(err)) {\n                this.onSessionExpired();\n            }\n        });\n    }\n    protected createOLMap(options: MapOptions): any {\n        return new Map(options);\n    }\n    private getCallback(): IMapViewerContextCallback {\n        return {\n            getMockMode: () => this.props.mock,\n            incrementBusyWorker: this.incrementBusyWorker.bind(this),\n            decrementBusyWorker: this.decrementBusyWorker.bind(this),\n            addImageLoaded: this.addImageLoaded.bind(this),\n            addImageLoading: this.addImageLoading.bind(this),\n            onImageError: this.onImageError.bind(this),\n            onSessionExpired: this.onSessionExpired.bind(this),\n            getSelectableLayers: this.getSelectableLayers.bind(this),\n            getClient: () => this._client,\n            isContextMenuOpen: () => this.props.isContextMenuOpen,\n            getAgentUri: () => this.props.agentUri,\n            getAgentKind: () => this.props.agentKind,\n            getMapName: () => this.props.map.Name,\n            getSessionId: () => this.props.map.SessionId,\n            getLocale: () => this.props.locale,\n            isFeatureTooltipEnabled: this.isFeatureTooltipEnabled.bind(this),\n            getPointSelectionBox: (point) => this.getPointSelectionBox(point, this.props.pointSelectionBuffer || 2),\n            openTooltipLink: (url) => this.props.onOpenTooltipLink(url),\n            addFeatureToHighlight: (feat, bAppend) => {\n                // Features have to belong to layer in order to be visible and have the highlight style, \n                // so in addition to adding this new feature to the OL select observable collection, we \n                // need to also add the feature to a scratch vector layer dedicated for this purpose\n                const layerSet = this._mapContext.getLayerSet(this.props.map.Name);\n                const sf = this._select.getFeatures();\n                if (!bAppend) {\n                    sf.clear();\n                    layerSet.clearScratchLayer();\n                }\n                \n                if (feat) {\n                    layerSet.addScratchFeature(feat);\n                    sf.push(feat);\n                }\n            }\n        };\n    }\n    private applyView(layerSet: MgLayerSet, vw: IMapView) {\n        this._triggerZoomRequestOnMoveEnd = false;\n        layerSet.getView().setCenter([vw.x, vw.y]);\n        //Don't use this.scaleToResolution() as that uses this.props to determine\n        //applicable layer set, but we already have that here\n        const res = layerSet.scaleToResolution(vw.scale);\n        layerSet.getView().setResolution(res);\n        this._triggerZoomRequestOnMoveEnd = true;\n    }\n    // ----------------- React Lifecycle ----------------- //\n    componentDidUpdate(prevProps: IMapViewerBaseProps) {\n        //\n        // React (no pun intended) to prop changes\n        //\n        const props = prevProps;\n        const nextProps = this.props;\n        if (nextProps.imageFormat != props.imageFormat) {\n            logger.warn(`Unsupported change of props: imageFormat`);\n        }\n        if (nextProps.agentUri != props.agentUri) {\n            logger.warn(`Unsupported change of props: agentUri`);\n            this._client = new Client(nextProps.agentUri, nextProps.agentKind);\n        }\n        if (nextProps.agentKind != props.agentKind) {\n            logger.warn(`Unsupported change of props: agentKind`);\n            this._client = new Client(nextProps.agentUri, nextProps.agentKind);\n        }\n        let bChangedView = false;\n        //map\n        if (!areMapsSame(nextProps.map, props.map)) {\n            const oldLayerSet = this._mapContext.getLayerSet(props.map.Name);\n            const newLayerSet = this._mapContext.getLayerSet(nextProps.map.Name, true, nextProps);\n            const ovMap = this._mapContext.getOverviewMap();\n            oldLayerSet.detach(this._map, ovMap);\n            newLayerSet.setMapGuideMocking(props.mock);\n            newLayerSet.attach(this._map, ovMap);\n            //This would happen if we switch to a map we haven't visited yet\n            if (!nextProps.view) {\n                newLayerSet.fitViewToExtent();\n                bChangedView = true;\n            } else {\n                const layerSet = this._mapContext.getLayerSet(nextProps.map.Name);\n                this.applyView(layerSet, nextProps.view);\n            }\n        }\n        //selectionColor\n        if (nextProps.selectionColor && nextProps.selectionColor != props.selectionColor) {\n            const layerSet = this._mapContext.getLayerSet(nextProps.map.Name);\n            layerSet.updateSelectionColor(nextProps.selectionColor);\n        }\n        //featureTooltipsEnabled\n        if (nextProps.featureTooltipsEnabled != props.featureTooltipsEnabled) {\n            this._mapContext.enableFeatureTooltips(nextProps.featureTooltipsEnabled);\n        }\n        //externalBaseLayers\n        if (nextProps.externalBaseLayers != null &&\n            nextProps.externalBaseLayers.length > 0) {\n            const layerSet = this._mapContext.getLayerSet(nextProps.map.Name);\n            layerSet.updateExternalBaseLayers(nextProps.externalBaseLayers);\n        }\n        //Layer transparency\n        if (layerTransparencyChanged(nextProps.layerTransparency, props.layerTransparency)) {\n            const layerSet = this._mapContext.getLayerSet(nextProps.map.Name);\n            layerSet.updateTransparency(nextProps.layerTransparency);\n        }\n        //Layer/Group visibility\n        if (areArraysDifferent(nextProps.showGroups, props.showGroups) ||\n            areArraysDifferent(nextProps.hideGroups, props.hideGroups) ||\n            areArraysDifferent(nextProps.showLayers, props.showLayers) ||\n            areArraysDifferent(nextProps.hideLayers, props.hideLayers)) {\n            this.refreshOnStateChange(nextProps);\n        }\n        //view\n        if (!areViewsCloseToEqual(nextProps.view, props.view)) {\n            const vw = nextProps.view;\n            if (vw != null && !bChangedView) {\n                const layerSet = this._mapContext.getLayerSet(nextProps.map.Name);\n                this.applyView(layerSet, vw);\n            } else {\n                logger.debug(`Skipping zoomToView as next/current views are close enough or target view is null`);\n            }\n        }\n        //overviewMapElement\n        if (nextProps.overviewMapElementSelector) {\n            this._mapContext.updateOverviewMapElement(nextProps.overviewMapElementSelector);\n        }\n        //viewRotation\n        if (prevProps.viewRotation != nextProps.viewRotation) {\n            this.getOLView().setRotation(nextProps.viewRotation);\n        }\n        //viewRotationEnabled\n        if (prevProps.viewRotationEnabled != nextProps.viewRotationEnabled) {\n            const view = this.getOLView();\n            const newView = new View({\n                enableRotation: nextProps.viewRotationEnabled,\n                rotation: nextProps.viewRotation,\n                center: view.getCenter(),\n                resolution: view.getResolution(),\n                resolutions: view.getResolutions(),\n                minResolution: view.getMinResolution(),\n                maxResolution: view.getMaxResolution(),\n                maxZoom: view.getMaxZoom(),\n                minZoom: view.getMinZoom(),\n                //constrainRotation: view.constrainRotation(),\n                projection: view.getProjection(),\n                zoom: view.getZoom()\n            });\n            this._map.setView(newView);\n        }\n        //activeSelectedFeatureXml\n        if (prevProps.activeSelectedFeatureXml != nextProps.activeSelectedFeatureXml) {\n            const ms = this._map.getSize();\n            const view = this.getOLView();\n            const me: any = view.calculateExtent(ms);\n            const size = { w: ms[0], h: ms[1] };\n            this._mapContext.showSelectedFeature(me, size, nextProps.map, nextProps.activeSelectedFeatureColor, nextProps.activeSelectedFeatureXml);\n        }\n    }\n    componentDidMount() {\n        const { locale } = this.props;\n        const mapNode = ReactDOM.findDOMNode(this);\n        this._select = new Select({\n            condition: (e) => false,\n            layers: (layer) => layer.get(LayerProperty.IS_SELECTABLE) == true || layer.get(LayerProperty.IS_SCRATCH) == true\n        });\n        this._client = new Client(this.props.agentUri, this.props.agentKind);\n        this._keepAlive = new SessionKeepAlive(() => this.props.map.SessionId, this._client, this.onSessionExpired.bind(this));\n        this._zoomSelectBox = new DragBox({\n            condition: (e) => !this.isDigitizing() && (this.props.tool === ActiveMapTool.Select || this.props.tool === ActiveMapTool.Zoom)\n        });\n        this._zoomSelectBox.on(\"boxend\", this.onZoomSelectBox.bind(this));\n        const mapOptions: MapOptions = {\n            target: mapNode as any,\n            //layers: layers,\n            //view: view,\n            controls: [\n                new Attribution({\n                    tipLabel: tr(\"OL_ATTRIBUTION_TIP\", locale)\n                }),\n                new Rotate({\n                    tipLabel: tr(\"OL_RESET_ROTATION_TIP\", locale)\n                })\n            ],\n            interactions: [\n                this._select,\n                new DragRotate(),\n                new DragPan({\n                    condition: (e) => {\n                        const startingMiddleMouseDrag = e.type == \"pointerdown\" && isMiddleMouseDownEvent((e as any).originalEvent);\n                        const enabled = (startingMiddleMouseDrag || this._supportsTouch || this.props.tool === ActiveMapTool.Pan);\n                        //console.log(e);\n                        //console.log(`Allow Pan - ${enabled} (middle mouse: ${startingMiddleMouseDrag})`);\n                        return enabled;\n                    }\n                }),\n                new PinchRotate(),\n                new PinchZoom(),\n                new KeyboardPan(),\n                new KeyboardZoom(),\n                new MouseWheelZoom(),\n                this._zoomSelectBox\n            ]\n        };\n        this._map = this.createOLMap(mapOptions);\n        this._map.on(\"pointermove\", this.onMouseMove.bind(this));\n        this._map.on(\"change:size\", this.onResize.bind(this));\n        const callback = this.getCallback();\n        this._mapContext = new MapViewerContext(this._map, callback, this.props.featureTooltipsEnabled);\n        const activeLayerSet = this._mapContext.initLayerSet(this.props);\n        this._mapContext.initContext(activeLayerSet, locale, this.props.overviewMapElementSelector);\n        document.addEventListener(\"keydown\", this.onKeyDown);\n        document.addEventListener(\"keyup\", this.onKeyUp);\n\n        this._map.on(\"click\", this.onMapClick.bind(this));\n        this._map.on(\"moveend\", (e: GenericEvent) => {\n            //HACK:\n            //\n            //What we're hoping here is that when the view has been broadcasted back up\n            //and flowed back in through new view props, that the resulting zoom/pan\n            //operation in componentDidUpdate() is effectively a no-op as the intended\n            //zoom/pan location has already been reached by this event right here\n            //\n            //If we look at this through Redux DevTools, we see 2 entries for Map/SET_VIEW\n            //for the initial view (un-desirable), but we still only get one map image request\n            //for the initial view (good!). Everything is fine after that.\n            if (this._triggerZoomRequestOnMoveEnd) {\n                this.onRequestZoomToView(this.getCurrentView());\n            } else {\n                logger.info(\"Triggering zoom request on moveend suppresseed\");\n            }\n            if (e.frameState.viewState.rotation != this.props.viewRotation) {\n                this.props.onRotationChanged?.(e.frameState.viewState.rotation);\n            }\n        });\n\n        if (this.props.view != null) {\n            this.zoomToView(this.props.view.x, this.props.view.y, this.props.view.scale);\n        } else {\n            this._map.getView().fit(activeLayerSet.getExtent());\n        }\n        this.onResize(this._map.getSize());\n    }\n    private onContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        if (this._mapContext.isMouseOverTooltip) {\n            return;\n        }\n        e.preventDefault();\n        //console.log(`Open context menu at (${e.clientX}, ${e.clientY})`);\n        this.props.onContextMenu?.([e.clientX, e.clientY]);\n    }\n    render(): JSX.Element {\n        const { map, tool } = this.props;\n        const { isMouseDown } = this.state;\n        const style: React.CSSProperties = {\n            width: \"100%\",\n            height: \"100%\"\n        };\n        if (this.isDigitizing()) {\n            const dtype = this.state.digitizingType;\n            switch (dtype) {\n                case \"Point\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_POINT}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Line\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_LINE}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"LineString\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_LINESTRING}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Rectangle\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_RECT}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Polygon\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_POLYGON}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Circle\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_CIRCLE}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n            }\n        } else {\n            switch (tool) {\n                case ActiveMapTool.Pan:\n                    if (isMouseDown) {\n                        style.cursor = `url(${CURSOR_GRABBING}), auto`;\n                        //console.log(`cursor: ${style.cursor}`);\n                    } else {\n                        style.cursor = `url(${CURSOR_GRAB}), auto`;\n                        //console.log(`cursor: ${style.cursor}`);\n                    }\n                    break;\n                case ActiveMapTool.Zoom:\n                    style.cursor = `url(${CURSOR_ZOOM_IN}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n            }\n        }\n        if (map) {\n            style.backgroundColor = `#${map.BackgroundColor.substring(2)}`;\n        }\n        const { loading, loaded } = this.state;\n        return <div className=\"map-viewer-component\" style={style} onContextMenu={this.onContextMenu} onMouseDown={this.onMouseDown} onMouseUp={this.onMouseUp}>\n            <MapLoadIndicator loaded={loaded || 0} loading={loading || 0} position={this.props.loadIndicatorPosition} color={this.props.loadIndicatorColor} />\n        </div>;\n    }\n    public getViewForExtent(extent: Bounds): IMapView {\n        const scale = this.getScaleForExtent(extent);\n        const center = olExtent.getCenter(extent);\n        return {\n            x: center[0],\n            y: center[1],\n            scale: scale,\n            resolution: this.getResolution()\n        };\n    }\n    private onSessionExpired = () => this.props.onSessionExpired?.();\n    private getScaleForExtent(bounds: Bounds): number {\n        const activeLayerSet = this._mapContext.getLayerSet(this.props.map.Name);\n        const mcsW = olExtent.getWidth(bounds);\n        const mcsH = olExtent.getHeight(bounds);\n        const size = this._map.getSize();\n        const devW = size[0];\n        const devH = size[1];\n        const metersPerPixel = 0.0254 / activeLayerSet.getDpi();\n        const metersPerUnit = activeLayerSet.getMetersPerUnit();\n        //Scale calculation code from AJAX viewer\n        let mapScale: number;\n        if (devH * mcsW > devW * mcsH)\n            mapScale = mcsW * metersPerUnit / (devW * metersPerPixel); // width-limited\n        else\n            mapScale = mcsH * metersPerUnit / (devH * metersPerPixel); // height-limited\n        return mapScale;\n    }\n    public getCurrentView(): IMapView {\n        const ov = this.getOLView();\n        const center = ov.getCenter();\n        const resolution = ov.getResolution();\n        const scale = this.resolutionToScale(resolution);\n        return {\n            x: center[0],\n            y: center[1],\n            scale: scale,\n            resolution: resolution\n        };\n    }\n    public getCurrentExtent(): Bounds {\n        return this._map.getView().calculateExtent(this._map.getSize()) as Bounds;\n    }\n    public getSize(): Size2 {\n        return this._map.getSize() as Size2;\n    }\n    public getOLView(): View {\n        return this._map.getView();\n    }\n    public zoomToView(x: number, y: number, scale: number): void {\n        const view = this._map.getView();\n        view.setCenter([x, y]);\n        view.setResolution(this.scaleToResolution(scale));\n    }\n    public setSelectionXml(xml: string, queryOpts?: Partial<IQueryMapFeaturesOptions>, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void {\n        //NOTE: A quirk of QUERYMAPFEATURES is that when passing in selection XML (instead of geometry),\n        //you must set the layerattributefilter to the full bit mask otherwise certain features in the\n        //selection XML will not be rendered because they may not pass the layer attribute filter\n        const reqQueryFeatures = 1; //Attributes\n        this.incrementBusyWorker();\n        const qOrig = {\n            mapname: this.props.map.Name,\n            session: this.props.map.SessionId,\n            persist: 1,\n            featurefilter: xml,\n            selectioncolor: this.props.selectionColor,\n            selectionformat: this.props.selectionImageFormat || \"PNG8\",\n            maxfeatures: -1,\n            requestdata: reqQueryFeatures\n        };\n        const queryOptions = { ...qOrig, ...queryOpts };\n        this.props.onQueryMapFeatures?.(queryOptions, res => {\n            this.decrementBusyWorker();\n            if (success)\n                success(res);\n        }, err => {\n            this.decrementBusyWorker();\n            if (failure)\n                failure(err);\n        });\n    }\n    public refreshMap(mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void {\n        this._mapContext.refreshMap(this.props.map.Name, mode);\n    }\n    public getMetersPerUnit(): number {\n        const activeLayerSet = this._mapContext.getLayerSet(this.props.map.Name);\n        return activeLayerSet.getMetersPerUnit();\n    }\n    public initialView(): void {\n        const activeLayerSet = this._mapContext.getLayerSet(this.props.map.Name);\n        this.onRequestZoomToView(this.getViewForExtent(activeLayerSet.getExtent()));\n    }\n    public clearSelection(): void {\n        this.setSelectionXml(\"\");\n    }\n    public zoomDelta(delta: number): void {\n        //TODO: To conform to redux uni-directional data flow, this should\n        //broadcast the new desired view back up and flow it back through to this\n        //component as new props\n        this.zoomByDelta(delta);\n    }\n    public zoomToExtent(extent: Bounds): void {\n        this.onRequestZoomToView(this.getViewForExtent(extent));\n    }\n    public isDigitizing(): boolean {\n        if (this._map == null)\n            return false;\n        const activeDraw = this._map.getInteractions().getArray().filter(inter => inter instanceof Draw)[0];\n        return activeDraw != null;\n    }\n    public digitizePoint(handler: DigitizerCallback<Point>, prompt?: string): void {\n        const draw = new Draw({\n            type: GeometryType.POINT // \"Point\"//ol.geom.GeometryType.POINT\n        });\n        this.pushDrawInteraction(\"Point\", draw, handler, prompt || tr(\"DIGITIZE_POINT_PROMPT\", this.props.locale));\n    }\n    public digitizeLine(handler: DigitizerCallback<LineString>, prompt?: string): void {\n        const draw = new Draw({\n            type: GeometryType.LINE_STRING, // \"LineString\", //ol.geom.GeometryType.LINE_STRING,\n            minPoints: 2,\n            maxPoints: 2\n        });\n        this.pushDrawInteraction(\"Line\", draw, handler, prompt || tr(\"DIGITIZE_LINE_PROMPT\", this.props.locale));\n    }\n    public digitizeLineString(handler: DigitizerCallback<LineString>, prompt?: string): void {\n        const draw = new Draw({\n            type: GeometryType.LINE_STRING, //\"LineString\", //ol.geom.GeometryType.LINE_STRING,\n            minPoints: 2\n        });\n        this.pushDrawInteraction(\"LineString\", draw, handler, prompt || tr(\"DIGITIZE_LINESTRING_PROMPT\", this.props.locale, {\n            key: String.fromCharCode(this.props.undoLastPointKey || KC_U) //Pray that a sane (printable) key was bound\n        }));\n    }\n    public digitizeCircle(handler: DigitizerCallback<Circle>, prompt?: string): void {\n        const draw = new Draw({\n            type: GeometryType.CIRCLE  // \"Circle\" //ol.geom.GeometryType.CIRCLE\n        });\n        this.pushDrawInteraction(\"Circle\", draw, handler, prompt || tr(\"DIGITIZE_CIRCLE_PROMPT\", this.props.locale));\n    }\n    public digitizeRectangle(handler: DigitizerCallback<Polygon>, prompt?: string): void {\n        const geomFunc: GeometryFunction = (coordinates, geometry) => {\n            if (!geometry) {\n                geometry = new Polygon([]);\n            }\n            const start: any = coordinates[0];\n            const end: any = coordinates[1];\n            (geometry as any).setCoordinates([\n                [start, [start[0], end[1]], end, [end[0], start[1]], start]\n            ]);\n            return geometry;\n        };\n        const draw = new Draw({\n            type: GeometryType.LINE_STRING, //\"LineString\", //ol.geom.GeometryType.LINE_STRING,\n            maxPoints: 2,\n            geometryFunction: geomFunc\n        });\n        this.pushDrawInteraction(\"Rectangle\", draw, handler, prompt || tr(\"DIGITIZE_RECT_PROMPT\", this.props.locale));\n    }\n    public digitizePolygon(handler: DigitizerCallback<Polygon>, prompt?: string): void {\n        const draw = new Draw({\n            type: GeometryType.POLYGON //\"Polygon\" //ol.geom.GeometryType.POLYGON\n        });\n        this.pushDrawInteraction(\"Polygon\", draw, handler, prompt || tr(\"DIGITIZE_POLYGON_PROMPT\", this.props.locale, {\n            key: String.fromCharCode(this.props.undoLastPointKey || KC_U) //Pray that a sane (printable) key was bound\n        }));\n    }\n    public selectByGeometry(geom: Geometry, selectionMethod?: SelectionVariant): void {\n        const options = this.buildDefaultQueryOptions(geom);\n        if (selectionMethod) {\n            options.selectionvariant = selectionMethod;\n        }\n        this.sendSelectionQuery(options);\n    }\n    public queryMapFeatures(options: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void {\n        this.sendSelectionQuery(options, success, failure);\n    }\n    public isFeatureTooltipEnabled(): boolean {\n        //return this._featureTooltip.isEnabled();\n        return this._mapContext.isFeatureTooltipEnabled();\n    }\n    public addInteraction<T extends Interaction>(interaction: T): T {\n        this._map.addInteraction(interaction);\n        return interaction;\n    }\n    public removeInteraction<T extends Interaction>(interaction: T): void {\n        this._map.removeInteraction(interaction);\n    }\n    public addOverlay(overlay: Overlay): void {\n        this._map.addOverlay(overlay);\n    }\n    public removeOverlay(overlay: Overlay): void {\n        this._map.removeOverlay(overlay);\n    }\n    public getProjection(): ProjectionLike {\n        return this._map.getView().getProjection();\n    }\n    public addHandler(eventName: string, handler: Function) {\n        this._map.on(eventName, handler as any);\n    }\n    public removeHandler(eventName: string, handler: Function) {\n        this._map.un(eventName, handler as any);\n    }\n    public updateSize() {\n        this._map.updateSize();\n    }\n    public getLayerManager(mapName?: string): ILayerManager {\n        const layerSet = this._mapContext.getLayerSet(mapName || this.props.map.Name, true, this.props);\n        return new MgLayerManager(this._map, layerSet);\n    }\n    public screenToMapUnits(x: number, y: number): [number, number] {\n        let bAllowOutsideWindow = false;\n        const [mapDevW, mapDevH] = this.getSize();\n        const [extX1, extY1, extX2, extY2] = this.getCurrentExtent();\n        if (!bAllowOutsideWindow) {\n            if (x > mapDevW - 1) x = mapDevW - 1;\n            else if (x < 0) x = 0;\n\n            if (y > mapDevH - 1) y = mapDevH - 1;\n            else if (y < 0) y = 0;\n        }\n        x = extX1 + (extX2 - extX1) * (x / mapDevW);\n        y = extY1 - (extY1 - extY2) * (y / mapDevH);\n        return [x, y];\n    }\n    public getSelectedFeatures() {\n        return this._select.getFeatures();\n    }\n    //------------------------------------//\n}","import { RuntimeMap } from '../api/contracts/runtime-map';\n\n/**\n * Type alias for a MapGuide site version\n * @since 0.12.1\n */\nexport type SiteVersion = [number, number, number, number];\n\n/**\n * Gets the MapGuide site version from the runtime map response\n * @param map \n * @since 0.12\n */\nexport function getSiteVersion(map: RuntimeMap): SiteVersion {\n    const [sMaj, sMin, sPatch, sRev] = map.SiteVersion.split(\".\");\n    const vMaj = parseInt(sMaj, 10);\n    const vMin = parseInt(sMin, 10);\n    const vPatch = parseInt(sPatch, 10);\n    const vRev = parseInt(sRev, 10);\n    return [vMaj, vMin, vPatch, vRev];\n}\n\n/**\n * Tests if QUERYMAPFEATURES 4.0.0 API can be used with this version of MapGuide\n * @param version The site version\n * @since 0.12.1\n */\nexport function canUseQueryMapFeaturesV4(version: SiteVersion): boolean {\n    const [vMaj, vMin, vPatch, vRev] = version;\n    if (vMaj >= 4) {\n        //Allow a 4.0 trunk/branch build\n        if (vMaj == 4 && vMin == 0 && vPatch == 0 && vRev == 0) {\n            return true;\n        }\n        //Test for > 4.0 preview 1\n        if (vMaj == 4 && vMin == 0 && vPatch == 0) {\n            return vRev > 9592; //This is the rev of preview 1\n        }\n        return true;\n    }\n    return false;\n}","import { IFormatDriver } from \"./format-driver\";\n\nconst _drivers: IFormatDriver[] = [];\n\nexport function getFormatDrivers() { return _drivers; }\n\nexport function addFormatDriver(driver: IFormatDriver) {\n    _drivers.push(driver);\n}","import { QueryMapFeaturesResponse } from './contracts';\n\n/**\n * session-store.ts\n * \n * A thin-wrapper layer over local storage for storing any data related to viewer sessions\n */\n\n\n\n/**\n * @since 0.12\n */\nexport async function clearSessionStore(): Promise<void> {\n    try {\n        for (const key in window.localStorage) {\n            if (key.startsWith(\"selection_\")) {\n                window.localStorage.removeItem(key);\n            }\n        }\n    } catch (e) {\n\n    }\n}\n\nfunction encodeKey(sessionId: string, mapName: string) {\n    return `selection_${sessionId}_${mapName}`;\n}\n\nexport async function storeSelectionSet(sessionId: string, mapName: string, resp: QueryMapFeaturesResponse): Promise<void> {\n    const key = encodeKey(sessionId, mapName);\n    const value = JSON.stringify(resp);\n    try {\n        window.localStorage.setItem(key, value);\n    } catch (e) {\n\n    }\n}\n\nexport async function getSelectionSet(sessionId: string, mapName: string): Promise<QueryMapFeaturesResponse | undefined> {\n    const key = encodeKey(sessionId, mapName);\n    const content = window.localStorage.getItem(key);\n    if (content) {\n        return JSON.parse(content);\n    }\n}","/**\n * template.ts\n *\n * Actions to support fusion templates\n */\nimport { ActionType } from '../constants/actions';\nimport { IElementState, ITemplateSetElementStateAction, ITemplateSetTaskPaneVisibilityAction, ITemplateSetSelectionPanelVisibility, ITemplateSetLegendVisibility } from './defs';\n\nexport function setElementStates(states: IElementState): ITemplateSetElementStateAction {\n    return {\n        type: ActionType.FUSION_SET_ELEMENT_STATE,\n        payload: states\n    };\n}\n\nexport function setTaskPaneVisibility(visible: boolean): ITemplateSetTaskPaneVisibilityAction {\n    return {\n        type: ActionType.FUSION_SET_TASK_PANE_VISIBILITY,\n        payload: visible\n    };\n}\n\nexport function setSelectionPanelVisibility(visible: boolean): ITemplateSetSelectionPanelVisibility {\n    return {\n        type: ActionType.FUSION_SET_SELECTION_PANEL_VISIBILITY,\n        payload: visible\n    };\n}\n\n/*\nexport function setOverviewMapVisibility(visible: boolean): ReduxAction {\n    return {\n        type: ActionType.FUSION_SET_OVERVIEW_MAP_VISIBILITY,\n        payload: visible\n    };\n}\n*/\n\nexport function setLegendVisibility(visible: boolean): ITemplateSetLegendVisibility {\n    return {\n        type: ActionType.FUSION_SET_LEGEND_VISIBILITY,\n        payload: visible\n    };\n}","import { MgError } from \"../api/error\";\nimport {\n    ReduxThunkedAction\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ITaskPaneBackAction, ITaskPaneForwardAction, ITaskPanePushUrlAction } from './defs';\n\n/**\n * Go back to the initial task URL\n *\n * @export\n * @returns {ReduxThunkedAction}\n */\nexport function goHome(): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        const initUrl = getState().taskpane.initialUrl;\n        if (initUrl != null) {\n            dispatch({\n                type: ActionType.TASK_PANE_HOME\n            });\n        } else {\n            throw new MgError(\"Case not handled yet: Home action when no initial task URL set\");\n        }\n    };\n}\n\n/**\n * Go back one entry in the task pane navigation history\n *\n * @export\n * @returns\n */\nexport function goBack(): ITaskPaneBackAction {\n    return {\n        type: ActionType.TASK_PANE_BACK\n    };\n}\n\n/**\n * Go forward one entry in the task pane navigation history\n *\n * @export\n * @returns\n */\nexport function goForward(): ITaskPaneForwardAction {\n    return {\n        type: ActionType.TASK_PANE_FORWARD\n    };\n}\n\n/**\n * Pushes the given URL to the task pane navigation history stack\n *\n * @export\n * @param {string} url\n * @param {boolean} [silent]\n * @returns\n */\nexport function pushUrl(url: string, silent?: boolean): ITaskPanePushUrlAction {\n    return {\n        type: ActionType.TASK_PANE_PUSH_URL,\n        payload: {\n            url: url,\n            silent: silent\n        }\n    };\n}","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Legend } from \"../components/legend\";\nimport * as LegendActions from \"../actions/legend\";\nimport * as MapActions from \"../actions/map\";\nimport { tr } from \"../api/i18n\";\nimport { useActiveMapState, useActiveMapView, useActiveMapShowGroups, useActiveMapShowLayers, useActiveMapHideGroups, useActiveMapHideLayers, useActiveMapExpandedGroups, useActiveMapSelectableLayers, useActiveMapExternalBaseLayers, useActiveMapName, useViewerLocale } from './hooks';\n\nexport interface ILegendContainerProps {\n    maxHeight?: number;\n    inlineBaseLayerSwitcher?: boolean;\n}\n\nconst LegendContainer = (props: ILegendContainerProps) => {\n    const { maxHeight, inlineBaseLayerSwitcher } = props;\n    const dispatch = useDispatch();\n    const activeMapName = useActiveMapName();\n    const locale = useViewerLocale();\n    const map = useActiveMapState();\n    const view = useActiveMapView();\n    const showGroups = useActiveMapShowGroups();\n    const showLayers = useActiveMapShowLayers();\n    const hideGroups = useActiveMapHideGroups();\n    const hideLayers=  useActiveMapHideLayers();\n    const expandedGroups = useActiveMapExpandedGroups();\n    const selectableLayers = useActiveMapSelectableLayers();\n    const externalBaseLayers = useActiveMapExternalBaseLayers();\n    const setBaseLayer= (mapName: string, layerName: string) => dispatch(MapActions.setBaseLayer(mapName, layerName));\n    const setGroupVisibility = (mapName: string, options: { id: string, value: boolean }) => dispatch(LegendActions.setGroupVisibility(mapName, options));\n    const setLayerVisibility = (mapName: string, options: { id: string, value: boolean }) => dispatch(LegendActions.setLayerVisibility(mapName, options));\n    const setLayerSelectable = (mapName: string, options: { id: string, value: boolean }) => dispatch(LegendActions.setLayerSelectable(mapName, options));\n    const setGroupExpanded = (mapName: string, options: { id: string, value: boolean }) => dispatch(LegendActions.setGroupExpanded(mapName, options));\n\n    const onLayerSelectabilityChanged = (id: string, selectable: boolean) => {\n        if (activeMapName) {\n            setLayerSelectable?.(activeMapName, { id: id, value: selectable });\n        }\n    };\n    const onGroupExpansionChanged = (id: string, expanded: boolean) => {\n        if (setGroupExpanded && activeMapName) {\n            setGroupExpanded(activeMapName, { id: id, value: expanded });\n        }\n    };\n    const onGroupVisibilityChanged = (groupId: string, visible: boolean) => {\n        if (setGroupVisibility && activeMapName) {\n            setGroupVisibility(activeMapName, { id: groupId, value: visible });\n        }\n    };\n    const onLayerVisibilityChanged = (layerId: string, visible: boolean) => {\n        if (setLayerVisibility && activeMapName) {\n            setLayerVisibility(activeMapName, { id: layerId, value: visible });\n        }\n    };\n    const onBaseLayerChanged = (layerName: string) => {\n        if (setBaseLayer && activeMapName) {\n            setBaseLayer(activeMapName, layerName);\n        }\n    };\n    //overrideSelectableLayers?: any;\n    //overrideExpandedItems?: any;\n    if (map && view) {\n        let scale = view.scale;\n        if (scale) {\n            return <Legend map={map}\n                maxHeight={maxHeight}\n                currentScale={scale}\n                showLayers={showLayers}\n                showGroups={showGroups}\n                hideLayers={hideLayers}\n                hideGroups={hideGroups}\n                locale={locale}\n                inlineBaseLayerSwitcher={!!inlineBaseLayerSwitcher}\n                externalBaseLayers={externalBaseLayers}\n                onBaseLayerChanged={onBaseLayerChanged}\n                overrideSelectableLayers={selectableLayers}\n                overrideExpandedItems={expandedGroups}\n                onLayerSelectabilityChanged={onLayerSelectabilityChanged}\n                onGroupExpansionChanged={onGroupExpansionChanged}\n                onGroupVisibilityChanged={onGroupVisibilityChanged}\n                onLayerVisibilityChanged={onLayerVisibilityChanged} />;\n        } else {\n            return <div>{tr(\"LOADING_MSG\", locale)}</div>;\n        }\n    } else {\n        return <div>{tr(\"LOADING_MSG\", locale)}</div>;\n    }\n}\n\nexport default LegendContainer;","import * as React from \"react\";\nimport { IExternalBaseLayer } from \"../api/common\";\nimport { STR_EMPTY, strIsNullOrEmpty } from \"../utils/string\";\nimport { tr } from \"../api/i18n\";\n\n/**\n * BaseLayersSwitcher component props\n *\n * @export\n * @interface IBaseLayerSwitcherProps\n */\nexport interface IBaseLayerSwitcherProps {\n    locale: string | undefined;\n    externalBaseLayers: IExternalBaseLayer[];\n    onBaseLayerChanged?: (name: string) => void;\n}\n\n/**\n * The BaseLayerSwitcher component provides a user interface for switching the active external\n * base layer of the current map\n * @param props \n */\nexport const BaseLayerSwitcher = (props: IBaseLayerSwitcherProps) => {\n    const { locale, externalBaseLayers } = props;\n    const visLayers = externalBaseLayers.filter(layer => layer.visible === true);\n    const [selected, setSelected] = React.useState(visLayers.length == 1 ? visLayers[0].name : STR_EMPTY);\n    const onBaseLayerChanged = (e: any) => {\n        const value = e.currentTarget.value;\n        setSelected(value);\n        props.onBaseLayerChanged?.(value);\n    }\n    return <div>\n        <div className=\"base-layer-switcher-item-container\">\n            <label className=\"bp3-control bp3-radio\">\n                <input className=\"base-layer-switcher-option\" type=\"radio\" value={STR_EMPTY} checked={strIsNullOrEmpty(selected)} onChange={onBaseLayerChanged} />\n                <span className=\"bp3-control-indicator\" />\n                {tr(\"NONE\", locale)}\n            </label>\n        </div>\n        {externalBaseLayers.map(layer => {\n            return <div className=\"base-layer-switcher-item-container\" key={`base-layer-${layer.name}`}>\n                <label className=\"bp3-control bp3-radio\">\n                    <input className=\"base-layer-switcher-option\" type=\"radio\" value={layer.name} checked={layer.name === selected} onChange={onBaseLayerChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {layer.name}\n                </label>\n            </div>;\n        })}\n    </div>;\n}","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport {\n    IMapView,\n    IMapViewer,\n    ILayerManager,\n    ActiveMapTool,\n    RefreshMode,\n    DigitizerCallback,\n    Bounds,\n    Coordinate2D\n} from \"../api/common\";\nimport * as Constants from \"../constants\";\nimport { MapViewerBase } from \"../components/map-viewer-base\";\nimport * as Runtime from \"../api/runtime\";\nimport * as FlyoutActions from \"../actions/flyout\";\nimport { Client } from \"../api/client\";\nimport { QueryMapFeaturesResponse, FeatureSet } from '../api/contracts/query';\nimport { IQueryMapFeaturesOptions } from '../api/request-builder';\nimport { buildSelectionXml, getActiveSelectedFeatureXml } from '../api/builders/deArrayify';\nimport * as MapActions from \"../actions/map\";\nimport * as ModalActions from \"../actions/modal\";\nimport { DefaultComponentNames } from \"../api/registry/component\";\nimport { tr } from \"../api/i18n\";\nimport { IOLFactory, OLFactory } from \"../api/ol-factory\";\nimport { Toaster, Position, Intent } from '@blueprintjs/core';\nimport * as logger from \"../utils/logger\";\nimport { useActiveMapState, useActiveMapSelectionSet, useActiveMapView, useActiveMapInitialView, useActiveMapExternalBaseLayers, useActiveMapLayerTransparency, useActiveMapShowGroups, useActiveMapHideGroups, useActiveMapShowLayers, useActiveMapHideLayers, useActiveMapActiveSelectedFeature, useIsContextMenuOpen, useActiveMapName, useActiveMapSessionId, useActiveMapSelectableLayerNames, useViewerActiveTool, useConfiguredAgentUri, useConfiguredAgentKind, useViewerViewRotation, useViewerViewRotationEnabled, useViewerLocale, useViewerImageFormat, useViewerSelectionImageFormat, useViewerSelectionColor, useViewerActiveFeatureSelectionColor as useViewerActiveSelectedFeatureColor, useViewerPointSelectionBuffer, useViewerFeatureTooltipsEnabled, useConfiguredManualFeatureTooltips, useConfiguredLoadIndicatorPositioning, useConfiguredLoadIndicatorColor, useConfiguredCancelDigitizationKey, useConfiguredUndoLastPointKey, useActiveMapLayers } from './hooks';\nimport olInteraction from \"ol/interaction/Interaction\";\nimport olOverlay from \"ol/Overlay\";\nimport { ProjectionLike } from \"ol/proj\";\nimport olGeometry from \"ol/geom/Geometry\";\nimport olGeomPoint from \"ol/geom/Point\";\nimport olGeomLineString from \"ol/geom/LineString\";\nimport olGeomCircle from \"ol/geom/Circle\";\nimport olGeomPolygon from \"ol/geom/Polygon\";\nimport { MapDebugContext } from '../components/map-viewer-context';\nimport { ISubscriberProps, Subscriber } from './subscriber';\nimport { ActionType } from '../constants/actions';\nimport { ensureParameters } from '../utils/url';\n\nexport interface IMapViewerContainerProps {\n    overviewMapElementSelector?: () => (Element | null);\n}\n\ntype INonBaseMapViewer = Pick<IMapViewer,\n    \"toastSuccess\" |\n    \"toastWarning\" |\n    \"toastError\" |\n    \"toastPrimary\" |\n    \"dismissToast\" |\n    \"getMapName\" |\n    \"getSessionId\" |\n    \"setViewRotation\" |\n    \"getViewRotation\" |\n    \"isViewRotationEnabled\" |\n    \"setViewRotationEnabled\" |\n    \"setFeatureTooltipEnabled\" |\n    \"getSelection\" |\n    \"getSelectionXml\" |\n    \"setActiveTool\" |\n    \"getActiveTool\" |\n    \"addSubscribers\" |\n    \"removeSubscribers\" |\n    \"getSubscribers\" |\n    \"dispatch\">;\n\nclass MapViewerAdapter implements IMapViewer {\n    constructor(private inner: MapViewerBase,\n        private olFactory: OLFactory = new OLFactory()) { }\n    private disp: INonBaseMapViewer;\n    getProjection(): ProjectionLike {\n        return this.inner.getProjection();\n    }\n    getViewForExtent(extent: Bounds): IMapView {\n        return this.inner.getViewForExtent(extent);\n    }\n    getCurrentExtent(): Bounds {\n        return this.inner.getCurrentExtent();\n    }\n    getCurrentView(): IMapView {\n        return this.inner.getCurrentView();\n    }\n    getSize(): [number, number] {\n        return this.inner.getSize();\n    }\n    zoomToView(x: number, y: number, scale: number): void {\n        this.inner.zoomToView(x, y, scale);\n    }\n    setSelectionXml(xml: string, queryOpts?: Partial<IQueryMapFeaturesOptions> | undefined, success?: ((res: QueryMapFeaturesResponse) => void) | undefined, failure?: ((err: Error) => void) | undefined): void {\n        this.inner.setSelectionXml(xml, queryOpts, success, failure);\n    }\n    refreshMap(mode?: RefreshMode | undefined): void {\n        this.inner.refreshMap(mode);\n    }\n    getMetersPerUnit(): number {\n        return this.inner.getMetersPerUnit();\n    }\n    clearSelection(): void {\n        this.inner.clearSelection();\n    }\n    zoomDelta(delta: number): void {\n        this.inner.zoomDelta(delta);\n    }\n    isDigitizing(): boolean {\n        return this.inner.isDigitizing();\n    }\n    cancelDigitization(): void {\n        this.inner.cancelDigitization();\n    }\n    digitizePoint(handler: DigitizerCallback<olGeomPoint>, prompt?: string | undefined): void {\n        this.inner.digitizePoint(handler, prompt);\n    }\n    digitizeLine(handler: DigitizerCallback<olGeomLineString>, prompt?: string | undefined): void {\n        this.inner.digitizeLine(handler, prompt);\n    }\n    digitizeLineString(handler: DigitizerCallback<olGeomLineString>, prompt?: string | undefined): void {\n        this.inner.digitizeLineString(handler, prompt);\n    }\n    digitizeCircle(handler: DigitizerCallback<olGeomCircle>, prompt?: string | undefined): void {\n        this.inner.digitizeCircle(handler, prompt);\n    }\n    digitizeRectangle(handler: DigitizerCallback<olGeomPolygon>, prompt?: string | undefined): void {\n        this.inner.digitizeRectangle(handler, prompt);\n    }\n    digitizePolygon(handler: DigitizerCallback<olGeomPolygon>, prompt?: string | undefined): void {\n        this.inner.digitizePolygon(handler, prompt);\n    }\n    selectByGeometry(geom: olGeometry, selectionMethod?: \"INTERSECTS\" | \"TOUCHES\" | \"WITHIN\" | \"ENVELOPEINTERSECTS\" | undefined): void {\n        this.inner.selectByGeometry(geom, selectionMethod)\n    }\n    queryMapFeatures(options: IQueryMapFeaturesOptions, success?: ((res: QueryMapFeaturesResponse) => void) | undefined, failure?: ((err: Error) => void) | undefined): void {\n        this.inner.queryMapFeatures(options, success, failure);\n    }\n    zoomToExtent(extent: Bounds): void {\n        this.inner.zoomToExtent(extent);\n    }\n    isFeatureTooltipEnabled(): boolean {\n        return this.inner.isFeatureTooltipEnabled();\n    }\n    getLayerManager(mapName?: string | undefined): ILayerManager {\n        return this.inner.getLayerManager(mapName);\n    }\n    addInteraction<T extends olInteraction>(interaction: T): T {\n        return this.inner.addInteraction(interaction);\n    }\n    removeInteraction<T extends olInteraction>(interaction: T): void {\n        this.inner.removeInteraction(interaction);\n    }\n    addOverlay(overlay: olOverlay): void {\n        this.inner.addOverlay(overlay);\n    }\n    removeOverlay(overlay: olOverlay): void {\n        this.inner.removeOverlay(overlay);\n    }\n    addHandler(eventName: string, handler: Function): void {\n        this.inner.addHandler(eventName, handler);\n    }\n    removeHandler(eventName: string, handler: Function): void {\n        this.inner.removeHandler(eventName, handler);\n    }\n    getResolution(): number {\n        return this.inner.getResolution();\n    }\n    scaleToResolution(scale: number): number {\n        return this.inner.scaleToResolution(scale);\n    }\n\n    screenToMapUnits(x: number, y: number): [number, number] {\n        return this.inner.screenToMapUnits(x, y);\n    }\n    updateSize(): void {\n        this.inner.updateSize();\n    }\n    attachExternal(disp: INonBaseMapViewer): void {\n        this.disp = disp;\n    }\n    toastSuccess(icon: string, message: string | JSX.Element): string | undefined {\n        return this.disp.toastSuccess(icon, message);\n    }\n    toastWarning(icon: string, message: string | JSX.Element): string | undefined {\n        return this.disp.toastWarning(icon, message);\n    }\n    toastError(icon: string, message: string | JSX.Element): string | undefined {\n        return this.disp.toastError(icon, message);\n    }\n    toastPrimary(icon: string, message: string | JSX.Element): string | undefined {\n        return this.disp.toastPrimary(icon, message);\n    }\n    dismissToast(key: string): void {\n        this.disp.dismissToast(key);\n    }\n    getMapName(): string {\n        return this.disp.getMapName();\n    }\n    getSessionId(): string {\n        return this.disp.getSessionId();\n    }\n    setViewRotation(rotation: number): void {\n        this.disp.setViewRotation(rotation);\n    }\n    getViewRotation(): number {\n        return this.disp.getViewRotation();\n    }\n    isViewRotationEnabled(): boolean {\n        return this.disp.isViewRotationEnabled();\n    }\n    setViewRotationEnabled(enabled: boolean): void {\n        this.disp.setViewRotationEnabled(enabled);\n    }\n    getOLFactory(): IOLFactory {\n        return this.olFactory;\n    }\n    setFeatureTooltipEnabled(enabled: boolean): void {\n        this.disp.setFeatureTooltipEnabled(enabled);\n    }\n    getSelection(): QueryMapFeaturesResponse | null {\n        return this.disp.getSelection();\n    }\n    getSelectionXml(selection: FeatureSet, layerIds?: string[] | undefined): string {\n        return this.disp.getSelectionXml(selection, layerIds);\n    }\n    setActiveTool(tool: ActiveMapTool): void {\n        this.disp.setActiveTool(tool);\n    }\n    getActiveTool(): ActiveMapTool {\n        return this.disp.getActiveTool();\n    }\n    initialView(): void {\n        this.inner.initialView();\n    }\n    getSelectedFeatures() {\n        return this.inner.getSelectedFeatures();\n    }\n    /**\n     * INTERNAL API. Not for public use\n     * @hidden\n     */\n    addImageLoading(): void {\n        this.inner.addImageLoading();\n    }\n    /**\n     * INTERNAL API. Not for public use\n     * @hidden\n     */\n    addImageLoaded(): void {\n        this.inner.addImageLoaded();\n    }\n    addSubscribers(props: ISubscriberProps[]): string[] {\n        return this.disp.addSubscribers(props);\n    }\n    removeSubscribers(names: string[]): boolean {\n        return this.disp.removeSubscribers(names);\n    }\n    getSubscribers(): string[] {\n        return this.disp.getSubscribers();\n    }\n    dispatch(action: any): void {\n        this.disp.dispatch(action);\n    }\n}\n\nconst MapViewerContainer = (props: IMapViewerContainerProps) => {\n    const { overviewMapElementSelector } = props;\n    const toasterRef = React.useRef<Toaster>(null);\n    const innerRef = React.useRef<MapViewerBase>(null);\n    const mapDebugContext = React.useContext(MapDebugContext);\n    const locale = useViewerLocale();\n    const map = useActiveMapState();\n    const selection = useActiveMapSelectionSet();\n    const currentView = useActiveMapView();\n    const initialView = useActiveMapInitialView();\n    const externalBaseLayers = useActiveMapExternalBaseLayers();\n    const layerTransparency = useActiveMapLayerTransparency();\n    const layers = useActiveMapLayers();\n    const showGroups = useActiveMapShowGroups();\n    const hideGroups = useActiveMapHideGroups();\n    const showLayers = useActiveMapShowLayers();\n    const hideLayers = useActiveMapHideLayers();\n    const activeSelectedFeature = useActiveMapActiveSelectedFeature();\n    const isContextMenuOpen = useIsContextMenuOpen();\n    const activeMapName = useActiveMapName();\n    const sessionId = useActiveMapSessionId();\n    const selectableLayerNames = useActiveMapSelectableLayerNames();\n    const tool = useViewerActiveTool();\n    const agentUri = useConfiguredAgentUri();\n    const agentKind = useConfiguredAgentKind();\n    const viewRotation = useViewerViewRotation();\n    const viewRotationEnabled = useViewerViewRotationEnabled();\n    const imageFormat = useViewerImageFormat();\n    const selectionImageFormat = useViewerSelectionImageFormat();\n    const selectionColor = useViewerSelectionColor();\n    const activeSelectedFeatureColor = useViewerActiveSelectedFeatureColor();\n    const pointSelectionBuffer = useViewerPointSelectionBuffer();\n    const featureTooltipsEnabled = useViewerFeatureTooltipsEnabled();\n    const manualFeatureTooltips = useConfiguredManualFeatureTooltips();\n    const loadIndicatorPositioning = useConfiguredLoadIndicatorPositioning();\n    const loadIndicatorColor = useConfiguredLoadIndicatorColor();\n    const cancelDigitizationKey = useConfiguredCancelDigitizationKey();\n    const undoLastPointKey = useConfiguredUndoLastPointKey();\n    const dispatch = useDispatch();\n    const [subscribers, setSubscribers] = React.useState<ISubscriberProps[]>([]);\n\n    const addSubscribers = (props: ISubscriberProps[]) => {\n        const ns = [...subscribers, ...props];\n        setSubscribers(ns);\n        return props.map(p => p.name);\n    };\n    const removeSubscribers = (names: string[]) => {\n        const ol = subscribers.length;\n        const ns = subscribers.filter(s => names.indexOf(s.name) < 0);\n        setSubscribers(ns);\n        return ns.length < ol;\n    };\n    const setActiveTool = (tool: ActiveMapTool) => dispatch(MapActions.setActiveTool(tool));\n    const setCurrentView = (view: IMapView) => dispatch(MapActions.setCurrentView(view));\n    const setBusyCount = (count: number) => dispatch(MapActions.setBusyCount(count));\n    const setMouseCoordinates = (mapName: string, coord: Coordinate2D) => dispatch(MapActions.setMouseCoordinates(mapName, coord));\n    const showModalComponent = (options: any) => dispatch(ModalActions.showModalComponent(options));\n    const queryMapFeatures = (mapName: string, options: MapActions.QueryMapFeatureActionOptions) => dispatch(MapActions.queryMapFeatures(mapName, options));\n    const setViewRotation = (rotation: number) => dispatch(MapActions.setViewRotation(rotation));\n    const setViewRotationEnabled = (enabled: boolean) => dispatch(MapActions.setViewRotationEnabled(enabled));\n    const mapResized = (width: number, height: number) => dispatch(MapActions.mapResized(width, height));\n    const setFeatureTooltipsEnabled = (enabled: boolean) => dispatch(MapActions.setFeatureTooltipsEnabled(enabled));\n    const showContextMenu = (pos: [number, number]) => dispatch(FlyoutActions.openContextMenu({ x: pos[0], y: pos[1] }));\n    const hideContextMenu = () => dispatch(FlyoutActions.closeContextMenu());\n    // Side-effect to apply the current external layer list\n    React.useEffect(() => {\n        const innerViewer = innerRef.current;\n        if (innerViewer && layers) {\n            const layerManager = innerViewer.getLayerManager();\n            layerManager.apply(layers);\n        }\n    }, [layers]);\n    // Side-effect to set the viewer \"instance\" once the MapViewerBase component has been mounted.\n    // Should only happen once.\n    React.useEffect(() => {\n        logger.debug(`React.useEffect - Change of innerRef.current`);\n        const innerViewer = innerRef.current;\n        if (innerViewer) {\n            const adapter = new MapViewerAdapter(innerViewer);\n            Runtime.setViewer(adapter);\n            const browserWindow: any = window;\n            browserWindow.getViewer = browserWindow.getViewer || Runtime.getViewer;\n            if (agentUri) {\n                browserWindow.getClient = browserWindow.getClient || (() => new Client(agentUri, agentKind));\n            }\n            logger.debug(`React.useEffect - Attached runtime viewer instance and installed browser global APIs`);\n        }\n    }, [innerRef, agentUri, agentKind]);\n    // Side-effect to imperatively refresh the map upon selection change\n    React.useEffect(() => {\n        logger.debug(`React.useEffect - Change of selection`);\n        innerRef.current?.refreshMap(RefreshMode.SelectionOnly);\n    }, [selection]);\n    // Side-effect to attach an updated \"external\" map viewer API to the current\n    // viewer \"instance\" upon change of any key map state\n    React.useEffect(() => {\n        logger.debug(`React.useEffect - Change of any of [toasterRef.current, map, selection, viewer, config]`);\n        const adapter = Runtime.getViewer() as MapViewerAdapter;\n        if (adapter && sessionId && activeMapName) {\n            const external: INonBaseMapViewer = {\n                dismissToast: key => toasterRef.current?.dismiss(key),\n                toastSuccess: (iconName, message) => toasterRef.current?.show({ icon: (iconName as any), message: message, intent: Intent.SUCCESS }),\n                toastWarning: (iconName, message) => toasterRef.current?.show({ icon: (iconName as any), message: message, intent: Intent.WARNING }),\n                toastError: (iconName, message) => toasterRef.current?.show({ icon: (iconName as any), message: message, intent: Intent.DANGER }),\n                toastPrimary: (iconName, message) => toasterRef.current?.show({ icon: (iconName as any), message: message, intent: Intent.PRIMARY }),\n                setViewRotation: setViewRotation,\n                setViewRotationEnabled: setViewRotationEnabled,\n                getViewRotation: () => viewRotation,\n                isViewRotationEnabled: () => viewRotationEnabled,\n                getSessionId: () => sessionId,\n                getMapName: () => activeMapName,\n                setActiveTool: setActiveTool,\n                getActiveTool: () => tool,\n                setFeatureTooltipEnabled: setFeatureTooltipsEnabled,\n                getSelection: () => selection,\n                getSelectionXml: (s, layerIds) => buildSelectionXml(s, layerIds),\n                addSubscribers: (props) => addSubscribers(props),\n                removeSubscribers: (name) => removeSubscribers(name),\n                getSubscribers: () => subscribers.map(s => s.name),\n                dispatch: (action) => dispatch(action)\n            };\n            adapter.attachExternal(external);\n            logger.debug(`Attached updated external \"API\" to runtime viewer instance`);\n        }\n    }, [toasterRef, sessionId, activeMapName, selection, tool, viewRotation, viewRotationEnabled]);\n\n    const onBeginDigitization = (callback: (cancelled: boolean) => void) => {\n        setActiveTool?.(ActiveMapTool.None);\n        //Could be a small timing issue here, but the active tool should generally\n        //be \"None\" before the user clicks their first digitizing vertex/point\n        callback(false);\n    };\n    const onMapResized = (size: [number, number]) => mapResized?.(size[0], size[1]);\n    const onRequestZoomToView = (view: IMapView) => setCurrentView?.(view);\n    const onQueryMapFeatures = (options: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void) => {\n        if (activeMapName) {\n            queryMapFeatures?.(activeMapName, {\n                options: options,\n                //append: this.inner.state.shiftKey === true,\n                callback: success,\n                errBack: failure\n            });\n        }\n    };\n    const onBusyLoading = (busyCount: number) => setBusyCount?.(busyCount);\n    const onRotationChanged = (newRotation: number) => setViewRotation?.(newRotation);\n    const onMouseCoordinateChanged = (coord: Coordinate2D) => {\n        if (activeMapName) {\n            setMouseCoordinates?.(activeMapName, coord);\n        }\n    };\n    const onSessionExpired = () => {\n        showModalComponent?.({\n            modal: {\n                title: tr(\"SESSION_EXPIRED\", locale),\n                backdrop: true\n            },\n            name: DefaultComponentNames.SessionExpired,\n            id: DefaultComponentNames.SessionExpired\n        });\n    };\n    const onHideContextMenu = () => hideContextMenu?.();\n    const onContextMenu = (pos: [number, number]) => showContextMenu?.(pos);\n    const onOpenTooltipLink = (url: string) => {\n        let fixedUrl = url;\n        if (activeMapName && sessionId) {\n            fixedUrl = ensureParameters(url, activeMapName, sessionId, locale);\n        }\n        dispatch({\n            type: ActionType.TASK_INVOKE_URL,\n            payload: {\n                url: fixedUrl\n            }\n        });\n    };\n    /*\n    const store = (this.context as any).store;\n    const items: any[] = contextmenu != null ? contextmenu.items : [];\n    const cmitems = (items || []).map(tb => mapToolbarReference(tb, store, invokeCommand));\n    const childItems = processMenuItems(cmitems);\n    */\n    let xml;\n    if (activeSelectedFeature && selection && selection.FeatureSet) {\n        xml = getActiveSelectedFeatureXml(selection.FeatureSet, activeSelectedFeature);\n    }\n    if (map && agentUri) {\n        return <>\n            {/* HACK: usePortal=false to workaround what I think is: https://github.com/palantir/blueprint/issues/3248 */}\n            <Toaster usePortal={false} position={Position.TOP} ref={toasterRef} />\n            <MapViewerBase ref={innerRef}\n                map={map}\n                mock={mapDebugContext.mock}\n                agentUri={agentUri}\n                agentKind={agentKind}\n                locale={locale}\n                externalBaseLayers={externalBaseLayers}\n                imageFormat={imageFormat}\n                selectionImageFormat={selectionImageFormat}\n                selectionColor={selectionColor}\n                activeSelectedFeatureColor={activeSelectedFeatureColor}\n                pointSelectionBuffer={pointSelectionBuffer}\n                tool={tool}\n                viewRotation={viewRotation}\n                viewRotationEnabled={viewRotationEnabled}\n                featureTooltipsEnabled={featureTooltipsEnabled}\n                manualFeatureTooltips={manualFeatureTooltips}\n                showGroups={showGroups}\n                hideGroups={hideGroups}\n                showLayers={showLayers}\n                hideLayers={hideLayers}\n                view={currentView || initialView}\n                selectableLayerNames={selectableLayerNames}\n                overviewMapElementSelector={overviewMapElementSelector}\n                loadIndicatorPosition={loadIndicatorPositioning}\n                loadIndicatorColor={loadIndicatorColor}\n                layerTransparency={layerTransparency || Constants.EMPTY_OBJECT}\n                onBeginDigitization={onBeginDigitization}\n                onSessionExpired={onSessionExpired}\n                onBusyLoading={onBusyLoading}\n                onRotationChanged={onRotationChanged}\n                onMouseCoordinateChanged={onMouseCoordinateChanged}\n                onQueryMapFeatures={onQueryMapFeatures}\n                onRequestZoomToView={onRequestZoomToView}\n                onMapResized={onMapResized}\n                cancelDigitizationKey={cancelDigitizationKey}\n                undoLastPointKey={undoLastPointKey}\n                activeSelectedFeatureXml={xml}\n                onContextMenu={onContextMenu}\n                onHideContextMenu={onHideContextMenu}\n                isContextMenuOpen={!!isContextMenuOpen}\n                onOpenTooltipLink={onOpenTooltipLink} />\n            {subscribers.map((s, i) => <Subscriber key={`subscriber-${i}-${s.name}`} {...s} />)}\n        </>;\n    }\n    return <div>{tr(\"LOADING_MSG\", locale)}</div>;\n};\n\nexport default MapViewerContainer;","import { IDOMElementMetrics } from \"../api/common\";\nimport {\n    IOpenFlyoutAction, \n    ICloseFlyoutAction,\n    IOpenComponentInFlyoutAction,\n    ICloseComponentInFlyoutAction,\n    IOpenContextMenuAction,\n    ICloseContextMenuAction\n} from \"./defs\";\nimport { ActionType } from '../constants/actions';\n\n/**\n * Opens the context menu at the specific position\n * \n * @param position The client x/y position\n * @since 0.13\n */\nexport function openContextMenu(position: { x: number, y: number }): IOpenContextMenuAction {\n    return {\n        type: ActionType.CONTEXT_MENU_OPEN,\n        payload: {\n            ...position\n        }\n    };\n}\n\n/**\n * Closes the context menu\n * \n * @since 0.13\n */\nexport function closeContextMenu(): ICloseContextMenuAction {\n    return {\n        type: ActionType.CONTEXT_MENU_CLOSE\n    };\n}\n\n/**\n * Opens the specified flyout menu\n *\n * @export\n * @param {string} id\n * @param {IDOMElementMetrics} metrics\n * @returns {IOpenFlyoutAction}\n */\nexport function openFlyout(id: string, metrics: IDOMElementMetrics): IOpenFlyoutAction {\n    return {\n        type: ActionType.FLYOUT_OPEN,\n        payload: {\n            flyoutId: id,\n            metrics: metrics\n        }\n    };\n}\n\n/**\n * Closes the specified flyout menu\n *\n * @export\n * @param {string} id\n * @returns {ICloseFlyoutAction}\n */\nexport function closeFlyout(id: string): ICloseFlyoutAction {\n    return {\n        type: ActionType.FLYOUT_CLOSE,\n        payload: {\n            flyoutId: id\n        }\n    };\n}\n\n/**\n * Load the specified component in the given flyout with the given component props\n *\n * @export\n * @param {string} id\n * @param {IDOMElementMetrics} metrics\n * @param {string} name\n * @param {*} props\n * @returns {IOpenComponentInFlyoutAction}\n */\nexport function openComponent(id: string, metrics: IDOMElementMetrics, name: string, props: any): IOpenComponentInFlyoutAction {\n    return {\n        type: ActionType.COMPONENT_OPEN,\n        payload: {\n            flyoutId: id,\n            metrics: metrics,\n            name: name,\n            props: props\n        }\n    };\n}\n\n/**\n * Closes the component in the given flyout\n *\n * @export\n * @param {string} id\n * @returns {ICloseComponentInFlyoutAction}\n */\nexport function closeComponent(id: string): ICloseComponentInFlyoutAction {\n    return {\n        type: ActionType.COMPONENT_CLOSE,\n        payload: {\n            flyoutId: id\n        }\n    };\n}","import olPoint from \"ol/geom/Point\";\nimport olLineString from \"ol/geom/LineString\";\nimport olCircle from \"ol/geom/Circle\";\nimport olPolygon, { fromCircle } from \"ol/geom/Polygon\";\nimport olLinearRing from \"ol/geom/LinearRing\";\nimport olMultiLineString from \"ol/geom/MultiLineString\";\nimport olMultiPoint from \"ol/geom/MultiPoint\";\nimport olMultiPolygon from \"ol/geom/MultiPolygon\";\nimport olGeometry from \"ol/geom/Geometry\";\nimport olGeometryCollection from \"ol/geom/GeometryCollection\";\n\nimport olOverlay, { Options as OverlayOptions } from \"ol/Overlay\";\nimport * as olExtent from \"ol/extent\";\nimport * as olProj from \"ol/proj\";\nimport olProjection, { Options as ProjectionOptions } from \"ol/proj/Projection\";\n\nimport { Options as VectorLayerOptions } from \"ol/layer/BaseVector\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport olVectorSource, { Options as VectorOptions } from \"ol/source/Vector\";\n\nimport olCollection from \"ol/Collection\";\nimport olFeature from \"ol/Feature\";\n\nimport olInteractionExtent, { Options as ExtentOptions } from \"ol/interaction/Extent\";\nimport olInteractionSnap, { Options as SnapOptions } from \"ol/interaction/Snap\";\nimport olInteractionDraw, { Options as DrawOptions } from \"ol/interaction/Draw\";\nimport olInteractionTranslate, { Options as TranslateOptions } from \"ol/interaction/Translate\";\nimport olInteractionModify, { Options as ModifyOptions } from \"ol/interaction/Modify\";\nimport olInteractionSelect, { Options as SelectOptions } from \"ol/interaction/Select\";\n\nimport olFormatGeoJSON, { Options as GeoJSONOptions } from \"ol/format/GeoJSON\";\nimport olFormatWKT, { Options as WKTOptions } from \"ol/format/WKT\";\n\nimport olStyle, { Options as StyleOptions } from \"ol/style/Style\";\nimport olStyleIcon, { Options as IconOptions } from \"ol/style/Icon\";\nimport olStyleRegularShape, { Options as RegularShapeOptions } from \"ol/style/RegularShape\";\nimport olStyleText, { Options as TextOptions } from \"ol/style/Text\";\nimport olStyleFill, { Options as FillOptions } from \"ol/style/Fill\";\nimport olStyleStroke, { Options as StrokeOptions } from \"ol/style/Stroke\";\nimport olStyleCircle, { Options as CircleOptions } from \"ol/style/Circle\";\nimport { Bounds, Coordinate2D } from './common';\nimport { ProjectionLike } from 'ol/proj';\n\n/**\n * Creates various OpenLayers types used by the viewer\n *\n * @export\n * @interface IOLFactory\n */\nexport interface IOLFactory {\n    createStyle(options?: StyleOptions): olStyle;\n    createStyleFill(options?: FillOptions): olStyleFill;\n    createStyleStroke(options?: StrokeOptions): olStyleStroke;\n    createStyleCircle(options?: CircleOptions): olStyleCircle;\n    /**\n     * @since 0.12.6\n     */\n    createStyleIcon(options?: IconOptions): olStyleIcon;\n    /**\n     * @since 0.12.6\n     */\n    createStyleRegularShape(options: RegularShapeOptions): olStyleRegularShape;\n    /**\n     * @since 0.12.6\n     */\n    createStyleText(options?: TextOptions): olStyleText;\n    createFeatureCollection(): olCollection<olFeature>;\n    extentContainsXY(extent: Bounds, x: number, y: number): boolean;\n    extendExtent(extent: Bounds, other: Bounds): Bounds;\n    createProjection(options: ProjectionOptions): olProjection;\n    transformCoordinateFromLonLat(lonlat: Coordinate2D, proj?: ProjectionLike): Coordinate2D;\n    transformCoordinate(coordinate: Coordinate2D, source: ProjectionLike, target: ProjectionLike): Coordinate2D;\n    transformExtent(extent: Bounds, source: ProjectionLike, target: ProjectionLike): Bounds;\n    createGeomPoint(coordinates: Coordinate2D): olPoint;\n    createGeomLineString(coordinates: Coordinate2D[]): olLineString;\n    createGeomCircle(center: Coordinate2D, radius: number | undefined): olCircle;\n    createGeomLinearRing(coordinates: Coordinate2D[]): olLinearRing;\n    createGeomPolygon(coordinates: Coordinate2D[][]): olPolygon;\n    createGeomPolygonFromCircle(circle: olCircle): olPolygon;\n    createGeomMultiLineString(coordinates: Coordinate2D[][]): olMultiLineString;\n    createGeomMultiPoint(coordinates: Coordinate2D[]): olMultiPoint;\n    createGeomMultiPolygon(coordinates: Coordinate2D[][][]): olMultiPolygon;\n    createGeomCollection(geometries: olGeometry[]): olGeometryCollection;\n    createVectorSource(options?: VectorOptions): olVectorSource;\n    createVectorLayer(options?: VectorLayerOptions | undefined): olVectorLayer;\n    createOverlay(options: OverlayOptions): olOverlay;\n    createInteractionDraw(options: DrawOptions): olInteractionDraw;\n    /**\n     * \n     * @since 0.11\n     * @param {ModifyOptions} options \n     * @returns {olInteractionModify} \n     * @memberof IOLFactory\n     */\n    createInteractionModify(options: ModifyOptions): olInteractionModify;\n    /**\n     * \n     * @since 0.11\n     * @param {SelectOptions} options \n     * @returns {olInteractionSelect} \n     * @memberof IOLFactory\n     */\n    createInteractionSelect(options: SelectOptions): olInteractionSelect;\n    createInteractionExtent(options: ExtentOptions): olInteractionExtent;\n    createInteractionSnap(options: SnapOptions): olInteractionSnap;\n    createInteractionTranslate(options: TranslateOptions): olInteractionTranslate;\n    createFeature(geomOrProps?: olGeometry | { [key: string]: any }): olFeature;\n    createFormatGeoJSON(options?: GeoJSONOptions | undefined): olFormatGeoJSON;\n    createFormatWKT(options?: WKTOptions | undefined): olFormatWKT;\n}\n\n/**\n * Creates various OpenLayers types used by the viewer\n *\n * @export\n * @class OLFactory\n * @implements {IOLFactory}\n */\nexport class OLFactory implements IOLFactory {\n    public createStyle(options?: StyleOptions): olStyle {\n        return new olStyle(options);\n    }\n    public createStyleFill(options?: FillOptions): olStyleFill {\n        return new olStyleFill(options);\n    }\n    public createStyleStroke(options?: StrokeOptions): olStyleStroke {\n        return new olStyleStroke(options);\n    }\n    public createStyleCircle(options?: CircleOptions): olStyleCircle {\n        return new olStyleCircle(options);\n    }\n    public createFeatureCollection(): olCollection<olFeature> {\n        return new olCollection<olFeature>();\n    }\n    public extentContainsXY(extent: Bounds, x: number, y: number): boolean {\n        return olExtent.containsXY(extent, x, y);\n    }\n    public extendExtent(extent: Bounds, other: Bounds): Bounds {\n        return olExtent.extend(extent, other) as Bounds;\n    }\n    public createProjection(options: ProjectionOptions): olProjection {\n        return new olProjection(options);\n    }\n    public transformCoordinateFromLonLat(lonlat: Coordinate2D, proj?: ProjectionLike): Coordinate2D {\n        return olProj.fromLonLat(lonlat, proj) as Coordinate2D;\n    }\n    public transformCoordinate(coordinate: Coordinate2D, source: ProjectionLike, target: ProjectionLike): Coordinate2D {\n        return olProj.transform(coordinate, source, target) as Coordinate2D;\n    }\n    public transformExtent(extent: Bounds, source: ProjectionLike, target: ProjectionLike): Bounds {\n        return olProj.transformExtent(extent, source, target) as Bounds;\n    }\n    public createGeomPoint(coordinates: Coordinate2D): olPoint {\n        return new olPoint(coordinates);\n    }\n    public createGeomLineString(coordinates: Coordinate2D[]): olLineString {\n        return new olLineString(coordinates);\n    }\n    public createGeomCircle(center: Coordinate2D, radius: number | undefined): olCircle {\n        return new olCircle(center, radius);\n    }\n    public createGeomLinearRing(coordinates: Coordinate2D[]): olLinearRing {\n        return new olLinearRing(coordinates);\n    }\n    public createGeomPolygon(coordinates: Coordinate2D[][]): olPolygon {\n        return new olPolygon(coordinates);\n    }\n    public createGeomPolygonFromCircle(circle: olCircle): olPolygon {\n        return fromCircle(circle);\n    }\n    public createGeomMultiLineString(coordinates: Coordinate2D[][]): olMultiLineString {\n        return new olMultiLineString(coordinates);\n    }\n    public createGeomMultiPoint(coordinates: Coordinate2D[]): olMultiPoint {\n        return new olMultiPoint(coordinates);\n    }\n    public createGeomMultiPolygon(coordinates: Coordinate2D[][][]): olMultiPolygon {\n        return new olMultiPolygon(coordinates);\n    }\n    public createGeomCollection(geometries: olGeometry[]): olGeometryCollection {\n        return new olGeometryCollection(geometries);\n    }\n    public createVectorSource(options?: VectorOptions): olVectorSource {\n        return new olVectorSource(options);\n    }\n    public createVectorLayer(options?: VectorLayerOptions | undefined): olVectorLayer {\n        return new olVectorLayer(options);\n    }\n    public createOverlay(options: OverlayOptions): olOverlay {\n        return new olOverlay(options);\n    }\n    public createInteractionDraw(options: DrawOptions): olInteractionDraw {\n        return new olInteractionDraw(options);\n    }\n    public createInteractionExtent(options: ExtentOptions): olInteractionExtent {\n        return new olInteractionExtent(options);\n    }\n    public createInteractionTranslate(options: TranslateOptions): olInteractionTranslate {\n        return new olInteractionTranslate(options);\n    }\n    public createInteractionSnap(options: SnapOptions): olInteractionSnap {\n        return new olInteractionSnap(options);\n    }\n    public createInteractionModify(options: ModifyOptions): olInteractionModify {\n        return new olInteractionModify(options);\n    }\n    public createInteractionSelect(options: SelectOptions): olInteractionSelect {\n        return new olInteractionSelect(options);\n    }\n    public createFeature(geomOrProps?: olGeometry | { [key: string]: any }): olFeature {\n        return new olFeature(geomOrProps);\n    }\n    public createFormatGeoJSON(options?: GeoJSONOptions | undefined): olFormatGeoJSON {\n        return new olFormatGeoJSON(options);\n    }\n    public createFormatWKT(options?: WKTOptions | undefined): olFormatWKT {\n        return new olFormatWKT(options);\n    }\n\n    /**\n     * @since 0.12.6\n     */\n    public createStyleIcon(options?: IconOptions | undefined): olStyleIcon {\n        return new olStyleIcon(options);\n    }\n    /**\n     * @since 0.12.6\n     */\n    public createStyleRegularShape(options: RegularShapeOptions): olStyleRegularShape {\n        return new olStyleRegularShape(options);\n    }\n    /**\n     * @since 0.12.6\n     */\n    public createStyleText(options?: TextOptions | undefined): olStyleText {\n        return new olStyleText(options);\n    }\n}","import * as React from \"react\";\nimport {\n    Coordinate2D,\n    UnitOfMeasure\n} from \"../api/common\";\nimport { MouseCoordinates } from \"../components/mouse-coordinates\";\nimport * as olProj from \"ol/proj\";\nimport { getUnitOfMeasure } from \"../utils/units\";\nimport { useViewerLocale, useCurrentMouseCoordinates, useActiveMapProjection, useConfiguredCoordinateProjection, useConfiguredCoordinateDecimals, useConfiguredCoordinateFormat } from './hooks';\n\nexport interface IMouseCoordinatesContainerProps {\n    style?: React.CSSProperties;\n}\n\nconst MouseCoordinatesContainer = (props: IMouseCoordinatesContainerProps) => {\n    const { style } = props;\n    const mapProjection = useActiveMapProjection();\n    const projection = useConfiguredCoordinateProjection();\n    const decimals = useConfiguredCoordinateDecimals();\n    const format = useConfiguredCoordinateFormat();\n    const mouse = useCurrentMouseCoordinates();\n    const locale = useViewerLocale();\n    if (mouse) {\n        const prj = olProj.get(projection ?? mapProjection);\n        let units;\n        if (prj) {\n            units = prj.getUnits();\n            switch (units) {\n                case \"degrees\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Degrees).abbreviation(locale);\n                    break;\n                case \"pixels\":\n                case \"tile-pixels\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Pixels).abbreviation(locale);\n                    break;\n                case \"m\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Meters).abbreviation(locale);\n                    break;\n                case \"ft\":\n                case \"us-ft\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Feet).abbreviation(locale);\n                    break;\n            }\n        }\n        let coords: Coordinate2D = [mouse[0], mouse[1]];\n        if (projection && mapProjection) {\n            try {\n                coords = olProj.transform(coords, mapProjection, projection) as Coordinate2D;\n            } catch (e) {\n\n            }\n        }\n        return <MouseCoordinates units={units} coords={coords} style={style} decimals={decimals} format={format} />;\n    } else {\n        return <div />;\n    }\n};\n\nexport default MouseCoordinatesContainer;","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { ICommand } from \"../api/common\";\nimport { Navigator, ZoomDirection, PanDirection } from \"../components/navigator\";\nimport * as MapActions from \"../actions/map\";\nimport { getCommand, DefaultCommands } from \"../api/registry/command\";\nimport { useViewerLocale, useActiveMapFiniteScales, useActiveMapView, useActiveMapName, useViewerBusyCount } from './hooks';\n\nexport interface INavigatorContainerProps {\n    style?: React.CSSProperties;\n}\n\nconst NavigatorContainer = (props: INavigatorContainerProps) => {\n    const { style } = props;\n    const dispatch = useDispatch();\n    const locale = useViewerLocale();\n    const finiteScales = useActiveMapFiniteScales();\n    const view = useActiveMapView();\n    const busyCount = useViewerBusyCount();;\n    const activeMapName = useActiveMapName();\n    const setScale = (mapName: string, scale: number) => dispatch(MapActions.setScale(mapName, scale));\n    const invokeCommand = (cmd: ICommand, parameters?: any) => dispatch(MapActions.invokeCommand(cmd, parameters));\n    const onZoom = (direction: ZoomDirection) => {\n        let cmd: ICommand | undefined;\n        switch (direction) {\n            case ZoomDirection.In:\n                cmd = getCommand(DefaultCommands.ZoomIn);\n                break;\n            case ZoomDirection.Out:\n                cmd = getCommand(DefaultCommands.ZoomOut);\n                break;\n        }\n        if (cmd) {\n            invokeCommand(cmd);\n        }\n    };\n    const onPan = (direction: PanDirection) => {\n        let cmd: ICommand | undefined;\n        switch (direction) {\n            case PanDirection.East:\n                cmd = getCommand(DefaultCommands.PanRight);\n                break;\n            case PanDirection.West:\n                cmd = getCommand(DefaultCommands.PanLeft);\n                break;\n            case PanDirection.North:\n                cmd = getCommand(DefaultCommands.PanUp);\n                break;\n            case PanDirection.South:\n                cmd = getCommand(DefaultCommands.PanDown);\n                break;\n        }\n        if (cmd) {\n            invokeCommand(cmd);\n        }\n    };\n    const onRequestZoomToScale = (scale: number) => {\n        if (activeMapName) {\n            setScale(activeMapName, scale);\n        }\n    };\n    if (view) {\n        return <Navigator style={style}\n            scale={view.scale}\n            finiteScaleList={finiteScales}\n            locale={locale}\n            busy={busyCount > 0}\n            onRequestZoomToScale={onRequestZoomToScale}\n            onPan={onPan}\n            onZoom={onZoom} />;\n    } else {\n        return <div />;\n    }\n}\n\nexport default NavigatorContainer;","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport * as MapActions from \"../actions/map\";\nimport { ScaleDisplay } from \"../components/scale-display\";\nimport { useActiveMapView, useActiveMapName, useActiveMapFiniteScales, useViewerLocale } from './hooks';\n\nexport interface IScaleDisplayContainerProps {\n    style?: React.CSSProperties;\n}\n\nconst ScaleDisplayContainer = (props: IScaleDisplayContainerProps) => {\n    const { style } = props;\n    const dispatch = useDispatch();\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const view = useActiveMapView();\n    const finiteScales = useActiveMapFiniteScales();\n    const setScale = (mapName: string, scale: number) => dispatch(MapActions.setScale(mapName, scale))\n    const onScaleChanged = (scale: number) => {\n        if (activeMapName) {\n            setScale(activeMapName, scale);\n        }\n    };\n    if (view) {\n        return <ScaleDisplay onScaleChanged={onScaleChanged}\n            view={view}\n            style={style}\n            finiteScales={finiteScales}\n            locale={locale} />;\n    } else {\n        return <noscript />;\n    }\n};\n\nexport default ScaleDisplayContainer;","import * as React from \"react\";\nimport { SelectedFeatureCount } from \"../components/selected-feature-count\";\nimport { useViewerLocale, useActiveMapSelectionSet } from './hooks';\n\nexport interface ISelectedFeatureCountContainerProps {\n    style?: React.CSSProperties;\n}\n\nconst SelectedFeatureCountContainer = (props: ISelectedFeatureCountContainerProps) => {\n    const { style } = props;\n    const selection = useActiveMapSelectionSet();\n    const locale = useViewerLocale();\n    if (selection && selection.FeatureSet) {\n        return <SelectedFeatureCount locale={locale} style={style} selection={selection.FeatureSet} />;\n    } else {\n        return <div />;\n    }\n}\n\nexport default SelectedFeatureCountContainer;","import * as React from \"react\";\nimport { connect, useDispatch } from \"react-redux\";\nimport { SelectionPanel, ISelectedFeatureProps } from \"../components/selection-panel\";\nimport { QueryMapFeaturesResponse, SelectedFeature } from \"../api/contracts/query\";\nimport * as MapActions from \"../actions/map\";\nimport { getViewer } from \"../api/runtime\";\nimport { tr, DEFAULT_LOCALE } from \"../api/i18n\";\nimport {\n    IMapView,\n    ReduxDispatch,\n    IApplicationState,\n    IConfigurationReducerState,\n    getSelectionSet\n} from \"../api/common\";\nimport { Callout, Intent } from '@blueprintjs/core';\nimport { AppContext } from '../components/context';\nimport { useViewerLocale, useActiveMapSelectionSet, useActiveMapName, useActiveMapState } from './hooks';\n\nexport interface ISelectionPanelContainerProps {\n    maxHeight?: number;\n    selectedFeatureRenderer?: (props: ISelectedFeatureProps) => JSX.Element;\n}\n\nconst SelectionPanelContainer = (props: ISelectionPanelContainerProps) => {\n    const { maxHeight, selectedFeatureRenderer } = props;\n    const locale = useViewerLocale();\n    const map = useActiveMapState();\n    const selection = useActiveMapSelectionSet();\n    const dispatch = useDispatch();\n    const activeMapName = useActiveMapName();\n    const setCurrentView = (view: IMapView) => dispatch(MapActions.setCurrentView(view));\n    const showSelectedFeature = (mapName: string, layerId: string, selectionKey: string) => dispatch(MapActions.showSelectedFeature(mapName, layerId, selectionKey));\n    const appContext = React.useContext(AppContext);\n    const onZoomToSelectedFeature = (feature: SelectedFeature) => {\n        const bbox: any = feature.Bounds.split(\" \").map(s => parseFloat(s));\n        const viewer = getViewer();\n        if (viewer) {\n            const view = viewer.getViewForExtent(bbox);\n            setCurrentView(view);\n        }\n    };\n    const resolveLayerLabel = (layerId: string, _: string) => {\n        const layer = map?.Layer?.filter?.(l => l.ObjectId == layerId)?.[0];\n        if (layer) {\n            return layer.LegendLabel;\n        }\n    };\n    const onShowSelectedFeature = (layerId: string, selectionKey: string) => {\n        if (activeMapName) {\n            showSelectedFeature(activeMapName, layerId, selectionKey);\n        }\n    };\n    if (selection != null && selection.SelectedFeatures != null) {\n        return <SelectionPanel locale={locale}\n            onResolveLayerLabel={resolveLayerLabel}\n            allowHtmlValues={appContext.allowHtmlValuesInSelection()}\n            cleanHTML={appContext.getHTMLCleaner()}\n            selection={selection.SelectedFeatures}\n            onRequestZoomToFeature={onZoomToSelectedFeature}\n            onShowSelectedFeature={onShowSelectedFeature}\n            selectedFeatureRenderer={selectedFeatureRenderer}\n            maxHeight={maxHeight} />;\n    } else {\n        return <Callout intent={Intent.PRIMARY} icon=\"info-sign\">\n            <p className=\"selection-panel-no-selection\">{tr(\"NO_SELECTED_FEATURES\", locale)}</p>\n        </Callout>;\n    }\n}\n\nexport default SelectionPanelContainer;","import * as React from \"react\";\nimport { isMenuRef, isComponentFlyout } from \"../utils/type-guards\";\nimport { IDOMElementMetrics, FlyoutVisibilitySet, GenericEvent } from \"../api/common\";\nimport { ToolbarContext } from \"./context\";\nimport { STR_EMPTY } from \"../utils/string\";\nimport { ImageIcon } from \"./icon\";\nimport {\n    BlueprintSvgIconNames\n} from \"../constants/assets\";\nimport * as Constants from \"../constants\";\nimport { Icon } from '@blueprintjs/core';\n\nexport const DEFAULT_TOOLBAR_SIZE = 29;\nexport const TOOLBAR_BACKGROUND_COLOR = \"#f0f0f0\";\n\n// Size is based on the default toolbar height of 29 (with base image icon size of 16x16)\n// This ratio will help \"scale\" SVG icons to match\nconst SVG_SIZE_RATIO = 16 / DEFAULT_TOOLBAR_SIZE;\n\nfunction getSelected(item: IItem): boolean {\n    const sel = item.selected;\n    if (sel != null) {\n        if (typeof sel === 'function') {\n            return sel();\n        } else {\n            return sel;\n        }\n    }\n    return false;\n}\n\nexport function getEnabled(item: IItem): boolean {\n    const en = item.enabled;\n    if (en != null) {\n        if (typeof en === 'function') {\n            return en();\n        } else {\n            return en;\n        }\n    }\n    return true;\n}\n\nfunction getIconElement(item: IItem, enabled: boolean, size: number): React.ReactNode {\n    const iconStyle = getIconStyle(enabled, size);\n    if (item.iconClass || item.icon) {\n        return <ImageIcon style={iconStyle} url={item.icon} spriteClass={item.iconClass} />\n    } else if (item.bpIconName) {\n        const { opacity } = iconStyle; //For SVG, we only care about opacity\n        return <Icon style={{ opacity }} icon={item.bpIconName} iconSize={size * SVG_SIZE_RATIO} />\n    } else {\n        return <></>;\n    }\n}\n\nfunction getFlyoutIconElement(isFlownOut: boolean | undefined, size: number) {\n    return <Icon icon={isFlownOut ? \"chevron-up\" : \"chevron-down\"} iconSize={size * SVG_SIZE_RATIO} />\n}\n\nfunction getTooltip(item: IItem): string {\n    const tt = item.tooltip;\n    if (tt != null) {\n        if (typeof tt === 'function') {\n            return tt();\n        } else {\n            return tt;\n        }\n    }\n    return STR_EMPTY;\n}\n\nexport function getIconStyle(enabled: boolean, height: number): React.CSSProperties {\n    const imgStyle: React.CSSProperties = {\n        verticalAlign: \"middle\",\n        lineHeight: height\n    };\n    if (!enabled) {\n        imgStyle.opacity = 0.2;\n    }\n    return imgStyle;\n}\n\nfunction getItemStyle(enabled: boolean, selected: boolean, size: number, isMouseOver: boolean, vertical?: boolean): React.CSSProperties {\n    const pad = ((size - 16) / 2);\n    const vertPad = 6;\n    const style: React.CSSProperties = {\n        display: vertical === true ? \"block\" : \"inline-block\",\n        //height: height,\n        paddingLeft: pad,\n        paddingRight: pad,\n        paddingTop: vertPad,\n        paddingBottom: vertPad\n    };\n    if ((isMouseOver === true && enabled === true) || selected) {\n        style.borderWidth = 1;\n        style.paddingLeft = pad - 1; //To compensate for border\n        style.paddingRight = pad - 1; //To compensate for border\n        style.paddingTop = vertPad - 1; //To compensate for border\n        style.paddingBottom = vertPad - 1; //To compensate for border\n    }\n    return style;\n}\n\nfunction getToolbarSeparatorItemStyle(vertical?: boolean): React.CSSProperties {\n    const style: React.CSSProperties = {\n        display: vertical === true ? \"block\" : \"inline-block\"\n    };\n    if (vertical === true) {\n        style.paddingTop = 2;\n        style.paddingBottom = -2;\n        style.marginLeft = 0;\n        style.marginRight = 0;\n    } else {\n        style.paddingTop = 0;\n        style.paddingBottom = 0;\n        style.marginLeft = 2;\n        style.marginRight = -2;\n    }\n    return style;\n}\n\nfunction getMenuItemStyle(enabled: boolean, selected: boolean, height: number, isMouseOver: boolean): React.CSSProperties {\n    const pad = ((height - 16) / 2);\n    const vertPad = 6;\n    const style: React.CSSProperties = {\n        //height: height,\n        paddingLeft: pad,\n        paddingRight: pad,\n        paddingTop: vertPad,\n        paddingBottom: vertPad\n    };\n    if (enabled && (isMouseOver === true || selected)) {\n        style.cursor = \"pointer\";\n        style.border = \"1px solid rgb(153, 181, 202)\";\n        style.paddingLeft = pad - 1; //To compensate for border\n        style.paddingRight = pad - 1; //To compensate for border\n        style.paddingTop = vertPad - 1; //To compensate for border\n        style.paddingBottom = vertPad - 1; //To compensate for border\n    }\n    return style;\n}\n\nexport interface IFlyoutMenuChildItemProps {\n    item: IItem | IInlineMenu;\n    onInvoked?: () => void;\n}\n\nexport const FlyoutMenuChildItem = (props: IFlyoutMenuChildItemProps) => {\n    const { item } = props;\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onClick = () => {\n        if (getEnabled(item)) {\n            item.invoke?.();\n            props.onInvoked?.();\n        }\n    };\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    };\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    };\n    const height = DEFAULT_TOOLBAR_SIZE;\n    const selected = getSelected(item);\n    const enabled = getEnabled(item);\n    const tt = getTooltip(item);\n    const style = getMenuItemStyle(enabled, selected, height, isMouseOver);\n    const iconEl = getIconElement(item, enabled, height);\n    return <li className=\"noselect flyout-menu-child-item\" title={tt} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick}>\n        <div style={style}>\n            {iconEl} {item.label}\n        </div>\n    </li>;\n}\n\n\n\ninterface IComponentFlyoutItemProps {\n    size: number;\n    item: IComponentFlyoutItem;\n    vertical?: boolean;\n    isFlownOut?: boolean;\n}\n\nconst ComponentFlyoutItem = (props: IComponentFlyoutItemProps) => {\n    const { size, item, vertical, isFlownOut } = props;\n    const toolbarCtx = React.useContext(ToolbarContext);\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onClick = (e: GenericEvent) => {\n        e.preventDefault();\n        const { flyoutId, componentName, componentProps } = item;\n        const newState = !!!isFlownOut;\n        if (newState) {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const metrics: IDOMElementMetrics = {\n                posX: rect.left, // e.clientX,\n                posY: rect.top, // e.clientY,\n                width: rect.width, // e.currentTarget.offsetWidth,\n                height: rect.height, // e.currentTarget.offsetHeight\n                vertical: vertical\n            };\n            toolbarCtx.openComponent(flyoutId, metrics, componentName, componentProps);\n        } else {\n            toolbarCtx.closeComponent(flyoutId);\n        }\n        return false;\n    };\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    };\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    };\n    const selected = getSelected(item);\n    const enabled = getEnabled(item);\n    const style = getItemStyle(enabled, selected, size, isMouseOver, vertical);\n    let label: any = item.label;\n    if (vertical === true) {\n        label = <div className=\"rotated-text\"><span className=\"rotated-text__inner rotated-text-ccw\">{item.label}</span></div>;\n    }\n    const ttip = getTooltip(item);\n    const iconEl = getIconElement(item, enabled, size);\n    return <div className={`noselect toolbar-flyout-btn ${selected ? \"selected-item\" : \"\"} ${isMouseOver ? \"mouse-over\" : \"\"}`} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick} style={style} title={ttip}>\n        <div data-flyout-id={`flyout-${item.flyoutId}`}>\n            {iconEl} {label} {getFlyoutIconElement(isFlownOut, size)}\n        </div>\n    </div>;\n};\n\ninterface IFlyoutMenuReferenceItemProps {\n    size: number;\n    menu: IFlyoutMenu;\n    vertical?: boolean;\n    isFlownOut?: boolean;\n}\n\nconst FlyoutMenuReferenceItem = (props: IFlyoutMenuReferenceItemProps) => {\n    const { size, menu, vertical, isFlownOut } = props;\n    const toolbarCtx = React.useContext(ToolbarContext);\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onClick = (e: GenericEvent) => {\n        e.preventDefault();\n        const newState = !!!isFlownOut;\n        if (newState) {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const metrics: IDOMElementMetrics = {\n                posX: rect.left, // e.clientX,\n                posY: rect.top, // e.clientY,\n                width: rect.width, // e.currentTarget.offsetWidth,\n                height: rect.height, // e.currentTarget.offsetHeight\n                vertical: vertical\n            };\n            toolbarCtx.openFlyout(menu.flyoutId, metrics);\n        } else {\n            toolbarCtx.closeFlyout(menu.flyoutId);\n        }\n        return false;\n    }\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    };\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    };\n    const selected = getSelected(menu);\n    const enabled = getEnabled(menu);\n    const style = getItemStyle(enabled, selected, size, isMouseOver, vertical);\n    let label: any = menu.label;\n    if (vertical === true) {\n        label = <div className=\"rotated-text\"><span className=\"rotated-text__inner rotated-text-ccw\">{menu.label}</span></div>;\n    }\n    let align = menu.flyoutAlign;\n    if (!align) {\n        align = (vertical === true) ? \"right bottom\" : \"bottom right\";\n    }\n    const ttip = getTooltip(menu);\n    const iconEl = getIconElement(menu, enabled, size);\n    return <div className={`noselect toolbar-flyout-btn ${selected ? \"selected-item\" : \"\"} ${isMouseOver ? \"mouse-over\" : \"\"}`} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick} style={style} title={ttip}>\n        <div data-flyout-id={`flyout-${menu.flyoutId}`}>\n            {iconEl} {label} {getFlyoutIconElement(isFlownOut, size)}\n        </div>\n    </div>;\n};\n\ninterface IToolbarSeparatorProps {\n    size: number;\n    vertical?: boolean;\n}\n\nconst ToolbarSeparator = (props: IToolbarSeparatorProps) => {\n    const style = getToolbarSeparatorItemStyle(props.vertical);\n    if (props.vertical === true) {\n        return <div className=\"noselect toolbar-separator-vertical\" style={style} />;\n    } else {\n        return <div className=\"noselect toolbar-separator-horizontal\" style={style}>{Constants.NBSP}</div>;\n    }\n}\n\ninterface IToolbarButtonProps {\n    height: number;\n    item: IItem;\n    vertical?: boolean;\n    hideVerticalLabels?: boolean;\n}\n\nconst ToolbarButton = (props: IToolbarButtonProps) => {\n    const { height, item, vertical, hideVerticalLabels } = props;\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    }\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    }\n    const onClick = (e: any) => {\n        e.preventDefault();\n        const { item } = props;\n        const enabled = getEnabled(item);\n        if (enabled && item.invoke) {\n            item.invoke();\n        }\n        return false;\n    }\n    const selected = getSelected(item);\n    const enabled = getEnabled(item);\n    const style = getItemStyle(enabled, selected, height, isMouseOver, vertical);\n    let ttip = null;\n    if (typeof (item.tooltip) == 'function') {\n        ttip = item.tooltip();\n    } else {\n        ttip = item.tooltip;\n    }\n    const iconEl = getIconElement(item, enabled, height);\n    return <div className={`noselect toolbar-btn ${selected ? \"selected-item\" : \"\"} ${(isMouseOver && enabled) ? \"mouse-over\" : \"\"}`} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} style={style} title={ttip} onClick={onClick}>\n        {iconEl} {(vertical == true && hideVerticalLabels == true) ? null : item.label}\n    </div>;\n}\n\nexport interface IItem {\n    label?: string | (() => string);\n    tooltip?: string | (() => string);\n    icon?: string;\n    iconClass?: string;\n    bpIconName?: BlueprintSvgIconNames;\n    invoke?: () => void;\n    enabled?: boolean | (() => boolean);\n    selected?: boolean | (() => boolean);\n    isSeparator?: boolean;\n}\n\nexport interface IInlineMenu extends IItem {\n    childItems: IItem[];\n    flyoutAlign?: string;\n}\n\nexport interface IFlyoutMenu extends IItem {\n    flyoutId: string;\n    flyoutAlign?: string;\n}\n\nexport interface IComponentFlyoutItem extends IItem {\n    flyoutId: string;\n    componentName: string;\n    componentProps?: any;\n}\n\nexport interface IContainerItem extends IItem {\n    renderContainerContent: () => JSX.Element;\n}\n\n/**\n * Toolbar component props\n *\n * @export\n * @interface IToolbarProps\n */\nexport interface IToolbarProps {\n    childItems: IItem[];\n    containerClass?: string;\n    containerStyle?: React.CSSProperties;\n    vertical?: boolean;\n    hideVerticalLabels?: boolean;\n    onOpenFlyout?: (id: string, metrics: IDOMElementMetrics) => void;\n    onCloseFlyout?: (id: string) => void;\n    onOpenComponent?: (id: string, metrics: IDOMElementMetrics, name: string, props?: any) => void;\n    onCloseComponent?: (id: string) => void;\n    flyoutStates?: FlyoutVisibilitySet;\n}\n\n/**\n * A generic toolbar component\n * @param props \n */\nexport const Toolbar = (props: IToolbarProps) => {\n    const {\n        containerStyle,\n        containerClass,\n        childItems,\n        vertical,\n        hideVerticalLabels,\n        flyoutStates,\n        onOpenFlyout,\n        onCloseFlyout,\n        onOpenComponent,\n        onCloseComponent\n    } = props;\n    const openFlyout = (id: string, metrics: IDOMElementMetrics) => onOpenFlyout?.(id, metrics);\n    const closeFlyout = (id: string) => onCloseFlyout?.(id);\n    const openComponent = (id: string, metrics: IDOMElementMetrics, name: string, props?: any) => onOpenComponent?.(id, metrics, name, props);\n    const closeComponent = (id: string) => onCloseComponent?.(id);\n    let height = DEFAULT_TOOLBAR_SIZE;\n    if (containerStyle) {\n        const ch = containerStyle.height;\n        if (typeof (ch) == 'number') {\n            height = ch;\n        }\n    }\n    const providerImpl = {\n        openFlyout: openFlyout,\n        closeFlyout: closeFlyout,\n        openComponent: openComponent,\n        closeComponent: closeComponent\n    };\n    return <ToolbarContext.Provider value={providerImpl}>\n        <div style={containerStyle} className={`has-flyout noselect ${containerClass}`}>\n            {childItems.map((item, index) => {\n                if (isComponentFlyout(item)) {\n                    const isFlownOut = flyoutStates && !!flyoutStates[item.flyoutId];\n                    return <ComponentFlyoutItem key={index} size={height} item={item} vertical={vertical} isFlownOut={isFlownOut} />;\n                } else if (isMenuRef(item)) {\n                    const isFlownOut = flyoutStates && !!flyoutStates[item.flyoutId];\n                    return <FlyoutMenuReferenceItem key={index} size={height} menu={item} vertical={vertical} isFlownOut={isFlownOut} />;\n                } else if (item.isSeparator === true) {\n                    return <ToolbarSeparator key={index} size={height} vertical={vertical} />;\n                } else {\n                    return <ToolbarButton key={index} height={height} item={item} vertical={vertical} hideVerticalLabels={hideVerticalLabels} />;\n                }\n            })}\n        </div>\n    </ToolbarContext.Provider>;\n}","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport {\n    ICommand,\n    IDOMElementMetrics,\n    IBranchedMapSubState,\n    FlyoutVisibilitySet\n} from \"../api/common\";\nimport { IItem } from \"../components/toolbar\";\nimport { TaskPane, TASK_PANE_OVERLAY_BGCOLOR } from \"../components/task-pane\";\nimport * as MapActions from \"../actions/map\";\nimport * as TaskPaneActions from \"../actions/taskpane\";\nimport { areUrlsSame, ensureParameters } from \"../utils/url\";\nimport { tr } from \"../api/i18n\";\nimport * as FlyoutActions from \"../actions/flyout\";\nimport { NonIdealState } from '@blueprintjs/core';\nimport { useActiveMapBranch, useViewerFlyouts, useTaskPaneInitialUrl, useTaskPaneLastUrlPushed, useTaskPaneNavigationIndex, useTaskPaneNavigationStack, useConfiguredCapabilities, useViewerLocale } from './hooks';\n\nexport interface ITaskPaneContainerProps {\n    maxHeight?: number;\n    isResizing?: boolean;\n}\n\ninterface ITaskPaneContainerState {\n    map: IBranchedMapSubState | undefined;\n    initialUrl: string | undefined;\n    navIndex: number;\n    navigationStack: string[];\n    locale: string;\n    flyouts: any;\n    lastUrlPushed: boolean;\n    hasTaskBar: boolean;\n}\n\ninterface ITaskPaneDispatch {\n    invokeCommand: (cmd: ICommand, parameters?: any) => void;\n    goHome: () => void;\n    goForward: () => void;\n    goBack: () => void;\n    pushUrl: (url: string, silent?: boolean) => void;\n    openFlyout: (id: string, metrics: IDOMElementMetrics) => void;\n    closeFlyout: (id: string) => void;\n}\n\ntype TaskPaneProps = ITaskPaneContainerProps & ITaskPaneContainerState & ITaskPaneDispatch;\n\nclass TaskPaneContainerInner extends React.Component<TaskPaneProps, any> {\n    private homeAction: IItem;\n    private backAction: IItem;\n    private forwardAction: IItem;\n    constructor(props: TaskPaneProps) {\n        super(props);\n        const locale = this.getLocale();\n        this.homeAction = {\n            bpIconName: \"home\",\n            tooltip: tr(\"TT_GO_HOME\", locale),\n            enabled: this.canGoHome,\n            invoke: () => this.props.goHome?.()\n        };\n        this.backAction = {\n            bpIconName: \"arrow-left\",\n            tooltip: tr(\"TT_GO_BACK\", locale),\n            enabled: this.canGoBack,\n            invoke: () => this.props.goBack?.()\n        };\n        this.forwardAction = {\n            bpIconName: \"arrow-right\",\n            tooltip: tr(\"TT_GO_FORWARD\", locale),\n            enabled: this.canGoForward,\n            invoke: () => this.props.goForward?.()\n        };\n    }\n    private getLocale(): string {\n        return this.props.locale;\n    }\n    private onCloseFlyout = (id: string) => this.props.closeFlyout?.(id);\n    private onOpenFlyout = (id: string, metrics: IDOMElementMetrics) => this.props.openFlyout?.(id, metrics);\n    private onUrlLoaded = (url: string) => {\n        const { navigationStack, navIndex, pushUrl } = this.props;\n        const currentUrl = navigationStack[navIndex];\n        if (!areUrlsSame(currentUrl, url)) {\n            pushUrl?.(url);\n        }\n    }\n    private canGoHome = (): boolean => {\n        const { initialUrl, navigationStack, navIndex, map } = this.props;\n        if (initialUrl) { //An initial URL was set\n            const initUrl = map && map.runtimeMap && initialUrl\n                ? ensureParameters(initialUrl, map.runtimeMap.Name, map.runtimeMap.SessionId, this.getLocale())\n                : initialUrl;\n            return navigationStack.length > 0 //We have a navigation stack\n                && !areUrlsSame(navigationStack[navIndex], initUrl); //The current URL is not initial.\n        }\n        return false;\n    }\n    private canGoBack = (): boolean => {\n        const { navIndex } = this.props;\n        return navIndex > 0;\n    }\n    private canGoForward = (): boolean => {\n        const { navigationStack, navIndex } = this.props;\n        return navIndex < navigationStack.length - 1;\n    }\n    render(): JSX.Element {\n        const { navigationStack, navIndex, hasTaskBar, lastUrlPushed, map, maxHeight, flyouts, isResizing } = this.props;\n        if (map && map.runtimeMap) {\n            if (navigationStack[navIndex]) {\n                const flyoutStates: FlyoutVisibilitySet = {};\n                if (flyouts) {\n                    const ids = Object.keys(flyouts);\n                    for (const fid of ids) {\n                        flyoutStates[fid] = !!flyouts[fid].open;\n                    }\n                }\n                return <div>\n                    <TaskPane currentUrl={navigationStack[navIndex]}\n                        showTaskBar={hasTaskBar}\n                        lastUrlPushed={lastUrlPushed}\n                        homeAction={this.homeAction}\n                        backAction={this.backAction}\n                        onOpenFlyout={this.onOpenFlyout}\n                        onCloseFlyout={this.onCloseFlyout}\n                        forwardAction={this.forwardAction}\n                        session={map.runtimeMap.SessionId}\n                        mapName={map.runtimeMap.Name}\n                        onUrlLoaded={this.onUrlLoaded}\n                        maxHeight={maxHeight}\n                        flyoutStates={flyoutStates}\n                        locale={this.getLocale()} />\n                    {(() => {\n                        if (isResizing == true) {\n                            return <div style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, backgroundColor: TASK_PANE_OVERLAY_BGCOLOR }}>\n                                <NonIdealState\n                                    icon=\"arrows-horizontal\"\n                                    description={tr(\"TASK_PANE_RESIZING\", this.getLocale())} />\n                            </div>\n                        }\n                    })()}\n                </div>\n            }\n        }\n        return <noscript />;\n    }\n}\n\nconst TaskPaneContainer = (props: ITaskPaneContainerProps) => {\n    const locale = useViewerLocale();\n    const map = useActiveMapBranch();\n    const flyouts = useViewerFlyouts();\n    const initialUrl = useTaskPaneInitialUrl();\n    const lastUrlPushed = useTaskPaneLastUrlPushed();\n    const navIndex = useTaskPaneNavigationIndex();\n    const navigationStack = useTaskPaneNavigationStack();\n    const hasTaskBar = useConfiguredCapabilities().hasTaskBar;\n\n    const dispatch = useDispatch();\n    const invokeCommand = (cmd: ICommand, parameters: any) => dispatch(MapActions.invokeCommand(cmd, parameters));\n    const goHome = () => dispatch(TaskPaneActions.goHome());\n    const goForward = () => dispatch(TaskPaneActions.goForward());\n    const goBack = () => dispatch(TaskPaneActions.goBack());\n    const pushUrl = (url: string, silent?: boolean) => dispatch(TaskPaneActions.pushUrl(url, silent));\n    const openFlyout = (id: string, metrics: IDOMElementMetrics) => dispatch(FlyoutActions.openFlyout(id, metrics));\n    const closeFlyout = (id: string) => dispatch(FlyoutActions.closeFlyout(id));\n\n    return <TaskPaneContainerInner map={map}\n        locale={locale}\n        flyouts={flyouts}\n        initialUrl={initialUrl}\n        lastUrlPushed={lastUrlPushed}\n        navIndex={navIndex}\n        navigationStack={navigationStack}\n        invokeCommand={invokeCommand}\n        hasTaskBar={hasTaskBar}\n        goHome={goHome}\n        goForward={goForward}\n        goBack={goBack}\n        pushUrl={pushUrl}\n        openFlyout={openFlyout}\n        closeFlyout={closeFlyout}\n        {...props} />;\n};\n\nexport default TaskPaneContainer;","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport {\n    GenericEvent,\n    UnitOfMeasure\n} from \"../api/common\";\nimport * as MapActions from \"../actions/map\";\nimport { tr } from \"../api/i18n\";\nimport { LAYER_ID_BASE, LAYER_ID_MG_BASE, LAYER_ID_MG_SEL_OVERLAY } from \"../constants/index\";\nimport { getUnits, getUnitOfMeasure } from \"../utils/units\";\nimport { Slider, HTMLSelect } from '@blueprintjs/core';\nimport { useActiveMapName, useViewerFeatureTooltipsEnabled, useConfiguredManualFeatureTooltips, useViewerSizeUnits, useViewerLocale, useActiveMapLayerTransparency, useActiveMapExternalBaseLayers } from './hooks';\n\nexport interface IViewerOptionsProps {\n\n}\n\nconst ViewerOptions = () => {\n    const externalBaseLayers = useActiveMapExternalBaseLayers();\n    const mapName = useActiveMapName();\n    const layerTransparency = useActiveMapLayerTransparency();\n    const featureTooltipsEnabled = useViewerFeatureTooltipsEnabled();\n    const manualFeatureTooltips = useConfiguredManualFeatureTooltips();\n    const viewSizeUnits = useViewerSizeUnits();\n    const locale = useViewerLocale();\n    const dispatch = useDispatch();\n    const toggleManualMapTips = (enabled: boolean) => dispatch(MapActions.setManualFeatureTooltipsEnabled(enabled));\n    const toggleMapTips = (enabled: boolean) => dispatch(MapActions.setFeatureTooltipsEnabled(enabled));\n    const setLayerTransparency = (mapName: string, id: string, opacity: number) => dispatch(MapActions.setLayerTransparency(mapName, id, opacity));\n    const setViewSizeDisplayUnits = (units: UnitOfMeasure) => dispatch(MapActions.setViewSizeUnits(units));\n    const onMgLayerOpacityChanged = (mapName: string | undefined, layerId: string, value: number) => {\n        if (mapName) {\n            setLayerTransparency?.(mapName, layerId, value);\n        }\n    };\n    const onBaseOpacityChanged = (value: number) => {\n        onMgLayerOpacityChanged(mapName, LAYER_ID_BASE, value);\n    };\n    const onMgOpacityChanged = (value: number) => {\n        onMgLayerOpacityChanged(mapName, LAYER_ID_MG_BASE, value);\n    };\n    const onMgSelOpacityChanged = (value: number) => {\n        onMgLayerOpacityChanged(mapName, LAYER_ID_MG_SEL_OVERLAY, value);\n    };\n    const onViewSizeUnitsChanged = (e: GenericEvent) => {\n        setViewSizeDisplayUnits(e.target.value);\n    };\n    const onFeatureTooltipsChanged = (e: GenericEvent) => {\n        toggleMapTips(e.target.checked);\n    };\n    const onManualFeatureTooltipsChanged = (e: GenericEvent) => {\n        toggleManualMapTips(e.target.checked);\n    };\n    const units = getUnits();\n    let opBase = 1.0;\n    let opMgBase = 1.0;\n    let opMgSelOverlay = 1.0;\n    if (layerTransparency) {\n        if (LAYER_ID_BASE in layerTransparency) {\n            opBase = layerTransparency[LAYER_ID_BASE];\n        }\n        if (LAYER_ID_MG_BASE in layerTransparency) {\n            opMgBase = layerTransparency[LAYER_ID_MG_BASE];\n        }\n        if (LAYER_ID_MG_SEL_OVERLAY in layerTransparency) {\n            opMgSelOverlay = layerTransparency[LAYER_ID_MG_SEL_OVERLAY];\n        }\n    }\n    return <div className=\"component-viewer-options\">\n        <h5>{tr(\"VIEWER_OPTIONS\", locale)}</h5>\n        <hr />\n        <label className=\"bp3-control bp3-switch\">\n            <input type=\"checkbox\" checked={featureTooltipsEnabled} onChange={onFeatureTooltipsChanged} />\n            <span className=\"bp3-control-indicator\"></span>\n            {tr(\"FEATURE_TOOLTIPS\", locale)}\n        </label>\n        {(() => {\n            if (featureTooltipsEnabled) {\n                return <label className=\"bp3-control bp3-switch\">\n                    <input type=\"checkbox\" checked={manualFeatureTooltips} onChange={onManualFeatureTooltipsChanged} />\n                    <span className=\"bp3-control-indicator\"></span>\n                    {tr(\"MANUAL_FEATURE_TOOLTIPS\", locale)}\n                </label>;\n            }\n        })()}\n        <fieldset>\n            <legend>{tr(\"LAYER_TRANSPARENCY\", locale)}</legend>\n            {(() => {\n                if (externalBaseLayers) {\n                    return <label className=\"bp3-label noselect\">\n                        {tr(\"LAYER_ID_BASE\", locale)}\n                        <div style={{ paddingLeft: 8, paddingRight: 8 }}>\n                            <Slider min={0} max={1.0} stepSize={0.01} value={opBase} onChange={onBaseOpacityChanged} />\n                        </div>\n                    </label>;\n                }\n            })()}\n            <label className=\"bp3-label noselect\">\n                {tr(\"LAYER_ID_MG_BASE\", locale)}\n                <div style={{ paddingLeft: 8, paddingRight: 8 }}>\n                    <Slider min={0} max={1.0} stepSize={0.01} value={opMgBase} onChange={onMgOpacityChanged} />\n                </div>\n            </label>\n            <label className=\"bp3-label noselect\">\n                {tr(\"LAYER_ID_MG_SEL_OVERLAY\", locale)}\n                <div style={{ paddingLeft: 8, paddingRight: 8 }}>\n                    <Slider min={0} max={1.0} stepSize={0.01} value={opMgSelOverlay} onChange={onMgSelOpacityChanged} />\n                </div>\n            </label>\n        </fieldset>\n        <label className=\"bp3-label\">\n            {tr(\"MAP_SIZE_DISPLAY_UNITS\", locale)}\n            <div className=\"bp3-select\">\n                <HTMLSelect value={viewSizeUnits} onChange={onViewSizeUnitsChanged}>\n                    {units.map(u => {\n                        const [uom] = u;\n                        const ui = getUnitOfMeasure(uom);\n                        return <option key={uom} value={uom}>{ui.localizedName(locale)}</option>;\n                    })}\n                </HTMLSelect>\n            </div>\n        </label>\n    </div>;\n};\n\nexport default ViewerOptions;","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { BaseLayerSwitcher } from \"../components/base-layer-switcher\";\nimport * as MapActions from \"../actions/map\";\nimport { useActiveMapName, useViewerLocale, useActiveMapExternalBaseLayers } from './hooks';\n\nexport interface IBaseLayerSwitcherContainerProps {\n\n}\n\nconst BaseLayerSwitcherContainer = () => {\n    const mapName = useActiveMapName();\n    const locale = useViewerLocale();\n    const externalBaseLayers = useActiveMapExternalBaseLayers();\n    const dispatch = useDispatch();\n    const setBaseLayer = (mapName: string, layerName: string) => dispatch(MapActions.setBaseLayer(mapName, layerName));\n    const onBaseLayerChanged = (layerName: string) => {\n        if (mapName) {\n            setBaseLayer?.(mapName, layerName);\n        }\n    }\n    if (locale && externalBaseLayers) {\n        return <BaseLayerSwitcher onBaseLayerChanged={onBaseLayerChanged} externalBaseLayers={externalBaseLayers} locale={locale} />;\n    } else {\n        return <noscript />;\n    }\n}\n\nexport default BaseLayerSwitcherContainer;","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { MapMenu } from \"../components/map-menu\";\nimport * as MapActions from \"../actions/map\";\nimport { useViewerLocale, useActiveMapName, useAvailableMaps } from './hooks';\n\nconst MapMenuContainer = () => {\n    const dispatch = useDispatch();\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const availableMaps = useAvailableMaps();\n    const setActiveMap = (mapName: string) => dispatch(MapActions.setActiveMap(mapName));\n    const onActiveMapChanged = (mapName: string) => setActiveMap(mapName);\n    if (locale && activeMapName && availableMaps) {\n        //TODO: Should use MapGroup id has label. For now, use map name for both\n        const entries = availableMaps.map(m => {\n            return { label: m.name, mapName: m.value };\n        });\n        return <MapMenu onActiveMapChanged={onActiveMapChanged} selectedMap={activeMapName} maps={entries} locale={locale} />;\n    } else {\n        return <noscript />;\n    }\n}\n\nexport default MapMenuContainer;","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\nimport * as olProj from \"ol/proj\";\nimport { Callout, Intent, Elevation, Card } from '@blueprintjs/core';\nimport { useViewerLocale, useCurrentMouseCoordinates, useActiveMapProjection } from './hooks';\n\nexport interface ICoordinateTrackerContainerProps {\n    projections: string[];\n}\n\n\nconst CoordinateTrackerContainer = (props: ICoordinateTrackerContainerProps) => {\n    const { projections } = props;\n    const locale = useViewerLocale();\n    const mouse = useCurrentMouseCoordinates();\n    const proj = useActiveMapProjection();\n    if (projections && projections.length) {\n        return <div style={{ margin: 8 }}>\n            <h4 className=\"bp3-heading\">{tr(\"COORDTRACKER\", locale)}</h4>\n            {projections.map(p => {\n                let x = NaN;\n                let y = NaN;\n                if (mouse && proj) {\n                    try {\n                        [x, y] = olProj.transform(mouse, proj, p);\n                    } catch (e) {\n\n                    }\n                }\n                return <Card style={{ marginBottom: 10 }}>\n                    <h5 className=\"bp3-heading\"><a href=\"#\">{p}</a></h5>\n                    <p><strong>X:</strong> {x}</p>\n                    <p><strong>Y:</strong> {y}</p>\n                </Card>;\n            })}\n        </div>;\n    } else {\n        return <Callout intent={Intent.DANGER} title={tr(\"ERROR\", locale)} icon=\"error\">\n            {tr(\"COORDTRACKER_NO_PROJECTIONS\", locale)}\n        </Callout>;\n    }\n}\n\nexport default CoordinateTrackerContainer;","import * as React from \"react\";\nimport * as Runtime from \"../api/runtime\";\nimport { tr } from \"../api/i18n\";\nimport { ILayerInfo, Bounds, LayerProperty } from \"../api/common\";\nimport { IVectorFeatureStyle } from \"../api/ol-style-helpers\";\nimport { ManageLayers } from \"../components/layer-manager/manage-layers\";\nimport { AddLayer } from \"../components/layer-manager/add-layer\";\nimport { Tabs, Tab, Icon } from '@blueprintjs/core';\nimport * as MapActions from \"../actions/map\";\nimport { useViewerLocale, useActiveMapName, useActiveMapLayers, useActiveMapView } from './hooks';\nimport olVectorLayer from \"ol/layer/Vector\";\nimport { transformExtent } from \"ol/proj\";\nimport { useDispatch } from 'react-redux';\n\n/**\n * \n * @since 0.11\n * @export\n * @interface IAddManageLayersContainerProps\n */\nexport interface IAddManageLayersContainerProps {\n\n}\n\nconst AddManageLayersContainer = () => {\n    const dispatch = useDispatch();\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const layers = useActiveMapLayers();\n    const view = useActiveMapView();\n    const getLayerIndex = (layerName: string) => {\n        if (layers) {\n            for (let i = 0; i < layers.length; i++) {\n                if (layers[i].name == layerName) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    };\n    const onLayerAdded = (layer: ILayerInfo) => {\n        if (activeMapName) {\n            dispatch(MapActions.mapLayerAdded(activeMapName, layer));\n        }\n    };\n    const onAddLayerBusyWorker = (name: string) => {\n        if (activeMapName) {\n            dispatch(MapActions.addMapLayerBusyWorker(activeMapName, name));\n        }\n    }\n    const onRemoveLayerBusyWorker = (name: string) => {\n        if (activeMapName) {\n            dispatch(MapActions.removeMapLayerBusyWorker(activeMapName, name));\n        }\n    };\n    const removeHandler = (layerName: string) => {\n        if (activeMapName) {\n            dispatch(MapActions.removeMapLayer(activeMapName, layerName));\n        }\n    };\n    const upHandler = (layerName: string) => {\n        const newIndex = getLayerIndex(layerName);\n        if (activeMapName && newIndex >= 0) {\n            dispatch(MapActions.setMapLayerIndex(activeMapName, layerName, newIndex - 1));\n        }\n    };\n    const downHandler = (layerName: string) => {\n        const newIndex = getLayerIndex(layerName);\n        if (layers && activeMapName && newIndex < layers.length - 1) {\n            dispatch(MapActions.setMapLayerIndex(activeMapName, layerName, newIndex + 1));\n        }\n    };\n    const zoomToBounds = (layerName: string) => {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const layer = viewer.getLayerManager().getLayer(layerName);\n            // If the layer has a WGS84 bbox, we'll use that\n            const ll_bbox = layer?.get(LayerProperty.WGS84_BBOX);\n            if (ll_bbox) {\n                const zoomBounds = transformExtent(ll_bbox, \"EPSG:4326\", viewer.getProjection());\n                viewer.zoomToExtent(zoomBounds as Bounds);\n            } else if (layer instanceof olVectorLayer) {\n                const source = layer.getSource();\n                let bounds = source.getExtent();\n                const sp = source.getProjection();\n                const dp = viewer.getProjection();\n                if (sp && dp) {\n                    bounds = transformExtent(bounds, sp, dp);\n                }\n                viewer.zoomToExtent(bounds as Bounds);\n            }\n        }\n    };\n    const setVisibility = (layerName: string, visible: boolean) => {\n        if (activeMapName) {\n            dispatch(MapActions.setMapLayerVisibility(activeMapName, layerName, visible));\n        }\n    };\n    const setOpacity = (layerName: string, value: number) => {\n        if (activeMapName) {\n            dispatch(MapActions.setMapLayerOpacity(activeMapName, layerName, value));\n        }\n    };\n    const updateVectorStyle = (layerName: string, value: IVectorFeatureStyle) => {\n        if (activeMapName) {\n            dispatch(MapActions.setMapLayerVectorStyle(activeMapName, layerName, value));\n        }\n    }\n    if (layers) {\n        return <div style={{ padding: 8 }}>\n            <Tabs id=\"tabs\" renderActiveTabPanelOnly={true}>\n                <Tab id=\"add_layer\" title={<span><Icon icon=\"new-layer\" iconSize={Icon.SIZE_STANDARD} /> {tr(\"ADD_LAYER\", locale)}</span>} panel={<AddLayer onLayerAdded={onLayerAdded} onAddLayerBusyWorker={onAddLayerBusyWorker} onRemoveLayerBusyWorker={onRemoveLayerBusyWorker} locale={locale} />} />\n                <Tab id=\"manage_layers\" title={<span><Icon icon=\"layers\" iconSize={Icon.SIZE_STANDARD} /> {tr(\"MANAGE_LAYERS\", locale)}</span>} panel={<ManageLayers layers={layers}\n                    locale={locale}\n                    currentResolution={view?.resolution}\n                    onSetOpacity={setOpacity}\n                    onSetVisibility={setVisibility}\n                    onZoomToBounds={zoomToBounds}\n                    onMoveLayerDown={downHandler}\n                    onMoveLayerUp={upHandler}\n                    onRemoveLayer={removeHandler}\n                    onVectorStyleChanged={updateVectorStyle} />} />\n            </Tabs>\n        </div>;\n    } else {\n        return <></>;\n    }\n};\n\nexport default AddManageLayersContainer;","import * as React from \"react\";\nimport { IVectorFeatureStyle, IBasicVectorPointStyle, IBasicVectorLineStyle, IBasicVectorPolygonStyle, IBasicPointCircleStyle, DEFAULT_POINT_STYLE, DEFAULT_LINE_STYLE, DEFAULT_POLY_STYLE } from '../api/ol-style-helpers';\nimport { NonIdealState, Tabs, Tab, FormGroup, NumericInput, Slider } from '@blueprintjs/core';\nimport { tr } from \"../api/i18n\";\nimport { ColorPicker } from './color-picker';\n\ninterface ISubStyleEditorProps<TStyle> {\n    style: TStyle;\n    locale: string;\n    onChange: (style: TStyle) => void;\n}\n\nconst PointStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicVectorPointStyle>) => {\n    return <div>\n        <FormGroup label={tr(\"VSED_PT_FILL_COLOR\", locale)}>\n            <ColorPicker locale={locale} value={style.fill.color} onChange={c => onChange({ ...style, fill: { color: c, alpha: style.fill.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_FILL_COLOR_ALPHA\", locale)}>\n            <Slider min={0} max={255} labelStepSize={255} value={style.fill.alpha} onChange={n => onChange({ ...style, fill: { color: style.fill.color, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_RADIUS\", locale)}>\n            <NumericInput fill value={style.radius} min={1} onValueChange={n => onChange({ ...style, radius: n })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_OUTLINE_COLOR\", locale)}>\n            <ColorPicker locale={locale} value={style.stroke.color} onChange={c => onChange({ ...style, stroke: { color: c, width: style.stroke.width, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_OUTLINE_COLOR_ALPHA\", locale)}>\n            <Slider min={0} max={255} labelStepSize={255} value={style.stroke.alpha} onChange={n => onChange({ ...style, stroke: { color: style.stroke.color, width: style.stroke.width, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_OUTLINE_WIDTH\", locale)}>\n            <NumericInput fill value={style.stroke.width} min={1} onValueChange={n => onChange({ ...style, stroke: { color: style.stroke.color, width: n, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n    </div>;\n}\n\nconst LineStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicVectorLineStyle>) => {\n    return <div>\n        <FormGroup label={tr(\"VSED_LN_OUTLINE_COLOR\", locale)}>\n            <ColorPicker locale={locale} value={style.color} onChange={c => onChange({ color: c, width: style.width, alpha: style.alpha })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_LN_OUTLINE_COLOR_ALPHA\", locale)}>\n            <Slider min={0} max={255} labelStepSize={255} value={style.alpha} onChange={n => onChange({ color: style.color, width: style.width, alpha: n })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_LN_OUTLINE_THICKNESS\", locale)}>\n            <NumericInput fill value={style.width} min={1} onValueChange={n => onChange({ color: style.color, width: n, alpha: style.alpha })} />\n        </FormGroup>\n    </div>;\n}\n\nconst PolygonStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicVectorPolygonStyle>) => {\n    return <div>\n        <FormGroup label={tr(\"VSED_PL_FILL_COLOR\", locale)}>\n            <ColorPicker locale={locale} value={style.fill.color} onChange={c => onChange({ ...style, fill: { color: c, alpha: style.fill.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_FILL_COLOR_ALPHA\", locale)}>\n            <Slider min={0} max={255} labelStepSize={255} value={style.fill.alpha} onChange={n => onChange({ ...style, fill: { color: style.fill.color, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_OUTLINE_COLOR\", locale)}>\n            <ColorPicker locale={locale} value={style.stroke.color} onChange={c => onChange({ ...style, stroke: { color: c, width: style.stroke.width, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_OUTLINE_COLOR_ALPHA\", locale)}>\n            <Slider min={0} max={255} labelStepSize={255} value={style.stroke.alpha} onChange={n => onChange({ ...style, stroke: { color: style.stroke.color, width: style.stroke.width, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_OUTLINE_THICKNESS\", locale)}>\n            <NumericInput fill value={style.stroke.width} min={1} onValueChange={n => onChange({ ...style, stroke: { color: style.stroke.color, width: n, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n    </div>;\n}\n\n/**\n * Vector style editor props\n * @since 0.13\n */\nexport interface IVectorStyleEditorProps {\n    style?: IVectorFeatureStyle;\n    onChange?: (style: IVectorFeatureStyle) => void;\n    enablePoint: boolean;\n    enableLine: boolean;\n    enablePolygon: boolean;\n    locale: string;\n}\n\ntype TabId = \"pointStyle\" | \"lineStyle\" | \"polyStyle\";\n\n/**\n * A vector style editor component\n * \n * @since 0.13\n */\nexport const VectorStyleEditor = (props: IVectorStyleEditorProps) => {\n    const { locale, style, onChange, enableLine, enablePoint, enablePolygon } = props;\n    const [selectedTab, setSelectedTab] = React.useState<TabId | undefined>(undefined);\n    const [pointStyle, setPointStyle] = React.useState(style?.point ?? DEFAULT_POINT_STYLE);\n    const [lineStyle, setLineStyle] = React.useState(style?.line ?? DEFAULT_LINE_STYLE);\n    const [polyStyle, setPolyStyle] = React.useState(style?.polygon ?? DEFAULT_POLY_STYLE);\n    React.useEffect(() => {\n        setPointStyle(style?.point ?? DEFAULT_POINT_STYLE);\n        setLineStyle(style?.line ?? DEFAULT_LINE_STYLE);\n        setPolyStyle(style?.polygon ?? DEFAULT_POLY_STYLE);\n    }, [style]);\n    const onStyleChanged = (point: IBasicPointCircleStyle, line: IBasicVectorLineStyle, poly: IBasicVectorPolygonStyle) => {\n        const newStyle: IVectorFeatureStyle = {};\n        if (enablePoint) {\n            newStyle.point = point;\n        }\n        if (enableLine) {\n            newStyle.line = line;\n        }\n        if (enablePolygon) {\n            newStyle.polygon = poly;\n        }\n        onChange?.(newStyle);\n        if (newStyle.point) {\n            setPointStyle(newStyle.point);\n        }\n        if (newStyle.line) {\n            setLineStyle(newStyle.line);\n        }\n        if (newStyle.polygon) {\n            setPolyStyle(newStyle.polygon);\n        }\n    };\n    if (!enableLine && !enablePoint && !enablePolygon) {\n        return <NonIdealState icon=\"warning-sign\" title={tr(\"VSED_NO_STYLES_TITLE\", locale)} description={tr(\"VSED_NO_STYLES_DESC\", locale)} />\n    } else {\n        const onPointStyleChanged = (st: IBasicPointCircleStyle) => {\n            onStyleChanged(st, lineStyle, polyStyle);\n        };\n        const onLineStyleChanged = (st: IBasicVectorLineStyle) => {\n            onStyleChanged(pointStyle, st, polyStyle);\n        };\n        const onPolygonStyleChanged = (st: IBasicVectorPolygonStyle) => {\n            onStyleChanged(pointStyle, lineStyle, st);\n        };\n        return <Tabs onChange={(t: any) => setSelectedTab(t)} selectedTabId={selectedTab}>\n            {enablePoint && <Tab id=\"pointStyle\" title={tr(\"VSED_TAB_POINT\", locale)} panel={<PointStyleEditor style={pointStyle} locale={locale} onChange={onPointStyleChanged} />} />}\n            {enableLine && <Tab id=\"lineStyle\" title={tr(\"VSED_TAB_LINE\", locale)} panel={<LineStyleEditor style={lineStyle} locale={locale} onChange={onLineStyleChanged} />} />}\n            {enablePolygon && <Tab id=\"polyStyle\" title={tr(\"VSED_TAB_POLY\", locale)} panel={<PolygonStyleEditor style={polyStyle} locale={locale} onChange={onPolygonStyleChanged} />} />}\n        </Tabs>\n    }\n}","import * as React from \"react\";\nimport { Collapse, Button, Intent, Card } from '@blueprintjs/core';\nimport { DEFAULT_COLOR } from '../api/ol-style-helpers';\nimport { tr } from \"../api/i18n\";\nimport { NBSP } from '../constants';\nconst SimpleColorPicker = require(\"react-simple-colorpicker\");\n\n/**\n * Color picker props\n * \n * @since 0.13\n */\nexport interface IColorPickerProps {\n    value?: string;\n    locale: string;\n    onChange: (value: string) => void;\n}\n\n/**\n * A basic color picker component\n * \n * @since 0.13\n */\nexport const ColorPicker = (props: IColorPickerProps) => {\n    const [isPickerOpen, setIsPickerOpen] = React.useState(false);\n    const onPickerToggle = () => {\n        setIsPickerOpen(!isPickerOpen);\n    };\n    return <div>\n        <button style={{ width: 80, borderRadius: 3, backgroundColor: props.value ?? DEFAULT_COLOR }} onClick={onPickerToggle}>{NBSP}{NBSP}{NBSP}</button>\n        <Collapse isOpen={isPickerOpen}>\n            <Card>\n                <SimpleColorPicker color={props.value ?? DEFAULT_COLOR} onChange={(c: any) => props.onChange(c)} />\n                <Button icon=\"chevron-up\" intent={Intent.PRIMARY} onClick={() => setIsPickerOpen(false)}>{tr(\"ACTION_CLOSE\", props.locale)}</Button>\n            </Card>\n        </Collapse>\n    </div>\n}","import * as React from \"react\";\nimport { UnitOfMeasure } from \"../api/common\";\nimport { ViewSize } from \"../components/view-size\";\nimport { useActiveMapWidth, useActiveMapHeight, useViewerSizeUnits, useActiveMapMetersPerUnit, useActiveMapView, useViewerLocale } from './hooks';\n\nexport interface IViewSizeContainerProps { }\n\nconst ViewSizeContainer = () => {\n    const width = useActiveMapWidth();\n    const height = useActiveMapHeight();\n    const sizeUnits = useViewerSizeUnits();\n    const metersPerUnit = useActiveMapMetersPerUnit();\n    const view = useActiveMapView();\n    const locale = useViewerLocale();\n    if (width && height && metersPerUnit && view) {\n        return <ViewSize locale={locale} width={width} height={height} view={view} metersPerUnit={metersPerUnit} units={sizeUnits || UnitOfMeasure.Unknown} />;\n    } else {\n        return <noscript />;\n    }\n};\n\nexport default ViewSizeContainer;","import { ProjectionLike } from 'ol/proj';\nimport olSourceVector from \"ol/source/Vector\";\nimport Geometry from 'ol/geom/Geometry';\nimport Feature from 'ol/Feature';\n\n/**\n * Defines parsed features\n * \n * @export\n * @interface IParsedFeatures\n * @since 0.13\n */\nexport interface IParsedFeatures {\n    name: string;\n    /**\n     * Indicates if there are any features. If false, it signals that the parsing attempt failed\n     */\n    hasFeatures(): boolean;\n    /**\n     * The projection of this feature. If not set, the projection is unknown and the user should specify\n     * the projection for these features. If set, it should be the projection used when adding the features\n     * to a vector layer\n     */\n    projection: string | null;\n    readonly type: string;\n    readonly size: number;\n    addTo(source: olSourceVector<Geometry>, mapProjection: ProjectionLike, dataProjection?: ProjectionLike): void;\n}\n\nexport class ParsedFeatures implements IParsedFeatures {\n    constructor(public type: string, public size: number, private features: Feature<Geometry>[], public projection: string | null = null) {\n\n    }\n    public hasFeatures(): boolean { return this.features.length > 0; }\n    public name: string;\n    public addTo(source: olSourceVector<Geometry>, mapProjection: ProjectionLike, dataProjection?: ProjectionLike) {\n        if (dataProjection) {\n            for (const f of this.features) {\n                const g = f.getGeometry();\n                const tg = g.transform(dataProjection, mapProjection)\n                f.setGeometry(tg);\n            }\n        }\n        source.addFeatures(this.features);\n    }\n}","import {\n    IConfigurationReducerState,\n    ICoordinateConfiguration,\n    IViewerCapabilities,\n    UnitOfMeasure,\n    KC_ESCAPE, \n    KC_U\n} from \"../api/common\";\nimport * as logger from \"../utils/logger\";\nimport { DEFAULT_LOCALE } from \"../api/i18n\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const CONFIG_INITIAL_STATE: IConfigurationReducerState = {\n    agentUri: undefined,\n    agentKind: \"mapagent\",\n    locale: DEFAULT_LOCALE,\n    activeMapName: undefined,\n    availableMaps: undefined,\n    viewRotation: 0,\n    viewRotationEnabled: true,\n    viewSizeUnits: UnitOfMeasure.Meters,\n    manualFeatureTooltips: false,\n    cancelDigitizationKey: KC_ESCAPE,\n    undoLastPointKey: KC_U,\n    coordinates: {\n        decimals: 6\n    } as ICoordinateConfiguration,\n    viewer: {\n        imageFormat: \"PNG\",\n        selectionImageFormat: \"PNG8\",\n        selectionColor: \"0x0000FFAA\", //Blue\n        activeSelectedFeatureColor: \"0xFF0000AA\", //Red\n        pointSelectionBuffer: 2,\n        loadIndicatorPositioning: \"top\",\n        loadIndicatorColor: \"rgba(34, 153, 221, 0.9)\",\n    },\n    capabilities: {\n        hasTaskPane: false,\n        hasTaskBar: false,\n        hasStatusBar: false,\n        hasNavigator: false,\n        hasSelectionPanel: false,\n        hasLegend: false,\n        hasToolbar: false,\n        hasViewSize: false\n    } as IViewerCapabilities\n};\n\nexport function configReducer(state = CONFIG_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.SET_LOCALE:\n            {\n                return {\n                    ...state,\n                    ...{ locale: action.payload }\n                }\n            }\n        case ActionType.INIT_APP:\n            {\n                const payload: any = action.payload || {};\n                const maps = payload.maps;\n                const availableMaps = [];\n                let am = payload.activeMapName;\n                const mapNames = Object.keys(maps);\n                for (const mapName of mapNames) {\n                    availableMaps.push({ name: maps[mapName].mapGroupId, value: mapName });\n                }\n                if (mapNames.indexOf(am) < 0) {\n                    logger.warn(`Invalid initial active map name: ${am}. Probably because we haven't properly implemented recovery of runtime maps on reload yet`);\n                    am = mapNames[0];\n                }\n                const state1: Partial<IConfigurationReducerState> = {\n                    locale: payload.locale || DEFAULT_LOCALE,\n                    capabilities: payload.capabilities,\n                    activeMapName: am,\n                    availableMaps: availableMaps\n                };\n                const newState: Partial<IConfigurationReducerState> = { ...state, ...state1 };\n                if (payload.config != null && Object.keys(payload.config).length > 0) {\n                    const coordConfig = { ...state.coordinates };\n                    const viewerConfig = { ...state.viewer };\n                    if (payload.config.imageFormat != null) {\n                        viewerConfig.imageFormat = payload.config.imageFormat;\n                    }\n                    if (payload.config.selectionImageFormat != null) {\n                        viewerConfig.selectionImageFormat = payload.config.selectionImageFormat;\n                    }\n                    if (payload.config.selectionColor != null) {\n                        viewerConfig.selectionColor = payload.config.selectionColor;\n                    }\n                    if (payload.config.pointSelectionBuffer != null) {\n                        viewerConfig.pointSelectionBuffer = payload.config.pointSelectionBuffer;\n                    }\n                    if (payload.config.coordinateProjection != null) {\n                        coordConfig.projection = payload.config.coordinateProjection;\n                    }\n                    if (payload.config.coordinateDecimals != null) {\n                        coordConfig.decimals = payload.config.coordinateDecimals;\n                    }\n                    if (payload.config.coordinateDisplayFormat != null) {\n                        coordConfig.format = payload.config.coordinateDisplayFormat;\n                    }\n                    const state2: Partial<IConfigurationReducerState> = { viewer: viewerConfig, coordinates: coordConfig };\n                    if (payload.config.viewSizeUnits != null) {\n                        state2.viewSizeUnits = payload.config.viewSizeUnits;\n                    }\n                    return { ...newState, ...state2 };\n                } else {\n                    return newState;\n                }\n            }\n        case ActionType.MAP_SET_VIEW_ROTATION:\n            {\n                return { ...state, ...{ viewRotation: action.payload } };\n            }\n        case ActionType.MAP_SET_VIEW_ROTATION_ENABLED:\n            {\n                return { ...state, ...{ viewRotationEnabled: action.payload } };\n            }\n        case ActionType.MAP_SET_ACTIVE_MAP:\n            {\n                const data: any = action.payload;\n                if (data) {\n                    const state1: Partial<IConfigurationReducerState> = {\n                        activeMapName: data\n                    };\n                    return { ...state, ...state1 };\n                }\n            }\n        case ActionType.MAP_SET_VIEW_SIZE_UNITS:\n            {\n                return { ...state, ...{ viewSizeUnits: action.payload } };\n            }\n        case ActionType.MAP_SET_MANUAL_MAPTIP:\n            {\n                return { ...state, ...{ manualFeatureTooltips: action.payload } };\n            }\n    }\n    return state;\n}","import {\n    ReducerFunction,\n    ITemplateReducerState,\n    TemplateReducerFunction\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { IElementState, ViewerAction } from '../actions/defs';\n\nexport const TEMPLATE_INITIAL_STATE: ITemplateReducerState = {\n    initialInfoPaneWidth: 250,\n    initialTaskPaneWidth: 300,\n    taskPaneVisible: true,\n    selectionPanelVisible: true,\n    legendVisible: true,\n    autoDisplaySelectionPanelOnSelection: true\n};\n\n/**\n * Checks if the given payload is an element state\n *\n * @export\n * @param {*} args\n * @returns {args is IElementState}\n */\nexport function isElementState(args: any): args is IElementState {\n    return args != null\n        && typeof (args.legendVisible) != 'undefined'\n        && typeof (args.selectionPanelVisible) != 'undefined'\n        && typeof (args.taskPaneVisible) != 'undefined';\n}\n\nlet _ovReducer: TemplateReducerFunction;\n\n/**\n * Installs a custom template reducer function. This is generally used by viewer templates\n * which need to respond to template-related actions in a way that is unique to the template\n *\n * @export\n * @param {ReducerFunction<ITemplateReducerState>} func\n */\nexport function setCustomTemplateReducer(func: TemplateReducerFunction): void {\n    _ovReducer = func;\n}\n\nexport function templateReducer(origState = TEMPLATE_INITIAL_STATE, action: ViewerAction) {\n    let state = origState;\n    //Whether this reducer has been overridden or not, service the MAP_SET_SELECTION action and\n    //if we get modified state, pass that down to the rest of the reducer\n    if (action.type == ActionType.MAP_SET_SELECTION) {\n        const { selection } = action.payload;\n        if (selection && selection.SelectedFeatures) {\n            if (selection.SelectedFeatures.SelectedLayer.length && origState.autoDisplaySelectionPanelOnSelection) {\n                state = {\n                    ...origState,\n                    // The majority of the templates provided have the SelectionPanel/Legend/TaskPane as\n                    // a mutually exclusive visible set, so this new state would be applicable for them.\n                    // For templates that do not, they can fix this state up \"in post\" against the same action\n                    // in their overridden reducer\n                    ...{ selectionPanelVisible: true, legendVisible: false, taskPaneVisible: false }\n                }\n            }\n        }\n    }\n    if (typeof (_ovReducer) == 'function') {\n        return _ovReducer(origState, state, action);\n    } else {\n        //If no template present (they would've overridden this reducer), at least service the actions we know affect this\n        //particular state branch\n        switch (action.type) {\n            case ActionType.FUSION_SET_ELEMENT_STATE:\n                {\n                    if (isElementState(action.payload)) {\n                        return { ...state, ...action.payload };\n                    }\n                    return state;\n                }\n            case ActionType.INIT_APP:\n                {\n                    let state1: Partial<ITemplateReducerState> = {};\n                    if (action.payload.initialTaskPaneWidth) {\n                        state1.initialTaskPaneWidth = action.payload.initialTaskPaneWidth;\n                    }\n                    if (action.payload.initialInfoPaneWidth) {\n                        state1.initialInfoPaneWidth = action.payload.initialInfoPaneWidth;\n                    }\n                    return { ...state, ...state1 };\n                }\n        }\n    }\n    return state;\n}","//import '@storybook/addon-console';\nimport { configure, addParameters } from '@storybook/react';\nimport { INITIAL_VIEWPORTS, DEFAULT_VIEWPORT } from \"@storybook/addon-viewport\";\nimport \"../src/stories/story-bootstrap\";\n\naddParameters({\n  viewport: {\n    viewports: INITIAL_VIEWPORTS,\n    defaultViewport: DEFAULT_VIEWPORT,\n  },\n});\n\nconst req = require.context(\"../src/stories\", true, /.stories.tsx$/);\nfunction loadStories() {\n    req.keys().forEach(req);\n}\nconfigure(loadStories, module);","import { bootstrap } from \"../api\";\nimport { addFormatDriver } from \"../api/layer-manager/driver-registry\";\nimport { CsvFormatDriver, CSV_COLUMN_ALIASES } from \"../api/layer-manager/csv-driver\";\nimport { FormatDriver } from \"../api/layer-manager/format-driver\";\nimport KML from \"ol/format/KML\";\nimport GPX from \"ol/format/GPX\";\nimport IGC from \"ol/format/IGC\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport TopoJSON from \"ol/format/TopoJSON\";\n\n// Bootstrap the viewer\nbootstrap();\naddFormatDriver(new CsvFormatDriver(CSV_COLUMN_ALIASES));\naddFormatDriver(new FormatDriver(\"GeoJSON\", new GeoJSON()));\naddFormatDriver(new FormatDriver(\"TopoJSON\", new TopoJSON()));\naddFormatDriver(new FormatDriver(\"KML\", new KML(), \"EPSG:4326\"));\naddFormatDriver(new FormatDriver(\"GPX\", new GPX(), \"EPSG:4326\"));\naddFormatDriver(new FormatDriver(\"IGC\", new IGC()));","/**\n * @hidden\n */\n\n/** */\n\nexport * from \"./deArrayify\";\nexport * from \"./mapagent\";","export default __webpack_public_path__ + \"static/media/digitizePoint.f8ed6685.cur\";","export default __webpack_public_path__ + \"static/media/digitizeLine.c1c4099e.cur\";","export default __webpack_public_path__ + \"static/media/digitizeLineString.7800225a.cur\";","export default __webpack_public_path__ + \"static/media/digitizeRectangle.8ae03d48.cur\";","export default __webpack_public_path__ + \"static/media/digitizePolygon.eb92719f.cur\";","export default __webpack_public_path__ + \"static/media/digitizeCircle.0c40decd.cur\";","export default __webpack_public_path__ + \"static/media/grabbing.c1e71226.cur\";","export default __webpack_public_path__ + \"static/media/grab.1bb05838.cur\";","export default __webpack_public_path__ + \"static/media/zoomin.15faa8e2.cur\";","export default __webpack_public_path__ + \"static/media/sliderscale.98b24e9c.png\";","export default __webpack_public_path__ + \"static/media/spinner.cb546845.gif\";","export default __webpack_public_path__ + \"static/media/slider.d40ca598.png\";","export default __webpack_public_path__ + \"static/media/PoweredBy_en.9a37bcc8.png\";","export default __webpack_public_path__ + \"static/media/about.1c4a00d1.png\";","export default __webpack_public_path__ + \"static/media/application-browser.6d893386.png\";","export default __webpack_public_path__ + \"static/media/back.ad22f433.png\";","export default __webpack_public_path__ + \"static/media/buffer.4ddaec73.png\";","export default __webpack_public_path__ + \"static/media/control-180.e99c05cf.png\";","export default __webpack_public_path__ + \"static/media/control-stop-180.aed41c44.png\";","export default __webpack_public_path__ + \"static/media/control-stop.69963cf6.png\";","export default __webpack_public_path__ + \"static/media/control.02849d7f.png\";","export default __webpack_public_path__ + \"static/media/coordinate-tracker.8e5747ad.png\";","export default __webpack_public_path__ + \"static/media/edit-copy.743240bf.png\";","export default __webpack_public_path__ + \"static/media/edit-cut.37b5af4a.png\";","export default __webpack_public_path__ + \"static/media/edit-duplicate.743240bf.png\";","export default __webpack_public_path__ + \"static/media/edit-paste.ee0e174b.png\";","export default __webpack_public_path__ + \"static/media/edit-xml.bf9a2847.png\";","export default __webpack_public_path__ + \"static/media/feature-info.bb0f4e99.png\";","export default __webpack_public_path__ + \"static/media/file-print.4827ba8e.png\";","export default __webpack_public_path__ + \"static/media/file-save.6d06e529.png\";","export default __webpack_public_path__ + \"static/media/folder-horizontal-open.838cb1ee.png\";","export default __webpack_public_path__ + \"static/media/folder-horizontal.c3be4846.png\";","export default __webpack_public_path__ + \"static/media/forward.64c6eb55.png\";","export default __webpack_public_path__ + \"static/media/geolocation.7de05c4c.png\";","export default __webpack_public_path__ + \"static/media/help.feccff3f.png\";","export default __webpack_public_path__ + \"static/media/icon_home.dea22bbd.png\";","export default __webpack_public_path__ + \"static/media/icon_menuarrow_disabled.55604442.png\";","export default __webpack_public_path__ + \"static/media/icon_menuarrow.9e02dd9f.png\";","export default __webpack_public_path__ + \"static/media/icon_menuarrowup_disabled.65c4a079.png\";","export default __webpack_public_path__ + \"static/media/icon_menuarrowup.b96f3cd6.png\";","export default __webpack_public_path__ + \"static/media/icon_refreshmap.cf59bb1c.png\";","export default __webpack_public_path__ + \"static/media/select.b7a09cfb.png\";","export default __webpack_public_path__ + \"static/media/icon_zoomselect.976076d1.png\";","export default __webpack_public_path__ + \"static/media/iconNavigator.b411ba02.png\";","export default __webpack_public_path__ + \"static/media/info.0bd9aabd.png\";","export default __webpack_public_path__ + \"static/media/initial-center.f373cca3.png\";","export default __webpack_public_path__ + \"static/media/invoke-script.b9d481a7.png\";","export default __webpack_public_path__ + \"static/media/invoke-url.946e1bc6.png\";","export default __webpack_public_path__ + \"static/media/lc_unselect.cbeacd29.png\";","export default __webpack_public_path__ + \"static/media/legend-DWF.cea0b58c.png\";","export default __webpack_public_path__ + \"static/media/legend-layer.c29f1930.png\";","export default __webpack_public_path__ + \"static/media/legend-map.887bf5fb.png\";","export default __webpack_public_path__ + \"static/media/legend-raster.3d07eec9.png\";","export default __webpack_public_path__ + \"static/media/legend-theme.b9e9553a.png\";","export default __webpack_public_path__ + \"static/media/maptip.3692354e.png\";","export default __webpack_public_path__ + \"static/media/measure.9c600cea.png\";","export default __webpack_public_path__ + \"static/media/options.f0932339.png\";","export default __webpack_public_path__ + \"static/media/out-of-range.786dfaa3.png\";","export default __webpack_public_path__ + \"static/media/overview-map.cb6e8f6e.png\";","export default __webpack_public_path__ + \"static/media/pan-east.0e6eae53.png\";","export default __webpack_public_path__ + \"static/media/pan-north.d6eaa62d.png\";","export default __webpack_public_path__ + \"static/media/pan-south.f3e9322e.png\";","export default __webpack_public_path__ + \"static/media/pan-west.485531a6.png\";","export default __webpack_public_path__ + \"static/media/pan.9ae253a8.png\";","export default __webpack_public_path__ + \"static/media/preview.ce6b9068.png\";","export default __webpack_public_path__ + \"static/media/print.4827ba8e.png\";","export default __webpack_public_path__ + \"static/media/property.11f290e6.png\";","export default __webpack_public_path__ + \"static/media/query.5624075f.png\";","export default __webpack_public_path__ + \"static/media/redline.9acf62bf.png\";","export default __webpack_public_path__ + \"static/media/search.710df28e.png\";","export default __webpack_public_path__ + \"static/media/select-centre.90c0c577.png\";","export default __webpack_public_path__ + \"static/media/select-clear.eac0e871.png\";","export default __webpack_public_path__ + \"static/media/select-features.28cec313.png\";","export default __webpack_public_path__ + \"static/media/select-polygon.1c9862c4.png\";","export default __webpack_public_path__ + \"static/media/select-radius.44219be2.png\";","export default __webpack_public_path__ + \"static/media/select-zoom.f8d89ea9.png\";","export default __webpack_public_path__ + \"static/media/theme.ba4dbebb.png\";","export default __webpack_public_path__ + \"static/media/toggle-expand.4bd50a1d.png\";","export default __webpack_public_path__ + \"static/media/toggle.5643c90b.png\";","export default __webpack_public_path__ + \"static/media/ui-menu.142b7a54.png\";","export default __webpack_public_path__ + \"static/media/view-back.c85b0b46.png\";","export default __webpack_public_path__ + \"static/media/view-forward.b097d5b6.png\";","export default __webpack_public_path__ + \"static/media/view-refresh.1fe4110e.png\";","export default __webpack_public_path__ + \"static/media/icon_warning.f233cd1b.png\";","export default __webpack_public_path__ + \"static/media/zoom-dynamic.72af572c.png\";","export default __webpack_public_path__ + \"static/media/zoom-full.b015ffb8.png\";","export default __webpack_public_path__ + \"static/media/zoom-in-fixed.017f7c21.png\";","export default __webpack_public_path__ + \"static/media/zoom-in.a6788ff7.png\";","export default __webpack_public_path__ + \"static/media/zoom-out-fixed.4fd2b308.png\";","export default __webpack_public_path__ + \"static/media/layer_add.1a016382.png\";","export default __webpack_public_path__ + \"static/media/globe_add.3597c849.png\";","export default __webpack_public_path__ + \"static/media/globe-share.7bc6d53c.png\";","import { ILocalizedMessages } from \"./msgdef\";\nimport { DEG } from '../constants';\n\nconst STRINGS_EN: ILocalizedMessages = {\n    \"OK\": \"OK\",\n    \"NONE\": \"NONE\",\n    \"ERROR\": \"Error\",\n    \"WARNING\": \"Warning\",\n    \"INIT_WARNINGS_FOUND\": \"The following warnings were encountered loading the viewer\",\n    \"INIT_WARNING_BING_API_KEY_REQD\": \"A Bing Maps API key is required. Sign up for an API key at http://www.bingmapsportal.com/\",\n    \"INIT_WARNING_BING_UNKNOWN_LAYER\": \"Unknown bing maps layer type {type}. This layer was skipped\",\n    \"INIT_WARNING_UNSUPPORTED_GOOGLE_MAPS\": \"This viewer does not support Google Maps base layers\",\n    \"INIT_WARNING_NO_CONTEXT_MENU\": \"Could not find the context menu configuration. Right-clicking the map will show an empty context menu. If you are loading from a Flexible Layout, it must have a container named '{containerName}'\",\n    \"LAYER_TRANSPARENCY\": \"Layer Transparency\",\n    \"LAYER_ID_BASE\": \"Base Layers\",\n    \"LAYER_ID_MG_BASE\": \"MapGuide Map\",\n    \"LAYER_ID_MG_SEL_OVERLAY\": \"MapGuide Selection Overlay\",\n    \"UNKNOWN_WIDGET\": \"This button references an unknown or unsupported widget: {widget}\",\n    \"UNKNOWN_COMMAND_REFERENCE\": \"This button references an unknown command or unsupported: {command}\",\n    \"INIT\": \"Initializing\",\n    \"INIT_DESC\": \"Please wait while the viewer is loading required assets ...\",\n    \"INIT_ERROR_TITLE\": \"An error occurred during startup\",\n    \"INIT_ERROR_UNKNOWN_RESOURCE_TYPE\": \"<p>Unknown or unsupported resource type for resource: <strong>{resourceId}</strong></p>\",\n    \"INIT_ERROR_MISSING_RESOURCE_PARAM\": \"<p>No <strong>resource</strong> parameter found. This viewer requires this parameter to be set in the query string and must refer to a valid Web Layout or Application Definition</p>\",\n    \"INIT_ERROR_UNSUPPORTED_COORD_SYS\": \"<p>The Map Definition <strong>{mapDefinition}</strong>, uses a coordinate system that does not resolve to a valid EPSG code and cannot be loaded in this viewer</p><p>Solution:</p><ul><li>Change the coordinate system of this Map Definition to one that resolves to an EPSG code</li><li>Please note: There will be a small performance overhead for server-side re-projection as a result of doing this</li></ul>\",\n    \"INIT_ERROR_UNREGISTERED_EPSG_CODE\": \"<p>The Map Definition <strong>{mapDefinition}</strong>, uses a coordinate system that resolves to a valid EPSG code (<strong>EPSG:{epsg}</strong>), but no projection for this EPSG code has been registered</p><p>Solution:</p><ol><li>Search for the matching proj4js definition at <a href='http://epsg.io/'>http://epsg.io/</a></li><li>Register this projection to the viewer before mounting it</li></ol>\",\n    \"INIT_ERROR_EXPIRED_SESSION\": \"<p>The session id given has expired: <strong>{sessionId}</strong></p><p>Reload the viewer without the <strong>session</strong> parameter, or supply a valid session id for the <strong>session</strong> parameter</p>\",\n    \"INIT_ERROR_RESOURCE_NOT_FOUND\": \"Attempted to load the following resource, but it was not found: <strong>{resourceId}</strong>\",\n    \"INIT_ERROR_NO_CONNECTION\": \"<p>There is no connection between the MapGuide Web Tier and the MapGuide Server.</p><p>Possible causes:</p><ul><li>MapGuide Server is not running or is no longer responding</li><li>Internet connection problems</li></ul><p>Possible solutions:</p><ul><li>Restart the MapGuide Server Service</li><li>Contact your server administrator</li></ul>\",\n    \"TPL_SIDEBAR_OPEN_TASKPANE\": \"Open Task Pane\",\n    \"TPL_SIDEBAR_OPEN_LEGEND\": \"Open Legend\",\n    \"TPL_SIDEBAR_OPEN_SELECTION_PANEL\": \"Open Selection Panel\",\n    \"TPL_TITLE_TASKPANE\": \"Task Pane\",\n    \"TPL_TITLE_LEGEND\": \"Legend\",\n    \"TPL_TITLE_SELECTION_PANEL\": \"Selection\",\n    \"TT_GO_HOME\": \"Go home\",\n    \"TT_GO_BACK\": \"Go back\",\n    \"TT_GO_FORWARD\": \"Go forward\",\n    \"SESSION_EXPIRED\": \"Session Expired\",\n    \"SESSION_EXPIRED_DETAILED\": \"Your current MapGuide session has expired\",\n    \"SESSION_EXPIRED_AVAILABLE_ACTIONS\": \"Available Actions:\",\n    \"SESSION_EXPIRED_RELOAD_VIEWER\": \"Reload the viewer\",\n    \"ERR_UNREGISTERED_LAYOUT\": \"ERROR: No layout named ({layout}) registered\",\n    \"ERR_UNREGISTERED_COMPONENT\": \"ERROR: No such registered component ({componentId}). Ensure the component has been registered in the component registry with an id of: {componentId}\",\n    \"ERR_NO_COMPONENT_ID\": \"No component id specified\",\n    \"LOADING_MSG\": \"Loading ...\",\n    \"MENU_TASKS\": \"Tasks\",\n    \"NO_SELECTED_FEATURES\": \"No selected features\",\n    \"FMT_SCALE_DISPLAY\": \"Scale - 1:{scale}\",\n    \"FMT_SELECTION_COUNT\": \"Selected {total} features in {layerCount} layers\",\n    \"DIGITIZE_POINT_PROMPT\": \"Click to finish and draw a point at this location<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_LINE_PROMPT\": \"Click to set this position as the start.<br/>Click again to finish the line at this position<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_LINESTRING_PROMPT\": \"Click to set this position as the start.<br/>Click again to add a vertex at this position.<br/>If you drew a vertex at the wrong spot, you can press {key} to undo.<br/>Hold SHIFT and drag while digitizing to draw in freehand mode<br/></br>Double click to finish<br/>Press ESC to cancel\",\n    \"DIGITIZE_CIRCLE_PROMPT\": \"Click to set this position as the center.<br/>Move out to the desired radius and click again to finish<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_RECT_PROMPT\": \"Click to set this position as one corner.<br/>Click again to finish and set this position as the other corner<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_POLYGON_PROMPT\": \"Click to set this positon as the start.<br/>Click again to add a vertex at this position.<br/>If you drew a vertex at the wrong spot, you can press {key} to undo<br/>Hold SHIFT and drag while digitizing to draw in freehand mode<br/><br/>Double click to finish and close the polygon<br/>Press ESC to cancel\",\n    \"MEASURE\": \"Measure\",\n    \"MEASURE_SEGMENT\": \"Segment\",\n    \"MEASURE_LENGTH\": \"Length\",\n    \"MEASURE_SEGMENT_PART\": \"Segment {segment}\",\n    \"MEASURE_TOTAL_AREA\": \"Total Area\",\n    \"MEASURE_TOTAL_LENGTH\": \"Total Length\",\n    \"MEASURING\": \"Measuring\",\n    \"MEASURING_MESSAGE\": \"You are currently measuring\",\n    \"MEASUREMENT\": \"Measurement\",\n    \"MEASUREMENT_TYPE\": \"Measurement Type\",\n    \"MEASUREMENT_TYPE_LENGTH\": \"Length (LineString)\",\n    \"MEASUREMENT_TYPE_AREA\": \"Area (Polygon)\",\n    \"MEASUREMENT_CLEAR\": \"Clear\",\n    \"MEASUREMENT_CONTINUE_POLYGON\": \"Click to continue drawing the polygon. Double-click to finish.\",\n    \"MEASUREMENT_CONTINUE_LINE\": \"Click to continue drawing the line. Double-click to finish.\",\n    \"MEASUREMENT_START_DRAWING\": \"Click to start drawing\",\n    \"MEASUREMENT_START\": \"Start\",\n    \"MEASUREMENT_END\": \"End\",\n    \"NAVIGATOR_PAN_EAST\": \"Pan East\",\n    \"NAVIGATOR_PAN_WEST\": \"Pan West\",\n    \"NAVIGATOR_PAN_SOUTH\": \"Pan South\",\n    \"NAVIGATOR_PAN_NORTH\": \"Pan North\",\n    \"NAVIGATOR_ZOOM_OUT\": \"Zoom Out\",\n    \"NAVIGATOR_ZOOM_IN\": \"Zoom In\",\n    \"FMT_NAVIGATOR_ZOOM_TO_SCALE\": \"Zoom to 1:{scale}\",\n    \"EXTERNAL_BASE_LAYERS\": \"External Base Layers\",\n    \"SELECTION_PROPERTY\": \"Property\",\n    \"SELECTION_VALUE\": \"Value\",\n    \"SELECTION_PREV_FEATURE\": \"Previous Feature\",\n    \"SELECTION_NEXT_FEATURE\": \"Next Feature\",\n    \"SELECTION_ZOOMTO_FEATURE\": \"Zoom to selected feature\",\n    \"VIEWER_OPTIONS\": \"Viewer Options\",\n    \"ABOUT\": \"About\",\n    \"HELP\": \"Help\",\n    \"QUICKPLOT_HEADER\": \"Quick Plot\",\n    \"QUICKPLOT_TITLE\": \"Title\",\n    \"QUICKPLOT_SUBTITLE\": \"Sub-Title\",\n    \"QUICKPLOT_PAPER_SIZE\": \"Paper Size\",\n    \"QUICKPLOT_ORIENTATION\": \"Orientation\",\n    \"QUICKPLOT_ORIENTATION_P\": \"Portrait\",\n    \"QUICKPLOT_ORIENTATION_L\": \"Landscape\",\n    \"QUICKPLOT_SHOWELEMENTS\": \"Show Elements\",\n    \"QUICKPLOT_SHOWLEGEND\": \"Show Legend\",\n    \"QUICKPLOT_SHOWNORTHARROW\": \"Show North Arrow\",\n    \"QUICKPLOT_SHOWCOORDINTES\": \"Show Coordinates\",\n    \"QUICKPLOT_SHOWSCALEBAR\": \"Show Scalebar\",\n    \"QUICKPLOT_SHOWDISCLAIMER\": \"Show Disclaimer\",\n    \"QUICKPLOT_ADVANCED_OPTIONS\": \"Advanced Options\",\n    \"QUICKPLOT_SCALING\": \"Scale\",\n    \"QUICKPLOT_DPI\": \"DPI\",\n    \"QUICKPLOT_BOX_INFO\": \"Quick Plot Map Capture box is active. Map rotation is disabled while box is active\",\n    \"QUICKPLOT_BOX_ROTATION\": \"Capture Box Rotation\",\n    \"QUICKPLOT_GENERATE\": \"Generate Plot\",\n    \"QUICKPLOT_COMMERCIAL_LAYER_WARNING\": \"Quick Plot will NOT include any visible commercial map layers\",\n    \"FEATURE_TOOLTIPS\": \"Feature Tooltips\",\n    \"MANUAL_FEATURE_TOOLTIPS\": \"Manual Feature Tooltips (click to show)\",\n    \"GEOLOCATION_SUCCESS\": \"Zoomed to your position\",\n    \"GEOLOCATION_WARN_OUTSIDE_MAP\": \"Zoomed to your position. It is outside the extents of your map\",\n    \"GEOLOCATION_ERROR\": \"Geolocation error: {message} ({code})\",\n    \"TASK_PANE_RESIZING\": \"Task Pane is resizing ...\",\n    \"TASK_PANE_LOADING\": \"Loading\",\n    \"TASK_PANE_LOADING_DESC\": \"Task Pane content is loading ...\",\n    \"COORDTRACKER\": \"Coordinate Tracker\",\n    \"COORDTRACKER_NO_PROJECTIONS\": \"You have no projections configured for this component\",\n    \"MAP_SIZE_DISPLAY_UNITS\": \"Map view size display units\",\n    \"ADD_MANAGE_LAYERS\": \"Add/Manage Layers\",\n    \"ADD_LAYER\": \"Add Layer\",\n    \"ADD_LAYER_TILED\": \"Add Tiled Layer\",\n    \"MANAGE_LAYERS\": \"Manage Layers\",\n    \"LAYER_TYPE\": \"Layer Type\",\n    \"SELECT_LAYER_TYPE\": \"Select Layer Type ...\",\n    \"ADD_WMS_LAYER_URL\": \"WMS Service URL\",\n    \"ADD_WMS_LAYER_LOADING\": \"Loading\",\n    \"ADD_WMS_LAYER_LOADING_DESC\": \"Loading WMS Capabilities\",\n    \"ADD_WMS_LAYER_NO_LAYERS\": \"No WMS Layers\",\n    \"WMS_VERSION\": \"WMS Version: {version}\",\n    \"ADD_WFS_LAYER_URL\": \"WFS Service URL\",\n    \"ADD_WFS_LAYER_LOADING\": \"Loading\",\n    \"ADD_WFS_LAYER_LOADING_DESC\": \"Loading WFS Capabilities\",\n    \"ADD_WFS_LAYER_NO_LAYERS\": \"No WFS Layers\",\n    \"WFS_NO_LAYER_DESCRIPTION\": \"Enter a WFS Service URL above and click the button beside it to load available layers\",\n    \"WFS_VERSION\": \"WFS Version: {version}\",\n    \"OWS_SERVICE_NAME\": \"Name: {name}\",\n    \"OWS_SERVICE_TITLE\": \"Title: {title}\",\n    \"OWS_SERVICE_ABSTRACT\": \"Abstract: {abstract}\",\n    \"WMS_LAYERS\": \"WMS Layers\",\n    \"WFS_LAYERS\": \"WFS Layers\",\n    \"OWS_LAYER_NAME\": \"Name: {name}\",\n    \"OWS_LAYER_TITLE\": \"Title: {title}\",\n    \"OWS_LAYER_ABSTRACT\": \"Abstract: {abstract}\",\n    \"OWS_LAYER_CRS\": \"CRS: {crs}\",\n    \"OWS_ADD_LAYER_PROMPT\": \"Click this layer to add it to the map\",\n    \"ADDED_LAYER\": \"Added layer: {name}\",\n    \"REMOVED_LAYER\": \"Removed layer: {name}\",\n    \"ADD_WFS_LAYER\": \"Add WFS Layer\",\n    \"SHARE_LINK_COPY_CLIPBOARD\": \"Copy Link\",\n    \"SHARE_LINK_COPIED\": \"Link copied\",\n    \"WMS_NO_LAYER_DESCRIPTION\": \"Enter a WMS Service URL above and click the button beside it to load available layers\",\n    \"UNIT_UNKNOWN\": \"Unknown\",\n    \"UNIT_INCHES\": \"Inches\",\n    \"UNIT_FEET\": \"Feet\",\n    \"UNIT_YARDS\": \"Yards\",\n    \"UNIT_MILES\": \"Miles\",\n    \"UNIT_NAUT_MILES\": \"Nautical Miles\",\n    \"UNIT_MILLIMETERS\": \"Millimeters\",\n    \"UNIT_CENTIMETERS\": \"Centimeters\",\n    \"UNIT_METERS\": \"Meters\",\n    \"UNIT_KILOMETERS\": \"Kilometers\",\n    \"UNIT_DEGREES\": \"Degrees\",\n    \"UNIT_DEC_DEGREES\": \"Decimal Degrees\",\n    \"UNIT_DMS\": \"Degrees Minutes Seconds\",\n    \"UNIT_PIXELS\": \"Pixels\",\n    \"UNIT_ABBR_UNKNOWN\": \"unk\",\n    \"UNIT_ABBR_INCHES\": \"in\",\n    \"UNIT_ABBR_FEET\": \"ft\",\n    \"UNIT_ABBR_YARDS\": \"yd\",\n    \"UNIT_ABBR_MILES\": \"mi\",\n    \"UNIT_ABBR_NAUT_MILES\": \"nm\",\n    \"UNIT_ABBR_MILLIMETERS\": \"mm\",\n    \"UNIT_ABBR_CENTIMETERS\": \"cm\",\n    \"UNIT_ABBR_METERS\": \"m\",\n    \"UNIT_ABBR_KILOMETERS\": \"km\",\n    \"UNIT_ABBR_DEGREES\": DEG,\n    \"UNIT_ABBR_DEC_DEGREES\": DEG,\n    \"UNIT_ABBR_DMS\": DEG,\n    \"UNIT_ABBR_PIXELS\": \"px\",\n    \"UNIT_FMT_M\": \"{value} m\",\n    \"UNIT_FMT_KM\": \"{value} km\",\n    \"UNIT_FMT_SQM\": \"{value} m<sup>2</sup>\",\n    \"UNIT_FMT_SQKM\": \"{value} km<sup>2</sup>\",\n    \"OL_ATTRIBUTION_TIP\": \"Attributions\",\n    \"OL_OVERVIEWMAP_TIP\": \"Overview Map\",\n    \"OL_RESET_ROTATION_TIP\": \"Reset Rotation\",\n    \"FEATURE_TOOLTIP_URL_HELP_TEXT\": \"Click for more information\",\n    \"SHARE_LINK_INCLUDE_SESSION\": \"Include Session ID\",\n    \"WINDOW_RESIZING\": \"Resizing Window\",\n    \"WINDOW_MOVING\": \"Moving Window\",\n    \"OTHER_THEME_RULE_COUNT\": \"... ({count} other theme rules)\",\n    \"LEGEND_FILTER_LAYERS\": \"Filter/search for layers or groups\",\n    \"ADD_LAYER_KIND_PROMPT\": \"What kind of layer do you want to add?\",\n    \"LAYER_KIND_FILE\": \"A local file-based layer\",\n    \"LAYER_KIND_URL\": \"A remote url-based layer\",\n    \"ADD_FILE\": \"Add Local File\",\n    \"ADD_FILE_INSTRUCTIONS\": \"Browse and select a file to view it locally on the map (it won't be saved or uploaded to the internet)\",\n    \"FMT_UPLOADED_FILE\": \"(size: {size} bytes, type: {type})\",\n    \"ADD_LOCAL_FILE_LAYER_FAILURE_NOT_TEXT\": \"Could not read text content from this file\",\n    \"ADD_LOCAL_FILE_LAYER_FAILURE\": \"Failed to load file as layer. It is probably an unsupported file format\",\n    \"WMS_UNSUPPORTED_VERSION\": \"Unsupported WMS version: {version}\",\n    \"NO_EXTERNAL_LAYERS\": \"No Layers\",\n    \"NO_EXTERNAL_LAYERS_DESC\": \"Add layers via the {tabName} tab above\",\n    \"LAYER_OPACITY\": \"Opacity\",\n    \"LAYER_NAME_EXISTS\": \"A layer named {name} already exists\",\n    \"LAYER_MANAGER_TT_MOVE_UP\": \"Move this layer up the draw order\",\n    \"LAYER_MANAGER_TT_MOVE_DOWN\": \"Move this layer down the draw order\",\n    \"LAYER_MANAGER_TT_ZOOM_EXTENTS\": \"Zoom to the extents of this layer\",\n    \"LAYER_MANAGER_TT_REMOVE\": \"Remove this layer\",\n    \"LAYER_MANAGER_TT_EDIT_STYLE\": \"Edit style\",\n    \"LAYER_MANAGER_TT_MORE_OPTIONS\": \"Show more layer options\",\n    \"CANCEL\": \"Cancel\",\n    \"UNKNOWN_FILE_TYPE\": \"Unknown\",\n    \"WMS_SERVICE_INFO\": \"WMS Service Info\",\n    \"WFS_SERVICE_INFO\": \"WFS Service Info\",\n    \"WMS_AVAILABLE_LAYERS\": \"Available WMS Layers\",\n    \"WFS_AVAILABLE_LAYERS\": \"Available WFS Layers\",\n    \"ADD_LAYER_WITH_WMS_STYLE\": \"Add layer ({style})\",\n    \"ADD_LAYER_WITH_WMS_STYLE_TILED\": \"Add tiled layer ({style})\",\n    \"WMS_LEGEND\": \"WMS Legend\",\n    \"VSED_NO_STYLES_TITLE\": \"No Styles\",\n    \"VSED_NO_STYLES_DESC\": \"This editor is not configured to edit any styles\",\n    \"VECTOR_LAYER_STYLE\": \"Vector Layer Style\",\n    \"VSED_PT_FILL_COLOR\": \"Point Fill Color\",\n    \"VSED_PT_FILL_COLOR_ALPHA\": \"Point Fill Color Alpha\",\n    \"VSED_PT_RADIUS\": \"Point Radius\",\n    \"VSED_PT_OUTLINE_COLOR\": \"Point Outline Color\",\n    \"VSED_PT_OUTLINE_COLOR_ALPHA\": \"Point Outline Color Alpha\",\n    \"VSED_PT_OUTLINE_WIDTH\": \"Point Outline Thickness\",\n    \"VSED_LN_OUTLINE_COLOR\": \"Line Color\",\n    \"VSED_LN_OUTLINE_COLOR_ALPHA\": \"Line Color Alpha\",\n    \"VSED_LN_OUTLINE_THICKNESS\": \"Line Thickness\",\n    \"VSED_PL_FILL_COLOR\": \"Fill Color\",\n    \"VSED_PL_FILL_COLOR_ALPHA\": \"Fill Color Alpha\",\n    \"VSED_PL_OUTLINE_COLOR\": \"Outline Color\",\n    \"VSED_PL_OUTLINE_COLOR_ALPHA\": \"Outline Color Alpha\",\n    \"VSED_PL_OUTLINE_THICKNESS\": \"Outline Thickness\",\n    \"VSED_TAB_POINT\": \"Point\",\n    \"VSED_TAB_LINE\": \"Line\",\n    \"VSED_TAB_POLY\": \"Polygon\",\n    \"ADD_LAYER_PROJECTION\": \"Projection of this layer\",\n    \"ADDING_LAYER_ERROR\": \"Error adding layer\",\n    \"LOADING_LAYER\": \"Loading layer: {name}\",\n    \"ACTION_CLOSE\": \"Close\",\n    \"MORE_LAYER_OPTIONS\": \"More Layer Options\",\n    \"CHOOSE_FILE\": \"Choose file ...\",\n    \"BROWSE\": \"Browse\",\n    \"SEL_FEATURE_PROPERTIES\": \"Feature Properties\",\n    \"SEL_FEATURE_PROPERTIES_NONE\": \"No properties\",\n    \"ADD_LOCAL_FILE_LAYER_FAILURE_NO_FORMATS\": \"Failed to add layer. No format drivers registered\"\n};\n\nexport default STRINGS_EN;","/**\n * @hidden\n */\n\n/** */\n\nexport * from './common';\nexport * from './runtime-map';\nexport * from './query';\nexport * from './weblayout';\nexport * from './fusion';","import * as Common from './common';\n\nexport interface FeatureSourceInfo {\n    ResourceId: Common.ResourceIdentifier;\n    ClassName: string;\n    Geometry: string;\n}\n\nexport enum FeatureStyleType {\n    Point = 1,\n    Line = 2,\n    Area = 3,\n    Composite = 4\n}\n\nexport interface RuleInfo {\n    LegendLabel?: string;\n    Filter?: Common.FdoFilter;\n    Icon?: Common.Base64Content;\n}\n\nexport interface FeatureStyleInfo {\n    Type: FeatureStyleType;\n    Rule: RuleInfo[];\n}\n\nexport interface ScaleRangeInfo {\n    MinScale: number;\n    MaxScale: number;\n    FeatureStyle: FeatureStyleInfo[];\n}\n\nexport interface MapElement {\n    /**\n     * The name of this element\n     *\n     * @type {string}\n     */\n    Name: string;\n    /**\n     * The element's legend label\n     *\n     * @type {string}\n     */\n    LegendLabel: string;\n    /**\n     * The element's object id\n     *\n     * @type {string}\n     */\n    ObjectId: string;\n    /**\n     * The element's parent id\n     *\n     * @type {string}\n     */\n    ParentId?: string | undefined;\n    /**\n     * Indicates whether this element should be displayed in the legend\n     *\n     * @type {boolean}\n     */\n    DisplayInLegend: boolean;\n    /**\n     * Indicates whether this element should be initially expanded in the legend\n     *\n     * @type {boolean}\n     */\n    ExpandInLegend: boolean;\n    /**\n     * Indicates whether this element is potentially visible. Note that this may be true even though the element is not visible. This will occur if one of the groups this element is organized within is not visible.\n     *\n     * @type {boolean}\n     */\n    Visible: boolean;\n    /**\n     * Indicates the actual visibility of the element. The visibility depends on the visible property of the element, and the visible property of each group this element is organized within.\n     *\n     * @type {boolean}\n     */\n    ActuallyVisible: boolean;\n}\n\nexport enum LayerType {\n    Dynamic = 1,\n    BaseMap = 2\n}\n\nexport enum GroupType {\n    Normal = 1,\n    BaseMap = 2,\n    BaseMapFromTileSet = 3\n}\n\nexport interface MapLayer extends MapElement {\n    Type: LayerType;\n    /**\n     * Gets whether this layer is selectable\n     *\n     * @type {boolean}\n     */\n    Selectable: boolean;\n    LayerDefinition: Common.ResourceIdentifier;\n    FeatureSource?: FeatureSourceInfo | undefined;\n    ScaleRange?: ScaleRangeInfo[] | undefined;\n}\n\n/**\n * Describes a group of Runtime Map Layers\n *\n * @export\n * @interface MapGroup\n * @extends {MapElement}\n */\nexport interface MapGroup extends MapElement {\n    /**\n     * The type of this group. Can be tiled or dynamic\n     *\n     * @type {GroupType}\n     */\n    Type: GroupType;\n}\n\nexport interface EnvCoordinate {\n    X: number;\n    Y: number;\n}\n\nexport interface Envelope {\n    LowerLeftCoordinate: EnvCoordinate;\n    UpperRightCoordinate: EnvCoordinate;\n}\n\n/**\n * Describes the coordinate system of the runtime map\n *\n * @export\n * @interface CoordinateSystemType\n */\nexport interface CoordinateSystemType {\n    /**\n     * The WKT string of the coordinate system\n     *\n     * @type {string}\n     */\n    Wkt: string;\n    /**\n     * The CS-Map code of the coordinate system\n     *\n     * @type {string}\n     */\n    MentorCode: string;\n    /**\n     * The EPSG code of the coordinate system\n     *\n     * @type {string}\n     */\n    EpsgCode: string;\n    /**\n     * The meters-per-unit value of the coordinate system\n     *\n     * @type {number}\n     */\n    MetersPerUnit: number;\n}\n\nexport interface RuntimeMap {\n    /**\n     * The MapGuide Site Version\n     *\n     * @type {Common.Version}\n     */\n    SiteVersion: Common.Version;\n    /**\n     * The name of the runtime map. This is the value required for any mapagent operation that require a MAPNAME parameter\n     *\n     * @type {string}\n     */\n    Name: string;\n    /**\n     * The session id\n     *\n     * @type {string}\n     */\n    SessionId: string;\n    /**\n     * The resource id of the Map Definition from which this runtime map was created from\n     *\n     * @type {Common.ResourceIdentifier}\n     */\n    MapDefinition: Common.ResourceIdentifier;\n    /**\n     * The resource id of the Tile Set Definition that this Map Definition is linked from. If this Map Definition does not link to a tile set, this element is omitted\n     *\n     * @type {Common.ResourceIdentifier}\n     */\n    TileSetDefinition?: Common.ResourceIdentifier | undefined;\n    /**\n     * The tile width as defined by the settings in the Tile Set Definition. If this Map Definition does not link to a tile set, this element is omitted\n     *\n     * @type {number}\n     */\n    TileWidth?: number | undefined;\n    /**\n     * The tile height as defined by the settings in the Tile Set Definition. If this Map Definition does not link to a tile set, this element is omitted\n     *\n     * @type {number}\n     */\n    TileHeight?: number | undefined;\n    /**\n     * The map's background color in ARGB hex string format\n     *\n     * @type {Common.Color}\n     */\n    BackgroundColor: Common.Color;\n    /**\n     * The number of dots per inch of the map display\n     *\n     * @type {number}\n     */\n    DisplayDpi: number;\n    /**\n     * The mime type of all inline icons\n     *\n     * @type {Common.MimeType}\n     */\n    IconMimeType?: Common.MimeType | undefined;\n    CoordinateSystem: CoordinateSystemType;\n    Extents: Envelope;\n    Group?: MapGroup[] | undefined;\n    Layer?: MapLayer[] | undefined;\n    FiniteDisplayScale?: number[] | undefined;\n}","/**\n * @hidden\n */\n\n/** */\n\nexport * from \"./command\";\nexport * from \"./component\";\nexport * from \"./layout\";","import PluggableMap from 'ol/PluggableMap';\n\n/**\n * Sets up key dependencies needed by the viewer\n *\n * @export\n */\nexport function bootstrap() {\n\n    PluggableMap.prototype.handleMapBrowserEvent = function (mapBrowserEvent: any) {\n        if (!this.frameState_) {\n            // With no view defined, we cannot translate pixels into geographical\n            // coordinates so interactions cannot be used.\n            return;\n        }\n        var target = /** @type {Node} */ (mapBrowserEvent.originalEvent.target);\n        if (!mapBrowserEvent.dragging) {\n            // <========= Patch is here ==========> //\n            if (!this.viewport_.contains(target)) {\n                // Abort if the event target is a child of the container that doesn't allow\n                // event propagation or is no longer in the page. It's possible for the target to no longer\n                // be in the page if it has been removed in an event listener, this might happen in a Control\n                // that recreates it's content based on user interaction either manually or via a render\n                // in something like https://reactjs.org/\n                return;\n            }\n        }\n        mapBrowserEvent.frameState = this.frameState_;\n        var interactionsArray = this.getInteractions().getArray();\n        if (this.dispatchEvent(mapBrowserEvent) !== false) {\n            for (var i = interactionsArray.length - 1; i >= 0; i--) {\n                var interaction = interactionsArray[i];\n                if (!interaction.getActive()) {\n                    continue;\n                }\n                var cont = interaction.handleEvent(mapBrowserEvent);\n                if (!cont) {\n                    break;\n                }\n            }\n        }\n    };\n}","import {\n    registerCommand,\n    DefaultCommands,\n    CommandConditions,\n    openUrlInTarget\n} from \"./registry/command\";\nimport {\n    IMapViewer,\n    ActiveMapTool,\n    RefreshMode,\n    ReduxDispatch,\n    getInitialView,\n    getSelectionSet,\n    getRuntimeMap,\n    getCurrentView,\n    ITargetedCommand,\n    IConfigurationReducerState,\n    DEFAULT_MODAL_SIZE,\n    Bounds\n} from \"./common\";\nimport * as LegendActions from \"../actions/legend\";\nimport * as MapActions from \"../actions/map\";\nimport * as ModalActions from \"../actions/modal\";\nimport * as TemplateActions from \"../actions/template\";\nimport { tr } from \"../api/i18n\";\nimport { DefaultComponentNames } from \"../api/registry/component\";\nimport { getFusionRoot } from \"../api/runtime\";\nimport { enableRedlineMessagePrompt } from \"../containers/viewer-shim\";\nimport {\n    SPRITE_SELECT,\n    SPRITE_PAN,\n    SPRITE_ZOOM_IN,\n    SPRITE_MAPTIP,\n    SPRITE_ZOOM_IN_FIXED,\n    SPRITE_ZOOM_OUT_FIXED,\n    SPRITE_PAN_WEST,\n    SPRITE_PAN_EAST,\n    SPRITE_PAN_NORTH,\n    SPRITE_PAN_SOUTH,\n    SPRITE_ABOUT,\n    SPRITE_HELP,\n    SPRITE_MEASURE,\n    SPRITE_PRINT,\n    SPRITE_OPTIONS,\n    SPRITE_SELECT_RADIUS,\n    SPRITE_SELECT_POLYGON,\n    SPRITE_INITIAL_CENTER,\n    SPRITE_ZOOM_FULL,\n    SPRITE_SELECT_CLEAR,\n    SPRITE_ICON_ZOOMSELECT,\n    SPRITE_VIEW_BACK,\n    SPRITE_ICON_REFRESHMAP,\n    SPRITE_VIEW_FORWARD,\n    SPRITE_GEOLOCATION,\n    SPRITE_BUFFER,\n    SPRITE_SELECT_FEATURES,\n    SPRITE_REDLINE,\n    SPRITE_FEATURE_INFO,\n    SPRITE_QUERY,\n    SPRITE_THEME,\n    SPRITE_INVOKE_SCRIPT,\n    SPRITE_COORDINATE_TRACKER,\n    SPRITE_LAYER_ADD,\n    SPRITE_SELECT_CENTRE\n} from \"../constants/assets\";\nimport * as olExtent from \"ol/extent\";\nimport { ensureParameters } from \"../utils/url\";\n\nfunction panMap(dispatch: ReduxDispatch, viewer: IMapViewer, value: \"right\" | \"left\" | \"up\" | \"down\") {\n    const settings: any = {\n        \"right\": [2, 1],\n        \"left\": [0, 1],\n        \"down\": [0, 1],\n        \"up\": [0, 3]\n    };\n\n    const view = viewer.getCurrentView();\n    const current_center = [view.x, view.y];\n    const currentExtent = viewer.getCurrentExtent();\n    let newPos: number[];\n\n    const direction = settings[value];\n\n    if (value == \"right\" || value == \"left\") {\n        newPos = [\n            currentExtent[direction[0]],\n            current_center[direction[1]]\n        ];\n\n    } else {\n        newPos = [\n            current_center[direction[0]],\n            currentExtent[direction[1]]\n        ];\n    }\n\n    dispatch(MapActions.setCurrentView({ x: newPos[0], y: newPos[1], scale: view.scale }));\n}\n\nfunction buildTargetedCommand(config: Readonly<IConfigurationReducerState>, parameters: any): ITargetedCommand {\n    const cmdTarget = (parameters || {}).Target;\n    const cmdDef: ITargetedCommand = {\n        target: cmdTarget || \"NewWindow\"\n    };\n    if (config.capabilities.hasTaskPane && cmdTarget == \"TaskPane\") {\n        cmdDef.target = \"TaskPane\";\n    }\n    if (cmdTarget == \"SpecifiedFrame\") {\n        cmdDef.target = cmdTarget;\n        cmdDef.targetFrame = (parameters || {}).TargetFrame;\n    }\n    return cmdDef;\n}\n\n/**\n * Registers the default set of commands into the command registry. This is automatically called by the default viewer\n * bundle. If creating your own viewer bundle, be sure to call this function in your entry point, or individually register\n * the commands you want to make available in your custom viewer bundle\n *\n * @export\n */\nexport function initDefaultCommands() {\n    //Select Tool\n    registerCommand(DefaultCommands.Select, {\n        iconClass: SPRITE_SELECT,\n        selected: (state) => {\n            return state.activeTool === ActiveMapTool.Select;\n        },\n        enabled: () => true,\n        invoke: (dispatch) => {\n            return dispatch(MapActions.setActiveTool(ActiveMapTool.Select));\n        }\n    });\n    //WMS Query Tool\n    registerCommand(DefaultCommands.WmsQuery, {\n        iconClass: SPRITE_SELECT,\n        selected: (state) => state.activeTool === ActiveMapTool.WmsQueryFeatures && state.visibleAndSelectableWmsLayerCount > 0,\n        enabled: (state) => state.visibleAndSelectableWmsLayerCount > 0,\n        invoke: (dispatch) => dispatch(MapActions.setActiveTool(ActiveMapTool.WmsQueryFeatures))\n    });\n    //Pan Tool\n    registerCommand(DefaultCommands.Pan, {\n        iconClass: SPRITE_PAN,\n        selected: (state) => {\n            return state.activeTool === ActiveMapTool.Pan;\n        },\n        enabled: () => true,\n        invoke: (dispatch) => {\n            return dispatch(MapActions.setActiveTool(ActiveMapTool.Pan));\n        }\n    });\n    //Zoom Tool\n    registerCommand(DefaultCommands.Zoom, {\n        iconClass: SPRITE_ZOOM_IN,\n        selected: (state) => {\n            return state.activeTool === ActiveMapTool.Zoom;\n        },\n        enabled: () => true,\n        invoke: (dispatch) => {\n            return dispatch(MapActions.setActiveTool(ActiveMapTool.Zoom));\n        }\n    });\n    //Feature Tooltips\n    registerCommand(DefaultCommands.MapTip, {\n        iconClass: SPRITE_MAPTIP,\n        selected: (state) => {\n            return state.featureTooltipsEnabled === true;\n        },\n        enabled: () => true,\n        invoke: (dispatch, getState) => {\n            const enabled = getState().viewer.featureTooltipsEnabled;\n            return dispatch(MapActions.setFeatureTooltipsEnabled(!enabled));\n        }\n    });\n    //Zoom in\n    registerCommand(DefaultCommands.ZoomIn, {\n        iconClass: SPRITE_ZOOM_IN_FIXED,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                viewer.zoomDelta(1);\n            }\n        }\n    });\n    //Zoom Out\n    registerCommand(DefaultCommands.ZoomOut, {\n        iconClass: SPRITE_ZOOM_OUT_FIXED,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                viewer.zoomDelta(-1);\n            }\n        }\n    });\n    //Pan Left\n    registerCommand(DefaultCommands.PanLeft, {\n        iconClass: SPRITE_PAN_WEST,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                panMap(dispatch, viewer, \"left\");\n            }\n        }\n    });\n    //Pan Right\n    registerCommand(DefaultCommands.PanRight, {\n        iconClass: SPRITE_PAN_EAST,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                panMap(dispatch, viewer, \"right\");\n            }\n        }\n    });\n    //Pan Up\n    registerCommand(DefaultCommands.PanUp, {\n        iconClass: SPRITE_PAN_NORTH,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                panMap(dispatch, viewer, \"up\");\n            }\n        }\n    });\n    //Pan Down\n    registerCommand(DefaultCommands.PanDown, {\n        iconClass: SPRITE_PAN_SOUTH,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                panMap(dispatch, viewer, \"down\");\n            }\n        }\n    });\n    //About\n    registerCommand(DefaultCommands.About, {\n        iconClass: SPRITE_ABOUT,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState) => {\n            dispatch(ModalActions.showModalComponent({\n                modal: {\n                    title: tr(\"ABOUT\", getState().config.locale),\n                    backdrop: true,\n                    size: DEFAULT_MODAL_SIZE\n                },\n                name: DefaultComponentNames.About,\n                component: DefaultComponentNames.About\n            }));\n        }\n    });\n    //Help\n    registerCommand(DefaultCommands.Help, {\n        iconClass: SPRITE_HELP,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState) => {\n            dispatch(ModalActions.showModalUrl({\n                modal: {\n                    title: tr(\"HELP\", getState().config.locale),\n                    backdrop: true,\n                    size: DEFAULT_MODAL_SIZE\n                },\n                name: DefaultCommands.Help,\n                url: \"help/index.html\"\n            }));\n        }\n    });\n    //Measure\n    registerCommand(DefaultCommands.Measure, {\n        iconClass: SPRITE_MEASURE,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const config = getState().config;\n            const url = \"component://Measure\";\n            const cmdDef = buildTargetedCommand(config, parameters);\n            openUrlInTarget(DefaultCommands.Measure, cmdDef, config.capabilities.hasTaskPane, dispatch, url, tr(\"MEASURE\", config.locale));\n        }\n    });\n    //Quick Plot\n    registerCommand(DefaultCommands.QuickPlot, {\n        iconClass: SPRITE_PRINT,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const config = getState().config;\n            const url = \"component://QuickPlot\";\n            const cmdDef = buildTargetedCommand(config, parameters);\n            openUrlInTarget(DefaultCommands.QuickPlot, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n        }\n    });\n    //Viewer Options\n    registerCommand(DefaultCommands.ViewerOptions, {\n        iconClass: SPRITE_OPTIONS,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const config = getState().config;\n            const url = \"component://ViewerOptions\";\n            const cmdDef = buildTargetedCommand(config, parameters);\n            openUrlInTarget(DefaultCommands.ViewerOptions, cmdDef, config.capabilities.hasTaskPane, dispatch, url, tr(\"VIEWER_OPTIONS\", config.locale));\n        }\n    });\n    //Select Radius\n    registerCommand(DefaultCommands.SelectRadius, {\n        iconClass: SPRITE_SELECT_RADIUS,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            if (viewer) {\n                const selMethod = parameters.SelectionType || \"INTERSECTS\";\n                viewer.digitizeCircle(circle => {\n                    const fact = viewer.getOLFactory();\n                    const geom = fact.createGeomPolygonFromCircle(circle);\n                    viewer.selectByGeometry(geom, selMethod);\n                });\n            }\n        }\n    });\n    //Select Polygon\n    registerCommand(DefaultCommands.SelectPolygon, {\n        iconClass: SPRITE_SELECT_POLYGON,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            if (viewer) {\n                const selMethod = parameters.SelectionType || \"INTERSECTS\";\n                viewer.digitizePolygon(geom => {\n                    viewer.selectByGeometry(geom, selMethod);\n                });\n            }\n        }\n    });\n    //Initial Center and scale\n    registerCommand(DefaultCommands.RestoreView, {\n        iconClass: SPRITE_INITIAL_CENTER,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                const view = getInitialView(getState());\n                if (view != null) {\n                    viewer.zoomToView(view.x, view.y, view.scale);\n                } else {\n                    viewer.initialView();\n                }\n            }\n        }\n    })\n    //Zoom Extents\n    registerCommand(DefaultCommands.ZoomExtents, {\n        iconClass: SPRITE_ZOOM_FULL,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                viewer.initialView();\n            }\n        }\n    });\n    //Clear Selection\n    registerCommand(DefaultCommands.ClearSelection, {\n        iconClass: SPRITE_SELECT_CLEAR,\n        selected: () => false,\n        enabled: CommandConditions.hasSelection,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                viewer.clearSelection();\n            }\n        }\n    });\n    //Zoom to Selection\n    registerCommand(DefaultCommands.ZoomToSelection, {\n        iconClass: SPRITE_ICON_ZOOMSELECT,\n        selected: () => false,\n        enabled: CommandConditions.hasSelection,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                const fact = viewer.getOLFactory();\n                const selection = getSelectionSet(getState());\n                let bounds: Bounds | null = null;\n                if (selection != null && selection.SelectedFeatures != null) {\n                    selection.SelectedFeatures.SelectedLayer.forEach(layer => {\n                        layer.Feature.forEach(feat => {\n                            const b: any = feat.Bounds.split(\" \").map(s => parseFloat(s));\n                            if (bounds == null) {\n                                bounds = b;\n                            } else {\n                                bounds = fact.extendExtent(bounds, b);\n                            }\n                        })\n                    });\n                }\n                if (bounds) {\n                    const view = viewer.getViewForExtent(bounds);\n                    dispatch(MapActions.setCurrentView(view));\n                }\n            }\n        }\n    });\n    //Refresh Map\n    registerCommand(DefaultCommands.RefreshMap, {\n        iconClass: SPRITE_ICON_REFRESHMAP,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer) => {\n            if (viewer) {\n                viewer.refreshMap(RefreshMode.LayersOnly | RefreshMode.SelectionOnly);\n                dispatch(LegendActions.refresh());\n            }\n        }\n    });\n    //Previous View\n    registerCommand(DefaultCommands.PreviousView, {\n        iconClass: SPRITE_VIEW_BACK,\n        selected: () => false,\n        enabled: CommandConditions.hasPreviousView,\n        invoke: (dispatch, getState) => {\n            const mapName = getState().config.activeMapName;\n            if (mapName) {\n                dispatch(MapActions.previousView(mapName));\n            }\n        }\n    });\n    //Next View\n    registerCommand(DefaultCommands.NextView, {\n        iconClass: SPRITE_VIEW_FORWARD,\n        selected: () => false,\n        enabled: CommandConditions.hasNextView,\n        invoke: (dispatch, getState) => {\n            const mapName = getState().config.activeMapName;\n            if (mapName) {\n                dispatch(MapActions.nextView(mapName));\n            }\n        }\n    });\n    //Geolocation\n    registerCommand(DefaultCommands.Geolocation, {\n        iconClass: SPRITE_GEOLOCATION,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const view = getCurrentView(state);\n            const rtMap = getRuntimeMap(state);\n            const locale = state.config.locale;\n            if (viewer && view && rtMap) {\n                const fact = viewer.getOLFactory();\n                const geoOptions: Partial<PositionOptions> = {};\n                let zoomScale = view.scale;\n                if (parameters.ZoomLevel) {\n                    zoomScale = parseInt(parameters.ZoomLevel, 10);\n                }\n                if (parameters.EnableHighAccuracy) {\n                    geoOptions.enableHighAccuracy = (parameters.EnableHighAccuracy == \"true\");\n                }\n                if (parameters.Timeout) {\n                    geoOptions.timeout = parseInt(parameters.Timeout, 10);\n                }\n                if (parameters.MaximumAge) {\n                    geoOptions.maximumAge = parseInt(parameters.MaximumAge, 10);\n                }\n                navigator.geolocation.getCurrentPosition(pos => {\n                    const proj = viewer.getProjection();\n                    const txCoord = fact.transformCoordinateFromLonLat([pos.coords.longitude, pos.coords.latitude], proj);\n                    const testCoord = fact.transformCoordinateFromLonLat([pos.coords.longitude, pos.coords.latitude], `EPSG:${rtMap.CoordinateSystem.EpsgCode}`);\n                    viewer.zoomToView(txCoord[0], txCoord[1], zoomScale);\n                    const extents: [number, number, number, number] = [\n                        rtMap.Extents.LowerLeftCoordinate.X,\n                        rtMap.Extents.LowerLeftCoordinate.Y,\n                        rtMap.Extents.UpperRightCoordinate.X,\n                        rtMap.Extents.UpperRightCoordinate.Y\n                    ];\n                    if (fact.extentContainsXY(extents, testCoord[0], testCoord[1])) {\n                        viewer.toastSuccess(\"geolocation\", tr(\"GEOLOCATION_SUCCESS\", locale));\n                        //getTopToaster().show({ icon: \"geolocation\", message: tr(\"GEOLOCATION_SUCCESS\", locale), intent: Intent.SUCCESS });\n                    } else {\n                        viewer.toastWarning(\"warning-sign\", tr(\"GEOLOCATION_WARN_OUTSIDE_MAP\", locale));\n                        //getTopToaster().show({ icon: \"warning-sign\", message: tr(\"GEOLOCATION_WARN_OUTSIDE_MAP\", locale), intent: Intent.WARNING });\n                    }\n                }, err => {\n                    viewer.toastError(\"error\", tr(\"GEOLOCATION_ERROR\", locale, { message: err.message, code: err.code }));\n                    //getTopToaster().show({ icon: \"error\", message: tr(\"GEOLOCATION_ERROR\", locale, { message: err.message, code: err.code }), intent: Intent.DANGER });\n                }, geoOptions);\n            }\n        }\n    });\n    //Buffer\n    registerCommand(DefaultCommands.Buffer, {\n        iconClass: SPRITE_BUFFER,\n        selected: () => false,\n        enabled: CommandConditions.hasSelection,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const map = getRuntimeMap(state);\n            const config = state.config;\n            if (map) {\n                let url = ensureParameters(`${getFusionRoot()}/widgets/BufferPanel/BufferPanel.php`, map.Name, map.SessionId, config.locale, false);\n                url += \"&popup=false&us=0\";\n                const cmdDef = buildTargetedCommand(config, parameters);\n                openUrlInTarget(DefaultCommands.Buffer, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n            }\n        }\n    });\n    //Select Within\n    registerCommand(DefaultCommands.SelectWithin, {\n        iconClass: SPRITE_SELECT_FEATURES,\n        selected: () => false,\n        enabled: (state, parameters) => !CommandConditions.disabledIfEmptySelection(state, parameters),\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const map = getRuntimeMap(state);\n            const config = state.config;\n            if (map) {\n                let url = ensureParameters(`${getFusionRoot()}/widgets/SelectWithin/SelectWithinPanel.php`, map.Name, map.SessionId, config.locale, false);\n                url += \"&popup=false\";\n                const cmdDef = buildTargetedCommand(config, parameters);\n                openUrlInTarget(DefaultCommands.SelectWithin, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n            }\n        }\n    });\n    //Redline\n    registerCommand(DefaultCommands.Redline, {\n        iconClass: SPRITE_REDLINE,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const map = getRuntimeMap(state);\n            const config = state.config;\n            if (map) {\n                let bUseAdvancedStylization = true;\n                let defaultDataStoreFormat = null;\n                let defaultRedlineGeometryType = 0;\n                let bCreateOnStartup = false;\n                if (parameters.AutogenerateLayerNames)\n\n                if (parameters.StylizationType)\n                    bUseAdvancedStylization = (parameters.StylizationType == \"advanced\");\n                \n                if (parameters.DataStoreFormat && parameters.RedlineGeometryFormat) {\n                    if (parameters.DataStoreFormat == \"SDF\" ||\n                        parameters.DataStoreFormat == \"SHP\" ||\n                        parameters.DataStoreFormat == \"SQLite\") {\n                        \n                        var geomTypes = parseInt(parameters.RedlineGeometryFormat);\n                        if (parameters.DataStoreFormat == \"SHP\") {\n                            //Only accept if geometry type is singular\n                            if (geomTypes == 1 || geomTypes == 2 || geomTypes == 4) {\n                                defaultDataStoreFormat = parameters.DataStoreFormat;\n                                defaultRedlineGeometryType = geomTypes;\n                                if (parameters.AutoCreateOnStartup)\n                                    bCreateOnStartup = (parameters.AutoCreateOnStartup == \"true\");\n                            }\n                        } else {\n                            defaultDataStoreFormat = parameters.DataStoreFormat;\n                            defaultRedlineGeometryType = geomTypes;\n                            if (parameters.AutoCreateOnStartup)\n                                bCreateOnStartup = (parameters.AutoCreateOnStartup == \"true\");\n                        }\n                    }\n                }\n\n                enableRedlineMessagePrompt(parameters.UseMapMessage == \"true\");\n                let url = ensureParameters(`${getFusionRoot()}/widgets/Redline/markupmain.php`, map.Name, map.SessionId, config.locale, true);\n                url += \"&POPUP=false\";\n                if (defaultDataStoreFormat != null && defaultRedlineGeometryType > 0) {\n                    url += `&REDLINEFORMAT=${defaultDataStoreFormat}`;\n                    url += `&REDLINEGEOMTYPE=${defaultRedlineGeometryType}`;\n                    url += `&AUTOCREATE=${bCreateOnStartup ? \"1\" : \"0\"}`;\n                }\n                url += `&REDLINESTYLIZATION=${bUseAdvancedStylization ? \"ADVANCED\" : \"BASIC\"}`;\n                const cmdDef = buildTargetedCommand(config, parameters);\n                openUrlInTarget(DefaultCommands.Redline, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n            }\n        }\n    });\n    //Feature Info\n    registerCommand(DefaultCommands.FeatureInfo, {\n        iconClass: SPRITE_FEATURE_INFO,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const map = getRuntimeMap(state);\n            const config = state.config;\n            if (map) {\n                const url = ensureParameters(`${getFusionRoot()}/widgets/FeatureInfo/featureinfomain.php`, map.Name, map.SessionId, config.locale, true);\n                const cmdDef = buildTargetedCommand(config, parameters);\n                openUrlInTarget(DefaultCommands.FeatureInfo, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n            }\n        }\n    });\n    //Query\n    registerCommand(DefaultCommands.Query, {\n        iconClass: SPRITE_QUERY,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const map = getRuntimeMap(state);\n            const config = state.config;\n            if (map) {\n                const url = ensureParameters(`${getFusionRoot()}/widgets/Query/querymain.php`, map.Name, map.SessionId, config.locale, true);\n                const cmdDef = buildTargetedCommand(config, parameters);\n                openUrlInTarget(DefaultCommands.Query, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n            }\n        }\n    });\n    //Theme\n    registerCommand(DefaultCommands.Theme, {\n        iconClass: SPRITE_THEME,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const state = getState();\n            const map = getRuntimeMap(state);\n            const config = state.config;\n            if (map) {\n                const url = ensureParameters(`${getFusionRoot()}/widgets/Theme/thememain.php`, map.Name, map.SessionId, config.locale, true);\n                const cmdDef = buildTargetedCommand(config, parameters);\n                openUrlInTarget(DefaultCommands.Theme, cmdDef, config.capabilities.hasTaskPane, dispatch, url);\n            }\n        }\n    });\n    //Coordinate Tracker\n    registerCommand(DefaultCommands.CoordinateTracker, {\n        iconClass: SPRITE_COORDINATE_TRACKER,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const config = getState().config;\n            const url = `component://CoordinateTracker?${(parameters.Projection || []).map((p: string) => \"projections=\" + p).join(\"&\")}`;\n            const cmdDef = buildTargetedCommand(config, parameters);\n            openUrlInTarget(DefaultCommands.CoordinateTracker, cmdDef, config.capabilities.hasTaskPane, dispatch, url, tr(\"COORDTRACKER\", config.locale));\n        }\n    });\n    //Add WMS Layer\n    registerCommand(DefaultCommands.AddManageLayers, {\n        iconClass: SPRITE_LAYER_ADD,\n        selected: () => false,\n        enabled: () => true,\n        invoke: (dispatch, getState, viewer, parameters) => {\n            const config = getState().config;\n            const url = `component://${DefaultComponentNames.AddManageLayers}`;\n            const cmdDef = buildTargetedCommand(config, parameters);\n            openUrlInTarget(DefaultCommands.AddManageLayers, cmdDef, config.capabilities.hasTaskPane, dispatch, url, tr(\"ADD_MANAGE_LAYERS\", config.locale));\n        }\n    });\n    //Center Selection\n    registerCommand(DefaultCommands.CenterSelection, {\n        iconClass: SPRITE_SELECT_CENTRE,\n        selected: () => false,\n        enabled: CommandConditions.hasSelection,\n        invoke: (dispatch, getState, viewer) => {\n            const state = getState();\n            const mapName = state.config.activeMapName;\n            if (mapName && viewer) {\n                const mapState = state.mapState[mapName];\n                if (mapState.selectionSet && mapState.selectionSet.SelectedFeatures) {\n                    let bbox;\n                    for (const layer of mapState.selectionSet.SelectedFeatures.SelectedLayer) {\n                        for (const f of layer.Feature) {\n                            const b: any = f.Bounds.split(\" \").map(s => parseFloat(s));\n                            if (!bbox) {\n                                bbox = b;\n                            } else {\n                                bbox = olExtent.extend(bbox, b);\n                            }\n                        }\n                    }\n                    if (bbox) {\n                        const view = viewer.getViewForExtent(bbox);\n                        dispatch(MapActions.setCurrentView(view));\n                    }\n                }\n            }\n        }\n    });\n\n    //Fusion template helper commands\n    /*\n    registerCommand(\"showOverview\", {\n        icon: \"images/icons/invoke-script\",\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState, viewer, parameters) => {\n\n        }\n    });\n    */\n    registerCommand(\"showTaskPane\", {\n        iconClass: SPRITE_INVOKE_SCRIPT,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState) => {\n            dispatch(TemplateActions.setTaskPaneVisibility(true));\n        }\n    });\n    registerCommand(\"showLegend\", {\n        iconClass: SPRITE_INVOKE_SCRIPT,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState) => {\n            dispatch(TemplateActions.setLegendVisibility(true));\n        }\n    });\n    registerCommand(\"showSelectionPanel\", {\n        iconClass: SPRITE_INVOKE_SCRIPT,\n        selected: () => false,\n        enabled: CommandConditions.isNotBusy,\n        invoke: (dispatch, getState) => {\n            dispatch(TemplateActions.setSelectionPanelVisibility(true));\n        }\n    });\n}","import { Size } from \"../../containers/map-capturer-context\";\nimport olOverlay from \"ol/Overlay\";\nimport olMap from \"ol/Map\";\nimport OverlayPositioning from 'ol/OverlayPositioning';\nimport { GenericEvent } from '../../api/common';\n\nconst HIDDEN_CLASS_NAME = \"tooltip-hidden\";\n\nexport class MouseTrackingTooltip {\n    private tooltip: olOverlay;\n    private tooltipElement: HTMLElement;\n    private map: olMap;\n    private text: string | null;\n    private isContextMenuOpen: () => boolean;\n    constructor(map: olMap, contextMenuTest: () => boolean) {\n        this.map = map;\n        this.isContextMenuOpen = contextMenuTest;\n        this.map.getViewport().addEventListener(\"mouseout\", this.onMouseOut.bind(this));\n        this.tooltipElement = document.createElement(\"div\");\n        this.tooltipElement.className = 'tooltip';\n        this.tooltip = new olOverlay({\n            element: this.tooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT // \"center-left\" /*ol.OverlayPositioning.CENTER_LEFT*/\n        })\n        this.map.addOverlay(this.tooltip);\n        this.text = null;\n        this.tooltipElement.classList.add(HIDDEN_CLASS_NAME);\n    }\n    public onMouseMove(e: GenericEvent) {\n        if (this.isContextMenuOpen())\n            return;\n        this.tooltip.setPosition(e.coordinate);\n        if (this.text)\n            this.tooltipElement.classList.remove(HIDDEN_CLASS_NAME);\n        else\n            this.tooltipElement.classList.add(HIDDEN_CLASS_NAME);\n    }\n    private onMouseOut() {\n        this.tooltipElement.classList.add(HIDDEN_CLASS_NAME);\n    }\n    public setText(prompt: string) {\n        this.text = prompt;\n        this.tooltipElement.innerHTML = this.text;\n    }\n    public clear() {\n        this.text = null;\n        this.tooltipElement.innerHTML = \"\";\n    }\n    public destroy() {\n        if (this.tooltipElement && this.tooltipElement.parentNode) {\n            this.tooltipElement.parentNode.removeChild(this.tooltipElement);\n        }\n    }\n}","import * as logger from '../../utils/logger';\nimport OverlayPositioning from 'ol/OverlayPositioning';\nimport debounce = require('lodash.debounce');\nimport olOverlay from \"ol/Overlay\";\nimport olWKTFormat from \"ol/format/WKT\";\nimport olPolygon, { fromExtent } from \"ol/geom/Polygon\";\nimport olMap from \"ol/Map\";\nimport { IMapViewerContextCallback } from '../map-viewer-context';\nimport { GenericEvent, GenericEventHandler } from '../../api/common';\nimport { Client } from '../../api/client';\nimport * as olExtent from \"ol/extent\";\nimport { isSessionExpiredError } from '../../api/error';\nimport { tr } from '../../api/i18n';\n\nexport class FeatureQueryTooltip {\n    private wktFormat: olWKTFormat;\n    private map: olMap;\n    private throttledMouseMove: GenericEventHandler;\n    private featureTooltipElement: HTMLElement;\n    private featureTooltip: olOverlay;\n    private linkElement: HTMLElement | null;\n    private enabled: boolean;\n    private isMouseOverTooltip: boolean;\n    private callback: IMapViewerContextCallback;\n    constructor(map: olMap, callback: IMapViewerContextCallback) {\n        this.callback = callback;\n        this.wktFormat = new olWKTFormat();\n        this.featureTooltipElement = document.createElement(\"div\");\n        this.featureTooltipElement.addEventListener(\"mouseover\", () => this.isMouseOverTooltip = true);\n        this.featureTooltipElement.addEventListener(\"mouseout\", () => this.isMouseOverTooltip = false);\n        this.featureTooltipElement.className = 'feature-tooltip';\n        this.featureTooltip = new olOverlay({\n            element: this.featureTooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT // \"center-left\" /* ol.OverlayPositioning.CENTER_LEFT */\n        })\n        this.map = map;\n        this.map.addOverlay(this.featureTooltip);\n        this.throttledMouseMove = debounce((e: GenericEvent) => {\n            this.raiseQueryFromPoint(e.pixel);\n        }, 1000);\n        this.enabled = true;\n        this.isMouseOverTooltip = false;\n    }\n    public get isMouseOver() { return this.isMouseOverTooltip; }\n    public raiseQueryFromPoint(pixel: [number, number]) {\n        const box = this.callback.getPointSelectionBox(pixel);\n        const geom = fromExtent(box);\n        logger.debug(`[${new Date()}] FeatureTooltip - onMouseMove (${box[0]}, ${box[1]}) (${box[2]}, ${box[3]})`);\n        this.sendTooltipQuery(geom);\n    }\n    public onMouseMove(e: GenericEvent) {\n        this.throttledMouseMove(e);\n    }\n    public isEnabled(): boolean {\n        return this.enabled;\n    }\n    public setEnabled(enabled: boolean): void {\n        this.enabled = enabled;\n        if (!this.enabled) {\n            this.featureTooltipElement.innerHTML = \"\";\n            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n            if (this.linkElement) {\n                this.linkElement.onclick = null;\n            }\n        }\n    }\n    private sendTooltipQuery(geom: olPolygon): void {\n        if (!this.enabled) {\n            return;\n        }\n        if (this.isMouseOverTooltip) {\n            logger.debug(`Mouse over tooltip. Doing nothing`);\n            return;\n        }\n        //const selectedLayerNames = this.onRequestSelectableLayers();\n        //if (selectedLayerNames != null && selectedLayerNames.length == 0) {\n        //    return;\n        //}\n        const reqQueryFeatures = 4 | 8; //Tooltips and hyperlinks\n        const wkt = this.wktFormat.writeGeometry(geom);\n        const client = new Client(this.callback.getAgentUri(), this.callback.getAgentKind());\n\n        //This is probably a case of blink and you'll miss\n        //\n        //this.featureTooltipElement.innerHTML = \"Querying tooltip data ...\";\n        //this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n        const coords = olExtent.getCenter(geom.getExtent());\n        this.featureTooltip.setPosition(coords);\n        this.callback.incrementBusyWorker();\n        client.queryMapFeatures({\n            mapname: this.callback.getMapName(),\n            session: this.callback.getSessionId(),\n            //layernames: selectedLayerNames != null ? selectedLayerNames.join(\",\") : null,\n            geometry: wkt,\n            persist: 0,\n            selectionvariant: \"INTERSECTS\",\n            maxfeatures: 1,\n            requestdata: reqQueryFeatures,\n            layerattributefilter: 5\n        }).then(res => {\n            let html = \"\";\n            if (res.Tooltip) {\n                html += `<div class='feature-tooltip-body'>${res.Tooltip.replace(/\\\\n/g, \"<br/>\")}</div>`;\n            }\n            if (res.Hyperlink) {\n                html += `<div><a id='feature-tooltip-link' href='${res.Hyperlink}'>${tr(\"FEATURE_TOOLTIP_URL_HELP_TEXT\", this.callback.getLocale())}</a></div>`;\n            }\n            this.featureTooltipElement.innerHTML = html;\n            this.linkElement = document.getElementById(\"feature-tooltip-link\");\n            this.setLinkClickHandler();\n            if (html == \"\") {\n                this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n                if (this.linkElement) {\n                    this.linkElement.onclick = null;\n                }\n            } else {\n                this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n            }\n        }).then(() => {\n            this.callback.decrementBusyWorker();\n        }).catch(err => {\n            this.callback.decrementBusyWorker();\n            if (isSessionExpiredError(err)) {\n                this.callback.onSessionExpired();\n            }\n        });\n    }\n    private setLinkClickHandler = () => {\n        if (this.linkElement) {\n            this.linkElement.onclick = this.handleLinkClick;\n        }\n    }\n    private handleLinkClick = (e: any) => {\n        e.preventDefault();\n        this.callback.openTooltipLink(e.target.href);\n        return false;\n    }\n}","import { RefreshMode, IExternalBaseLayer, Bounds, LayerTransparencySet, LayerProperty, MgBuiltInLayers, MgLayerType, MG_LAYER_TYPE_NAME, MG_BASE_LAYER_GROUP_NAME, SourceProperty, ILayerInfo } from './common';\nimport { Size, BLANK_SIZE } from '../containers/map-capturer-context';\nimport olLayerGroup from \"ol/layer/Group\";\nimport olTileGrid from \"ol/tilegrid/TileGrid\";\nimport olSource from \"ol/source/Source\";\nimport olImageSource, { defaultImageLoadFunction } from \"ol/source/Image\";\nimport olTileImageSource from \"ol/source/TileImage\";\nimport createMapGuideSource, { isMapGuideImageSource } from \"./ol-mapguide-source-factory\";\nimport olImageStaticSource from \"ol/source/ImageStatic\";\nimport olMapGuideSource from \"ol/source/ImageMapGuide\";\nimport { LAYER_ID_BASE, LAYER_ID_MG_BASE, LAYER_ID_MG_SEL_OVERLAY, BLANK_GIF_DATA_URI } from \"../constants/index\";\nimport { restrictToRange } from \"../utils/number\";\nimport olView from \"ol/View\";\nimport * as olExtent from \"ol/extent\";\nimport olTileLayer from \"ol/layer/Tile\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olLayerBase from \"ol/layer/Base\";\nimport { IMapViewerContextCallback, IMapViewerContextProps, MapGuideMockMode } from '../components/map-viewer-context';\nimport { RuntimeMap } from './contracts/runtime-map';\nimport * as logger from '../utils/logger';\nimport { createExternalSource } from '../components/external-layer-factory';\nimport { strIsNullOrEmpty } from '../utils/string';\nimport { parseUrl } from '../utils/url';\nimport ImageWrapper from 'ol/Image';\nimport { tr } from './i18n';\nimport olMap from \"ol/Map\";\nimport olOverviewMap from \"ol/control/OverviewMap\";\nimport { MgError } from './error';\nimport { setOLVectorLayerStyle } from './ol-style-helpers';\nimport olVectorLayer from \"ol/layer/Vector\";\nimport olSourceVector from \"ol/source/Vector\";\nimport { getLayerInfo } from './layer-manager';\nimport * as olHas from \"ol/has\";\nimport Feature from \"ol/Feature\";\nimport { assertNever } from '../utils/never';\n\nfunction blankImageLoadFunction(image: ImageWrapper) {\n    (image.getImage() as any).src = BLANK_GIF_DATA_URI;\n}\n\nfunction mockMapGuideImageLoadFunction(image: ImageWrapper, src: string) {\n    let el = document.getElementById(\"mg-debug-text-canvas\");\n    if (!el) {\n        el = document.createElement(\"canvas\");\n        el.style.visibility = \"hidden\";\n        el.id = \"mg-debug-text-canvas\";\n        document.body.append(el);\n    }\n    const tCtx = (el as HTMLCanvasElement).getContext(\"2d\");\n    if (tCtx) {\n        tCtx.clearRect(0, 0, tCtx.canvas.width, tCtx.canvas.height);\n\n        const strings = [];\n        const parsed = parseUrl(src);\n        strings.push(\"[Mock MapGuide Map Image Request]\");\n        strings.push(`Agent: ${parsed.url}`);\n\n        const xoff = 10;\n        const yoff = 30;\n        const fontSize = 14;\n        let mm = tCtx.measureText(strings[0])\n        let maxSize = mm.width + xoff;\n\n        let ch = yoff + fontSize + 2;\n\n        maxSize = Math.max(tCtx.measureText(strings[1]).width + xoff, maxSize);\n        ch += (fontSize + 2);\n\n        const keys = Object.keys(parsed.query);\n        for (const k of keys) {\n            if (k == \"MAPNAME\" || k == \"SETDISPLAYWIDTH\" || k == \"SETDISPLAYHEIGHT\" || k == \"SETVIEWCENTERX\" || k == \"SETVIEWCENTERY\" || k == \"SETVIEWSCALE\") {\n                if (!strIsNullOrEmpty(parsed.query[k])) {\n                    const s = `${k}: ${parsed.query[k]}`;\n                    strings.push(s);\n                    maxSize = Math.max(tCtx.measureText(s).width + xoff, maxSize);\n                    ch += (fontSize + 2);\n                }\n            }\n        }\n\n        tCtx.canvas.width = maxSize;\n        tCtx.canvas.height = ch;\n        tCtx.fillStyle = \"rgba(255, 0, 0, 0.5)\";\n        tCtx.fillRect(0, 0, maxSize, ch);\n\n        tCtx.fillStyle = \"rgba(255, 255, 0, 1.0)\";\n        //console.log(`Canvas size: [${tCtx.canvas.width}, ${tCtx.canvas.height}]`);\n        tCtx.font = `${fontSize}px sans-serif`;\n\n        let y = yoff;\n        for (const str of strings) {\n            //console.log(`Draw (${str}) at [10, ${y}]`);\n            tCtx.fillText(str, 10, y);\n            y += (fontSize + 1);\n        }\n        (image.getImage() as any).src = tCtx.canvas.toDataURL();\n    }\n}\n\nexport interface ILayerSetOL {\n    view: olView;\n    extent: olExtent.Extent;\n    dpi: number;\n    projection: string | undefined;\n    scaleToResolution(scale: number): number;\n    resolutionToScale(resolution: number): number;\n    refreshMap(mode: RefreshMode): void;\n    getMetersPerUnit(): number;\n    getLayers(): olLayerBase[];\n    getSourcesForProgressTracking(): olSource[];\n    updateExternalBaseLayers(externalBaseLayers: IExternalBaseLayer[]): void;\n    updateTransparency(trans: LayerTransparencySet): void;\n    // ====== This is MapGuide-specific ======== //\n    showActiveSelectedFeature(mapExtent: Bounds, size: Size, uri: string): void;\n    update(showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined): void;\n    updateSelectionColor(color: string): void;\n}\n\nclass MgLayerSetInner implements ILayerSetOL {\n    constructor(public readonly mgTiledLayers: olTileLayer[],\n        public readonly externalBaseLayersGroup: olLayerGroup | undefined,\n        public readonly overlay: olImageLayer,\n        public readonly projection: string | undefined,\n        public readonly dpi: number,\n        public readonly extent: Bounds,\n        private readonly inPerUnit: number,\n        public readonly view: olView) { }\n\n    public selectionOverlay: olImageLayer | undefined;\n    public activeSelectedFeatureOverlay: olImageLayer | undefined;\n\n    public getMetersPerUnit(): number {\n        return this.inPerUnit / 39.37\n    }\n    public scaleToResolution(scale: number): number {\n        return (scale / this.inPerUnit / this.dpi) * olHas.DEVICE_PIXEL_RATIO;\n    }\n    public resolutionToScale(resolution: number): number {\n        return (resolution * this.dpi * this.inPerUnit) / olHas.DEVICE_PIXEL_RATIO;\n    }\n    public getSourcesForProgressTracking(): olSource[] {\n        const sources: olSource[] = [];\n        if (this.externalBaseLayersGroup) {\n            const bls = this.externalBaseLayersGroup.getLayersArray();\n            for (const bl of bls) {\n                if (bl instanceof olImageLayer || bl instanceof olTileLayer) {\n                    sources.push(bl.getSource());\n                }\n            }\n        }\n        for (let i = this.mgTiledLayers.length - 1; i >= 0; i--) {\n            sources.push(this.mgTiledLayers[i].getSource());\n        }\n        sources.push(this.overlay.getSource());\n        if (this.selectionOverlay) {\n            sources.push(this.selectionOverlay.getSource());\n        }\n        if (this.activeSelectedFeatureOverlay) {\n            sources.push(this.activeSelectedFeatureOverlay.getSource());\n        }\n        return sources;\n    }\n    public getLayers(): olLayerBase[] {\n        const layers: olLayerBase[] = [];\n        if (this.externalBaseLayersGroup) {\n            layers.push(this.externalBaseLayersGroup);\n        }\n        for (let i = this.mgTiledLayers.length - 1; i >= 0; i--) {\n            layers.push(this.mgTiledLayers[i]);\n        }\n        layers.push(this.overlay);\n        if (this.selectionOverlay) {\n            layers.push(this.selectionOverlay);\n        }\n        if (this.activeSelectedFeatureOverlay) {\n            layers.push(this.activeSelectedFeatureOverlay);\n        }\n        return layers;\n    }\n    public update(showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined) {\n        //Send the request\n        const imgSource = this.overlay.getSource() as any; //olMapGuideSource;\n        //NOTE: Even if these group ids being shown/hidden are MG base layer groups, it still has to be\n        //done as the server-side snapshot of the runtime map needs to be aware as well. This will be\n        //apparent if you were to plot a runtime-map server-side that has base layer groups.\n        imgSource.updateParams({\n            showlayers: showLayers,\n            showgroups: showGroups,\n            hidelayers: hideLayers,\n            hidegroups: hideGroups\n        });\n        //As MG base layer groups are separate ol layer instances, we have to toggle them on the client-side as well\n        if (showGroups && showGroups.length > 0) {\n            for (const groupId of showGroups) {\n                const match = this.mgTiledLayers.filter(l => l.get(LayerProperty.LAYER_NAME) === groupId);\n                if (match.length == 1) {\n                    match[0].setVisible(true);\n                }\n            }\n        }\n        if (hideGroups && hideGroups.length > 0) {\n            for (const groupId of hideGroups) {\n                const match = this.mgTiledLayers.filter(l => l.get(LayerProperty.LAYER_NAME) === groupId);\n                if (match.length == 1) {\n                    match[0].setVisible(false);\n                }\n            }\n        }\n    }\n    public updateSelectionColor(color: string) {\n        if (this.selectionOverlay) {\n            const source = this.selectionOverlay.getSource() as any; // olMapGuideSource;\n            source.updateParams({\n                SELECTIONCOLOR: color\n            });\n        }\n    }\n    public updateExternalBaseLayers(externalBaseLayers: IExternalBaseLayer[]) {\n        if (this.externalBaseLayersGroup) {\n            const layers = this.externalBaseLayersGroup.getLayers();\n            layers.forEach((l: olLayerBase) => {\n                const match = (externalBaseLayers || []).filter(el => el.name === l.get(\"title\"));\n                if (match.length == 1) {\n                    l.setVisible(!!match[0].visible);\n                } else {\n                    l.setVisible(false);\n                }\n            });\n        }\n    }\n    public updateTransparency(trans: LayerTransparencySet) {\n        //If no external layers defined, this won't be set\n        if (this.externalBaseLayersGroup) {\n            if (LAYER_ID_BASE in trans) {\n                this.externalBaseLayersGroup.setOpacity(restrictToRange(trans[LAYER_ID_BASE], 0, 1.0));\n            } else {\n                this.externalBaseLayersGroup.setOpacity(1.0);\n            }\n        }\n\n        if (LAYER_ID_MG_BASE in trans) {\n            const opacity = restrictToRange(trans[LAYER_ID_MG_BASE], 0, 1.0);\n            this.overlay.setOpacity(opacity);\n            for (const group of this.mgTiledLayers) {\n                group.setOpacity(opacity);\n            }\n        } else {\n            this.overlay.setOpacity(1.0);\n            for (const group of this.mgTiledLayers) {\n                group.setOpacity(1.0);\n            }\n        }\n\n        if (this.selectionOverlay) {\n            if (LAYER_ID_MG_SEL_OVERLAY in trans) {\n                this.selectionOverlay.setOpacity(restrictToRange(trans[LAYER_ID_MG_SEL_OVERLAY], 0, 1.0));\n            } else {\n                this.selectionOverlay.setOpacity(1.0);\n            }\n        }\n    }\n    public refreshMap(mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void {\n        if ((mode & RefreshMode.LayersOnly) == RefreshMode.LayersOnly) {\n            const imgSource = this.overlay.getSource() as any; // olMapGuideSource;\n            imgSource.updateParams({\n                seq: (new Date()).getTime()\n            });\n        }\n        if (this.selectionOverlay) {\n            if ((mode & RefreshMode.SelectionOnly) == RefreshMode.SelectionOnly) {\n                const imgSource = this.selectionOverlay.getSource() as any; // olMapGuideSource;\n                imgSource.updateParams({\n                    seq: (new Date()).getTime()\n                });\n            }\n        }\n    }\n    private makeActiveSelectedFeatureSource(mapExtent: Bounds, size: Size, url: string = BLANK_GIF_DATA_URI) {\n        return new olImageStaticSource({\n            imageExtent: mapExtent,\n            imageSize: [size.w, size.h],\n            url: url\n        });\n    }\n    public showActiveSelectedFeature(mapExtent: Bounds, size: Size, uri: string) {\n        if (this.activeSelectedFeatureOverlay) {\n            this.activeSelectedFeatureOverlay.setSource(this.makeActiveSelectedFeatureSource(mapExtent, size, uri));\n            this.activeSelectedFeatureOverlay.setVisible(true);\n        }\n    }\n}\n\nclass MgInnerLayerSetFactory {\n    private dynamicOverlayParams: any;\n    private staticOverlayParams: any;\n    private selectionOverlayParams: any;\n    constructor(private callback: IMapViewerContextCallback,\n        private map: RuntimeMap,\n        private agentUri: string,\n        imageFormat: string,\n        selectionImageFormat: string | undefined,\n        selectionColor: string | undefined) {\n        this.dynamicOverlayParams = {\n            MAPNAME: map.Name,\n            FORMAT: imageFormat,\n            SESSION: map.SessionId,\n            BEHAVIOR: 2\n        };\n        this.staticOverlayParams = {\n            MAPDEFINITION: map.MapDefinition,\n            FORMAT: imageFormat,\n            CLIENTAGENT: \"ol.source.ImageMapGuide for OverviewMap\",\n            USERNAME: \"Anonymous\",\n            VERSION: \"3.0.0\"\n        };\n        this.selectionOverlayParams = {\n            MAPNAME: map.Name,\n            FORMAT: selectionImageFormat || \"PNG8\",\n            SESSION: map.SessionId,\n            SELECTIONCOLOR: selectionColor,\n            BEHAVIOR: 1 | 4 //selected features + include outside current scale\n        };\n    }\n    private getTileUrlFunctionForGroup(resourceId: string, groupName: string, zOrigin: number) {\n        const urlTemplate = this.callback.getClient().getTileTemplateUrl(resourceId, groupName, '{x}', '{y}', '{z}');\n        return function (tileCoord: [number, number, number]) {\n            return urlTemplate\n                .replace('{z}', (zOrigin - tileCoord[0]).toString())\n                .replace('{x}', tileCoord[1].toString())\n                .replace('{y}', (-tileCoord[2] - 1).toString());\n        };\n    }\n    public create(locale: string | undefined,\n        externalBaseLayers: IExternalBaseLayer[] | undefined,\n        isNotForOverviewMap: boolean): ILayerSetOL {\n        const { map, agentUri } = this;\n        //If a tile set definition is defined it takes precedence over the map definition, this enables\n        //this example to work with older releases of MapGuide where no such resource type exists.\n        const resourceId = map.TileSetDefinition || map.MapDefinition;\n        //On MGOS 2.6 or older, tile width/height is never returned, so default to 300x300\n        const tileWidth = map.TileWidth || 300;\n        const tileHeight = map.TileHeight || 300;\n        const metersPerUnit = map.CoordinateSystem.MetersPerUnit;\n        const finiteScales = [] as number[];\n        if (map.FiniteDisplayScale) {\n            for (let i = map.FiniteDisplayScale.length - 1; i >= 0; i--) {\n                finiteScales.push(map.FiniteDisplayScale[i]);\n            }\n        }\n        const extent: olExtent.Extent = [\n            map.Extents.LowerLeftCoordinate.X,\n            map.Extents.LowerLeftCoordinate.Y,\n            map.Extents.UpperRightCoordinate.X,\n            map.Extents.UpperRightCoordinate.Y\n        ];\n        const dpi = map.DisplayDpi;\n        const inPerUnit = 39.37 * map.CoordinateSystem.MetersPerUnit;\n        const resolutions = new Array(finiteScales.length);\n        let projection: string | undefined;\n        for (let i = 0; i < finiteScales.length; ++i) {\n            resolutions[i] = finiteScales[i] / inPerUnit / dpi;\n        }\n\n        if (map.CoordinateSystem.EpsgCode.length > 0) {\n            projection = `EPSG:${map.CoordinateSystem.EpsgCode}`;\n        }\n\n        const tileGrid = new olTileGrid({\n            origin: olExtent.getTopLeft(extent),\n            resolutions: resolutions,\n            tileSize: [tileWidth, tileHeight]\n        });\n\n        const zOrigin = finiteScales.length - 1;\n        const mgTiledLayers = [];\n\n        //const groupLayers = [] as olTileLayer[];\n        if (map.Group) {\n            for (let i = 0; i < map.Group.length; i++) {\n                const group = map.Group[i];\n                if (group.Type != 2 && group.Type != 3) { //BaseMap or LinkedTileSet\n                    continue;\n                }\n                const tileSource = new olTileImageSource({\n                    tileGrid: tileGrid,\n                    projection: projection,\n                    tileUrlFunction: this.getTileUrlFunctionForGroup(resourceId, group.Name, zOrigin),\n                    wrapX: false\n                });\n                const tileLayer = new olTileLayer({\n                    //name: group.Name,\n                    source: tileSource\n                });\n                tileLayer.set(LayerProperty.LAYER_NAME, group.ObjectId);\n                tileLayer.set(LayerProperty.LAYER_TYPE, MgLayerType.Tiled);\n                tileLayer.set(LayerProperty.IS_EXTERNAL, false);\n                tileLayer.set(LayerProperty.IS_GROUP, false);\n                tileLayer.setVisible(group.Visible);\n                //groupLayers.push(tileLayer);\n                mgTiledLayers.push(tileLayer);\n            }\n        }\n        /*\n        if (groupLayers.length > 0) {\n            groupLayers.push(\n                new ol.layer.Tile({\n                    source: new ol.source.TileDebug({\n                        tileGrid: tileGrid,\n                        projection: projection,\n                        tileUrlFunction: function(tileCoord) {\n                            return urlTemplate.replace('{z}', (zOrigin - tileCoord[0]).toString())\n                                .replace('{x}', tileCoord[1].toString())\n                                .replace('{y}', (-tileCoord[2] - 1).toString());\n                        },\n                        wrapX: false\n                    })\n                })\n            );\n        }\n        */\n        const overlay = this.createMgOverlayLayer(MgBuiltInLayers.Overlay, agentUri, metersPerUnit, projection, isNotForOverviewMap, isNotForOverviewMap ? this.dynamicOverlayParams : this.staticOverlayParams);\n\n        let selectionOverlay: olImageLayer | undefined;\n        let activeSelectedFeatureOverlay: olImageLayer | undefined;\n        if (isNotForOverviewMap) {\n            selectionOverlay = this.createMgOverlayLayer(MgBuiltInLayers.SelectionOverlay, agentUri, metersPerUnit, projection, isNotForOverviewMap, this.selectionOverlayParams);\n        }\n        if (isNotForOverviewMap) {\n            //NOTE: Not tracking this source atm\n            activeSelectedFeatureOverlay = new olImageLayer({\n                //OL6: need to specify a source up-front otherwise it will error blindly\n                //trying to get a source out of this URL, so set up a source with an empty\n                //image data URI, it will be updated if we receive a request to show an\n                //active selected feature image\n                source: new olImageStaticSource({\n                    imageExtent: extent,\n                    imageSize: [BLANK_SIZE.w, BLANK_SIZE.h],\n                    url: BLANK_GIF_DATA_URI\n                })\n            });\n            activeSelectedFeatureOverlay.set(LayerProperty.LAYER_NAME, MgBuiltInLayers.ActiveFeatureSelectionOverlay);\n            activeSelectedFeatureOverlay.set(LayerProperty.LAYER_TYPE, MG_LAYER_TYPE_NAME);\n            activeSelectedFeatureOverlay.set(LayerProperty.IS_EXTERNAL, false)\n            activeSelectedFeatureOverlay.set(LayerProperty.IS_GROUP, false);\n        }\n        let externalBaseLayersGroup: olLayerGroup | undefined;\n        //NOTE: Don't bother adding external base layers for overview map as the main map in the\n        //overview is rendered with GETMAPIMAGE and not GETDYNAMICMAPOVERLAYIMAGE meaning the background\n        //is opaque and you won't be able to see the base layers underneath anyways.\n        if (isNotForOverviewMap && externalBaseLayers != null) {\n            const groupOpts: any = {\n                title: tr(\"EXTERNAL_BASE_LAYERS\", locale),\n                layers: externalBaseLayers.map(ext => {\n                    const tl = this.createExternalBaseLayer(ext);\n                    return tl;\n                })\n            };\n            externalBaseLayersGroup = new olLayerGroup(groupOpts);\n            externalBaseLayersGroup.set(LayerProperty.LAYER_NAME, MG_BASE_LAYER_GROUP_NAME);\n            externalBaseLayersGroup.set(LayerProperty.IS_EXTERNAL, false);\n            externalBaseLayersGroup.set(LayerProperty.IS_GROUP, true);\n        }\n\n        logger.debug(`Creating OL view with projection ${projection} and ${resolutions.length} resolutions`);\n        let view: olView;\n        if (resolutions.length == 0) {\n            view = new olView({\n                projection: projection\n            });\n        } else {\n            view = new olView({\n                projection: projection,\n                resolutions: resolutions\n            });\n        }\n\n        const layerSet = new MgLayerSetInner(mgTiledLayers,\n            externalBaseLayersGroup,\n            overlay,\n            projection,\n            dpi,\n            extent,\n            inPerUnit,\n            view);\n        layerSet.selectionOverlay = selectionOverlay;\n        layerSet.activeSelectedFeatureOverlay = activeSelectedFeatureOverlay;\n        return layerSet;\n    }\n    private createExternalBaseLayer(ext: IExternalBaseLayer) {\n        const extSource = createExternalSource(ext);\n        const options: any = {\n            title: ext.name,\n            type: \"base\",\n            visible: ext.visible === true,\n            source: extSource\n        };\n        const tl = new olTileLayer(options);\n        tl.set(LayerProperty.LAYER_TYPE, ext.kind);\n        tl.set(LayerProperty.LAYER_NAME, ext.name);\n        tl.set(LayerProperty.IS_EXTERNAL, false);\n        tl.set(LayerProperty.IS_GROUP, false);\n        return tl;\n    }\n    private createMgOverlayLayer(layerName: string, agentUri: string, metersPerUnit: number, projection: string | undefined, useImageOverlayOp: boolean, params: any): olImageLayer {\n        const overlaySource = createMapGuideSource({\n            projection: projection,\n            url: agentUri,\n            useOverlay: useImageOverlayOp,\n            metersPerUnit: metersPerUnit,\n            params: params,\n            ratio: 1,\n            // For mobile devices with retina/hidpi displays, the default 96 DPI produces\n            // really low quality map images. For such devices, the DPI should be some\n            // function of the device pixel ratio reported. As this value can be fractional\n            // round it down to the nearest integer\n            displayDpi: Math.floor(olHas.DEVICE_PIXEL_RATIO) * 96\n        });\n        const layer = new olImageLayer({\n            //name: \"MapGuide Dynamic Overlay\",\n            source: overlaySource\n        });\n        layer.set(LayerProperty.LAYER_NAME, layerName);\n        layer.set(LayerProperty.LAYER_TYPE, MG_LAYER_TYPE_NAME);\n        layer.set(LayerProperty.IS_EXTERNAL, false);\n        layer.set(LayerProperty.IS_GROUP, false);\n        return layer;\n    }\n}\n\nexport class MgLayerSet {\n\n    private mainSet: ILayerSetOL;\n    private overviewSet: ILayerSetOL;\n    private scratchLayer: olVectorLayer;\n\n    private callback: IMapViewerContextCallback;\n    private _customLayers: {\n        [name: string]: {\n            layer: olLayerBase,\n            order: number\n        }\n    };\n    constructor(props: IMapViewerContextProps, callback: IMapViewerContextCallback) {\n        this.callback = callback;\n        this._customLayers = {};\n        const factory = new MgInnerLayerSetFactory(callback, props.map, props.agentUri, props.imageFormat, props.selectionImageFormat, props.selectionColor);\n\n        //NOTE: MapGuide does not like concurrent map rendering operations of the same mapname/session pair, which\n        //this will do when the MG overlay is shared between the main viewer and the overview map. This is probably\n        //because the concurrent requests both have SET[X/Y/SCALE/DPI/etc] parameters attached, so there is concurrent\n        //requests to modify and persist the runtime map state (in addition to the rendering) and there is most likely\n        //server-side lock contention to safely update the map state. Long story short: re-using the main overlay for the\n        //OverviewMap control IS A BAD THING. Same thing happens with selection overlays\n        //\n        //As of OL6, this unwanted behavior from shared layers extends to all layer types, so what this means is that\n        //we have to create 2 sets of layers, one for the main map and one for the overview map. We CANNOT and DO NOT share\n        //any of these layer instances between the main map and the overview map!\n\n        this.mainSet = factory.create(props.locale, props.externalBaseLayers, true);\n        this.overviewSet = factory.create(props.locale, props.externalBaseLayers, false);\n        const progressNotifySources = this.mainSet.getSourcesForProgressTracking();\n        /*\n        console.log(\"Draw Order:\");\n        for (let i = 0; i < layers.length; i++) {\n            console.log(\" \" + layers[i].get(LayerProperty.LAYER_NAME));\n        }\n        */\n\n        for (const src of progressNotifySources) {\n            const suppress: boolean | undefined = src.get(SourceProperty.SUPPRESS_LOAD_EVENTS);\n            if (!(suppress == true))\n                this.registerSourceEvents(src);\n        }\n\n        this.scratchLayer = new olVectorLayer({\n            source: new olSourceVector()\n        });\n        this.scratchLayer.set(LayerProperty.IS_SCRATCH, true);\n    }\n    public addScratchFeature(feat: Feature) {\n        this.scratchLayer.getSource().addFeature(feat);\n    }\n    public clearScratchLayer() {\n        this.scratchLayer.getSource().clear();\n    }\n    public setMapGuideMocking(mock: MapGuideMockMode | undefined) {\n        const allLayers = this.mainSet.getLayers();\n        for (const layer of allLayers) {\n            if (layer instanceof olImageLayer) {\n                const source = layer.getSource();\n                if (source instanceof olMapGuideSource) {\n                    if (typeof (mock) != 'undefined') {\n                        switch (mock) {\n                            case MapGuideMockMode.RenderPlaceholder:\n                                source.setImageLoadFunction(mockMapGuideImageLoadFunction);\n                                break;\n                            case MapGuideMockMode.DoNotRender:\n                                source.setImageLoadFunction(blankImageLoadFunction);\n                                break;\n                            default:\n                                assertNever(mock);\n                                break;\n                        }\n                    } else {\n                        source.setImageLoadFunction(defaultImageLoadFunction);\n                    }\n                }\n            }\n        }\n    }\n    private registerSourceEvents(source: olSource): void {\n        if (source instanceof olImageSource) {\n            source.on(\"imageloadstart\", this.callback.addImageLoading);\n            //onImageError is a MapGuide-specific callback\n            if (isMapGuideImageSource(source)) {\n                source.on(\"imageloaderror\", this.callback.onImageError);\n            }\n            source.on(\"imageloaderror\", this.callback.addImageLoaded);\n            source.on(\"imageloadend\", this.callback.addImageLoaded);\n        } else if (source instanceof olTileImageSource) {\n            source.on(\"tileloadstart\", this.callback.addImageLoading);\n            source.on(\"tileloaderror\", this.callback.addImageLoaded);\n            source.on(\"tileloadend\", this.callback.addImageLoaded);\n        }\n    }\n    public updateSelectionColor = (color: string) => this.mainSet.updateSelectionColor(color);\n    public updateExternalBaseLayers(externalBaseLayers: IExternalBaseLayer[]) {\n        this.mainSet.updateExternalBaseLayers(externalBaseLayers);\n        this.overviewSet.updateExternalBaseLayers(externalBaseLayers);\n    }\n    public updateTransparency = (trans: LayerTransparencySet) => this.mainSet.updateTransparency(trans);\n    public fitViewToExtent = () => this.mainSet.view.fit(this.mainSet.extent);\n    public getView = () => this.mainSet.view;\n    public getDpi = () => this.mainSet.dpi;\n    public getExtent = () => this.mainSet.extent;\n    public getLayersForOverviewMap = () => this.overviewSet.getLayers();\n    public getProjection = () => this.mainSet.projection;\n    public refreshMap = (mode: RefreshMode) => this.mainSet.refreshMap(mode);\n    public showActiveSelectedFeature = (mapExtent: Bounds, size: Size, uri: string) => this.mainSet.showActiveSelectedFeature(mapExtent, size, uri);\n    public getMetersPerUnit = () => this.mainSet.getMetersPerUnit();\n    public scaleToResolution = (scale: number) => this.mainSet.scaleToResolution(scale);\n    public resolutionToScale = (resolution: number) => this.mainSet.resolutionToScale(resolution);\n    public update = (showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined) => this.mainSet.update(showGroups, showLayers, hideGroups, hideLayers);\n    public attach(map: olMap, ovMapControl: olOverviewMap, bSetLayers = true): void {\n        // To guard against the possibility that we may be attaching layers to a map that\n        // already has layers (eg. Measurements), we reverse iterate all the layers we need to\n        // add and insert them to the front one-by-one, ensuring all the layers we add will be\n        // at the bottom of the draw order\n        const layers = map.getLayers();\n        // Attach scratch layer\n        layers.insertAt(0, this.scratchLayer);\n        // Attach custom layers\n        const customLayers = Object.keys(this._customLayers).map(k => this._customLayers[k]);\n        customLayers.sort((a, b) => {\n            return a.order - b.order;\n        });\n        for (const item of customLayers) {\n            layers.insertAt(0, item.layer);\n        }\n        // Then the regular layers\n        const allLayers = this.mainSet.getLayers();\n        for (let i = allLayers.length - 1; i >= 0; i--) {\n            layers.insertAt(0, allLayers[i]);\n        }\n        map.setView(this.mainSet.view);\n        if (bSetLayers) {\n            const ovMap = ovMapControl.getOverviewMap();\n            const ovLayers = this.getLayersForOverviewMap();\n            for (const layer of ovLayers) {\n                ovMap.addLayer(layer);\n            }\n            //ol.View has immutable projection, so we have to replace the whole view on the OverviewMap\n            const center = this.mainSet.view.getCenter();\n            if (center) {\n                ovMap.setView(new olView({\n                    center: [center[0], center[1]],\n                    resolution: this.mainSet.view.getResolution(),\n                    projection: this.mainSet.view.getProjection()\n                }));\n            } else {\n                const view = new olView({\n                    projection: this.mainSet.view.getProjection()\n                });\n                ovMap.setView(view);\n                view.fit(this.mainSet.extent, { size: ovMap.getSize() });\n            }\n        }\n    }\n    public detach(map: olMap, ovMapControl: olOverviewMap): void {\n        const allLayers = this.mainSet.getLayers();\n        for (const layer of allLayers) {\n            map.removeLayer(layer);\n        }\n        //Detach custom layers\n        for (const layerName in this._customLayers) {\n            map.removeLayer(this._customLayers[layerName].layer);\n        }\n        //Detach scratch layer\n        map.removeLayer(this.scratchLayer);\n        const ovLayers = this.getLayersForOverviewMap();\n        const ovMap = ovMapControl.getOverviewMap();\n        for (const layer of ovLayers) {\n            ovMap.removeLayer(layer);\n        }\n    }\n\n    public getCustomLayers(map: olMap): ILayerInfo[] {\n        const larr = map.getLayers().getArray();\n        const layers = larr\n            .filter(l => this._customLayers[l.get(LayerProperty.LAYER_NAME)] != null)\n            .map(l => ({\n                ...getLayerInfo(l, true),\n                //Smuggle these values out for debugging purposes\n                isSelectable: this._customLayers[l.get(LayerProperty.LAYER_NAME)].layer.get(LayerProperty.IS_SELECTABLE) == true,\n                order: this._customLayers[l.get(LayerProperty.LAYER_NAME)].order\n            }));\n        return layers.reverse();\n    }\n    public hasLayer(name: string): boolean {\n        return this._customLayers[name] != null;\n    }\n    public addLayer<T extends olLayerBase>(map: olMap, name: string, layer: T, allowReplace?: boolean): T {\n        const bAllow = !!allowReplace;\n        if (this._customLayers[name]) {\n            if (!bAllow) {\n                throw new MgError(tr(\"LAYER_NAME_EXISTS\", this.callback.getLocale(), { name: name }));\n            } else {\n                //Remove the layer that is about to be replaced first \n                map.removeLayer(this._customLayers[name].layer);\n            }\n        }\n        map.addLayer(layer);\n        this._customLayers[name] = { layer, order: map.getLayers().getArray().indexOf(layer) };\n        layer.set(LayerProperty.LAYER_NAME, name);\n        return layer;\n    }\n    public removeLayer(map: olMap, name: string): olLayerBase | undefined {\n        let layer: olLayerBase;\n        if (this._customLayers[name]) {\n            layer = this._customLayers[name].layer;\n            map.removeLayer(layer);\n            delete this._customLayers[name];\n            return layer;\n        }\n    }\n    public getLayer<T extends olLayerBase>(name: string): T | undefined {\n        let layer: T | undefined;\n        if (this._customLayers[name]) {\n            layer = this._customLayers[name]?.layer as T;\n        }\n        return layer;\n    }\n    public apply(map: olMap, layers: ILayerInfo[]): void {\n        const layersByName = layers.reduce((current, layer) => {\n            current[layer.name] = layer;\n            return current;\n        }, {} as any);\n        //Apply opacity/visibility/styling and other top-level properties\n        for (const layer of layers) {\n            const oll = this._customLayers[layer.name]?.layer;\n            if (oll) {\n                oll.setVisible(layer.visible);\n                oll.setOpacity(layer.opacity);\n                oll.set(LayerProperty.BUSY_WORKER_COUNT, layer.busyWorkerCount);\n                if (oll instanceof olVectorLayer && layer.vectorStyle) {\n                    setOLVectorLayerStyle(oll, layer.vectorStyle);\n                }\n            }\n        }\n        //Apply removals \n        for (const layerName in this._customLayers) {\n            if (!layersByName[layerName]) {\n                this.removeLayer(map, layerName);\n            }\n        }\n\n        //Fix order if required\n        //First item, top-most\n        //Last item, bottom-most\n        const cCurrentLayers = map.getLayers();\n        const aCurrentLayers = cCurrentLayers.getArray();\n        const currentLayers = aCurrentLayers.map(l => ({\n            name: l.get(LayerProperty.LAYER_NAME),\n            type: l.get(LayerProperty.LAYER_TYPE),\n            isExternal: l.get(LayerProperty.IS_EXTERNAL),\n            isGroup: l.get(LayerProperty.IS_GROUP),\n            layer: l\n        })).filter(l => l.isExternal == true);\n        //console.assert(currentLayers.length == layers.length);\n        //console.table(currentLayers);\n        //console.table(layers);\n        let bReorder = false;\n        let ii = 0;\n        for (let i = layers.length - 1; i >= 0; i--) {\n            const layer = layers[i];\n            //console.log(`Checking if layer (${layer.name}) needs re-ordering`);\n            if (layer.name != currentLayers[ii].name) {\n                bReorder = true;\n                break;\n            }\n            ii++;\n        }\n        if (bReorder) {\n            //console.log(\"Re-ordering layers\");\n            for (const toRemove of currentLayers) {\n                map.removeLayer(toRemove.layer);\n            }\n            //Re-add in order according to layers array\n            for (let i = layers.length - 1; i >= 0; i--) {\n                const toAdd = currentLayers.filter(l => l.name == layers[i].name)[0];\n                map.addLayer(toAdd.layer);\n                const item = this._customLayers[layers[i].name];\n                if (item) {\n                    item.order = cCurrentLayers.getArray().indexOf(toAdd.layer);\n                }\n            }\n        }\n    }\n}","import { MapGuideImageSourceOptions, IMapGuideImageSource } from \"./common\";\n//import { MapGuideImageSource } from \"./ol-mapguide-source\";\nimport olMapGuideSource from \"ol/source/ImageMapGuide\";\n\n/**\n * @hidden\n */\nexport function isMapGuideImageSource(arg: any): arg is IMapGuideImageSource {\n    return typeof(arg.updateParams) != 'undefined';\n}\n\n/**\n * @hidden\n */\nexport default function createMapGuideSource(options: MapGuideImageSourceOptions): olMapGuideSource {\n    //const ctor: any = MapGuideImageSource;\n    //const source = new ctor(options);\n    const source = new olMapGuideSource(options);\n    return source;\n}","import { MgError } from \"../api/error\";\nimport { IExternalBaseLayer } from \"../api/common\";\nimport olSource from \"ol/source/Source\";\nimport XYZ from \"ol/source/XYZ\";\nimport OSM from \"ol/source/OSM\";\nimport Stamen from \"ol/source/Stamen\";\nimport BingMaps from \"ol/source/BingMaps\";\n\ninterface OLSourceCtor {\n    new (options?: any): olSource;\n}\n\n/**\n * Creates an OpenLayers source based on the given external base layer definition\n *\n * @export\n * @param {IExternalBaseLayer} layer\n * @returns\n */\nexport function createExternalSource(layer: IExternalBaseLayer): olSource {\n    let sourceCtor: OLSourceCtor;\n\n    switch (layer.kind) {\n        case \"XYZ\":\n            sourceCtor = XYZ;\n            break;\n        case \"OSM\":\n            sourceCtor = OSM;\n            break;\n        case \"Stamen\":\n            sourceCtor = Stamen;\n            break;\n        case \"BingMaps\":\n            sourceCtor = BingMaps;\n            break;\n        default:\n            throw new MgError(`Unknown external base layer provider: ${layer.kind}`);\n    }\n    if (typeof(layer.options) != 'undefined')\n        return new sourceCtor(layer.options);\n    else\n        return new sourceCtor();\n}","import olMap from \"ol/Map\";\nimport olOverlay from \"ol/Overlay\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olTileLayer from \"ol/layer/Tile\";\nimport olSourceWMS from \"ol/source/ImageWMS\";\nimport olSourceTileWMS from \"ol/source/TileWMS\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport OverlayPositioning from 'ol/OverlayPositioning';\nimport Collection from 'ol/Collection';\nimport Feature from 'ol/Feature';\nimport { tr } from '../../api/i18n';\nimport { ILayerManager, Coordinate2D } from '../../api/common';\nimport { Client } from '../../api/client';\nimport { IMapViewerContextCallback } from '../map-viewer-context';\nimport { parseEpsgCodeFromCRS } from '../layer-manager/wfs-capabilities-panel';\nimport { ProjectionLike } from '@hanreev/types-ol/ol/proj';\n\nexport class SelectedFeaturesTooltip {\n    private map: olMap;\n    private featureTooltipElement: HTMLElement;\n    private featureTooltip: olOverlay;\n    private enabled: boolean;\n    private isMouseOverTooltip: boolean;\n    private closerEl: HTMLElement | null;\n    constructor(map: olMap) {\n        this.featureTooltipElement = document.createElement(\"div\");\n        this.featureTooltipElement.addEventListener(\"mouseover\", () => this.isMouseOverTooltip = true);\n        this.featureTooltipElement.addEventListener(\"mouseout\", () => this.isMouseOverTooltip = false);\n        this.featureTooltipElement.className = 'selected-tooltip';\n        this.featureTooltip = new olOverlay({\n            element: this.featureTooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT // \"center-left\" /* ol.OverlayPositioning.CENTER_LEFT */\n        })\n        this.map = map;\n        this.map.addOverlay(this.featureTooltip);\n        this.enabled = true;\n        this.isMouseOverTooltip = false;\n    }\n    public get isMouseOver() { return this.isMouseOverTooltip; }\n    public isEnabled(): boolean {\n        return this.enabled;\n    }\n    public setEnabled(enabled: boolean): void {\n        this.enabled = enabled;\n        if (!this.enabled) {\n            this.featureTooltipElement.innerHTML = \"\";\n            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n        }\n    }\n    public hide() {\n        this.featureTooltipElement.innerHTML = \"\";\n        this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n    }\n    public async queryWmsFeatures(layerMgr: ILayerManager, coord: Coordinate2D, resolution: number, callback: IMapViewerContextCallback) {\n        let selected = 0;\n        //See what WMS layers we have\n        const client = new Client(\"\", \"mapagent\");\n        const format = new GeoJSON();\n        const layers = layerMgr.getLayers().filter(l => l.visible && l.selectable && l.type == \"WMS\");\n        for (const layer of layers) {\n            const wmsLayer = layerMgr.getLayer(layer.name);\n            if (wmsLayer instanceof olImageLayer || wmsLayer instanceof olTileLayer) {\n                const source = wmsLayer.getSource();\n                if (source instanceof olSourceWMS || source instanceof olSourceTileWMS) {\n                    const url = source.getFeatureInfoUrl(coord, resolution, this.map.getView().getProjection(), {\n                        'INFO_FORMAT': \"application/json\"\n                    });\n                    const resp = await client.getText(url);\n                    const json = JSON.parse(resp);\n                    if (json.features?.length > 0) {\n                        let srcProj: ProjectionLike = source.getProjection();\n                        if (!srcProj) {\n                            const epsg = parseEpsgCodeFromCRS(json.crs?.properties?.name);\n                            if (epsg) {\n                                srcProj = `EPSG:${epsg}`;\n                            }\n                        }\n                        const features = format.readFeatures(resp, {\n                            dataProjection: srcProj,\n                            featureProjection: this.map.getView().getProjection()\n                        });\n                        this.featureTooltip.setPosition(coord);\n                        const html = this.generateFeatureHtml(features[0], callback.getLocale());\n                        callback.addFeatureToHighlight(features[0], false);\n                        selected++;\n                        this.featureTooltipElement.innerHTML = html;\n                        this.closerEl = document.getElementById(\"feat-popup-closer\");\n                        this.setPopupCloseHandler();\n                        if (html == \"\") {\n                            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n                        } else {\n                            this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n                        }\n                        return;\n                    }\n                }\n            }\n        }\n        // Clear if there was no selection made\n        if (selected == 0) {\n            callback.addFeatureToHighlight(undefined, false);\n            this.hide();\n        }\n    }\n    private generateFeatureHtml(feat: Feature, locale?: string) {\n        let html = \"\";\n        html += \"<div style='min-width: 190px'><div style='float: left; font-weight: bold; font-size: 1.3em'>\" + tr(\"SEL_FEATURE_PROPERTIES\", locale) + \"</div><a id='feat-popup-closer' href='#' style='float: right'>[x]</a><div class='clear: both'></div></div>\";\n        var table = \"<table style='margin-top: 25px'>\";\n        const f = feat.getProperties();\n        let pc = 0;\n        for (const key in f) {\n            if (key == feat.getGeometryName()) {\n                continue;\n            }\n            table += \"<tr>\";\n            table += \"<td><strong>\" + key + \"</strong></td>\";\n            table += \"<td>\" + f[key] + \"</td>\";\n            table += \"</tr>\";\n            pc++;\n        }\n        table += \"</table>\";\n        if (pc > 0) {\n            html += table;\n        } else {\n            html += \"<p>\" + tr(\"SEL_FEATURE_PROPERTIES_NONE\", locale) + \"</p>\";\n        }\n        return html;\n    }\n    private setPopupCloseHandler = () => {\n        if (this.closerEl) {\n            this.closerEl.onclick = this.closePopup;\n        }\n    }\n    private closePopup = (e: any) => {\n        e.preventDefault();\n        this.hide();\n        if (this.closerEl) {\n            this.closerEl.onclick = null;\n        }\n        return false;\n    };\n    public showSelectedVectorFeatures(features: Collection<Feature>, pixel: [number, number], locale?: string) {\n        const coords = this.map.getCoordinateFromPixel(pixel);\n        if (features.getLength() > 0) {\n            this.featureTooltip.setPosition(coords);\n            const html = this.generateFeatureHtml(features.item(0), locale);\n            this.featureTooltipElement.innerHTML = html;\n            this.closerEl = document.getElementById(\"feat-popup-closer\");\n            this.setPopupCloseHandler();\n            if (html == \"\") {\n                this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n            } else {\n                this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n            }\n        } else {\n            this.featureTooltipElement.innerHTML = \"\";\n            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n        }\n    }\n}","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { getWidth, getHeight } from \"ol/extent\";\nimport olPoint from \"ol/geom/Point\";\nimport olLineString from \"ol/geom/LineString\";\nimport olPolygon from \"ol/geom/Polygon\";\nimport olCircle from \"ol/geom/Circle\";\nimport olGeom from \"ol/geom/Geometry\";\nimport * as Constants from \"../constants\";\nimport * as Runtime from \"../api/runtime\";\nimport * as logger from \"../utils/logger\";\nimport { Client } from \"../api/client\";\nimport { MgError } from \"../api/error\";\nimport { RuntimeMap } from \"../api/contracts/runtime-map\";\nimport { FeatureSet, SelectedFeatureSet, QueryMapFeaturesResponse } from \"../api/contracts/query\";\nimport { RefreshMode, ICommand, ClientKind, UnitOfMeasure, Bounds } from \"../api/common\";\nimport * as MapActions from \"../actions/map\";\nimport * as TaskPaneActions from \"../actions/taskpane\";\nimport * as LegendActions from \"../actions/legend\";\nimport { deArrayify, buildSelectionXml } from \"../api/builders/deArrayify\";\nimport { FormFrameShim } from \"../components/form-frame-shim\";\nimport { getCommand, DefaultCommands } from \"../api/registry/command\";\nimport { tr } from \"../api/i18n\";\nimport { serialize } from \"../api/builders/mapagent\";\nimport { ILocalizedMessages } from \"../strings/msgdef\";\nimport { getUnitOfMeasure } from '../utils/units';\nimport { useActiveMapState, useActiveMapSelectionSet, useConfiguredAgentUri, useConfiguredAgentKind, useViewerBusyCount, useViewerSizeUnits } from './hooks';\n\nfunction isEmptySelection(selection: QueryMapFeaturesResponse | undefined): boolean {\n    if (selection && selection.FeatureSet) {\n        let count = 0;\n        for (const l of selection.FeatureSet.Layer) {\n            count += l.Class.ID.length;\n        }\n        return count === 0;\n    }\n    return true; //Treat undefined/null as empty\n}\n\n/**\n * This class emulates a subset of the Fusion API. This represents the top-level object named \"Fusion\"\n */\nclass FusionApiShim {\n    public Event: FusionEventApiShim;\n    constructor(private parent: ViewerApiShimInner) {\n        this.Event = new FusionEventApiShim();\n    }\n    xml2json(callback: Function, response: any, json: boolean) {\n        if (json) {\n            const o = JSON.parse(response.responseText);\n            callback(o);\n        } else {\n            const options = {\n                onSuccess: callback,\n                method: 'POST',\n                parameters: { 'xml': encodeURIComponent(response.responseText) }\n            };\n            this.ajaxRequest('common/php/Xml2JSON.php', options);\n        }\n    }\n    ajaxRequest(url: string, options: any) { // onSuccess: Function, onFailure: Function, parameters: any) {\n        let reqUrl = `${Runtime.getFusionRoot()}/${url}`;\n        const client = this.parent.getClient();\n        const resolve = options.onSuccess || (() => logger.debug(`No success handler defined for this operation`));\n        const fail = options.onFailure || options.onException || ((_r: any, res: Error) => logger.error(res));\n        if (client) {\n            if (typeof (options.parameters) == 'string') {\n                reqUrl += \"?\" + options.parameters;\n                fetch(reqUrl, {\n                    method: \"GET\"\n                }).then(res => {\n                    if (!res.ok) {\n                        const stat = res.statusText;\n                        res.text().then(t => {\n                            fail({\n                                transport: {\n                                    responseText: t\n                                }\n                            }, new MgError(stat));\n                        });\n                    } else {\n                        res.text().then(t => resolve({\n                            responseText: t\n                        }));\n                    }\n                });\n            } else {\n                fetch(reqUrl, {\n                    headers: {\n                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n                    } as any,\n                    method: \"POST\",\n                    body: serialize(options.parameters, false) //form\n                }).then(res => {\n                    if (!res.ok) {\n                        const stat = res.statusText;\n                        res.text().then(t => {\n                            fail({\n                                transport: {\n                                    responseText: t\n                                }\n                            }, new MgError(stat));\n                        });\n                    } else {\n                        res.text().then(t => resolve({\n                            responseText: t\n                        }));\n                    }\n                });\n            }\n        }\n    }\n\n    getMapByName(name: string): FusionWidgetApiShim | undefined {\n        if (this.parent.props.map && this.parent.props.map.Name == name) {\n            return new FusionWidgetApiShim(this.parent);\n        }\n        return undefined;\n    }\n    getWidgetById(id: string): FusionWidgetApiShim | undefined {\n        if (id == Constants.FUSION_TASKPANE_NAME ||\n            id == Constants.FUSION_MAP_NAME) {\n            return new FusionWidgetApiShim(this.parent);\n        }\n        return undefined;\n    }\n    getWidgetsByType(type: string): FusionWidgetApiShim[] {\n        if (type == Constants.FUSION_REDLINE_NAME) {\n            return [\n                new FusionWidgetApiShim(this.parent)\n            ];\n        }\n        return [];\n    }\n    registerForEvent(eventID: number, callback: (...args: any[]) => void): void {\n        this.parent.registerForEvent(eventID, callback);\n    }\n}\n\n/**\n * This class emulates the OpenLayers.Function.bind helper\n */\nclass OL2FunctionHelper {\n    public bind(func: Function, obj_this: any) {\n        return func.bind(obj_this);\n    }\n}\n\n/**\n * This class emulates a subset of the OpenLayers 2 API\n */\nclass OL2Shim {\n    public Function: OL2FunctionHelper;\n    constructor() {\n        this.Function = new OL2FunctionHelper();\n    }\n    i18n(key: keyof ILocalizedMessages): string {\n        return tr(key);\n    }\n}\n\n/**\n * This class emulates event constants defined by Fusion\n */\nclass FusionEventApiShim {\n    constructor() {\n\n    }\n    public get MAP_SELECTION_ON(): number { return 1; }\n    public get MAP_SELECTION_OFF(): number { return 2; }\n    public get MAP_ACTIVE_LAYER_CHANGED(): number { return 3; }\n    public get MAP_BUSY_CHANGED(): number { return 4; }\n}\n\ntype FusionGeomDigitizer = (geom: any) => void;\n\n/**\n * This class emulates a digitized rectangle\n */\nclass OL2Rect {\n    constructor(private poly: olPolygon) { }\n    getVertices(): ({ x: number, y: number } | undefined)[] {\n        const coords = this.poly.getExtent();\n        return [\n            { x: coords[0], y: coords[1] },//0\n            undefined,                     //1\n            { x: coords[2], y: coords[3] } //2\n        ]\n    }\n}\n\n/**\n * This class emulates an OpenLayers 2 geometry\n */\nclass OL2Geom {\n    constructor(private geom: olGeom) { }\n    get x(): number {\n        const g = this.geom;\n        if (g instanceof olPoint) {\n            return g.getCoordinates()[0];\n        }\n        return NaN;\n    }\n    get y(): number {\n        const g = this.geom;\n        if (g instanceof olPoint) {\n            return g.getCoordinates()[1];\n        }\n        return NaN;\n    }\n    getVertices(): { x: number, y: number }[] {\n        const g = this.geom;\n        if (g instanceof olPoint) {\n        } else if (g instanceof olLineString) {\n            return g.getCoordinates().map(c => {\n                return { x: c[0], y: c[1] };\n            })\n        } else if (g instanceof olPolygon) {\n            return g.getLinearRing(0).getCoordinates().map(c => {\n                return { x: c[0], y: c[1] };\n            });\n        }\n        return [];\n    }\n    get CLASS_NAME(): string {\n        if (this.geom instanceof olPoint) {\n            return \"OpenLayers.Geometry.Point\";\n        } else if (this.geom instanceof olLineString) {\n            return \"OpenLayers.Geometry.LineString\";\n        } else if (this.geom instanceof olPolygon) {\n            return \"OpenLayers.Geometry.Polygon\";\n        } else {\n            return \"Unknown\";\n        }\n    }\n}\n\n/**\n * This class emulates OpenLayers.Bounds\n */\nclass OL2Bounds {\n    public left: number;\n    public bottom: number;\n    public right: number;\n    public top: number;\n    constructor(bounds: [number, number, number, number] | { left: number, bottom: number, right: number, top: number }) {\n        if (Array.isArray(bounds)) {\n            this.left = bounds[0];\n            this.bottom = bounds[1];\n            this.right = bounds[2];\n            this.top = bounds[3];\n        } else {\n            this.left = bounds.left;\n            this.bottom = bounds.bottom;\n            this.right = bounds.right;\n            this.top = bounds.top;\n        }\n    }\n}\n\nlet mRedlineMessageEnabled: boolean | undefined;\n\n/**\n * @hidden\n */\nfunction isRedlineMessagePromptEnabled(): boolean {\n    return !!mRedlineMessageEnabled;\n}\n\n/**\n * @hidden\n */\nexport function enableRedlineMessagePrompt(enabled: boolean): void {\n    mRedlineMessageEnabled = enabled;\n}\n\n/**\n * This class emulates APIs from various widgets\n */\nclass FusionWidgetApiShim {\n    private _activeLayer: any;\n    private _activeToast: string | undefined;\n\n    constructor(private parent: ViewerApiShimInner) {\n    }\n\n    goHome(): void { //TaskPane\n        this.parent.goHome();\n    }\n    processFeatureInfo(r: any): void {\n        const o = JSON.parse(r.responseText);\n        if (o.FeatureInformation) {\n            const norm: QueryMapFeaturesResponse = deArrayify(o);\n            const selXml = buildSelectionXml(norm.FeatureSet);\n            this.setSelection(selXml, false);\n        } else if (o.Message) {\n            this.warn(o.Message);\n        }\n    }\n    getSelectableLayers(): FusionSelectedLayer[] { //Map\n        const layers = [] as FusionSelectedLayer[];\n        const { map } = this.parent.props;\n        if (map && map.Layer) {\n            const matches = map.Layer\n                .filter(l => l.Selectable)\n                .map(l => {\n                    return { layerName: l.Name, legendLabel: l.LegendLabel };\n                });\n            for (const l of matches) {\n                layers.push(l);\n            }\n        }\n        return layers;\n    }\n    get mapWidget(): FusionWidgetApiShim { //Map\n        return this;\n    }\n    getExtentFromPoint(x: number, y: number, scale: number): OL2Bounds | undefined { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const view = viewer.getCurrentView();\n            if (!scale) {\n                scale = view.scale;\n            }\n            const res = viewer.scaleToResolution(scale);\n            const size = viewer.getSize();\n            const w = size[0] * res;\n            const h = size[1] * res;\n            return new OL2Bounds([\n                x - w / 2,\n                y - h / 2,\n                x + w / 2,\n                y + h / 2\n            ]);\n        }\n        return undefined;\n    }\n    setExtents(bounds: OL2Bounds) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.zoomToExtent([bounds.left, bounds.bottom, bounds.right, bounds.top]);\n        }\n    }\n    setActiveLayer(layer: any) { //Map\n        this._activeLayer = layer;\n        const fusionAPI: FusionApiShim = this.parent.getFusionAPI();\n        this.parent.triggerFusionEvent(fusionAPI.Event.MAP_ACTIVE_LAYER_CHANGED);\n    }\n    getActiveLayer(): any { //Map\n        return this._activeLayer;\n    }\n    clearSelection(): void { //Map\n        this.parent.ClearSelection();\n    }\n    cancelDigitization(): void { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.cancelDigitization();\n        }\n    }\n    query(options: any): void { //Map\n        const viewer = Runtime.getViewer();\n        const { map } = this.parent.props;\n        if (map && viewer) {\n            const mapName = map.Name;\n            const qmo = {\n                mapname: mapName,\n                session: map.SessionId,\n                selectionvariant: options.selectionType,\n                maxfeatures: options.maxFeatures,\n                geometry: options.geometry,\n                layernames: options.layers\n            };\n            if (qmo.maxfeatures == 0) {\n                qmo.maxfeatures = -1;\n            }\n\n            viewer.setSelectionXml(\"\", qmo);\n        }\n    }\n    setSelection(xml: string, zoomTo: boolean): void { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            //TODO: Support zoomTo\n            viewer.setSelectionXml(xml, {\n                layerattributefilter: 0 //Need to set this in order for requestdata to be respected\n            }, (selection) => {\n                if (zoomTo) {\n                    const fact = viewer.getOLFactory();\n                    let bounds: Bounds | null = null;\n                    if (selection != null && selection.SelectedFeatures != null) {\n                        selection.SelectedFeatures.SelectedLayer.forEach(layer => {\n                            layer.Feature.forEach(feat => {\n                                const b: any = feat.Bounds.split(\" \").map(s => parseFloat(s));\n                                if (bounds == null) {\n                                    bounds = b;\n                                } else {\n                                    bounds = fact.extendExtent(bounds, b);\n                                }\n                            })\n                        });\n                    }\n                    if (bounds) {\n                        const bw = getWidth(bounds);\n                        const bh = getHeight(bounds);\n                        if (bw > 0 && bh > 0) { //Don't zoom if we get 0 bounds. Cruncing bounds from selected points would do this.\n                            const view = viewer.getViewForExtent(bounds);\n                            this.parent.ZoomToView(view.x, view.y, view.scale);\n                        }\n                    }\n                }\n            });\n        }\n    }\n    getSelectedLayers(): FusionSelectedLayer[] { //Map\n        const layers = [] as FusionSelectedLayer[];\n        const map = this.parent.props.map;\n        const selectionSet = this.parent.props.selectionSet;\n        if (map && map.Layer && selectionSet && selectionSet.FeatureSet) {\n            for (const fl of selectionSet.FeatureSet.Layer) {\n                const ml = map.Layer.filter(l => l.ObjectId == fl[\"@id\"])[0];\n                if (ml) {\n                    layers.push({ legendLabel: ml.LegendLabel, layerName: ml.Name });\n                }\n            }\n        }\n        return layers;\n    }\n    isBusy(): boolean { //Map\n        if (this.parent.props.busyCount)\n            return this.parent.props.busyCount > 0;\n        return false;\n    }\n    isMapLoaded(): boolean { //Map\n        return true;\n    }\n    redraw(): void { //Map\n        this.parent.Refresh();\n    }\n\n    reloadMap(): void { //Map\n        this.parent.Refresh();\n    }\n    info(msg: string): void { //Map MessageBar\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            this._activeToast = viewer.toastPrimary(\"info-sign\", <div className=\"mg-fusion-message\" dangerouslySetInnerHTML={{ __html: msg }} />);\n        }\n    }\n    warn(msg: string): void { //Map MessageBar\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            this._activeToast = viewer.toastPrimary(\"warning-sign\", <div className=\"mg-fusion-message\" dangerouslySetInnerHTML={{ __html: msg }} />);\n        }\n    }\n    error(msg: string): void { //Map MessageBar\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            this._activeToast = viewer.toastPrimary(\"error\", <div className=\"mg-fusion-message\" dangerouslySetInnerHTML={{ __html: msg }} />);\n        }\n    }\n    clear(): void { //Map MessageBar\n        const viewer = Runtime.getViewer();\n        if (viewer && this._activeToast) {\n            viewer.dismissToast(this._activeToast);\n        }\n    }\n    get mapMessagePrompt(): boolean { //Redline\n        return isRedlineMessagePromptEnabled();\n    }\n    get container(): FusionWidgetApiShim {\n        return this;\n    }\n    get ownerDocument(): Document {\n        return document;\n    }\n    get message(): FusionWidgetApiShim { //Map\n        return this;\n    }\n    get layerRoot(): FusionWidgetApiShim { //Map\n        return this;\n    }\n    findLayerByAttribute(name: string, value: string) { //Map\n        const map = this.parent.props.map;\n        if (map && map.Layer) {\n            const ml = map.Layer.filter(lyr => {\n                switch (name) {\n                    case \"layerName\":\n                        return lyr.Name == value;\n                }\n                return false;\n            })[0];\n            if (ml) {\n                return { layerName: ml.Name };\n            }\n        }\n        return null;\n    }\n    pixToGeoMeasure(tolerance: number) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            return tolerance * viewer.getResolution();\n        }\n        return 0.000001; //Pull some random number\n    }\n    drawMap(): void {\n        this.parent.Refresh();\n    }\n    registerForEvent(eventID: number, callback: Function): void { //Widget\n        this.parent.registerForEvent(eventID, callback);\n    }\n    deregisterForEvent(eventID: number, callback: Function): void { //Widget\n        this.parent.deregisterForEvent(eventID, callback);\n    }\n    static toOL2Circle(circ: olCircle) {\n        const c = circ.getCenter();\n        return {\n            x: c[0],\n            y: c[1],\n            r: circ.getRadius()\n        };\n    }\n    digitizePoint(_options: any, handler: FusionGeomDigitizer) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizePoint(pt => {\n                handler(new OL2Geom(pt));\n            });\n        }\n    }\n    digitizeLine(_options: any, handler: FusionGeomDigitizer) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeLine(ln => {\n                handler(new OL2Geom(ln));\n            });\n        }\n    }\n    digitizeLineString(_options: any, handler: FusionGeomDigitizer) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeLineString(lstr => {\n                handler(new OL2Geom(lstr));\n            });\n        }\n    }\n    digitizeRectangle(_options: any, handler: FusionGeomDigitizer) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeRectangle(rect => {\n                handler(new OL2Rect(rect));\n            });\n        }\n    }\n    digitizePolygon(_options: any, handler: FusionGeomDigitizer) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizePolygon(poly => {\n                handler(new OL2Geom(poly));\n            });\n        }\n    }\n    digitizeCircle(_options: any, handler: FusionGeomDigitizer) { //Map\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeCircle(circ => {\n                handler(FusionWidgetApiShim.toOL2Circle(circ));\n            });\n        }\n    }\n}\n\ninterface FusionSelectedLayer {\n    legendLabel: string;\n    layerName: string;\n}\n\nexport type SelectionHandlerCallback = (mapName: string, selection: QueryMapFeaturesResponse | undefined) => void;\n\nexport class AjaxViewerLineStringOrPolygon {\n    private coordinates: IAjaxViewerPoint[];\n    constructor(coordinates: IAjaxViewerPoint[]) {\n        this.coordinates = coordinates;\n    }\n    public get Count(): number { return this.coordinates.length; }\n    public Point(i: number): IAjaxViewerPoint {\n        const pt = this.coordinates[i];\n        return pt;\n    }\n}\n\nexport interface IAjaxViewerRect {\n    Point1: IAjaxViewerPoint;\n    Point2: IAjaxViewerPoint;\n}\n\nexport interface IAjaxViewerCircle {\n    Center: IAjaxViewerPoint;\n    Radius: number;\n}\n\nexport interface IAjaxViewerPoint {\n    X: number;\n    Y: number;\n}\n\nexport interface IAjaxViewerLayer {\n    legend: string;\n    name: string;\n    objectid: string;\n}\n\nexport interface IAjaxViewerBounds {\n    minx: number;\n    miny: number;\n    maxx: number;\n    maxy: number;\n}\n\nexport enum AjaxViewerMapActionCode {\n    PanMode = 1,\n    PanUp = 2,\n    PanDown = 3,\n    PanRight = 4,\n    PanLeft = 5,\n    ZoomMode = 6,\n    ZoomIn = 7,\n    ZoomOut = 8,\n    ZoomRect = 9,\n    ZoomSelection = 10,\n    ZoomExtents = 11,\n    PrevView = 12,\n    NextView = 13,\n    InitialView = 14,\n    SelectionMode = 15,\n    SelectRadius = 16,\n    SelectPolygon = 17,\n    ClearSelection = 19,\n    RefreshMap = 20,\n    CopyMap = 21,\n    About = 22\n}\n\nexport type IAjaxViewerSelectionSet = any;\n\nexport interface IViewerApiShimProps {\n\n}\n\ninterface IViewerApiShimState {\n    map: RuntimeMap | undefined;\n    selectionSet: QueryMapFeaturesResponse | null;\n    agentUri: string | undefined;\n    agentKind: ClientKind;\n    busyCount: number;\n    sizeUnits: UnitOfMeasure;\n}\n\ninterface IViewerApiShimDispatch {\n    goHome: () => void;\n    legendRefresh: () => void;\n    invokeCommand: (cmd: ICommand, parameters?: any) => void;\n    setSelection: (mapName: string, selectionSet: any) => void;\n    queryMapFeatures: (mapName: string, options: MapActions.QueryMapFeatureActionOptions) => void;\n}\n\ntype ViewerApiShimProps = IViewerApiShimProps & IViewerApiShimState & IViewerApiShimDispatch;\n\n/**\n * This component installs a AJAX/Fusion viewer API compatibility layer when mounted allowing for existing\n * script content to work against this viewer.\n * \n * @export\n * @class ViewerApiShim\n * @extends {React.Component<ViewerApiShimProps, any>}\n */\nclass ViewerApiShimInner extends React.Component<ViewerApiShimProps, any> {\n    private userSelectionHandlers: SelectionHandlerCallback[];\n    private us: boolean;\n    private formFrame: FormFrameShim;\n    private ol2API: OL2Shim;\n    private fusionAPI: FusionApiShim;\n    private fusionEventHandlers: { [id: number]: Function[] };\n\n    constructor(props: ViewerApiShimProps) {\n        super(props);\n        this.us = true;\n        this.userSelectionHandlers = [];\n        this.fusionEventHandlers = {};\n        this.ol2API = new OL2Shim();\n        this.fusionAPI = new FusionApiShim(this);\n    }\n    private onFormFrameMounted = (form: FormFrameShim) => {\n        this.formFrame = form;\n    }\n    getClient(): Client | undefined {\n        const { agentUri, agentKind } = this.props;\n        if (agentUri && agentKind) {\n            return new Client(agentUri, agentKind);\n        }\n        return undefined;\n    }\n    // ------------------------ Fusion API support ----------------------- //\n    getFusionAPI(): any { //any because I don't want to leak out the FusionApiShim internal class\n        return this.fusionAPI;\n    }\n    public registerForEvent(eventID: number, callback: Function): void {\n        logger.debug(`Fusion registerForEvent - ${eventID}`);\n        if (!this.fusionEventHandlers[eventID]) {\n            this.fusionEventHandlers[eventID] = [];\n        }\n        this.fusionEventHandlers[eventID].push(callback);\n    }\n    public deregisterForEvent(eventID: number, callback: Function): void {\n        logger.debug(`Fusion deregisterForEvent - ${eventID}`);\n        if (this.fusionEventHandlers[eventID]) {\n            const funcs = this.fusionEventHandlers[eventID].filter(f => f != callback);\n            this.fusionEventHandlers[eventID] = funcs;\n        } else {\n            logger.debug(`No callbacks registered for fusion event - ${eventID}`);\n        }\n    }\n    public triggerFusionEvent(eventID: number) {\n        logger.debug(`Trigger Fusion Event ID - ${eventID}`);\n        if (this.fusionEventHandlers[eventID]) {\n            for (const cb of this.fusionEventHandlers[eventID]) {\n                cb.apply(null, arguments);\n            }\n        }\n    }\n    private fusionSelectionHandler(selection: QueryMapFeaturesResponse | undefined) {\n        const eventID = isEmptySelection(selection) ? this.fusionAPI.Event.MAP_SELECTION_OFF : this.fusionAPI.Event.MAP_SELECTION_ON;\n        this.triggerFusionEvent(eventID);\n    }\n    // ------------------------ Map Frame -------------------------------- //\n\n    /**\n     * Indicates if the map frame is ready\n     *\n     * Although this not part of the \"public\" API, most AJAX viewer examples test for this\n     * flag anyways, so we might as well emulate it here\n     */\n    public get mapInit(): boolean { return this.props.map?.SessionId != null; }\n    public ExecuteMapAction(code: AjaxViewerMapActionCode) {\n        let cmdName: string;\n        switch (code) {\n            case AjaxViewerMapActionCode.About:\n                cmdName = DefaultCommands.About;\n                break;\n            case AjaxViewerMapActionCode.ClearSelection:\n                cmdName = DefaultCommands.ClearSelection;\n                break;\n            case AjaxViewerMapActionCode.InitialView:\n                cmdName = DefaultCommands.ZoomExtents;\n                break;\n            case AjaxViewerMapActionCode.NextView:\n                cmdName = DefaultCommands.NextView;\n                break;\n            case AjaxViewerMapActionCode.PanDown:\n                cmdName = DefaultCommands.PanDown;\n                break;\n            case AjaxViewerMapActionCode.PanLeft:\n                cmdName = DefaultCommands.PanLeft;\n                break;\n            case AjaxViewerMapActionCode.PanMode:\n                cmdName = DefaultCommands.Pan;\n                break;\n            case AjaxViewerMapActionCode.PanRight:\n                cmdName = DefaultCommands.PanRight;\n                break;\n            case AjaxViewerMapActionCode.PanUp:\n                cmdName = DefaultCommands.PanUp;\n                break;\n            case AjaxViewerMapActionCode.PrevView:\n                cmdName = DefaultCommands.PreviousView;\n                break;\n            case AjaxViewerMapActionCode.RefreshMap:\n                cmdName = DefaultCommands.RefreshMap;\n                break;\n            case AjaxViewerMapActionCode.SelectionMode:\n                cmdName = DefaultCommands.Select;\n                break;\n            case AjaxViewerMapActionCode.SelectPolygon:\n                cmdName = DefaultCommands.SelectPolygon;\n                break;\n            case AjaxViewerMapActionCode.SelectRadius:\n                cmdName = DefaultCommands.SelectRadius;\n                break;\n            case AjaxViewerMapActionCode.ZoomExtents:\n                cmdName = DefaultCommands.ZoomExtents;\n                break;\n            case AjaxViewerMapActionCode.ZoomIn:\n                cmdName = DefaultCommands.ZoomIn;\n                break;\n            case AjaxViewerMapActionCode.ZoomMode:\n                cmdName = DefaultCommands.Zoom;\n                break;\n            case AjaxViewerMapActionCode.ZoomOut:\n                cmdName = DefaultCommands.ZoomOut;\n                break;\n            case AjaxViewerMapActionCode.ZoomRect:\n                cmdName = DefaultCommands.Zoom;\n                break;\n            case AjaxViewerMapActionCode.ZoomSelection:\n                cmdName = DefaultCommands.ZoomToSelection;\n                break;\n            default:\n                logger.warn(`Unknown command code: ${code}`);\n                return;\n        }\n        const cmd = getCommand(cmdName);\n        if (cmd && this.props.invokeCommand) {\n            this.props.invokeCommand(cmd);\n        }\n    }\n    public ClearSelection(): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.clearSelection();\n        }\n    }\n    public DigitizeCircle(handler: (circle: IAjaxViewerCircle) => void): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeCircle(circle => {\n                const center = circle.getCenter();\n                const radius = circle.getRadius();\n                handler({\n                    Center: {\n                        X: center[0],\n                        Y: center[1]\n                    },\n                    Radius: radius\n                });\n            });\n        }\n    }\n    public DigitizeLine(handler: (geom: AjaxViewerLineStringOrPolygon) => void): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeLine(line => {\n                const coords = line.getCoordinates().map<IAjaxViewerPoint>(coord => {\n                    return {\n                        X: coord[0],\n                        Y: coord[1]\n                    };\n                });\n                handler(new AjaxViewerLineStringOrPolygon(coords));\n            });\n        }\n    }\n    public DigitizePoint(handler: (geom: IAjaxViewerPoint) => void): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizePoint(pt => {\n                const coords = pt.getCoordinates();\n                handler({ X: coords[0], Y: coords[1] });\n            });\n        }\n    }\n    public DigitizePolygon(handler: (geom: AjaxViewerLineStringOrPolygon) => void): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizePolygon(poly => {\n                //Our API isn't expected to allow drawing polygons with holes, so the first (outer) ring\n                //is what we're after\n                const ring = poly.getLinearRing(0);\n                const coords = ring.getCoordinates().map<IAjaxViewerPoint>(coord => {\n                    return {\n                        X: coord[0],\n                        Y: coord[1]\n                    };\n                });\n                handler(new AjaxViewerLineStringOrPolygon(coords));\n            });\n        }\n    }\n    public DigitizeLineString(handler: (geom: AjaxViewerLineStringOrPolygon) => void): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeLineString(line => {\n                const coords = line.getCoordinates().map<IAjaxViewerPoint>(coord => {\n                    return {\n                        X: coord[0],\n                        Y: coord[1]\n                    };\n                });\n                handler(new AjaxViewerLineStringOrPolygon(coords));\n            });\n        }\n    }\n    public DigitizeRectangle(handler: (geom: IAjaxViewerRect) => void): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.digitizeRectangle(rect => {\n                const extent = rect.getExtent();\n                handler({\n                    Point1: {\n                        X: extent[0],\n                        Y: extent[1]\n                    },\n                    Point2: {\n                        X: extent[2],\n                        Y: extent[3]\n                    }\n                });\n            });\n        }\n    }\n    public GetCenter(): IAjaxViewerPoint | null {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const view = viewer.getCurrentView();\n            return { X: view.x, Y: view.y };\n        }\n        return null;\n    }\n    public GetLayers(onlyVisible: boolean, onlySelectable: boolean): IAjaxViewerLayer[] {\n        const selLayers: IAjaxViewerLayer[] = [];\n        const { map, selectionSet } = this.props;\n        if (map && selectionSet && selectionSet.FeatureSet) {\n            const fset: FeatureSet = selectionSet.FeatureSet;\n            const ids = fset.Layer.map(l => l[\"@id\"]);\n            if (map.Layer) {\n                for (const layer of map.Layer) {\n                    if (ids.indexOf(layer.ObjectId) >= 0) {\n                        if (onlyVisible === true && layer.Visible === true) {\n                            selLayers.push({ legend: layer.LegendLabel, name: layer.Name, objectid: layer.ObjectId });\n                        }\n                        if (onlySelectable === true && layer.Selectable === true) {\n                            selLayers.push({ legend: layer.LegendLabel, name: layer.Name, objectid: layer.ObjectId });\n                        }\n                    }\n                }\n            }\n        }\n        return selLayers;\n    }\n    public GetMetersPerUnit(): number | null {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            return viewer.getMetersPerUnit();\n        }\n        return null;\n    }\n    public GetMapHeight(): number {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const [, gh] = viewer.getSize();\n            return gh;\n        }\n        return NaN;\n    }\n    public GetMapName = (): string | undefined => this.props.map?.Name;\n    public GetMapUnitsType(): string {\n        const uom = getUnitOfMeasure(this.props.sizeUnits || UnitOfMeasure.Unknown);\n        return uom.name;\n    }\n    public GetMapWidth(): number {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const [gw] = viewer.getSize();\n            return gw;\n        }\n        return NaN;\n    }\n    public GetScale(): number | null {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const view = viewer.getCurrentView();\n            return view.scale;\n        }\n        return null;\n    }\n    public GetSelectedLayers(): IAjaxViewerLayer[] {\n        const selLayers: IAjaxViewerLayer[] = [];\n        const { map, selectionSet } = this.props;\n        if (map && selectionSet && selectionSet.FeatureSet) {\n            const fset: FeatureSet = selectionSet.FeatureSet;\n            const ids = fset.Layer.map(l => l[\"@id\"]);\n            if (map.Layer) {\n                for (const layer of map.Layer) {\n                    if (ids.indexOf(layer.ObjectId) >= 0) {\n                        selLayers.push({ legend: layer.LegendLabel, name: layer.Name, objectid: layer.ObjectId });\n                    }\n                }\n            }\n        }\n        return selLayers;\n    }\n    public GetSelectionXML(): string {\n        const { selectionSet } = this.props;\n        if (!selectionSet || !selectionSet.FeatureSet) {\n            return \"\";\n        } else {\n            return buildSelectionXml(selectionSet.FeatureSet);\n        }\n    }\n    public GetSessionId = (): string | undefined => this.props.map?.SessionId;\n    public GetSelectedBounds(): IAjaxViewerBounds | null {\n        let bounds: IAjaxViewerBounds | null = null;\n        const { selectionSet } = this.props;\n        if (selectionSet && selectionSet.SelectedFeatures) {\n            const fset: SelectedFeatureSet = selectionSet.SelectedFeatures;\n            fset.SelectedLayer.forEach(layer => {\n                layer.Feature.forEach(feature => {\n                    const bbox = feature.Bounds.split(\" \").map(s => parseFloat(s));\n                    if (bounds == null) {\n                        bounds = { minx: bbox[0], miny: bbox[1], maxx: bbox[2], maxy: bbox[3] };\n                    } else {\n                        if (bbox[0] < bounds.minx)\n                            bounds.minx = bbox[0];\n                        if (bbox[1] < bounds.miny)\n                            bounds.miny = bbox[1];\n                        if (bbox[2] > bounds.maxx)\n                            bounds.maxx = bbox[2];\n                        if (bbox[3] > bounds.maxy)\n                            bounds.maxy = bbox[3];\n                    }\n                });\n            });\n        }\n        return bounds;\n    }\n    public GetSelectedCount(): number {\n        let count = 0;\n        const { selectionSet } = this.props;\n        if (selectionSet && selectionSet.FeatureSet) {\n            const fset: FeatureSet = selectionSet.FeatureSet;\n            fset.Layer.forEach(layer => {\n                layer.Class.ID.forEach(() => {\n                    count++;\n                });\n            });\n        }\n        return count;\n    }\n    public GetSelectedFeatures(): IAjaxViewerSelectionSet | undefined {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const selection = viewer.getSelection();\n            if (selection && selection.SelectedFeatures) {\n                const sel: IAjaxViewerSelectionSet = {};\n                for (const sl of selection.SelectedFeatures.SelectedLayer) {\n                    sel[sl[\"@name\"]] = sl.Feature.map(f => {\n                        const bbox = f.Bounds.split(\" \").map(s => parseFloat(s));\n                        return {\n                            zoom: { minx: bbox[0], miny: bbox[1], maxx: bbox[2], maxy: bbox[3] },\n                            values: f.Property.map(p => ({ name: p.Name, value: p.Value }))\n                        };\n                    })\n                }\n                return sel;\n            }\n        }\n    }\n    public IsDigitizing(): boolean {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            return viewer.isDigitizing();\n        } else {\n            return false;\n        }\n    }\n    public IsEnglishUnits(): boolean {\n        return this.us;\n    }\n    public IsLatLongDisplayUnits(): boolean {\n        return true; //This is what the AJAX viewer returns\n    }\n    public MapUnitsToLatLon(): IAjaxViewerPoint {\n        throw new MgError(`Un-implemented AJAX viewer shim API: map_frame.MapUnitsToLatLon(x, y)`);\n    }\n    public Refresh(): void {\n        const viewer = Runtime.getViewer();\n        viewer?.refreshMap(RefreshMode.LayersOnly | RefreshMode.SelectionOnly);\n        this.props.legendRefresh?.();\n    }\n    public ScreenToMapUnits(x: number, y: number): IAjaxViewerPoint | undefined {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const [sx, sy] = viewer.screenToMapUnits(x, y);\n            return { X: sx, Y: sy };\n        }\n    }\n    public SetEnglishUnits(usEnglish: boolean): void {\n        this.us = usEnglish;\n    }\n    public SetLatLongDisplayUnits(): void {\n        //This is what the AJAX viewer does\n    }\n    public SetSelectionXML(xmlSet: string): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.setSelectionXml(xmlSet);\n        }\n    }\n    public ZoomToView(x: number, y: number, scale: number) {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            viewer.zoomToView(x, y, scale);\n        }\n    }\n    public SetStatusMsg(msg: string): void {\n        window.status = msg || \"\"; //Most browsers do nothing with window.status, but that is what this method does in the AJAX viewer\n    }\n    //This isn't in the AJAX Viewer API reference, but there are samples referencing it!\n    public ZoomToScale(scale: number): void {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            const view = viewer.getCurrentView();\n            viewer.zoomToView(view.x, view.y, scale);\n        }\n    }\n    //Form frame\n    public Submit(url: string, params: string[], frameTarget: string) {\n        this.formFrame.submit(url, params, frameTarget);\n    }\n\n    public goHome = () => this.props.goHome?.();\n\n    private RegisterSelectionHandler(handler: SelectionHandlerCallback): number {\n        this.userSelectionHandlers.push(handler);\n        return this.userSelectionHandlers.length;\n    }\n\n    private UnregisterSelectionHandler(handler: SelectionHandlerCallback): number {\n        this.userSelectionHandlers = this.userSelectionHandlers.filter(h => h != handler);\n        return this.userSelectionHandlers.length;\n    }\n\n    private installShims(browserWindow: any) {\n        browserWindow.Fusion = this.fusionAPI;\n        browserWindow.OpenLayers = this.ol2API;\n\n        browserWindow.GetMapFrame = browserWindow.GetMapFrame || (() => this);\n        //NOTE: mapFrame is technically not part of the \"public\" API for the AJAX viewer, but since most examples test\n        //for this in place of GetMapFrame(), we might as well emulate it here\n        browserWindow.mapFrame = browserWindow.GetMapFrame();\n        browserWindow.formFrame = browserWindow.mapFrame;\n\n        browserWindow.ExecuteMapAction = browserWindow.ExecuteMapAction || ((code: any) => this.ExecuteMapAction(code));\n        browserWindow.Refresh = browserWindow.Refresh || (() => this.Refresh());\n        browserWindow.SetSelectionXML = browserWindow.SetSelectionXML || ((xmlSet: string) => this.SetSelectionXML(xmlSet));\n        browserWindow.ZoomToView = browserWindow.ZoomToView || ((x: number, y: number, scale: number) => this.ZoomToView(x, y, scale));\n        browserWindow.GotoHomePage = browserWindow.GotoHomePage || (() => this.goHome());\n\n        // ======= Extended Viewer API ========== //\n        browserWindow.GetViewerInterface = browserWindow.GetViewerInterface || (() => Runtime.getViewer());\n        browserWindow.RegisterSelectionHandler = browserWindow.RegisterSelectionHandler || ((handler: SelectionHandlerCallback) => this.RegisterSelectionHandler(handler));\n        browserWindow.UnregisterSelectionHandler = browserWindow.UnregisterSelectionHandler || ((handler: SelectionHandlerCallback) => this.UnregisterSelectionHandler(handler));\n    }\n    componentDidMount() {\n        //Install shims into browser window\n        let browserWindow: any = window;\n        this.installShims(browserWindow);\n        this.installShims(window.parent);\n\n        this.RegisterSelectionHandler((_mapName: string, selection: QueryMapFeaturesResponse | undefined) => {\n            this.fusionSelectionHandler(selection);\n        });\n    }\n    componentDidUpdate(prevProps: ViewerApiShimProps) {\n        const nextProps = this.props;\n        if (nextProps.map && nextProps.selectionSet != prevProps.selectionSet) {\n            for (const handler of this.userSelectionHandlers) {\n                handler(nextProps.map.Name, nextProps.selectionSet ?? undefined);\n            }\n        }\n        if (nextProps.busyCount != prevProps.busyCount) {\n            this.triggerFusionEvent(this.fusionAPI.Event.MAP_BUSY_CHANGED);\n        }\n    }\n    render(): JSX.Element {\n        //This is for all intents and purposes, a \"background\" component. There is no real DOM representation\n        return <div>\n            <FormFrameShim ref={this.onFormFrameMounted} />\n        </div>;\n    }\n}\n\nconst ViewerApiShim = () => {\n    const map = useActiveMapState();\n    const selectionSet = useActiveMapSelectionSet();\n    const agentUri = useConfiguredAgentUri();\n    const agentKind = useConfiguredAgentKind();\n    const busyCount = useViewerBusyCount();\n    const sizeUnits = useViewerSizeUnits();\n\n    const dispatch = useDispatch();\n    const goHome = () => dispatch(TaskPaneActions.goHome());\n    const legendRefresh = () => dispatch(LegendActions.refresh());\n    const invokeCommand = (cmd: ICommand, parameters: any) => dispatch(MapActions.invokeCommand(cmd, parameters));\n    const setSelection = (mapName: string, res: any) => dispatch(MapActions.setSelection(mapName, res));\n    const queryMapFeatures = (mapName: string, options: MapActions.QueryMapFeatureActionOptions) => dispatch(MapActions.queryMapFeatures(mapName, options));\n\n    return <ViewerApiShimInner map={map}\n        selectionSet={selectionSet}\n        agentUri={agentUri}\n        agentKind={agentKind}\n        busyCount={busyCount}\n        sizeUnits={sizeUnits}\n        goHome={goHome}\n        legendRefresh={legendRefresh}\n        invokeCommand={invokeCommand}\n        setSelection={setSelection}\n        queryMapFeatures={queryMapFeatures} />;\n}\n\nexport default ViewerApiShim;","import * as React from 'react';\n\nexport type FormFrameShimProps = any;\n\n/**\n * The FormFrameShim component provides a compatibility shim for the AJAX viewer form frame\n *\n * @export\n * @class FormFrameShim\n * @extends {React.Component<FormFrameShimProps, any>}\n */\nexport class FormFrameShim extends React.Component<FormFrameShimProps, any> {\n    private _form: HTMLFormElement;\n    constructor(props: FormFrameShimProps) {\n        super(props);\n        this.state = {\n            target: \"\",\n            action: \"\",\n            params: []\n        };\n    }\n    private onFormMounted = (form: HTMLFormElement) => {\n        this._form = form;\n    }\n    submit(url: string, params: string[], target: string): void {\n        //TODO: Can't convert this to functional component with hooks, until this type\n        //of pattern is possible\n        this.setState({\n            action: url,\n            params: params,\n            target: target\n        }, () => {\n            //The form will have the updated content at this point\n            this._form.submit();\n        })\n    }\n    render(): JSX.Element {\n        const { target, action, params } = this.state;\n        return <form style={{ visibility: \"hidden\", width: 0, height: 0 }} ref={this.onFormMounted} method=\"post\" id=\"Frm\" target={target} action={action} encType=\"application/x-www-form-urlencoded\">\n            {(() => {\n                const fields = [] as JSX.Element[];\n                for (let i = 0; i < params.length; i+=2) {\n                    fields.push(<input id={`f${i}`} key={`f${i}`} type=\"hidden\" name={params[i]} value={params[i+1]} />);\n                }\n                return fields;\n            })()}\n        </form>;\n    }\n}","import * as React from \"react\";\n\nimport LegendContainer from \"../containers/legend\";\nimport MapViewerContainer from \"../containers/map-viewer\";\nimport MouseCoordinatesContainer from \"../containers/mouse-coordinates\";\nimport NavigatorContainer from \"../containers/navigator\";\nimport ScaleDisplayContainer from \"../containers/scale-display\";\nimport SelectedFeatureCountContainer from \"../containers/selected-feature-count\";\nimport SelectionPanelContainer from \"../containers/selection-panel\";\nimport TaskPaneContainer from \"../containers/task-pane\";\nimport { PoweredByMapGuide } from \"../components/pbmg\";\nimport { About } from \"../components/about\";\nimport { SessionExpired } from \"../components/session-expired\";\nimport MeasureContainer from \"../containers/measure\";\nimport ViewerOptions from \"../containers/viewer-options\";\nimport QuickPlotContainer from \"../containers/quick-plot\";\nimport BaseLayerSwitcherContainer from \"../containers/base-layer-switcher\";\nimport MapMenuContainer from \"../containers/map-menu\";\nimport CoordinateTrackerContainer from \"../containers/coordinate-tracker\";\nimport AddManageLayersContainer from \"../containers/add-manage-layers\";\nimport { registerComponentFactory, DefaultComponentNames } from \"../api/registry/component\";\nimport ViewSizeContainer from \"../containers/view-size\";\nimport ShareLinkToViewContainer from '../containers/share-link-to-view';\n\n/**\n * Registers the default set of components\n *\n * @export\n */\nexport function registerDefaultComponents(): void {\n    registerComponentFactory(DefaultComponentNames.Map, (props) => <MapViewerContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.Legend, (props) => <LegendContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.SelectionPanel, (props) => <SelectionPanelContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.Navigator, (props) => <NavigatorContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.MouseCoordinates, (props) => <MouseCoordinatesContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.ScaleDisplay, (props) => <ScaleDisplayContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.SelectedFeatureCount, (props) => <SelectedFeatureCountContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.PoweredByMapGuide, (props) => <PoweredByMapGuide {...props} />);\n    registerComponentFactory(DefaultComponentNames.TaskPane, (props) => <TaskPaneContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.About, (props) => <About {...props} />);\n    registerComponentFactory(DefaultComponentNames.SessionExpired, (props) => <SessionExpired {...props} />);\n    registerComponentFactory(DefaultComponentNames.Measure, (props) => <MeasureContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.ViewerOptions, (props) => <ViewerOptions {...props} />);\n    registerComponentFactory(DefaultComponentNames.QuickPlot, (props) => <QuickPlotContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.BaseMapSwitcher, (props) => <BaseLayerSwitcherContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.MapMenu, (props) => <MapMenuContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.ViewSize, (props) => <ViewSizeContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.CoordinateTracker, (props) => <CoordinateTrackerContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.AddManageLayers, (props) => <AddManageLayersContainer {...props} />);\n    registerComponentFactory(DefaultComponentNames.ShareLinkToView, (props) => <ShareLinkToViewContainer {...props} />);\n}","import * as React from \"react\";\nimport { IExternalBaseLayer, GenericEvent } from \"../api/common\";\nimport { RuntimeMap, MapLayer, MapGroup, RuleInfo } from \"../api/contracts/runtime-map\";\nimport { LegendContext, ILegendContext } from \"./context\";\nimport { BaseLayerSwitcher } from \"./base-layer-switcher\";\nimport { isLayer } from \"../utils/type-guards\";\nimport { Icon, ImageIcon } from \"./icon\";\nimport { Card, Icon as BpIcon, Button, InputGroup } from \"@blueprintjs/core\";\nimport { scaleRangeBetween } from \"../utils/number\";\nimport { tr } from \"../api/i18n\";\nimport * as Constants from \"../constants\";\nimport { BlueprintSvgIconNames } from '../constants/assets';\nimport { strIsNullOrEmpty } from '../utils';\n\nconst ICON_LEGEND_LAYER: BlueprintSvgIconNames = \"layer\";\nconst ICON_SELECT: BlueprintSvgIconNames = \"select\";\nconst ICON_LC_UNSELECT: BlueprintSvgIconNames = \"disable\";\nconst ICON_LEGEND_THEME: BlueprintSvgIconNames = \"multi-select\";\nconst ICON_LEGEND_TOGGLE: BlueprintSvgIconNames = \"chevron-down\";\nconst ICON_LEGEND_TOGGLE_EXPAND: BlueprintSvgIconNames = \"chevron-right\";\nconst ICON_LEGEND_RASTER: BlueprintSvgIconNames = \"media\";\nconst ICON_FOLDER_HORIZONTAL: BlueprintSvgIconNames = \"folder-close\";\nconst ICON_CLEAR: BlueprintSvgIconNames = \"cross\";\nconst ICON_SEARCH: BlueprintSvgIconNames = \"search\";\n\nconst UL_LIST_STYLE = (baseSize: number) => ({ listStyle: \"none\", paddingLeft: baseSize + 4, marginTop: 2, marginBottom: 2 });\nconst LI_LIST_STYLE = { listStyle: \"none\", marginTop: 2, marginBottom: 2 };\nconst ROW_ITEM_ELEMENT_STYLE = { verticalAlign: \"middle\" };\nconst CHK_STYLE = (baseSize: number) => ({ margin: 0, width: `${baseSize - 2}px`, height: `${baseSize - 2}px`, padding: 1, verticalAlign: \"middle\" });\nconst EMPTY_STYLE = (baseSize: number) => ({ display: \"inline-block\", margin: 0, width: `${baseSize}px`, height: `${baseSize}px`, verticalAlign: \"middle\" });\n\nexport type MapElementChangeFunc = (objectId: string, visible: boolean) => void;\n\ninterface ILegendLabelProps {\n    text: string;\n    baseSize: number;\n}\n\nconst LegendLabel = (props: ILegendLabelProps) => {\n    const legendCtx = React.useContext(LegendContext);\n    let inner;\n    const ft = legendCtx.getFilterText()?.toLocaleLowerCase();\n    if (legendCtx.isFiltering() && !strIsNullOrEmpty(ft)) {\n        const idx = props.text.toLocaleLowerCase().indexOf(ft);\n        if (idx >= 0) {\n            inner = props.text.substring(0, idx);\n            inner += `<span class='legend-label-highlight-text'>${props.text.substring(idx, idx + ft.length)}</span>`;\n            inner += props.text.substring(idx + ft.length, props.text.length);\n        } else {\n            inner = props.text;\n        }\n    } else {\n        inner = props.text;\n    }\n    return <span className=\"legend-label\" style={{ lineHeight: `${props.baseSize}px`, verticalAlign: \"middle\" }} dangerouslySetInnerHTML={{ __html: inner }} />;\n};\n\n/**\n * Legend component props\n *\n * @export\n * @interface ILegendProps\n */\nexport interface ILegendProps {\n    baseIconSize?: number;\n    map: RuntimeMap;\n    showLayers: string[] | undefined;\n    showGroups: string[] | undefined;\n    hideLayers: string[] | undefined;\n    hideGroups: string[] | undefined;\n    locale: string;\n    externalBaseLayers?: IExternalBaseLayer[] | undefined;\n    onBaseLayerChanged?: (name: string) => void | undefined;\n    onLayerSelectabilityChanged?: (id: string, selectable: boolean) => void | undefined;\n    onGroupExpansionChanged?: (id: string, expanded: boolean) => void | undefined;\n    onLayerVisibilityChanged?: MapElementChangeFunc | undefined;\n    onGroupVisibilityChanged?: MapElementChangeFunc | undefined;\n    currentScale: number;\n    overrideSelectableLayers?: any | undefined;\n    overrideExpandedItems?: any | undefined;\n    maxHeight?: number;\n    inlineBaseLayerSwitcher: boolean;\n}\n\nfunction getIconUri(iconMimeType: string | undefined, iconBase64: string | undefined): string | undefined {\n    if (iconMimeType && iconBase64) {\n        return `data:${iconMimeType};base64,${iconBase64}`;\n    } else {\n        return undefined;\n    }\n}\n\ninterface IEmptyNodeProps {\n    baseSize: number;\n}\n\nconst EmptyNode: React.StatelessComponent<IEmptyNodeProps> = (props: IEmptyNodeProps) => {\n    return <div style={EMPTY_STYLE(props.baseSize)}>{Constants.NBSP}</div>;\n};\n\ninterface IRuleNodeProps {\n    iconMimeType: string | undefined;\n    rule: RuleInfo;\n    baseSize: number;\n}\n\nconst RuleNode = (props: IRuleNodeProps) => {\n    const icon = getIconUri(props.iconMimeType, props.rule.Icon);\n    const label = (props.rule.LegendLabel ? props.rule.LegendLabel : \"\");\n    return <li className=\"layer-rule-node\" style={LI_LIST_STYLE}>\n        <EmptyNode baseSize={props.baseSize} /> <img style={ROW_ITEM_ELEMENT_STYLE} src={icon} /> <LegendLabel baseSize={props.baseSize} text={label} />\n    </li>;\n};\n\nexport interface ILayerNodeProps {\n    layer: MapLayer;\n}\n\nexport const LayerNode = (props: ILayerNodeProps) => {\n    const { layer } = props;\n    const legendCtx = React.useContext(LegendContext);\n    const [layerVisible, setLayerVisible] = React.useState(legendCtx.getLayerVisibility(props.layer));\n    const label = layer.LegendLabel ? layer.LegendLabel : \"\";\n    const iconMimeType = legendCtx.getIconMimeType();\n\n    const onVisibilityChanged = (e: GenericEvent) => {\n        setLayerVisible(e.target.checked);\n        legendCtx.setLayerVisibility(layer.ObjectId, e.target.checked);\n    }\n    const onToggleSelectability = (e: GenericEvent) => {\n        const selectable = getLayerSelectability(layer.ObjectId);\n        legendCtx.setLayerSelectability(layer.ObjectId, !selectable);\n    }\n    const getExpanded = () => {\n        let expanded = legendCtx.getLayerExpanded(layer.ObjectId);\n        if (expanded == null)\n            expanded = layer.ExpandInLegend;\n        return expanded;\n    };\n    const onToggleExpansion = (e: GenericEvent) => {\n        const expanded = getExpanded();\n        legendCtx.setLayerExpanded(layer.ObjectId, !expanded);\n    }\n    const getLayerSelectability = (layerId: string) => {\n        let selectable = legendCtx.getLayerSelectability(layerId);\n        if (selectable == null) {\n            selectable = layer.Selectable;\n        }\n        return selectable;\n    }\n\n    let text = label;\n    let icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n        {bs => <BpIcon icon={ICON_LEGEND_LAYER} iconSize={bs} />}\n    </Icon>;\n    let selectable: JSX.Element | undefined;\n    if (layer.Selectable === true) {\n        //NOTE: As we've intercepted the BP icons package, we've re-appropriated the \"disable\" icon for\n        //disabling selection\n        selectable = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE} onClick={onToggleSelectability}>\n            {bs => <BpIcon icon={getLayerSelectability(layer.ObjectId) ? ICON_SELECT : ICON_LC_UNSELECT} iconSize={bs} />}\n        </Icon>;\n    }\n    let chkbox: JSX.Element | undefined;\n    if (layer.Type == 1) { //Dynamic\n        chkbox = <input type='checkbox'\n            className='layer-checkbox'\n            style={CHK_STYLE(legendCtx.getBaseIconSize())}\n            value={layer.ObjectId}\n            onChange={onVisibilityChanged}\n            checked={(layerVisible)} />;\n    }\n    const tooltip = label;\n    const nodeClassName = \"layer-node\";\n    let nodeStyle: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", ...LI_LIST_STYLE };\n    if (layer.ScaleRange) {\n        for (const scaleRange of layer.ScaleRange) {\n            if (scaleRange.FeatureStyle && scaleRange.FeatureStyle.length > 0) {\n                const ruleElements = [];\n                //if (debug)\n                //    text = label + \" (\" + scaleRange.MinScale + \" - \" + scaleRange.MaxScale + \")\";\n                let body: JSX.Element | undefined;\n                let isExpanded = getExpanded();\n                let totalRuleCount = 0;\n                for (const fts of scaleRange.FeatureStyle) {\n                    totalRuleCount += fts.Rule.length;\n                }\n                if (isExpanded && totalRuleCount > 1) {\n                    icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n                        {bs => <BpIcon icon={ICON_LEGEND_THEME} iconSize={bs} />}\n                    </Icon>;\n\n                    for (let fi = 0; fi < scaleRange.FeatureStyle.length; fi++) {\n                        const fts = scaleRange.FeatureStyle[fi];\n                        const ftsRuleCount = fts.Rule.length;\n                        //Test compression\n                        let bCompressed = false;\n                        if (ftsRuleCount > 3) {\n                            bCompressed = !(fts.Rule[1].Icon);\n                        }\n                        if (bCompressed) {\n                            ruleElements.push(<RuleNode baseSize={legendCtx.getBaseIconSize()} key={`layer-${layer.ObjectId}-style-${fi}-rule-first`} iconMimeType={iconMimeType} rule={fts.Rule[0]} />);\n                            ruleElements.push(<li style={LI_LIST_STYLE} key={`layer-${layer.ObjectId}-style-${fi}-rule-compressed`}><LegendLabel baseSize={legendCtx.getBaseIconSize()} text={tr(\"OTHER_THEME_RULE_COUNT\", legendCtx.getLocale(), { count: ftsRuleCount - 2 })} /></li>);\n                            ruleElements.push(<RuleNode baseSize={legendCtx.getBaseIconSize()} key={`layer-${layer.ObjectId}-style-${fi}-rule-last`} iconMimeType={iconMimeType} rule={fts.Rule[ftsRuleCount - 1]} />);\n                        } else {\n                            for (let i = 0; i < ftsRuleCount; i++) {\n                                const rule = fts.Rule[i];\n                                ruleElements.push(<RuleNode baseSize={legendCtx.getBaseIconSize()} key={`layer-${layer.ObjectId}-style-${fi}-rule-${i}`} iconMimeType={iconMimeType} rule={rule} />);\n                            }\n                        }\n                    }\n                } else { //Collapsed\n                    if (totalRuleCount > 1) {\n                        icon = <Icon style={ROW_ITEM_ELEMENT_STYLE} baseSize={legendCtx.getBaseIconSize()}>\n                            {bs => <BpIcon icon={ICON_LEGEND_THEME} iconSize={bs} />}\n                        </Icon>;\n                    } else {\n                        const uri = getIconUri(iconMimeType, scaleRange.FeatureStyle[0].Rule[0].Icon);\n                        if (uri) {\n                            icon = <ImageIcon style={ROW_ITEM_ELEMENT_STYLE} url={uri} />;\n                        }\n                    }\n                }\n\n                if (ruleElements.length > 0) {\n                    body = <ul style={UL_LIST_STYLE(legendCtx.getBaseIconSize())}>{ruleElements}</ul>;\n                }\n\n                let expanded: JSX.Element;\n                if (totalRuleCount > 1) {\n                    expanded = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE} onClick={onToggleExpansion}>\n                        {bs => <BpIcon icon={isExpanded ? ICON_LEGEND_TOGGLE : ICON_LEGEND_TOGGLE_EXPAND} iconSize={bs} />}\n                    </Icon>;\n                } else {\n                    expanded = <EmptyNode baseSize={legendCtx.getBaseIconSize()} />;\n                }\n                return <li title={tooltip} style={nodeStyle} className={nodeClassName}>{expanded} {chkbox} {selectable} {icon} <LegendLabel baseSize={legendCtx.getBaseIconSize()} text={text} /> {body}</li>;\n            } else { //This is generally a raster\n                icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n                    {bs => <BpIcon icon={ICON_LEGEND_RASTER} iconSize={bs} />}\n                </Icon>;\n            }\n        }\n    }\n    return <li title={tooltip} style={nodeStyle} className={nodeClassName}><EmptyNode baseSize={legendCtx.getBaseIconSize()} /> {chkbox} {selectable} {icon} {label}</li>;\n};\n\nexport interface IGroupNodeProps {\n    group: MapGroup;\n    childItems: (MapLayer | MapGroup)[];\n}\n\nexport const GroupNode = (props: IGroupNodeProps) => {\n    const { group } = props;\n    const [groupVisible, setGroupVisible] = React.useState(group.Visible);\n    const legendCtx = React.useContext(LegendContext);\n    const getExpanded = () => {\n        let expanded = legendCtx.getGroupExpanded(group.ObjectId);\n        if (expanded == null)\n            expanded = group.ExpandInLegend;\n        return expanded;\n    };\n    const onToggleExpansion = (e: GenericEvent) => {\n        const expanded = getExpanded();\n        legendCtx.setGroupExpanded(group.ObjectId, !expanded);\n    };\n    const onVisibilityChanged = (e: GenericEvent) => {\n        setGroupVisible(e.target.checked);\n        legendCtx.setGroupVisibility(group.ObjectId, e.target.checked);\n    };\n    const currentScale = legendCtx.getCurrentScale();\n    const tree = legendCtx.getTree();\n    const icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n        {bs => <BpIcon icon={ICON_FOLDER_HORIZONTAL} iconSize={bs} />}\n    </Icon>;\n    const isExpanded = getExpanded();\n    const expanded = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE} onClick={onToggleExpansion}>\n        {bs => <BpIcon icon={isExpanded ? ICON_LEGEND_TOGGLE : ICON_LEGEND_TOGGLE_EXPAND} iconSize={bs} />}\n    </Icon>;\n    const chkbox = <input type='checkbox' className='group-checkbox' style={CHK_STYLE(legendCtx.getBaseIconSize())} value={group.ObjectId} onChange={onVisibilityChanged} checked={(groupVisible)} />;\n    const tooltip = group.LegendLabel;\n    const nodeClassName = \"group-node\";\n    let nodeStyle: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", ...LI_LIST_STYLE };\n    return <li title={tooltip} style={nodeStyle} className={nodeClassName}>\n        <span>{expanded} {chkbox} {icon} <LegendLabel baseSize={legendCtx.getBaseIconSize()} text={group.LegendLabel} /></span>\n        {(() => {\n            if (isExpanded && props.childItems.length > 0) {\n                return <ul style={UL_LIST_STYLE(legendCtx.getBaseIconSize())}>{props.childItems.map(item => {\n                    if (item.DisplayInLegend === true) {\n                        if (isLayer(item)) {\n                            if (isLayerVisibleAtScale(item, currentScale)) {\n                                //console.debug(`isLayerVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                return <LayerNode key={item.ObjectId} layer={item} />;\n                            }\n                        } else {\n                            if (isGroupVisibleAtScale(item, tree, currentScale)) {\n                                //console.debug(`isGroupVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                const children = tree.groupChildren[item.ObjectId] || [];\n                                return <GroupNode key={item.ObjectId} group={item} childItems={children} />;\n                            }\n                        }\n                    }\n                })}</ul>;\n            }\n        })()}\n    </li>;\n};\n\nfunction isLayerVisibleAtScale(layer: MapLayer, scale: number): boolean {\n    if (layer.ScaleRange) {\n        for (const sr of layer.ScaleRange) {\n            if (scaleRangeBetween(scale, sr.MinScale, sr.MaxScale)) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\nfunction isGroupVisibleAtScale(group: MapGroup, tree: any, scale: number): boolean {\n    const children: (MapLayer | MapGroup)[] = tree.groupChildren[group.ObjectId] || [];\n    for (const child of children) {\n        if (isLayer(child)) {\n            if (isLayerVisibleAtScale(child, scale)) {\n                return true;\n            }\n        } else {\n            if (isGroupVisibleAtScale(child, tree, scale)) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\ninterface TreeState {\n    root: (MapLayer | MapGroup)[],\n    groupChildren: {[objectId: string]: (MapLayer | MapGroup)[]}\n}\n\nfunction itemTextFilter(items: (MapLayer | MapGroup)[], text: string) {\n    const filtered = items.map(i => {\n        if (isLayer(i)) {\n            if (i.LegendLabel.toLocaleLowerCase().indexOf(text) < 0) {\n                return null;\n            }\n            return i;\n        } else {\n            return i;\n        }\n    }).filter(i => i != null) as (MapLayer | MapGroup)[];\n    return filtered;\n}\n\nfunction buildFilteredTree(tree: TreeState, text: string): TreeState {\n    const filtered: TreeState = {\n        root: itemTextFilter(tree.root, text),\n        groupChildren: {}\n    };\n    const keys = Object.keys(tree.groupChildren);\n    for (const oid of keys) {\n        filtered.groupChildren[oid] = itemTextFilter(tree.groupChildren[oid], text);\n    }\n    return filtered;\n}\n\nfunction setupTree(map: RuntimeMap) {\n    const state = {\n        Layers: map.Layer,\n        Groups: map.Group,\n        LayerMap: {} as {[objectId: string]: MapLayer},\n        GroupMap: {} as {[objectId: string]: MapGroup},\n        tree: {\n            root: [] as (MapLayer | MapGroup)[],\n            groupChildren: {} as {[objectId: string]: (MapLayer | MapGroup)[]}\n        } as TreeState\n    };\n    if (map.Layer) {\n        for (const layer of map.Layer) {\n            state.LayerMap[layer.ObjectId] = layer;\n        }\n    }\n    if (map.Group) {\n        for (const group of map.Group) {\n            state.GroupMap[group.ObjectId] = group;\n        }\n    }\n    const { Layers, Groups, LayerMap, GroupMap } = state;\n    const { root, groupChildren } = state.tree;\n    if (Groups) {\n        const remainingGroups: any = {};\n        //1st pass, un-parented groups\n        for (const group of Groups) {\n            groupChildren[group.ObjectId] = [];\n            if (group.ParentId) {\n                remainingGroups[group.ObjectId] = group;\n                continue;\n            }\n            root.push(group);\n        }\n        //2nd pass, parented groups\n        var itemCount = 0;\n        for (const objId in remainingGroups) {\n            itemCount++;\n        }\n        //Whittle down\n        while (itemCount > 0) {\n            var removeIds = [] as string[];\n            for (const objId in remainingGroups) {\n                var group = remainingGroups[objId];\n                //Do we have a parent?\n                if (typeof (groupChildren[group.ParentId]) != 'undefined') {\n                    if (typeof (groupChildren[group.ObjectId]) != 'undefined') {\n                        groupChildren[group.ObjectId] = [];\n                    }\n                    groupChildren[group.ParentId].push(group);\n                    removeIds.push(group.ObjectId);\n                }\n            }\n            for (const id of removeIds) {\n                delete remainingGroups[id];\n            }\n\n            itemCount = 0;\n            for (const objId in remainingGroups) {\n                itemCount++;\n            }\n        }\n    }\n    if (Layers) {\n        for (const layer of Layers) {\n            if (layer.ParentId) {\n                //Do we have a parent?\n                if (typeof (groupChildren[layer.ParentId]) === 'undefined') {\n                    groupChildren[layer.ParentId] = [];\n                }\n                groupChildren[layer.ParentId].push(layer);\n            } else {\n                root.push(layer);\n            }\n        }\n    }\n    return state;\n}\n\nconst DEFAULT_ICON_SIZE = 16;\n\n/**\n * The Legend component provides a component to view the layer structure, its styles and thematics and\n * the ability to toggle the group/layer visibility of the current map\n * @param props \n */\nexport const Legend = (props: ILegendProps) => {\n    const [state, setState] = React.useState(setupTree(props.map));\n    const { tree: _tree } = state;\n    const { currentScale, externalBaseLayers, onBaseLayerChanged, maxHeight } = props;\n    const [isFiltering, setIsFiltering] = React.useState(false);\n    const [filterText, setFilterText] = React.useState(\"\");\n    const [filteredTree, setFilteredTree] = React.useState<TreeState | undefined>(undefined);\n    React.useEffect(() => {\n        onExitFilterMode();\n        const tree: any = setupTree(props.map);\n        setState(tree);\n    }, [props.map]);\n    const onEnterFilterMode = () => {\n        setIsFiltering(true);\n        setFilterText(\"\");\n        setFilteredTree(_tree);\n    };\n    const onExitFilterMode = () => {\n        setIsFiltering(false);\n        setFilterText(\"\");\n        setFilteredTree(undefined);\n    };\n    const onFilterUpdate = (text: string) => {\n        setFilterText(text);\n        if (strIsNullOrEmpty(text)) {\n            setFilteredTree(_tree);\n        } else {\n            setFilteredTree(buildFilteredTree(_tree, text.toLocaleLowerCase()));\n        }\n    }\n    const getLayerSelectability = (layerId: string): boolean => {\n        const items: any = props.overrideSelectableLayers || {};\n        return items[layerId];\n    };\n    const setLayerSelectability = (layerId: string, selectable: boolean): void => {\n        props.onLayerSelectabilityChanged?.(layerId, selectable);\n    };\n    const getGroupExpanded = (groupId: string): boolean => {\n        const items: any = props.overrideExpandedItems || {};\n        return items[groupId];\n    };\n    const setGroupExpanded = (groupId: string, expanded: boolean): void => {\n        props.onGroupExpansionChanged?.(groupId, expanded);\n    };\n    const getLayerExpanded = (layerId: string): boolean => {\n        const items: any = props.overrideExpandedItems || {};\n        return items[layerId];\n    };\n    const setLayerExpanded = (layerId: string, expanded: boolean): void => {\n        props.onGroupExpansionChanged?.(layerId, expanded);\n    };\n    const getGroupVisibility = (group: MapGroup): boolean => {\n        const { showGroups, hideGroups } = props;\n        let visible = group.Visible;\n        if (showGroups && showGroups.indexOf(group.ObjectId) >= 0) {\n            visible = true;\n        } else if (hideGroups && hideGroups.indexOf(group.ObjectId) >= 0) {\n            visible = false;\n        }\n        return visible;\n    };\n    const getLayerVisibility = (layer: MapLayer): boolean => {\n        const { showLayers, hideLayers } = props;\n        let visible = layer.Visible;\n        if (showLayers && showLayers.indexOf(layer.ObjectId) >= 0) {\n            visible = true;\n        } else if (hideLayers && hideLayers.indexOf(layer.ObjectId) >= 0) {\n            visible = false;\n        }\n        return visible;\n    };\n    const setGroupVisibility = (groupId: string, visible: boolean) => {\n        props.onGroupVisibilityChanged?.(groupId, visible);\n    };\n    const setLayerVisibility = (layerId: string, visible: boolean) => {\n        props.onLayerVisibilityChanged?.(layerId, visible);\n    };\n    const getIconMimeType = (): string | undefined => {\n        return props.map.IconMimeType;\n    };\n    const getChildren = (objectId: string): (MapLayer | MapGroup)[] => {\n        return state.tree.groupChildren[objectId] || [];\n    };\n    const rootStyle: React.CSSProperties = {\n        position: \"relative\"\n    };\n    if (maxHeight) {\n        rootStyle.maxHeight = maxHeight;\n    }\n    const providerImpl: ILegendContext = {\n        isFiltering: () => isFiltering,\n        getFilterText: () => filterText,\n        getLocale: () => props.locale,\n        getBaseIconSize: () => props.baseIconSize ?? DEFAULT_ICON_SIZE,\n        getIconMimeType: getIconMimeType,\n        getChildren: getChildren,\n        getCurrentScale: () => props.currentScale,\n        getTree: () => isFiltering && filteredTree ? filteredTree : state.tree,\n        getGroupVisibility: getGroupVisibility,\n        getLayerVisibility: getLayerVisibility,\n        setGroupVisibility: setGroupVisibility,\n        setLayerVisibility: setLayerVisibility,\n        getLayerSelectability: getLayerSelectability,\n        setLayerSelectability: setLayerSelectability,\n        getGroupExpanded: getGroupExpanded,\n        setGroupExpanded: setGroupExpanded,\n        getLayerExpanded: getLayerExpanded,\n        setLayerExpanded: setLayerExpanded\n    };\n    const daTree = providerImpl.getTree();\n    const rootItems: (MapLayer | MapGroup)[] = daTree.root;\n    return <LegendContext.Provider value={providerImpl}>\n        <div style={rootStyle}>\n            {(() => {\n                if (externalBaseLayers != null &&\n                    externalBaseLayers.length > 0 &&\n                    props.inlineBaseLayerSwitcher) {\n                    return <Card style={{ marginBottom: 10 }}>\n                        <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"EXTERNAL_BASE_LAYERS\", props.locale)}</a></h5>\n                        <BaseLayerSwitcher locale={props.locale} externalBaseLayers={externalBaseLayers} onBaseLayerChanged={onBaseLayerChanged} />\n                    </Card>;\n                }\n            })()}\n            {(() => {\n                if (isFiltering) {\n                    return <InputGroup round\n                        autoFocus\n                        leftIcon={ICON_SEARCH}\n                        placeholder={tr(\"LEGEND_FILTER_LAYERS\", props.locale)}\n                        onChange={(e: any) => onFilterUpdate(e.target.value)}\n                        rightElement={<Button minimal icon={ICON_CLEAR}\n                        onClick={() => onExitFilterMode()} />} />;\n                } else {\n                    return <Button onClick={() => onEnterFilterMode()} title={tr(\"LEGEND_FILTER_LAYERS\", props.locale)} icon={ICON_SEARCH} style={{ position: \"absolute\", right: 0, top: 0 }} />\n                }\n            })()}\n            <ul style={UL_LIST_STYLE(props.baseIconSize ?? DEFAULT_ICON_SIZE)}>\n                {rootItems.map(item => {\n                    if (item.DisplayInLegend === true) {\n                        if (isLayer(item)) {\n                            if (isLayerVisibleAtScale(item, currentScale)) {\n                                //console.debug(`isLayerVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                return <LayerNode key={item.ObjectId} layer={item} />;\n                            }\n                        } else {\n                            const bGroupVisAtScale = isGroupVisibleAtScale(item, daTree, currentScale);\n                            let bGroupVisFilter = false;\n                            if (providerImpl.isFiltering()) {\n                                const bInFilter = item.LegendLabel.toLocaleLowerCase().indexOf(providerImpl.getFilterText().toLocaleLowerCase()) >= 0;\n                                //console.log(`'${item.LegendLabel}' - '${providerImpl.getFilterText()}': ${bInFilter ? \"true\" : \"false\"}`);\n                                if (bInFilter) {\n                                    bGroupVisFilter = true;\n                                }\n                            }\n                            if (bGroupVisAtScale || bGroupVisFilter) {\n                                //console.debug(`isGroupVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                const children = daTree.groupChildren[item.ObjectId] || [];\n                                return <GroupNode key={item.ObjectId} group={item} childItems={children} />;\n                            }\n                        }\n                    }\n                })}\n            </ul>\n        </div>\n    </LegendContext.Provider>;\n}","import { IItem, IInlineMenu } from \"../components/toolbar\";\n\n// This is a \"band-aid\" function to work around bogus TypeScript compiler errors\n// when webpack is live-reloading\n//\n// https://github.com/jumpinjackie/mapguide-react-layout/issues/61\n\n/**\n * @hidden\n */\nexport function processMenuItems(items: (IItem | IInlineMenu | null)[]): IItem[] {\n    const processed = [] as IItem[];\n    if (items != null) {\n        for (const i of items) {\n            if (i != null) {\n                processed.push(i);\n            }\n        }\n    }\n    return processed;\n}","import * as React from \"react\";\nimport { useSelector } from 'react-redux';\nimport { IApplicationState } from '../api/common';\n\n/**\n * @since 0.13\n */\nexport interface ISubscriberProps {\n    name: string;\n    appStateSelector: (state: IApplicationState) => any;\n    appStateEqualityFn?: (left: any, right: any) => boolean;\n    onNewState: (state: any) => void;\n}\n\n/**\n * \n * @param props \n * @since 0.13\n */\nexport const Subscriber = (props: ISubscriberProps) => {\n    const state = useSelector<IApplicationState, any>(props.appStateSelector, props.appStateEqualityFn);\n    React.useEffect(() => {\n        props.onNewState(state);\n    }, [state]);\n    return <noscript data-subscriber-name={props.name} />;\n}","import * as React from \"react\";\nimport { fmt } from \"../api/i18n\";\nimport { strTrim } from '../utils/string';\n\n/**\n * MouseCoordinates component props\n *\n * @export\n * @interface IMouseCoordinatesProps\n * @extends {React.Props<any>}\n */\nexport interface IMouseCoordinatesProps extends React.Props<any> {\n    format?: string;\n    coords?: [number, number];\n    style?: React.CSSProperties;\n    decimals?: number;\n    units?: string;\n}\n\nfunction formatCoordinates(props: IMouseCoordinatesProps) {\n    const { coords, decimals, format, units } = props;\n    if (coords == null) {\n        return null; //TODO: Use value indicated by EmptyText extension property\n    }\n    const [x, y] = coords;\n    const sfmt = format || \"X: {x}, Y: {y} {units}\";\n    const str = fmt(sfmt, {\n        x: `${decimals != null ? x.toFixed(decimals) : x}`,\n        y: `${decimals != null ? y.toFixed(decimals) : y}`,\n        units: units || \"\"\n    });\n    return <span dangerouslySetInnerHTML={{ __html: strTrim(str) }} />;\n}\n\n/**\n * Displays tracked mouse coordinates\n * @param props\n */\nexport const MouseCoordinates = (props: IMouseCoordinatesProps) => {\n    return <div className=\"status-bar-component component-mouse-coordinates\" style={props.style}>{formatCoordinates(props)}</div>;\n};","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\n// According to this (https://github.com/mzabriskie/react-draggable/issues/246#issuecomment-299698481), typings\n// only works if module type is \"es6\". This is not the case for us, so just use untyped require()\nimport Draggable from \"react-draggable\";\nimport { getFiniteScaleIndexForScale } from \"../utils/number\";\nimport {\n    IMG_SLIDER,\n    IMG_SLIDER_SCALE,\n    GIF_SPINNER\n} from \"../constants/assets\";\n\nexport enum ZoomDirection {\n    In,\n    Out\n}\n\nexport enum PanDirection {\n    East,\n    West,\n    South,\n    North\n}\n\ninterface DraggableData {\n    node: HTMLElement;\n    // lastX + deltaX === x\n    x: number;\n    y: number;\n    deltaX: number;\n    deltaY: number;\n    lastX: number;\n    lastY: number;\n};\n\nconst VERT_START = 10;\nconst VERT_SPAN = 81;  //This is the pixel height of the maximum draggable scale range\n\nconst LN9 = Math.log(9);\n\n/**\n * Navigator component props\n *\n * @export\n * @interface INavigatorProps\n * @extends {React.Props<any>}\n */\nexport interface INavigatorProps extends React.Props<any> {\n    style?: React.CSSProperties;\n    busy: boolean;\n    scale: number;\n    /**\n     * A list of finite scales. Set when the map contains base (tiled) layers. When set, slider drags will snap to the values\n     * in this list. Zooming in and out will move to the next/previous finite scale instead of the default logarithmic calculation\n     *\n     * @type {number[]}\n     * @memberOf INavigatorProps\n     */\n    finiteScaleList?: number[];\n    locale?: string;\n    onZoom: (direction: ZoomDirection) => void;\n    onPan: (direction: PanDirection) => void;\n    onRequestZoomToScale: (scale: number) => void;\n}\n\nfunction calculatePosForScale(scale: number, finiteScaleList?: number[]): number {\n    if (finiteScaleList) {\n        const index = getFiniteScaleIndexForScale(finiteScaleList, scale);\n        const pos = (VERT_SPAN / finiteScaleList.length) * (index + 1);\n        //console.log(`Scale: ${scale} @ ${index} / ${finiteScaleList.length} -> ${Math.floor(pos)}`);\n        return Math.floor(pos);\n    } else {\n        const pos = 9 * Math.log(scale) / LN9;\n        return Math.floor(pos);\n    }\n}\n\nfunction calculateScaleForPos(pos: number, finiteScaleList?: number[]): number {\n    const scale = Math.pow(9, pos / 9);\n    if (finiteScaleList) {\n        const index = getFiniteScaleIndexForScale(finiteScaleList, scale);\n        return finiteScaleList[index];\n    } else {\n        return scale;\n    }\n}\n\n/**\n * The Navigator component provides an interactive zoom slider for the map viewer\n * @param props \n */\nexport const Navigator = (props: INavigatorProps) => {\n    const { busy, locale } = props;\n    const onPanEast = () => {\n        props.onPan(PanDirection.East);\n    };\n    const onPanWest = () => {\n        props.onPan(PanDirection.West);\n    };\n    const onPanSouth = () => {\n        props.onPan(PanDirection.South);\n    };\n    const onPanNorth = () => {\n        props.onPan(PanDirection.North);\n    };\n    const onZoomOut = () => {\n        props.onZoom(ZoomDirection.Out);\n    };\n    const onZoomIn = () => {\n        props.onZoom(ZoomDirection.In);\n    };\n    const onStart = (e: MouseEvent) => {\n        e.preventDefault();\n        //console.log(`Drag start (dy: ${data.deltaY})`);\n        setIsDragging(true);\n        setPreviewPos(pos);\n    };\n    const onDrag = (e: MouseEvent, data: DraggableData) => {\n        e.preventDefault();\n        //console.log(`Dragging (dy: ${data.deltaY})`);\n        const pos = previewPos;\n        setPreviewPos(pos + data.deltaY);\n    };\n    const onStop = (e: MouseEvent) => {\n        e.preventDefault();\n        const newScale = calculateScaleForPos(previewPos);\n        //console.log(`posDelta: ${posDelta}`);\n        setIsDragging(false);\n        setPos(previewPos);\n        props.onRequestZoomToScale(newScale);\n    };\n    //Used to specify the preview destination scale \"position\"\n    const [previewPos, setPreviewPos] = React.useState(calculatePosForScale(props.scale, props.finiteScaleList));\n    //Used to specify the current scale \"position\"\n    const [pos, setPos] = React.useState(calculatePosForScale(props.scale, props.finiteScaleList));\n    const [isDragging, setIsDragging] = React.useState(false);\n    React.useEffect(() => {\n        const pos = calculatePosForScale(props.scale, props.finiteScaleList);\n        setPos(pos);\n        setPreviewPos(pos);\n    }, [props.scale, props.finiteScaleList]);\n    return <div id=\"Navigator\" style={props.style} className=\"component-navigator noselect\">\n        <map name=\"Navigator_ImageMap\" id=\"Navigator_ImageMap\">\n            <area onClick={onPanEast} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_EAST\", locale)} title={tr(\"NAVIGATOR_PAN_EAST\", locale)} coords=\"27,176, 27,177, 40,190, 44,182, 44,159\" />\n            <area onClick={onPanWest} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_WEST\", locale)} title={tr(\"NAVIGATOR_PAN_WEST\", locale)} coords=\"24,177, 24,176, 7,159, 7,182, 11,190\" />\n            <area onClick={onPanSouth} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_SOUTH\", locale)} title={tr(\"NAVIGATOR_PAN_SOUTH\", locale)} coords=\"25,178, 12,191, 21,197, 30,197, 39,191, 26,178\" />\n            <area onClick={onPanNorth} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_NORTH\", locale)} title={tr(\"NAVIGATOR_PAN_NORTH\", locale)} coords=\"26,175, 43,158, 8,158, 25,175\" />\n            <area onClick={onZoomOut} shape=\"circle\" alt={tr(\"NAVIGATOR_ZOOM_OUT\", locale)} title={tr(\"NAVIGATOR_ZOOM_OUT\", locale)} coords=\"25,142,8\" />\n            <area onClick={onZoomIn} shape=\"circle\" alt={tr(\"NAVIGATOR_ZOOM_IN\", locale)} title={tr(\"NAVIGATOR_ZOOM_IN\", locale)} coords=\"25,34,8\" />\n        </map>\n        <img src={IMG_SLIDER_SCALE} className=\"png24\" width=\"51\" height=\"201\" useMap=\"#Navigator_ImageMap\" style={{ position: \"absolute\", left: 0, top: 0 }} />\n        <div style={{ position: \"absolute\", top: 6, left: 6, width: 39, height: 16 }}>\n            <img src={GIF_SPINNER} className=\"navigator-spinner\" width=\"18\" height=\"6\" style={{ position: \"absolute\", top: 3, right: 4, visibility: busy ? \"visible\" : \"hidden\" }} />\n        </div>\n        {/*\n            NOTE: pos is the displacement from VERT_START instead of 0. This ensures\n            at the lowest possible scale, the slider doesn't \"cross over\" the (+) button\n        */}\n        <Draggable axis=\"y\"\n            handle=\"img.navigator-drag-handle\"\n            position={{ x: 0, y: (VERT_START + pos) }}\n            bounds={{ top: VERT_START, bottom: (VERT_START + VERT_SPAN), left: 0, right: 0 }}\n            onStart={onStart}\n            onDrag={onDrag}\n            onStop={onStop}>\n            <div>\n                <img src={IMG_SLIDER} className=\"png24 navigator-drag-handle\" width=\"29\" height=\"12\" style={{ position: \"relative\", left: 11, top: 28 }} />\n                {(() => {\n                    if (isDragging === true) {\n                        const dragLabel = tr(\"FMT_NAVIGATOR_ZOOM_TO_SCALE\", props.locale, { scale: calculateScaleForPos(previewPos).toFixed(2) });\n                        return <div className=\"tooltip\" style={{ position: \"relative\", width: 170, right: 190, top: 28, textAlign: \"right\" }}>{dragLabel}</div>;\n                    }\n                })()}\n            </div>\n        </Draggable>\n    </div>;\n}","import * as React from \"react\";\nimport {\n    GenericEvent,\n    IMapView\n} from \"../api/common\";\nimport { tr } from \"../api/i18n\";\nimport { getFiniteScaleIndexForScale } from \"../utils/number\";\n\n/**\n * ScaleDisplay component props\n *\n * @export\n * @interface IScaleDisplayProps\n */\nexport interface IScaleDisplayProps {\n    style?: React.CSSProperties;\n    view: IMapView;\n    finiteScales?: number[] | null;\n    locale: string;\n    onScaleChanged: (scale: number) => void;\n}\n\n/**\n * A component that displays the map scale\n * @param props \n */\nexport const ScaleDisplay = (props: IScaleDisplayProps) => {\n    const { view, style, locale, finiteScales, onScaleChanged } = props;\n    const [localScale, setLocalScale] = React.useState<number | undefined>(undefined);\n    const onFiniteScaleChanged = (e: GenericEvent) => onScaleChanged?.(parseFloat(e.target.value));\n    const onScaleKeyPressed = (e: GenericEvent) => {\n        if (e.key == 'Enter' && localScale) {\n            onScaleChanged?.(localScale);\n        }\n    };\n    const onScaleInputChanged = (e: GenericEvent) => setLocalScale(parseFloat(e.target.value));\n    React.useEffect(() => {\n        if (!finiteScales && view && view.scale != localScale) {\n            setLocalScale(view.scale);\n        }\n    }, [finiteScales, view]);\n    const label = tr(\"FMT_SCALE_DISPLAY\", locale, {\n        scale: \"\"\n    });\n    if (finiteScales) {\n        const fi = getFiniteScaleIndexForScale(finiteScales, view.scale);\n        const fiScale = finiteScales[fi];\n        //NOTE: Not using BP styled HTML select as the size imposed is not acceptable\n        return <div className=\"status-bar-component component-scale-display\" style={style}>\n            {label} <select className=\"scale-input\" value={fiScale} onChange={onFiniteScaleChanged}>\n                {finiteScales.map(s => {\n                    return <option key={s} value={s}>{s}</option>;\n                })}\n            </select>\n        </div>;\n    } else {\n        return <div className=\"status-bar-component component-scale-display\" style={style}>\n            {label} <input className=\"scale-input\" type=\"number\" value={localScale || \"\"} onChange={onScaleInputChanged} onKeyPress={onScaleKeyPressed} />\n        </div>;\n    }\n}","import * as React from \"react\";\nimport { FeatureSet } from \"../api/contracts/query\";\nimport { tr, fmt } from \"../api/i18n\";\n\n/**\n * SelectedFeatureCount component props\n *\n * @export\n * @interface ISelectedFeatureCountProps\n */\nexport interface ISelectedFeatureCountProps {\n    selection: FeatureSet;\n    locale?: string;\n    format?: string;\n    style?: React.CSSProperties;\n}\n\nfunction countTotalSelected(featureSet: FeatureSet): number {\n    let total = 0;\n    featureSet.Layer.map(layer => layer.Class.ID.length).forEach(subTotal => {\n        total += subTotal;\n    });\n    return total;\n}\n\n/**\n * Displays the number of selected features on the map\n */\nexport const SelectedFeatureCount = (props: ISelectedFeatureCountProps) => {\n    const format = props.format || tr(\"FMT_SELECTION_COUNT\", props.locale);\n    let label: string | undefined;\n    if (props.selection.Layer.length > 0) {\n        label = fmt(format, {\n            total: countTotalSelected(props.selection),\n            layerCount: props.selection.Layer.length\n        });\n    }\n    return <div className=\"status-bar-component component-selected-feature-count\" style={props.style}>{label}</div>;\n};","import * as React from \"react\";\nimport { SelectedFeatureSet, SelectedFeature, LayerMetadata, SelectedLayer, FeatureProperty } from \"../api/contracts/query\";\nimport { Toolbar, IItem, DEFAULT_TOOLBAR_SIZE, TOOLBAR_BACKGROUND_COLOR } from \"./toolbar\";\nimport { tr as xlate, DEFAULT_LOCALE } from \"../api/i18n\";\nimport { GenericEvent } from \"../api/common\";\nimport { Callout, Intent, HTMLSelect } from '@blueprintjs/core';\n\nexport interface ISelectedFeatureProps {\n    selectedFeature: SelectedFeature;\n    selectedLayer: LayerMetadata;\n    locale: string;\n    allowHtmlValues: boolean;\n    cleanHTML?: (html: string) => string;\n}\n\nconst DefaultSelectedFeature = (props: ISelectedFeatureProps) => {\n    const { selectedFeature, selectedLayer, locale, allowHtmlValues, cleanHTML } = props;\n    const featureProps = [] as FeatureProperty[];\n    for (const lp of selectedLayer.Property) {\n        const matches = selectedFeature.Property.filter(fp => fp.Name === lp.DisplayName);\n        if (matches.length === 1) {\n            featureProps.push(matches[0]);\n        }\n    }\n    return <table className=\"selection-panel-property-grid bp3-html-table bp3-html-table-condensed bp3-html-table-bordered\">\n        <thead>\n            <tr>\n                <th>{xlate(\"SELECTION_PROPERTY\", locale)}</th>\n                <th>{xlate(\"SELECTION_VALUE\", locale)}</th>\n            </tr>\n        </thead>\n        <tbody>\n            {featureProps.map(prop => {\n                return <tr key={prop.Name}>\n                    <td className=\"property-name-cell\" data-property-name={prop.Name}>{prop.Name}</td>\n                    {(() => {\n                        let value = prop.Value;\n                        if (allowHtmlValues) {\n                            if (cleanHTML) {\n                                value = cleanHTML(value);\n                            }\n                            return <td className=\"property-value-cell\" data-property-value-for={prop.Name} dangerouslySetInnerHTML={{ __html: value }} />\n                        } else {\n                            return <td className=\"property-value-cell\" data-property-value-for={prop.Name}>{prop.Value}</td>;\n                        }\n                    })()}\n                </tr>;\n            })}\n        </tbody>\n    </table>;\n};\n\n/**\n * SelectionPanel component props\n *\n * @export\n * @interface ISelectionPanelProps\n */\nexport interface ISelectionPanelProps {\n    locale?: string;\n    selection: SelectedFeatureSet;\n    onResolveLayerLabel?: (layerId: string, layerName: string) => string | undefined;\n    onRequestZoomToFeature: (feat: SelectedFeature) => void;\n    onShowSelectedFeature: (layerId: string, selectionKey: string) => void;\n    maxHeight?: number;\n    selectedFeatureRenderer?: (props: ISelectedFeatureProps) => JSX.Element;\n    /**\n     * Controls whether HTML values are allowed be rendered in property values\n     * \n     * @since 0.11\n     * @type {boolean}\n     * @memberof ISelectionPanelProps\n     */\n    allowHtmlValues: boolean;\n    /**\n     * If allowHtmlValues = true, defines a custom function for sanitizing the given HTML string\n     * to guard against cross-site scripting attacks. You are strongly recommended to provide\n     * a santitization function if your HTML property values come from an un-trusted source\n     * \n     * @since 0.11\n     * @memberof ISelectionPanelProps\n     */\n    cleanHTML?: (html: string) => string;\n}\n\ninterface ISelectionPanel {\n    locale: string;\n    canGoPrev(): boolean;\n    canGoNext(): boolean;\n    prevFeature(): void;\n    nextFeature(): void;\n    canZoomSelectedFeature(): boolean;\n    zoomSelectedFeature(): void;\n}\n\nfunction buildToolbarItems(selPanel: ISelectionPanel): IItem[] {\n    return [\n        {\n            bpIconName: \"arrow-left\",\n            tooltip: xlate(\"SELECTION_PREV_FEATURE\", selPanel.locale),\n            enabled: () => selPanel.canGoPrev(),\n            invoke: () => selPanel.prevFeature()\n        },\n        {\n            bpIconName: \"arrow-right\",\n            tooltip: xlate(\"SELECTION_NEXT_FEATURE\", selPanel.locale),\n            enabled: () => selPanel.canGoNext(),\n            invoke: () => selPanel.nextFeature()\n        },\n        { isSeparator: true },\n        {\n            bpIconName: \"path-search\",\n            tooltip: xlate(\"SELECTION_ZOOMTO_FEATURE\", selPanel.locale),\n            enabled: () => selPanel.canZoomSelectedFeature(),\n            invoke: () => selPanel.zoomSelectedFeature()\n        }\n    ];\n}\n\nconst SELECTION_TOOLBAR_STYLE: React.CSSProperties = { float: \"right\", height: DEFAULT_TOOLBAR_SIZE };\nconst SELECTION_PANEL_TOOLBAR_STYLE: React.CSSProperties = { height: DEFAULT_TOOLBAR_SIZE, backgroundColor: TOOLBAR_BACKGROUND_COLOR };\nconst LAYER_COMBO_STYLE: React.CSSProperties = { float: \"left\", height: DEFAULT_TOOLBAR_SIZE };\nconst FloatClear = () => <div style={{ clear: \"both\" }} />;\n\n/**\n * Displays attributes of selected features with the ability to zoom in on selected features\n * @param props \n */\nexport const SelectionPanel = (props: ISelectionPanelProps) => {\n    const {\n        maxHeight,\n        selection,\n        selectedFeatureRenderer,\n        allowHtmlValues,\n        cleanHTML,\n        onShowSelectedFeature,\n        onRequestZoomToFeature\n    } = props;\n    const [selectedLayerIndex, setSelectedLayerIndex] = React.useState(-1);\n    const [featureIndex, setFeatureIndex] = React.useState(-1);\n    React.useEffect(() => {\n        if (selection != null) {\n            if ((selection.SelectedLayer || []).length > 0) {\n                setSelectedLayerIndex(0);\n                setFeatureIndex(0);\n            }\n        }\n    }, [selection]);\n    const getCurrentLayer = () => {\n        if (selection == null)\n            return null;\n        return selection.SelectedLayer[selectedLayerIndex];\n    };\n    const getFeatureAt = (index: number) => {\n        const layer = getCurrentLayer();\n        if (layer != null) {\n            return layer.Feature[index];\n        }\n        return null;\n    };\n    const getCurrentFeature = () => {\n        return getFeatureAt(featureIndex);\n    };\n    const canGoPrev = (): boolean => {\n        return featureIndex > 0;\n    };\n    const canGoNext = (): boolean => {\n        const layer = getCurrentLayer();\n        if (layer != null) {\n            return featureIndex + 1 < layer.Feature.length;\n        }\n        return false;\n    };\n    const canZoomSelectedFeature = (): boolean => {\n        const feat = getCurrentFeature();\n        return feat != null && feat.Bounds != null;\n    };\n    const prevFeature = () => {\n        const newIndex = featureIndex - 1;\n        setFeatureIndex(newIndex);\n        const layer = getCurrentLayer();\n        if (layer) {\n            const layerId = layer[\"@id\"];\n            const sKey = getFeatureAt(newIndex)?.SelectionKey;\n            if (sKey) {\n                onShowSelectedFeature?.(layerId, sKey);\n            }\n        }\n    };\n    const nextFeature = () => {\n        const newIndex = featureIndex + 1;\n        setFeatureIndex(newIndex);\n        const layer = getCurrentLayer();\n        if (layer) {\n            const layerId = layer[\"@id\"];\n            const sKey = getFeatureAt(newIndex)?.SelectionKey;\n            if (sKey) {\n                onShowSelectedFeature?.(layerId, sKey);\n            }\n        }\n    };\n    const zoomSelectedFeature = () => {\n        const feat = getCurrentFeature();\n        if (feat) {\n            onRequestZoomToFeature(feat);\n        }\n    };\n    const onSelectedLayerChanged = (e: GenericEvent) => {\n        setSelectedLayerIndex(e.target.value);\n        setFeatureIndex(0);\n    };\n    const locale = props.locale || DEFAULT_LOCALE;\n    let feat: SelectedFeature | undefined;\n    let meta: LayerMetadata | undefined;\n    if (selection != null && selectedLayerIndex >= 0 && featureIndex >= 0) {\n        const selLayer = selection.SelectedLayer[selectedLayerIndex];\n        feat = selLayer.Feature[featureIndex];\n        meta = selLayer.LayerMetadata;\n    }\n    let selBodyStyle: React.CSSProperties | undefined;\n    if (maxHeight) {\n        selBodyStyle = {\n            overflowY: \"auto\",\n            maxHeight: maxHeight - DEFAULT_TOOLBAR_SIZE\n        };\n    } else {\n        selBodyStyle = {\n            overflow: \"auto\",\n            position: \"absolute\",\n            top: DEFAULT_TOOLBAR_SIZE,\n            bottom: 0,\n            right: 0,\n            left: 0\n        }\n    }\n    return <div>\n        {(() => {\n            if (selection != null && selection.SelectedLayer != null && selection.SelectedLayer.length > 0) {\n                const selectionToolbarItems = buildToolbarItems({\n                    locale,\n                    canGoPrev,\n                    canGoNext,\n                    prevFeature,\n                    nextFeature,\n                    canZoomSelectedFeature,\n                    zoomSelectedFeature\n                });\n                return <div className=\"selection-panel-toolbar\" style={SELECTION_PANEL_TOOLBAR_STYLE}>\n                    <div className=\"bp3-select selection-panel-layer-selector\">\n                        <HTMLSelect value={selectedLayerIndex} style={LAYER_COMBO_STYLE} onChange={onSelectedLayerChanged}>\n                            {selection.SelectedLayer.map((layer: SelectedLayer, index: number) => {\n                                const label = props?.onResolveLayerLabel?.(layer[\"@id\"], layer[\"@name\"]) ?? layer[\"@name\"];\n                                return <option key={`selected-layer-${layer[\"@id\"]}`} value={`${index}`}>{label}</option>\n                            })}\n                        </HTMLSelect>\n                    </div>\n                    <Toolbar childItems={selectionToolbarItems} containerStyle={SELECTION_TOOLBAR_STYLE} />\n                    <FloatClear />\n                </div>;\n            }\n        })()}\n        <div className=\"selection-panel-body\" style={selBodyStyle}>\n            {(() => {\n                if (feat && meta) {\n                    if (selectedFeatureRenderer) {\n                        return selectedFeatureRenderer({ selectedFeature: feat, cleanHTML: cleanHTML, allowHtmlValues: allowHtmlValues, selectedLayer: meta, locale: locale });\n                    } else {\n                        return <DefaultSelectedFeature selectedFeature={feat} cleanHTML={cleanHTML} allowHtmlValues={allowHtmlValues} selectedLayer={meta} locale={locale} />;\n                    }\n                } else if (selection == null || (selection.SelectedLayer || []).length == 0) {\n                    return <Callout intent={Intent.PRIMARY} icon=\"info-sign\">\n                        <p className=\"selection-panel-no-selection\">{xlate(\"NO_SELECTED_FEATURES\", locale)}</p>\n                    </Callout>;\n                }\n            })()}\n        </div>\n    </div>;\n}","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport * as Constants from \"../constants\";\nimport {\n    Toolbar,\n    IItem,\n    IFlyoutMenu,\n    DEFAULT_TOOLBAR_SIZE,\n    TOOLBAR_BACKGROUND_COLOR\n} from \"./toolbar\";\nimport { PlaceholderComponent } from \"../api/registry/component\";\nimport { tr } from \"../api/i18n\";\nimport {\n    GenericEvent,\n    IDOMElementMetrics,\n    FlyoutVisibilitySet\n} from \"../api/common\";\nimport { parseComponentUri, ensureParameters } from \"../utils/url\";\nimport { Callout, Intent, NonIdealState, Spinner } from '@blueprintjs/core';\n\nexport const TASK_PANE_OVERLAY_BGCOLOR = \"#dee8f9\";\n\nfunction currentUrlDoesNotMatchMapName(currentUrl: string, mapName: string): boolean {\n    const normUrl = currentUrl.toLowerCase();\n    //Only invalidate if url has mapname and it doesn't match our current one\n    if (normUrl.indexOf(\"mapname=\") >= 0) {\n        return normUrl.indexOf(`mapname=${mapName.toLowerCase()}`) < 0;\n    } else {\n        return false;\n    }\n}\n\n/**\n * TaskPane component props\n *\n * @export\n * @interface ITaskPaneProps\n */\nexport interface ITaskPaneProps {\n    currentUrl?: string;\n    mapName: string;\n    session: string;\n    locale: string;\n    homeAction: IItem;\n    backAction: IItem;\n    forwardAction: IItem;\n    onUrlLoaded: (url: string) => void;\n    lastUrlPushed?: boolean;\n    showTaskBar: boolean;\n    maxHeight?: number;\n    flyoutStates?: FlyoutVisibilitySet;\n    onOpenFlyout: (id: string, metrics: IDOMElementMetrics) => void;\n    onCloseFlyout: (id: string) => void;\n}\n\n// HACK:\n//\n// Having the lastUrlPushed props sounds extremely hacky, but we need a way to signal that\n// the url its about to receive was pushed and should not be reloaded into the internal iframe\n//\n// This is because we want internal url transitions (eg. Clicking a link, submitting a form) to\n// be recorded in the navigation stack so we can properly go back/forward just like a web browser.\n// But we don't want these recorded URLs to accidentally trigger a re-load of the same url.\n\n// FIXME:\n//\n// While the current iframe works the way we want and we have a nice navigation\n// stack to go forward/back, the iframe is also putting real entries into our\n// browser's history, meaning hitting the actual browser back/forward buttons can\n// throw the internal navigation stack out of whack!\n//\n// There is a solution to this: Replace the current iframe with a new iframe with\n// the new URL (http://stackoverflow.com/questions/821359/reload-an-iframe-without-adding-to-the-history)\n//\n// However, I suspect this doesn't work in React because of the virtual DOM retaining\n// the old iframe element. How can we get React to make a new iframe for each URL?\n\n/**\n * A component that serves as a generic container for content or User Interface for custom functionality\n *\n * @export\n * @class TaskPane\n * @extends {React.Component<ITaskPaneProps, any>}\n */\nexport class TaskPane extends React.Component<ITaskPaneProps, any> {\n    private _iframe: HTMLIFrameElement;\n    private taskButtons: IItem[];\n    constructor(props: ITaskPaneProps) {\n        super(props);\n        this.taskButtons = [\n            props.homeAction,\n            { isSeparator: true },\n            props.backAction,\n            props.forwardAction\n        ];\n        this.state = {\n            activeComponent: null,\n            invalidated: false,\n            frameContentLoaded: false\n        };\n    }\n    private onCloseFlyout = (id: string) => this.props.onCloseFlyout?.(id);\n    private onOpenFlyout = (id: string, metrics: IDOMElementMetrics) => this.props.onOpenFlyout?.(id, metrics);\n    private onFrameMounted = (iframe: HTMLIFrameElement) => {\n        this._iframe = iframe;\n        if (this._iframe) {\n            const el = ReactDOM.findDOMNode(this._iframe);\n            //This is needed for backcompat with certain fusion widgets\n            (el as any).taskPaneId = Constants.FUSION_TASKPANE_NAME;\n        }\n    }\n    private onFrameLoaded = (e: GenericEvent) => {\n        const frame = e.currentTarget;\n        if (frame.contentWindow) {\n            this.setState({ frameContentLoaded: true });\n            this.props.onUrlLoaded(frame.contentWindow.location.href);\n        }\n    }\n    componentDidUpdate(prevProps: ITaskPaneProps) {\n        const nextProps = this.props;\n        if (prevProps.currentUrl != nextProps.currentUrl) {\n            if (nextProps.currentUrl && nextProps.lastUrlPushed === false) {\n                this.loadUrl(nextProps.currentUrl);\n            }\n        }\n        if (!this.state.invalidated && nextProps.currentUrl && nextProps.currentUrl.indexOf(\"component://\") != 0 && currentUrlDoesNotMatchMapName(nextProps.currentUrl, nextProps.mapName)) {\n            //TODO: If we want to be smart, we could have the TaskPane amend the currentUrl with the new map name\n            this.setState({ invalidated: true });\n        } else if (this.state.invalidated && nextProps.currentUrl && (nextProps.currentUrl.indexOf(\"component://\") == 0 || !currentUrlDoesNotMatchMapName(nextProps.currentUrl, nextProps.mapName))) {\n            this.setState({ invalidated: false });\n        }\n    }\n    componentDidMount() {\n        if (this.props.currentUrl) {\n            this.loadUrl(this.props.currentUrl);\n        }\n    }\n    loadUrl(url: string) {\n        //TODO: Can't convert this to functional component with hooks, until this type\n        //of pattern is possible\n        const compUri = parseComponentUri(url);\n        if (compUri) {\n            this.setState({ activeComponent: compUri.name, activeComponentProps: compUri.props });\n        } else {\n            this.setState({ activeComponent: null, frameContentLoaded: false }, () => {\n                if (this._iframe) {\n                    const navUrl = ensureParameters(url, this.props.mapName, this.props.session, this.props.locale);\n                    this._iframe.contentWindow?.location.replace(navUrl);\n                }\n            });\n        }\n    }\n    render(): JSX.Element {\n        const { invalidated, activeComponent } = this.state;\n        const { locale, maxHeight, showTaskBar } = this.props;\n        const taskMenu: IFlyoutMenu = {\n            label: tr(\"MENU_TASKS\", locale),\n            flyoutAlign: \"bottom left\",\n            flyoutId: Constants.WEBLAYOUT_TASKMENU\n        };\n        const rootStyle: React.CSSProperties = {};\n        const taskBarStyle: React.CSSProperties = {\n            height: DEFAULT_TOOLBAR_SIZE,\n            backgroundColor: TOOLBAR_BACKGROUND_COLOR\n        };\n        const taskBodyStyle: React.CSSProperties = {};\n        const taskFrameStyle: React.CSSProperties = {\n            border: \"none\"\n        };\n        const taskComponentContainerStyle: React.CSSProperties = {\n            border: \"none\"\n        };\n        if (!maxHeight) {\n            rootStyle.width = \"100%\";\n            rootStyle.height = \"100%\";\n\n            taskBarStyle.position = \"absolute\";\n            taskBarStyle.top = 0;\n            taskBarStyle.left = 0;\n            taskBarStyle.right = 0;\n\n            taskBodyStyle.position = \"absolute\";\n            taskBodyStyle.top = (showTaskBar === true ? DEFAULT_TOOLBAR_SIZE : 0);\n            taskBodyStyle.left = 0;\n            taskBodyStyle.right = 0;\n            taskBodyStyle.bottom = 0;\n            taskBodyStyle.overflow = \"hidden\";\n\n            taskFrameStyle.width = \"100%\";\n            taskFrameStyle.height = \"100%\";\n\n            taskComponentContainerStyle.width = \"100%\";\n            taskComponentContainerStyle.height = \"100%\";\n        } else {\n            taskFrameStyle.width = \"100%\";\n            taskFrameStyle.height = (showTaskBar === true ? (maxHeight - DEFAULT_TOOLBAR_SIZE) : maxHeight);\n\n            taskComponentContainerStyle.width = \"100%\";\n            taskComponentContainerStyle.maxHeight = (showTaskBar === true ? (maxHeight - DEFAULT_TOOLBAR_SIZE) : maxHeight);\n            taskComponentContainerStyle.overflowY = \"auto\";\n        }\n        return <div style={rootStyle}>\n            {(() => {\n                if (showTaskBar === true) {\n                    return <div style={taskBarStyle}>\n                        <Toolbar childItems={this.taskButtons} containerStyle={{ float: \"left\", height: DEFAULT_TOOLBAR_SIZE }} onCloseFlyout={this.onCloseFlyout} onOpenFlyout={this.onOpenFlyout} flyoutStates={this.props.flyoutStates} />\n                        <Toolbar childItems={[taskMenu]} containerStyle={{ float: \"right\", height: DEFAULT_TOOLBAR_SIZE }} onCloseFlyout={this.onCloseFlyout} onOpenFlyout={this.onOpenFlyout} flyoutStates={this.props.flyoutStates} />\n                        <div style={{ clear: \"both\" }} />\n                    </div>;\n                }\n            })()}\n            <div style={taskBodyStyle}>\n                {(() => {\n                    if (activeComponent != null) {\n                        const cpp = this.state.activeComponentProps;\n                        taskComponentContainerStyle.overflowY = \"auto\";\n                        return <div style={taskComponentContainerStyle}>\n                            <PlaceholderComponent id={activeComponent} componentProps={cpp} locale={this.props.locale} />\n                        </div>\n                    } else {\n                        const { frameContentLoaded } = this.state;\n                        const components = [\n                            <iframe key=\"taskPaneFrame\" name=\"taskPaneFrame\" ref={this.onFrameMounted} onLoad={this.onFrameLoaded} style={taskFrameStyle}>\n                            </iframe>\n                        ];\n                        if (frameContentLoaded == false) {\n                            components.push(<div key=\"taskPaneFrameLoadingOverlay\" style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, backgroundColor: TASK_PANE_OVERLAY_BGCOLOR }}>\n                                <NonIdealState \n                                    icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                                    title={tr(\"TASK_PANE_LOADING\", locale)}\n                                    description={tr(\"TASK_PANE_LOADING_DESC\", locale)} />\n                            </div>);\n                        }\n                        return components;\n                    }\n                })()}\n                <iframe name=\"scriptFrame\" style={{ width: 0, height: 0, visibility: \"hidden\" }}></iframe>\n            </div>\n        </div>;\n    }\n}","import * as React from \"react\";\nimport { ImageIcon } from \"./icon\";\n\n/**\n * \"Powered by MapGuide\" logo\n * @param props\n */\nexport const PoweredByMapGuide = (props: any) => {\n    return <div className=\"status-bar-component component-pbmg\" {...props}>\n        <ImageIcon style={{ display: \"block\" }} spriteClass=\"PoweredBy_en\" />\n    </div>;\n};","import * as React from \"react\";\n\n/**\n * The About component displays information about this viewer\n * @param props\n */\nexport const About: React.StatelessComponent<any> = (props) => {\n    return <div className=\"component-about-dialog-content\">\n        <h4>mapguide-react-layout</h4>\n        <hr />\n        <p>Hash: {__COMMITHASH__}</p>\n        <hr />\n        <p><a target=\"_blank\" href=\"https://github.com/jumpinjackie/mapguide-react-layout\">GitHub</a></p>\n        <p><a target=\"_blank\" href=\"https://github.com/jumpinjackie/mapguide-react-layout/issues\">Issues</a></p>\n        <p>Uses icons from the <a target=\"_blank\" href=\"http://p.yusukekamiyamane.com/\">Fugue icon set by Yusuke Kamiyamane</a></p>\n    </div>;\n};","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\nimport { GenericEvent } from \"../api/common\";\n\nfunction reload(e: GenericEvent) {\n    e.preventDefault();\n    //TODO: This is obviously the nuclear solution.\n    //\n    //The more graceful solution is to re-create the runtime map and interleave the response\n    //into the current redux store and preserve the existing view and layer/group state and\n    //we should be able to continue where we left off\n    window.location.reload();\n    return false;\n}\n\nexport interface ISessionExpiredProps {\n    locale: string;\n}\n\n/**\n * Displays the \"session expired\" error message with possible recovery actions\n * @param props\n */\nexport const SessionExpired = (props: ISessionExpiredProps) => {\n    return <div className=\"component-session-expired\">\n        <p>{tr(\"SESSION_EXPIRED_DETAILED\", props.locale)}</p>\n        <p><strong>{tr(\"SESSION_EXPIRED_AVAILABLE_ACTIONS\", props.locale)}</strong></p>\n        <ul>\n            <li><a href=\"#\" onClick={reload}>{tr(\"SESSION_EXPIRED_RELOAD_VIEWER\", props.locale)}</a></li>\n        </ul>\n    </div>;\n};","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport {\n    GenericEvent,\n    ActiveMapTool} from \"../api/common\";\nimport { getViewer } from \"../api/runtime\";\nimport { tr, DEFAULT_LOCALE } from \"../api/i18n\";\nimport * as MapActions from \"../actions/map\";\nimport { IMeasureCallback, MeasureSegment, MeasureContext, IMeasureComponent } from \"./measure-context\";\nimport { roundTo } from \"../utils/number\";\nimport { Callout, Intent, ButtonGroup, Button, HTMLSelect } from '@blueprintjs/core';\nimport { useActiveMapName, useViewerLocale, useAvailableMaps } from './hooks';\nimport GeometryType from 'ol/geom/GeometryType';\n\nexport interface IMeasureContainerProps {\n\n}\n\ninterface IMeasureContainerReducerState {\n    mapNames: string[] | undefined;\n    activeMapName: string | undefined;\n    locale: string;\n}\n\ninterface IMeasureContainerDispatch {\n    setActiveTool: (tool: ActiveMapTool) => void;\n}\n\ninterface IMeasureContainerState {\n    measuring: boolean;\n    drawType: GeometryType;\n    activeType: \"LineString\" | \"Area\";\n    segmentTotal: number;\n    segments: MeasureSegment[];\n}\n\ntype MeasureProps = IMeasureContainerProps & IMeasureContainerReducerState & IMeasureContainerDispatch;\n\nconst _measurements: MeasureContext[] = [];\n\nclass MeasureContainerInner extends React.Component<MeasureProps, Partial<IMeasureContainerState>> implements IMeasureComponent, IMeasureCallback {\n\n    constructor(props: MeasureProps) {\n        super(props);\n        this.state = {\n            measuring: false,\n            drawType: GeometryType.LINE_STRING // \"LineString\"\n        }\n    }\n    private onTypeChanged = (e: GenericEvent) => {\n        const newType = e.target.value;\n        this.setState({ drawType: newType }, () => {\n            const { activeMapName } = this.props;\n            if (activeMapName && this.state.measuring === true) {\n                const activeMeasure = _measurements.filter(m => m.getMapName() === activeMapName)[0];\n                if (activeMeasure) {\n                    activeMeasure.handleDrawTypeChange();\n                }\n            }\n        });\n    }\n    private onClearMeasurements = (e: GenericEvent) => {\n        e.preventDefault();\n        const { activeMapName } = this.props;\n        if (activeMapName) {\n            const activeMeasure = _measurements.filter(m => m.getMapName() === activeMapName)[0];\n            if (activeMeasure) {\n                activeMeasure.clearMeasurements();\n            }\n        }\n        return false;\n    }\n    private onStartMeasure = () => {\n        this.startMeasure();\n    }\n    private onEndMeasure = () => {\n        this.endMeasure();\n    }\n    private startMeasure() {\n        const { activeMapName } = this.props;\n        const { drawType: type, measuring } = this.state;\n        if (activeMapName && type && !measuring) {\n            //Set to none to prevent select tool interference when measuring\n            this.props.setActiveTool?.(ActiveMapTool.None);\n            const activeMeasure = _measurements.filter(m => m.getMapName() === activeMapName)[0];\n            if (activeMeasure) {\n                activeMeasure.startMeasure();\n                this.setState({ measuring: true });\n            }\n        }\n    }\n    private endMeasure() {\n        const { activeMapName } = this.props;\n        const { measuring } = this.state;\n        if (activeMapName && measuring) {\n            const activeMeasure = _measurements.filter(m => m.getMapName() === activeMapName)[0];\n            if (activeMeasure) {\n                activeMeasure.endMeasure();\n                this.setState({ measuring: false });\n            }\n        }\n    }\n    updateSegments(kind: \"LineString\" | \"Area\", total: number, segments: MeasureSegment[] | undefined): void {\n        this.setState({ activeType: kind, segmentTotal: total, segments: segments });\n    }\n    clearSegments(): void {\n        this.setState({ segments: undefined });\n    }\n    getCurrentDrawType(): GeometryType | undefined { return this.state.drawType; }\n    getLocale(): string {\n        return this.props.locale || DEFAULT_LOCALE;\n    }\n    componentDidMount() {\n        let activeMeasure: MeasureContext | undefined;\n        if (_measurements.length == 0) {\n            const { mapNames, activeMapName } = this.props;\n            const viewer = getViewer();\n            if (viewer && mapNames && mapNames.length) {\n                for (const mapName of mapNames) {\n                    const context = new MeasureContext(viewer, mapName, this);\n                    _measurements.push(context);\n                    if (activeMapName == mapName) {\n                        activeMeasure = context;\n                    }\n                }\n            }\n        } else {\n            for (const measure of _measurements) {\n                measure.setParent(this);\n            }\n\n            activeMeasure = _measurements.filter(m => m.getMapName() === this.props.activeMapName)[0];\n        }\n\n        if (activeMeasure && this.props.activeMapName) {\n            activeMeasure.activate(this.props.activeMapName, this);\n        }\n    }\n    componentWillUnmount() {\n        const { activeMapName } = this.props;\n        this.setState({ measuring: false });\n        for (const measure of _measurements) {\n            measure.detachParent();\n        }\n        if (activeMapName) {\n            for (const measure of _measurements) {\n                measure.deactivate(activeMapName);\n            }\n        }\n    }\n    componentDidUpdate(prevProps: MeasureProps) {\n        const nextProps = this.props;\n        //Active map changed\n        if (prevProps.activeMapName != nextProps.activeMapName) {\n            const oldMeasure = _measurements.filter(m => m.getMapName() === prevProps.activeMapName)[0];\n            const newMeasure = _measurements.filter(m => m.getMapName() === nextProps.activeMapName)[0];\n            if (oldMeasure) {\n                oldMeasure.deactivate(prevProps.activeMapName!);\n            }\n            if (newMeasure) {\n                newMeasure.activate(nextProps.activeMapName!, this);\n            }\n            //Reset\n            this.setState({ measuring: false });\n        }\n    }\n    render(): JSX.Element {\n        const { measuring, drawType: type } = this.state;\n        const locale = this.getLocale();\n        return <div className=\"component-measure\">\n            <form className=\"form-inline\">\n                <label className=\"bp3-label\">\n                    {tr(\"MEASUREMENT_TYPE\", locale)}\n                    <div className=\"bp3-select\">\n                        <HTMLSelect value={type} onChange={this.onTypeChanged}>\n                            <option value=\"LineString\">{tr(\"MEASUREMENT_TYPE_LENGTH\", locale)}</option>\n                            <option value=\"Polygon\">{tr(\"MEASUREMENT_TYPE_AREA\", locale)}</option>\n                        </HTMLSelect>\n                    </div>\n                </label>\n                <ButtonGroup>\n                    <Button type=\"button\" icon=\"play\" disabled={measuring} onClick={this.onStartMeasure}>{tr(\"MEASUREMENT_START\", locale)}</Button>\n                    <Button type=\"button\" icon=\"stop\" disabled={!measuring} onClick={this.onEndMeasure}>{tr(\"MEASUREMENT_END\", locale)}</Button>\n                    <Button type=\"button\" icon=\"cross\" onClick={this.onClearMeasurements}>{tr(\"MEASUREMENT_CLEAR\", locale)}</Button>\n                </ButtonGroup>\n                {(() => {\n                    if (this.state.measuring === true) {\n                        return <div>\n                            <Callout intent={Intent.PRIMARY} title={tr(\"MEASURING\", locale)}>\n                                {tr(\"MEASURING_MESSAGE\", locale)}\n                            </Callout>\n                            {(() => {\n                                if (this.state.segments) {\n                                    return <table className=\"bp3-html-table bp3-html-table-condensed\">\n                                        <thead>\n                                            <tr>\n                                                <th>{tr(\"MEASURE_SEGMENT\", locale)}</th>\n                                                <th>{tr(\"MEASURE_LENGTH\", locale)}</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            {this.state.segments.map(s => {\n                                                return <tr key={`segment-${s.segment}`}>\n                                                    <td>{tr(\"MEASURE_SEGMENT_PART\", locale, { segment: s.segment })}</td>\n                                                    <td>{tr(\"UNIT_FMT_M\", locale, { value: roundTo(s.length, 2) })}</td>\n                                                </tr>\n                                            })}\n                                            {(() => {\n                                                if (this.state.segmentTotal && this.state.activeType) {\n                                                    return <tr>\n                                                        {(() => {\n                                                            if (this.state.activeType == \"Area\") {\n                                                                return <>\n                                                                    <td><strong>{tr(\"MEASURE_TOTAL_AREA\", locale)}</strong></td>\n                                                                    <td><div dangerouslySetInnerHTML={{ __html: tr(\"UNIT_FMT_SQM\", locale, { value: `${roundTo(this.state.segmentTotal, 4)}` }) }} /></td>\n                                                                </>\n                                                            } else {\n                                                                return <>\n                                                                    <td><strong>{tr(\"MEASURE_TOTAL_LENGTH\", locale)}</strong></td>\n                                                                    <td><div dangerouslySetInnerHTML={{ __html: tr(\"UNIT_FMT_M\", locale, { value: `${roundTo(this.state.segmentTotal, 4)}` }) }} /></td>\n                                                                </>\n                                                            }\n                                                        })()}\n                                                    </tr>;\n                                                }\n                                            })()}\n                                        </tbody>\n                                    </table>;\n                                }\n                            })()}\n                        </div>;\n                    }\n                })()}\n            </form>\n        </div>;\n    }\n}\n\nconst MeasureContainer = (props: IMeasureContainerProps) => {\n    const activeMapName = useActiveMapName();\n    const locale = useViewerLocale();\n    const mapNames = useAvailableMaps()?.map(m => m.value);\n    const dispatch = useDispatch();\n    const setActiveTool = (tool: ActiveMapTool) => dispatch(MapActions.setActiveTool(tool))\n    return <MeasureContainerInner \n        activeMapName={activeMapName}\n        locale={locale}\n        mapNames={mapNames}\n        setActiveTool={setActiveTool}\n        {...props} />;\n};\n\nexport default MeasureContainer;","import {\n    GenericEvent,\n    IMapViewer,\n    Coordinate2D\n} from \"../api/common\";\nimport { IOLFactory } from \"../api/ol-factory\";\nimport { tr } from \"../api/i18n\";\nimport * as logger from \"../utils/logger\";\nimport { roundTo } from \"../utils/number\";\nimport * as olObservable from \"ol/Observable\";\nimport * as olSphere from \"ol/sphere\";\nimport olOverlay from \"ol/Overlay\";\nimport olLineString from \"ol/geom/LineString\";\nimport olPolygon from \"ol/geom/Polygon\";\nimport olStyle from \"ol/style/Style\";\nimport olInteractionDraw from \"ol/interaction/Draw\";\nimport olFeature from \"ol/Feature\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport GeometryType from 'ol/geom/GeometryType';\nimport OverlayPositioning from 'ol/OverlayPositioning';\n\nconst LAYER_NAME = \"measure-layer\";\n\n/**\n * @hidden\n */\nexport interface MeasureSegment { \n    segment: number;\n    length: number;\n}\n\n/**\n * @hidden\n */\nexport interface IMeasureCallback {\n    updateSegments(kind: \"LineString\" | \"Area\", total: number, segments: MeasureSegment[] | undefined): void;\n    clearSegments(): void;\n}\n\n/**\n * @hidden\n */\nexport interface IMeasureComponent {\n    getCurrentDrawType(): GeometryType | undefined;\n    getLocale(): string;\n}\n\n/**\n * @hidden\n */\nexport class MeasureContext {\n    private olFactory: IOLFactory;\n    private draw: olInteractionDraw;\n    private measureOverlays: olOverlay[];\n    private measureLayer: olVectorLayer;\n    private viewer: IMapViewer;\n    private sketch: olFeature | null;\n    private listener: any;\n    private helpTooltipElement: HTMLElement;\n    private helpTooltip: olOverlay;\n    private measureTooltipElement: HTMLElement | null;\n    private measureTooltip: olOverlay;\n    private mapName: string;\n    private layerName: string;\n    private parent: IMeasureComponent | undefined;\n    private callback: IMeasureCallback | undefined;\n    constructor(viewer: IMapViewer, mapName: string, parent: IMeasureComponent) {\n        this.measureOverlays = [];\n        this.viewer = viewer;\n        this.mapName = mapName;\n        this.parent = parent;\n        this.layerName = `${LAYER_NAME}-${mapName}`;\n        this.olFactory = viewer.getOLFactory();\n        this.measureLayer = this.olFactory.createVectorLayer({\n            source: this.olFactory.createVectorSource()\n        });\n        this.measureLayer.setStyle(this.createMeasureStyle());\n    }\n    /**\n     * Establishes the new parent component for this context. Is called by the\n     * new parent component when it mounts and is resuming from previously recorded\n     * measurements and is not meant to be called directly\n     * \n     * @param parent The new parent component\n     * @since 0.12\n     */\n    public setParent(parent: IMeasureComponent) {\n        this.parent = parent;\n    }\n    /**\n     * Detaches the parent component from this context. Is called by the parent\n     * component when it unmounts and is not meant to be called directly.\n     * \n     * @since 0.12\n     */\n    public detachParent() {\n        this.parent = undefined;\n    }\n    /**\n     * Format length output.\n     * @param {LineString} line The line.\n     * @return {string} The formatted length.\n     */\n    private formatLength(line: olLineString): [string, number, MeasureSegment[] | undefined] {\n        let length: number;\n        let segments: MeasureSegment[] | undefined;\n        let locale;\n        if (this.parent) {\n            locale = this.parent.getLocale();\n            const coordinates = line.getCoordinates() as Coordinate2D[];\n            segments = [];\n            length = 0;\n            const sourceProj = this.viewer.getProjection();\n            for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n                const c1 = this.olFactory.transformCoordinate(coordinates[i], sourceProj, 'EPSG:4326');\n                const c2 = this.olFactory.transformCoordinate(coordinates[i + 1], sourceProj, 'EPSG:4326');\n                const dist = olSphere.getDistance(c1, c2);\n                length += dist;\n                segments.push({ segment: (i + 1), length: dist });\n            }\n        } else {\n            length = NaN;\n        }\n        let output: string;\n        if (length > 100) {\n            output = tr(\"UNIT_FMT_KM\", locale, { value: (roundTo(length / 1000, 2)) });\n        } else {\n            output = tr(\"UNIT_FMT_M\", locale, { value: (roundTo(length, 2)) });\n        }\n        return [output, length, segments];\n    }\n    /**\n     * Format area output.\n     * @param {Polygon} polygon The polygon.\n     * @return {string} Formatted area.\n     */\n    private formatArea(polygon: olPolygon): [string, number, MeasureSegment[] | undefined] {\n        let area: number;\n        let segments: MeasureSegment[] | undefined;\n        let locale;\n        if (this.parent) {\n            locale = this.parent.getLocale();\n            segments = [];\n            const sourceProj = this.viewer.getProjection();\n            const geom = polygon;\n            area = olSphere.getArea(geom, { projection: sourceProj });\n            logger.debug(`Polygon area: ${area}`);\n            const ring = geom.getLinearRing(0);\n            const coordinates = ring.getCoordinates() as Coordinate2D[];\n            for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n                // Unlike getArea(), getDistance() requires that our input coordinates are in\n                // EPSG:4326 first\n                const c1 = this.olFactory.transformCoordinate(coordinates[i], sourceProj, 'EPSG:4326');\n                const c2 = this.olFactory.transformCoordinate(coordinates[i + 1], sourceProj, 'EPSG:4326');\n                const dist = olSphere.getDistance(c1, c2);\n                segments.push({ segment: (i + 1), length: dist });\n            }\n        } else {\n            area = NaN;\n        }\n        let output: string;\n        //TODO: The dynamic switch in display of measurement unit based on size of value may prove to be\n        //jarring, so we should provide a fixed unit value option in the future that will be used to \n        //display regardless of the size of value\n        if (area > 10000) {\n            output = tr(\"UNIT_FMT_SQKM\", locale, {\n                value: `${(roundTo(area / 1000000, 2))}`\n            });\n        } else {\n            output = tr(\"UNIT_FMT_SQM\", locale, {\n                value: `${(roundTo(area, 2))}`\n            });\n        }\n        return [output, area, segments];\n    }\n    private onDrawStart = (evt: GenericEvent) => {\n        // set sketch\n        this.sketch = evt.feature;\n\n        /** @type {ol.Coordinate|undefined} */\n        let tooltipCoord = evt.coordinate;\n\n        if (this.sketch) {\n            this.listener = this.sketch.getGeometry().on('change', (e: GenericEvent) => {\n                const geom = e.target;\n                let output: string;\n                if (geom instanceof olPolygon) {\n                    const [o, total, segments] = this.formatArea(geom);\n                    output = o;\n                    if (this.callback) {\n                        this.callback.updateSegments(\"Area\", total, segments);\n                    }\n                    tooltipCoord = geom.getInteriorPoint().getCoordinates();\n                } else if (geom instanceof olLineString) {\n                    const [o, total, segments] = this.formatLength(geom);\n                    output = o;\n                    if (this.callback) {\n                        this.callback.updateSegments(\"LineString\", total, segments);\n                    }\n                    tooltipCoord = geom.getLastCoordinate();\n                } else {\n                    output = \"\";\n                }\n                if (this.measureTooltipElement) {\n                    this.measureTooltipElement.innerHTML = output;\n                }\n                this.measureTooltip.setPosition(tooltipCoord);\n            });\n        }\n    }\n    private onDrawEnd = () => {\n        if (this.measureTooltipElement) {\n            this.measureTooltipElement.className = 'tooltip tooltip-static';\n        }\n        this.measureTooltip.setOffset([0, -7]);\n        // unset sketch\n        this.sketch = null;\n        // unset tooltip so that a new one can be created\n        this.measureTooltipElement = null;\n        this.createMeasureTooltip();\n        olObservable.unByKey(this.listener);\n    }\n    private onMouseMove = (evt: GenericEvent) => {\n        if (evt.dragging || !this.parent) {\n            return;\n        }\n        const locale = this.parent.getLocale();\n        /** @type {string} */\n        let helpMsg = tr(\"MEASUREMENT_START_DRAWING\", locale);\n        if (this.sketch) {\n            const geom = (this.sketch.getGeometry());\n            if (geom instanceof olPolygon) {\n                helpMsg = tr(\"MEASUREMENT_CONTINUE_POLYGON\", locale);\n            } else if (geom instanceof olLineString) {\n                helpMsg = tr(\"MEASUREMENT_CONTINUE_LINE\", locale);\n            }\n        }\n        this.helpTooltipElement.innerHTML = helpMsg;\n        this.helpTooltip.setPosition(evt.coordinate);\n        this.helpTooltipElement.classList.remove('hidden');\n    }\n    public getMapName(): string { return this.mapName; }\n    private createMeasureStyle(): olStyle {\n        return this.olFactory.createStyle({\n            fill: this.olFactory.createStyleFill({\n                color: 'rgba(255, 255, 255, 0.2)'\n            }),\n            stroke: this.olFactory.createStyleStroke({\n                color: '#ffcc33',\n                width: 2\n            }),\n            image: this.olFactory.createStyleCircle({\n                radius: 7,\n                fill: this.olFactory.createStyleFill({\n                    color: '#ffcc33'\n                })\n            })\n        });\n    }\n    private createDrawInteraction(type: GeometryType): olInteractionDraw {\n        const source = this.measureLayer.getSource();\n        return this.olFactory.createInteractionDraw({\n            source: source,\n            type: /** @type {ol.geom.GeometryType} */ (type),\n            style: this.olFactory.createStyle({\n                fill: this.olFactory.createStyleFill({\n                    color: 'rgba(255, 255, 255, 0.2)'\n                }),\n                stroke: this.olFactory.createStyleStroke({\n                    color: 'rgba(0, 0, 0, 0.5)',\n                    lineDash: [10, 10],\n                    width: 2\n                }),\n                image: this.olFactory.createStyleCircle({\n                    radius: 5,\n                    stroke: this.olFactory.createStyleStroke({\n                        color: 'rgba(0, 0, 0, 0.7)'\n                    }),\n                    fill: this.olFactory.createStyleFill({\n                        color: 'rgba(255, 255, 255, 0.2)'\n                    })\n                })\n            })\n        });\n    }\n    private removeElement(el: Element | null) {\n        if (el && el.parentNode) {\n            el.parentNode.removeChild(el);\n        }\n    }\n    /**\n     * Creates a new help tooltip\n     */\n    private createHelpTooltip() {\n        this.removeElement(this.helpTooltipElement);\n        this.helpTooltipElement = document.createElement('div');\n        this.helpTooltipElement.className = 'tooltip hidden';\n        this.helpTooltip = this.olFactory.createOverlay({\n            element: this.helpTooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT // 'center-left'\n        });\n        this.viewer.addOverlay(this.helpTooltip);\n    }\n    /**\n     * Creates a new measure tooltip\n     */\n    private createMeasureTooltip() {\n        this.removeElement(this.measureTooltipElement);\n        this.measureTooltipElement = document.createElement('div');\n        this.measureTooltipElement.className = 'tooltip tooltip-measure';\n        //Stash the old overlay\n        if (this.measureTooltip) {\n            this.measureOverlays.push(this.measureTooltip);\n        }\n        this.measureTooltip = this.olFactory.createOverlay({\n            element: this.measureTooltipElement,\n            offset: [0, -15],\n            positioning: OverlayPositioning.BOTTOM_CENTER //'bottom-center'\n        });\n        this.viewer.addOverlay(this.measureTooltip);\n    }\n    private setActiveInteraction(type: GeometryType) {\n        if (this.draw) {\n            this.draw.un(\"drawstart\", this.onDrawStart);\n            this.draw.un(\"drawend\", this.onDrawEnd);\n            this.viewer.removeInteraction(this.draw);\n        }\n        this.draw = this.createDrawInteraction(type);\n        if (this.draw) {\n            this.draw.on(\"drawstart\", this.onDrawStart);\n            this.draw.on(\"drawend\", this.onDrawEnd);\n            this.viewer.addInteraction(this.draw);\n        }\n    }\n    public startMeasure() {\n        if (this.parent) {\n            const type = this.parent.getCurrentDrawType();\n            if (type) {\n                this.createMeasureTooltip();\n                this.createHelpTooltip();\n                this.setActiveInteraction(type);\n                this.viewer.addHandler('pointermove', this.onMouseMove);\n            }\n        }\n    }\n    public endMeasure() {\n        this.viewer.removeHandler('pointermove', this.onMouseMove);\n        if (this.draw) {\n            this.draw.un(\"drawstart\", this.onDrawStart);\n            this.draw.un(\"drawend\", this.onDrawEnd);\n            this.viewer.removeInteraction(this.draw);\n            //this.draw = null;\n        }\n        this.removeElement(this.helpTooltipElement);\n    }\n    public clearMeasurements() {\n        this.measureLayer.getSource().clear();\n        for (const ov of this.measureOverlays) {\n            this.viewer.removeOverlay(ov);\n        }\n        this.measureOverlays.length = 0; //Clear\n        if (this.callback) {\n            this.callback.clearSegments();\n        }\n    }\n    public handleDrawTypeChange() {\n        if (this.parent) {\n            const type = this.parent.getCurrentDrawType();\n            if (type) {\n                this.setActiveInteraction(type);\n            }\n        }\n    }\n    /**\n     * Since 0.12, mapName is required to explicitly state which map you are activating the context for\n     *\n     * @param {string} mapName\n     * @param {IMeasureCallback} callback\n     * @memberof MeasureContext\n     */\n    public activate(mapName: string, callback: IMeasureCallback) {\n        this.callback = callback;\n        logger.debug(`Activating measure context for ${this.mapName}`);\n        for (const ov of this.measureOverlays) {\n            this.viewer.addOverlay(ov);\n        }\n        this.viewer.getLayerManager(mapName).addLayer(this.layerName, this.measureLayer, true);\n    }\n    /**\n     * Since 0.12, mapName is required to explicitly state which map you are deactivating the context for\n     *\n     * @param {string} mapName\n     * @memberof MeasureContext\n     */\n    public deactivate(mapName: string) {\n        this.callback = undefined;\n        logger.debug(`De-activating measure context for ${this.mapName}`);\n        this.endMeasure();\n        for (const ov of this.measureOverlays) {\n            this.viewer.removeOverlay(ov);\n        }\n        this.viewer.getLayerManager(mapName).removeLayer(this.layerName);\n    }\n}","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { getViewer, getFusionRoot } from \"../api/runtime\";\nimport { tr as xlate, tr } from \"../api/i18n\";\nimport { RuntimeMap } from \"../api/contracts/runtime-map\";\nimport {\n    GenericEvent,\n    IMapView,\n    ReduxDispatch,\n    IApplicationState,\n    IConfigurationReducerState,\n    IExternalBaseLayer,\n    getRuntimeMap,\n    getCurrentView,\n    getExternalBaseLayers,\n    IMapViewer\n} from \"../api/common\";\nimport * as MapActions from \"../actions/map\";\nimport { MapCapturerContext, Size, IMapCapturerContextCallback } from \"./map-capturer-context\";\nimport { Slider, Button, Intent, Callout, HTMLSelect } from '@blueprintjs/core';\nimport { useActiveMapName, useActiveMapState, useActiveMapView, useActiveMapExternalBaseLayers, useViewerLocale, useAvailableMaps, usePrevious } from './hooks';\nimport * as logger from \"../utils/logger\";\n\nfunction getMargin() {\n    /*\n    var widget = getParent().Fusion.getWidgetsByType(\"QuickPlot\")[0];\n    var margin;\n    \n    if(!!widget.margin){\n         margin = widget.margin;\n    }else{\n        //the default margin\n        margin = {top: 25.4, buttom: 12.7, left: 12.7, right: 12.7};\n    }\n    return margin;\n    */\n    return { top: 25.4, buttom: 12.7, left: 12.7, right: 12.7 };\n}\n\nfunction getPrintSize(viewer: IMapViewer, showAdvanced: boolean, paperSize: string, orientation: \"P\" | \"L\"): Size {\n    const value = paperSize.split(\",\");\n    let size: Size;\n    if (orientation === \"P\") {\n        size = { w: parseFloat(value[0]), h: parseFloat(value[1]) };\n    } else {\n        size = { w: parseFloat(value[1]), h: parseFloat(value[0]) };\n    }\n\n    if (!showAdvanced) {\n        // Calculate the paper size to make sure it has a same ratio with the viweport\n        const paperRatio = size.w / size.h;\n        var viewSize = viewer.getSize();\n        let vs: Size | undefined;\n        if (orientation === \"P\") {\n            vs = {\n                w: viewSize[1],\n                h: viewSize[0]\n            };\n        } else {\n            vs = {\n                w: viewSize[0],\n                h: viewSize[1]\n            };\n        }\n        if (vs) {\n            const viewRatio = vs.w / vs.h;\n            if (paperRatio > viewRatio) {\n                size.w = size.h * viewRatio;\n            } else {\n                size.h = size.w / viewRatio;\n            }\n        }\n    }\n\n    const margins = getMargin();\n    size.h = size.h - margins.top - margins.buttom;\n    size.w = size.w - margins.left - margins.right;\n\n    return size;\n}\n\nconst _mapCapturers: MapCapturerContext[] = [];\n\nfunction getActiveCapturer(viewer: IMapViewer, mapNames: string[], activeMapName: string): MapCapturerContext | undefined {\n    let activeCapturer: MapCapturerContext | undefined;\n    if (_mapCapturers.length == 0) {\n        if (mapNames.length) {\n            for (const mapName of mapNames) {\n                const context = new MapCapturerContext(viewer, mapName);\n                _mapCapturers.push(context);\n                if (activeMapName == mapName) {\n                    activeCapturer = context;\n                }\n            }\n        }\n    } else {\n        activeCapturer = _mapCapturers.filter(m => m.getMapName() === activeMapName)[0];\n    }\n    return activeCapturer;\n}\n\nfunction toggleMapCapturerLayer(locale: string,\n    mapNames: string[] | undefined,\n    activeMapName: string,\n    showAdvanced: boolean,\n    paperSize: string,\n    orientation: \"P\" | \"L\",\n    scale: string,\n    rotation: number,\n    updateBoxCoords: (box: string, normalizedBox: string) => void,\n    setViewRotationEnabled: (flag: boolean) => void,\n    setViewRotation: (rot: number) => void) {\n    const bVisible: boolean = showAdvanced;\n    const viewer = getViewer();\n    if (viewer && mapNames) {\n        const activeCapturer = getActiveCapturer(viewer, mapNames, activeMapName);\n        if (activeCapturer) {\n            if (bVisible) {\n                const ppSize = getPrintSize(viewer, showAdvanced, paperSize, orientation);\n                const cb: IMapCapturerContextCallback = {\n                    updateBoxCoords\n                }\n                activeCapturer.activate(cb, ppSize, parseFloat(scale), rotation);\n                //For simplicity, reset rotation to 0 and prevent the ability to rotate while the map capture box\n                //is active\n                setViewRotationEnabled(false);\n                setViewRotation(0);\n                viewer.toastPrimary(\"info-sign\", tr(\"QUICKPLOT_BOX_INFO\", locale));\n            } else {\n                activeCapturer.deactivate();\n                setViewRotationEnabled(true);\n            }\n        }\n    }\n}\n\nexport interface IQuickPlotContainerOwnProps {\n\n}\n\nexport interface IQuickPlotContainerConnectedState {\n    config: IConfigurationReducerState;\n    map: RuntimeMap;\n    view: IMapView;\n    externalBaseLayers: IExternalBaseLayer[];\n    mapNames: string[];\n}\n\nexport interface IQuickPlotContainerDispatch {\n    setViewRotation: (rotation: number) => void;\n    setViewRotationEnabled: (enabled: boolean) => void;\n}\n\n\n\nexport interface IQuickPlotContainerState {\n    title: string;\n    subTitle: string;\n    showLegend: boolean;\n    showNorthBar: boolean;\n    showCoordinates: boolean;\n    showScaleBar: boolean;\n    showDisclaimer: boolean;\n    showAdvanced: boolean;\n    orientation: \"P\" | \"L\";\n    paperSize: string;\n    scale: string;\n    dpi: string;\n    rotation: number;\n    box: string;\n    normalizedBox: string;\n}\n\nconst QuickPlotContainer = () => {\n    const [title, setTitle] = React.useState(\"\"); ``\n    const [subTitle, setSubTitle] = React.useState(\"\");\n    const [showLegend, setShowLegend] = React.useState(false);\n    const [showNorthBar, setShowNorthBar] = React.useState(false);\n    const [showCoordinates, setShowCoordinates] = React.useState(false);\n    const [showScaleBar, setShowScaleBar] = React.useState(false);\n    const [showDisclaimer, setShowDisclaimer] = React.useState(false);\n    const [showAdvanced, setShowAdvanced] = React.useState(false);\n    const [orientation, setOrientation] = React.useState<\"L\" | \"P\">(\"P\");\n    const [paperSize, setPaperSize] = React.useState(\"210.0,297.0,A4\");\n    const [scale, setScale] = React.useState(\"5000\");\n    const [dpi, setDpi] = React.useState(\"96\");\n    const [rotation, setRotation] = React.useState(0);\n    const [box, setBox] = React.useState(\"\");\n    const [normalizedBox, setNormalizedBox] = React.useState(\"\");\n\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const mapNames = useAvailableMaps()?.map(m => m.value);\n    const map = useActiveMapState();\n    const view = useActiveMapView();\n    const externalBaseLayers = useActiveMapExternalBaseLayers();\n    const dispatch = useDispatch();\n    const setViewRotation = (rotation: number) => dispatch(MapActions.setViewRotation(rotation));\n    const setViewRotationEnabled = (enabled: boolean) => dispatch(MapActions.setViewRotationEnabled(enabled));\n\n    const onTitleChanged = (e: GenericEvent) => {\n        setTitle(e.target.value);\n    };\n    const onSubTitleChanged = (e: GenericEvent) => {\n        setSubTitle(e.target.value);\n    };\n    const onShowLegendChanged = () => {\n        setShowLegend(!showLegend);\n    };\n    const onShowNorthArrowChanged = () => {\n        setShowNorthBar(!showNorthBar);\n    };\n    const onShowCoordinatesChanged = () => {\n        setShowCoordinates(!showCoordinates);\n    };\n    const onShowScaleBarChanged = () => {\n        setShowScaleBar(!showScaleBar);\n    };\n    const onShowDisclaimerChanged = () => {\n        setShowDisclaimer(!showDisclaimer);\n    };\n    const onDpiChanged = (e: GenericEvent) => {\n        setDpi(e.target.value);\n    };\n    const onAdvancedOptionsChanged = () => {\n        setShowAdvanced(!showAdvanced);\n    };\n    const onScaleChanged = (e: GenericEvent) => {\n        setScale(e.target.value);\n    };\n    const onPaperSizeChanged = (e: GenericEvent) => {\n        setPaperSize(e.target.value);\n    };\n    const onOrientationChanged = (e: GenericEvent) => {\n        setOrientation(e.target.value);\n    };\n    const onRotationChanged = (value: number) => {\n        setRotation(value);\n    };\n    const onGeneratePlot = () => { };\n    const updateBoxCoords = (box: string, normalizedBox: string): void => {\n        setBox(box);\n        setNormalizedBox(normalizedBox);\n    };\n    //Side-effect that emulates the old componentWillUnmount lifecyle method to tear down\n    //the active map capturer\n    React.useEffect(() => {\n        return () => {\n            //Tear down all active capture box layers\n            const viewer = getViewer();\n            if (viewer && mapNames) {\n                for (const activeMapName of mapNames) {\n                    const activeCapturer = getActiveCapturer(viewer, mapNames, activeMapName);\n                    if (activeCapturer) {\n                        logger.debug(`De-activating map capturer for: ${activeMapName}`);\n                        activeCapturer.deactivate();\n                    }\n                }\n            }\n        };\n    }, []);\n    //Although the dep array arg of React.useEffect() has effectively rendered the need to\n    //track previous values obsolete, we still need to track the previous advanced flag to\n    //verify that the flag is amongst the actual values in the dep array that has changed\n    const prevShowAdvanced = usePrevious(showAdvanced);\n    //Side-effect that toggles/updates associated map capturers\n    React.useEffect(() => {\n        if (activeMapName && mapNames) {\n            if (showAdvanced != prevShowAdvanced) {\n                toggleMapCapturerLayer(locale,\n                    mapNames,\n                    activeMapName,\n                    showAdvanced,\n                    paperSize,\n                    orientation,\n                    scale,\n                    rotation,\n                    updateBoxCoords,\n                    setViewRotationEnabled,\n                    setViewRotation);\n            }\n            if (showAdvanced) {\n                const v = getViewer();\n                if (v) {\n                    const capturer = getActiveCapturer(v, mapNames, activeMapName);\n                    if (capturer) {\n                        const ppSize = getPrintSize(v, showAdvanced, paperSize, orientation);\n                        logger.debug(`Updating map capturer for: ${activeMapName}`);\n                        capturer.updateBox(ppSize, parseFloat(scale), rotation);\n                    }\n                }\n            }\n        }\n    }, [mapNames, activeMapName, showAdvanced, scale, paperSize, orientation, rotation, locale]);\n    const viewer = getViewer();\n    if (!viewer || !map || !view) {\n        return <noscript />;\n    }\n    let hasExternalBaseLayers = false;\n    if (externalBaseLayers) {\n        hasExternalBaseLayers = externalBaseLayers.length > 0;\n    }\n    let normBox = normalizedBox;\n    let theBox = box;\n    if (!showAdvanced) {\n        const extent = viewer.getCurrentExtent();\n        theBox = `${extent[0]}, ${extent[1]}, ${extent[2]}, ${extent[1]}, ${extent[2]}, ${extent[3]}, ${extent[0]}, ${extent[3]}, ${extent[0]}, ${extent[1]}`;\n        normBox = theBox;\n    }\n    let ppSize: string;\n    let prSize: string;\n    const tokens = paperSize.split(\",\");\n    if (orientation === \"L\") {\n        prSize = `${tokens[1]},${tokens[0]}`;\n        ppSize = `${prSize},${tokens[2]}`;\n    } else { // P\n        prSize = `${tokens[0]},${tokens[1]}`;\n        ppSize = `${prSize},${tokens[2]}`;\n    }\n    const url = `${getFusionRoot()}/widgets/QuickPlot/PlotAsPDF.php`\n    return <div className=\"component-quick-plot\">\n        <form id=\"Form1\" name=\"Form1\" target=\"_blank\" method=\"post\" action={url}>\n            <input type=\"hidden\" id=\"printId\" name=\"printId\" value={`${Math.random() * 1000}`} />\n            <div className=\"Title FixWidth\">{xlate(\"QUICKPLOT_HEADER\", locale)}</div>\n            <label className=\"bp3-label\">\n                {xlate(\"QUICKPLOT_TITLE\", locale)}\n                <input type=\"text\" className=\"bp3-input bp3-fill\" dir=\"auto\" name=\"{field:title}\" id=\"title\" maxLength={100} value={title} onChange={onTitleChanged} />\n            </label>\n            <label className=\"bp3-label\">\n                {xlate(\"QUICKPLOT_SUBTITLE\", locale)}\n                <input type=\"text\" className=\"bp3-input bp3-fill\" dir=\"auto\" name=\"{field:sub_title}\" id=\"subtitle\" maxLength={100} value={subTitle} onChange={onSubTitleChanged} />\n            </label>\n            <label className=\"bp3-label\">\n                {xlate(\"QUICKPLOT_PAPER_SIZE\", locale)}\n                <div className=\"bp3-select bp3-fill\">\n                    {/*\n                            The pre-defined paper size list. The value for each \"option\" item is in this format: [width,height]. The unit is in millimeter.\n                            We can change the html code to add more paper size or remove some ones.\n                        */}\n                    <HTMLSelect className=\"FixWidth\" id=\"paperSizeSelect\" name=\"paperSizeSelect\" value={paperSize} onChange={onPaperSizeChanged}>\n                        <option value=\"210.0,297.0,A4\">A4 (210x297 mm; 8.27x11.69 In) </option>\n                        <option value=\"297.0,420.0,A3\">A3 (297x420 mm; 11.69x16.54 In) </option>\n                        <option value=\"148.0,210.0,A5\">A5 (148x210 mm; 5.83x8.27 in) </option>\n                        <option value=\"216.0,279.0,Letter\">Letter (216x279 mm; 8.50x11.00 In) </option>\n                        <option value=\"216.0,356.0,Legal\">Legal (216x356 mm; 8.50x14.00 In) </option>\n                    </HTMLSelect>\n                </div>\n            </label>\n            <label className=\"bp3-label\">\n                {xlate(\"QUICKPLOT_ORIENTATION\", locale)}\n                {/*\n                        The pre-defined paper orientations\n                    */}\n                <div className=\"bp3-select bp3-fill\">\n                    <HTMLSelect className=\"FixWidth\" id=\"orientation\" name=\"orientation\" value={orientation} onChange={onOrientationChanged}>\n                        <option value=\"P\">{xlate(\"QUICKPLOT_ORIENTATION_P\", locale)}</option>\n                        <option value=\"L\">{xlate(\"QUICKPLOT_ORIENTATION_L\", locale)}</option>\n                    </HTMLSelect>\n                </div>\n            </label>\n            <input type=\"hidden\" id=\"paperSize\" name=\"paperSize\" value={ppSize} />\n            <input type=\"hidden\" id=\"printSize\" name=\"printSize\" value={prSize} />\n            <fieldset>\n                <legend>{xlate(\"QUICKPLOT_SHOWELEMENTS\", locale)}</legend>\n                <label className=\"bp3-control bp3-checkbox\">\n                    <input type=\"checkbox\" id=\"ShowLegendCheckBox\" name=\"ShowLegend\" checked={showLegend} onChange={onShowLegendChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {xlate(\"QUICKPLOT_SHOWLEGEND\", locale)}\n                </label>\n                <label className=\"bp3-control bp3-checkbox\">\n                    <input type=\"checkbox\" id=\"ShowNorthArrowCheckBox\" name=\"ShowNorthArrow\" checked={showNorthBar} onChange={onShowNorthArrowChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {xlate(\"QUICKPLOT_SHOWNORTHARROW\", locale)}\n                </label>\n                <label className=\"bp3-control bp3-checkbox\">\n                    <input type=\"checkbox\" id=\"ShowCoordinatesCheckBox\" name=\"ShowCoordinates\" checked={showCoordinates} onChange={onShowCoordinatesChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {xlate(\"QUICKPLOT_SHOWCOORDINTES\", locale)}\n                </label>\n                <label className=\"bp3-control bp3-checkbox\">\n                    <input type=\"checkbox\" id=\"ShowScaleBarCheckBox\" name=\"ShowScaleBar\" checked={showScaleBar} onChange={onShowScaleBarChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {xlate(\"QUICKPLOT_SHOWSCALEBAR\", locale)}\n                </label>\n                <label className=\"bp3-control bp3-checkbox\">\n                    <input type=\"checkbox\" id=\"ShowDisclaimerCheckBox\" name=\"ShowDisclaimer\" checked={showDisclaimer} onChange={onShowDisclaimerChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {xlate(\"QUICKPLOT_SHOWDISCLAIMER\", locale)}\n                </label>\n            </fieldset>\n            <div className=\"HPlaceholder5px\"></div>\n            <div>\n                <label className=\"bp3-control bp3-checkbox\">\n                    <input type=\"checkbox\" id=\"AdvancedOptionsCheckBox\" onChange={onAdvancedOptionsChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {xlate(\"QUICKPLOT_ADVANCED_OPTIONS\", locale)}\n                </label>\n            </div>\n            {(() => {\n                if (showAdvanced) {\n                    return <div>\n                        <label className=\"bp3-label\">\n                            {xlate(\"QUICKPLOT_SCALING\", locale)}\n                            {/*\n                                    The pre-defined scales. The value for each \"option\" item is the scale denominator.\n                                    We can change the html code to extend the pre-defined scales\n                                */}\n                            <div className=\"bp3-select bp3-fill\">\n                                <HTMLSelect className=\"FixWidth\" id=\"scaleDenominator\" name=\"scaleDenominator\" value={scale} onChange={onScaleChanged}>\n                                    <option value=\"500\">1: 500</option>\n                                    <option value=\"1000\">1: 1000</option>\n                                    <option value=\"2500\">1: 2500</option>\n                                    <option value=\"5000\">1: 5000</option>\n                                </HTMLSelect>\n                            </div>\n                        </label>\n                        <label className=\"bp3-label\">\n                            {xlate(\"QUICKPLOT_DPI\", locale)}\n                            {/*\n                                    The pre-defined print DPI.\n                                    We can change the html code to extend the pre-defined values\n                                */}\n                            <div className=\"bp3-select bp3-fill\">\n                                <HTMLSelect className=\"FixWidth\" id=\"dpi\" name=\"dpi\" value={dpi} onChange={onDpiChanged}>\n                                    <option value=\"96\">96</option>\n                                    <option value=\"150\">150</option>\n                                    <option value=\"300\">300</option>\n                                    <option value=\"600\">600</option>\n                                </HTMLSelect>\n                            </div>\n                        </label>\n                        <label className=\"bp3-label noselect\">\n                            {xlate(\"QUICKPLOT_BOX_ROTATION\", locale)}\n                            <div style={{ paddingLeft: 16, paddingRight: 16 }}>\n                                <Slider min={0} max={360} labelStepSize={90} stepSize={1} value={rotation} onChange={onRotationChanged} />\n                            </div>\n                        </label>\n                    </div>;\n                } else {\n                    return <div>\n                        <input type=\"hidden\" id=\"scaleDenominator\" name=\"scaleDenominator\" value={`${view.scale}`} />\n                        <input type=\"hidden\" id=\"dpi\" name=\"dpi\" value={dpi} />\n                    </div>;\n                }\n            })()}\n            <div className=\"HPlaceholder5px\"></div>\n            {(() => {\n                if (hasExternalBaseLayers) {\n                    return <Callout intent={Intent.PRIMARY} icon=\"info-sign\">\n                        {xlate(\"QUICKPLOT_COMMERCIAL_LAYER_WARNING\", locale)}\n                    </Callout>;\n                }\n            })()}\n            <div className=\"ButtonContainer FixWidth\">\n                <Button type=\"submit\" intent={Intent.PRIMARY} icon=\"print\" onClick={onGeneratePlot}>{xlate(\"QUICKPLOT_GENERATE\", locale)}</Button>\n            </div>\n            <input type=\"hidden\" id=\"margin\" name=\"margin\" />\n            <input type=\"hidden\" id=\"normalizedBox\" name=\"normalizedBox\" value={normBox} />\n            <input type=\"hidden\" id=\"rotation\" name=\"rotation\" value={-(rotation || 0)} />\n            <input type=\"hidden\" id=\"sessionId\" name=\"sessionId\" value={map.SessionId} />\n            <input type=\"hidden\" id=\"mapName\" name=\"mapName\" value={map.Name} />\n            <input type=\"hidden\" id=\"box\" name=\"box\" value={theBox} />\n            <input type=\"hidden\" id=\"legalNotice\" name=\"legalNotice\" />\n        </form>\n    </div>;\n}\n\nexport default QuickPlotContainer;","import * as React from \"react\";\nimport { IMapMenuEntry } from \"../api/common\";\n\n/**\n * MapMenu component props\n *\n * @export\n * @interface IMapMenuProps\n */\nexport interface IMapMenuProps {\n    locale: string | undefined;\n    selectedMap: string;\n    maps: IMapMenuEntry[];\n    onActiveMapChanged?: (name: string) => void;\n}\n\n/**\n * The MapMenu component provides the ability to switch between active maps\n * @param props \n */\nexport const MapMenu = (props: IMapMenuProps) => {\n    const [selected, setSelected] = React.useState(undefined);\n    const onActiveMapChanged = (e: any) => {\n        const value = e.currentTarget.value;\n        setSelected(value);\n        props.onActiveMapChanged?.(value);\n    };\n    return <div>\n        {props.maps.map(layer => {\n            return <div className=\"map-menu-item-container\" key={`base-layer-${layer.mapName}`}>\n                <label className=\"bp3-control bp3-radio\">\n                    <input className=\"map-menu-option\" type=\"radio\" value={layer.mapName} checked={layer.mapName === props.selectedMap} onChange={onActiveMapChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {layer.label}\n                </label>\n            </div>;\n        })}\n    </div>;\n}","import * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { ILayerInfo } from \"../../api/common\";\nimport { Button, Intent, ButtonGroup, Card, Icon, Switch, NonIdealState, Slider, Collapse, Spinner } from '@blueprintjs/core';\nimport { BlueprintSvgIconNames } from '../../constants';\nimport { strIsNullOrEmpty } from \"../../utils/string\";\nimport { VectorStyleEditor } from '../vector-style-editor';\nimport { IVectorFeatureStyle } from '../../api/ol-style-helpers';\n\ninterface IManageLayerItemProps {\n    layer: ILayerInfo;\n    locale: string;\n    currentResolution?: number;\n    canMoveUp: boolean;\n    canMoveDown: boolean;\n    onSetOpacity: (name: string, value: number) => void;\n    onSetVisibility: (name: string, visible: boolean) => void;\n    onZoomToBounds: (name: string) => void;\n    onRemoveLayer: (name: string) => void;\n    onMoveLayerUp: (name: string) => void;\n    onMoveLayerDown: (name: string) => void;\n    onVectorStyleChanged: (name: string, style: IVectorFeatureStyle) => void;\n}\n\nenum OpenPanel {\n    None,\n    MoreLayerOptions,\n    EditVectorStyle,\n    WmsLegend\n}\n\nconst ManageLayerItem = (props: IManageLayerItemProps) => {\n    const {\n        layer,\n        locale,\n        canMoveUp,\n        canMoveDown,\n        currentResolution,\n        onSetOpacity,\n        onRemoveLayer,\n        onMoveLayerUp,\n        onMoveLayerDown,\n        onZoomToBounds,\n        onSetVisibility,\n        onVectorStyleChanged\n    } = props;\n    const [wmsLegendUrl, setWmsLegendUrl] = React.useState<string | undefined>(undefined);\n    const [openPanel, setOpenPanel] = React.useState(OpenPanel.None);\n    const onToggleWmsLegend = (action: (res?: number) => string) => {\n        if (wmsLegendUrl) {\n            setWmsLegendUrl(undefined);\n            setOpenPanel(OpenPanel.None);\n        } else {\n            const url = action(currentResolution);\n            setWmsLegendUrl(url);\n            setOpenPanel(OpenPanel.WmsLegend);\n        }\n    };\n    const toggleOpenPanel = (panel: OpenPanel) => {\n        let p = OpenPanel.None;\n        switch (panel) {\n            case OpenPanel.EditVectorStyle:\n            case OpenPanel.MoreLayerOptions:\n            case OpenPanel.WmsLegend:\n                p = (panel == openPanel) ? OpenPanel.None : panel;\n                break;\n        }\n        setOpenPanel(p);\n    };\n    const isBusy = (layer.busyWorkerCount > 0);\n    if (isBusy) {\n        return <Card>\n            <Spinner size={30} />\n            <p style={{ textAlign: \"center\", marginTop: 5 }}>{tr(\"LOADING_LAYER\", locale, { name: layer.name })}</p>\n        </Card>;\n    }\n    const canZoom = layer.type != \"WMS\";\n    let iconName: BlueprintSvgIconNames = \"layer\";\n    if (layer.type == \"WMS\") {\n        iconName = \"media\";\n    }\n    const extraActions = [] as JSX.Element[];\n    const { extensions } = layer;\n    let isWms = false;\n    if (extensions) {\n        switch (extensions.type) {\n            case \"WMS\":\n                {\n                    isWms = true;\n                    if (extensions.getLegendUrl) {\n                        extraActions.push(<Button key=\"toggle-wms-legend\" intent={Intent.SUCCESS} icon=\"info-sign\" onClick={() => onToggleWmsLegend(extensions.getLegendUrl as any)} />)\n                    }\n                }\n        }\n    }\n    if (layer.vectorStyle) {\n        if (layer.type != \"KML\") {\n            extraActions.push(<Button key=\"edit-vector-style\" title={tr(\"LAYER_MANAGER_TT_EDIT_STYLE\", locale)} intent={Intent.PRIMARY} icon=\"edit\" onClick={() => toggleOpenPanel(OpenPanel.EditVectorStyle)} />)\n        }\n    }\n    extraActions.push(<Button key=\"more-layer-options\" title={tr(\"LAYER_MANAGER_TT_MORE_OPTIONS\", locale)} intent={Intent.PRIMARY} icon=\"cog\" onClick={() => toggleOpenPanel(OpenPanel.MoreLayerOptions)} />)\n    const isWmsLegendOpen = !strIsNullOrEmpty(wmsLegendUrl);\n    return <Card key={layer.name}>\n        <Switch checked={layer.visible} onChange={() => onSetVisibility(layer.name, !layer.visible)} labelElement={<><Icon icon={iconName} /> {layer.name}</>} />\n        <ButtonGroup>\n            <Button disabled={!canMoveUp} title={tr(\"LAYER_MANAGER_TT_MOVE_UP\", locale)} intent={Intent.PRIMARY} icon=\"caret-up\" onClick={() => onMoveLayerUp(layer.name)} />\n            <Button disabled={!canMoveDown} title={tr(\"LAYER_MANAGER_TT_MOVE_DOWN\", locale)} intent={Intent.PRIMARY} icon=\"caret-down\" onClick={() => onMoveLayerDown(layer.name)} />\n            <Button disabled={!canZoom} title={tr(\"LAYER_MANAGER_TT_ZOOM_EXTENTS\", locale)} intent={Intent.SUCCESS} icon=\"zoom-to-fit\" onClick={() => onZoomToBounds(layer.name)} />\n            <Button title={tr(\"LAYER_MANAGER_TT_REMOVE\", locale)} intent={Intent.DANGER} icon=\"trash\" onClick={() => onRemoveLayer(layer.name)} />\n            {extraActions}\n        </ButtonGroup>\n        <Collapse isOpen={openPanel == OpenPanel.MoreLayerOptions}>\n            <Card>\n                <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"MORE_LAYER_OPTIONS\", locale)}</a></h5>\n                <p>{tr(\"LAYER_OPACITY\", locale)}</p>\n                <Slider min={0} max={1.0} stepSize={0.01} value={layer.opacity} onChange={e => onSetOpacity(layer.name, e)} />\n            </Card>\n        </Collapse>\n        {isWms && <Collapse isOpen={isWmsLegendOpen}>\n            <Card>\n                <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WMS_LEGEND\", locale)}</a></h5>\n                <img src={wmsLegendUrl} />\n            </Card>\n        </Collapse>}\n        {layer.vectorStyle && <Collapse isOpen={openPanel == OpenPanel.EditVectorStyle}>\n            <Card>\n                <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"VECTOR_LAYER_STYLE\", locale)}</a></h5>\n                <VectorStyleEditor onChange={st => onVectorStyleChanged(layer.name, st)} locale={locale} style={layer.vectorStyle} enablePoint={true} enableLine={true} enablePolygon={true} />\n            </Card>\n        </Collapse>}\n    </Card>;\n}\n\n/**\n * @hidden\n */\nexport interface IManageLayersProps {\n    layers: ILayerInfo[];\n    locale: string;\n    currentResolution?: number;\n    onSetOpacity: (name: string, value: number) => void;\n    onSetVisibility: (name: string, visible: boolean) => void;\n    onZoomToBounds: (name: string) => void;\n    onRemoveLayer: (name: string) => void;\n    onMoveLayerUp: (name: string) => void;\n    onMoveLayerDown: (name: string) => void;\n    onVectorStyleChanged: (name: string, style: IVectorFeatureStyle) => void;\n}\n\n/**\n * @hidden\n */\nexport const ManageLayers = (props: IManageLayersProps) => {\n    const {\n        locale,\n        currentResolution,\n        onSetOpacity,\n        onRemoveLayer,\n        onMoveLayerUp,\n        onMoveLayerDown,\n        onZoomToBounds,\n        onSetVisibility,\n        onVectorStyleChanged\n    } = props;\n    const [layers, setLayers] = React.useState(props.layers);\n    const [wmsLegendUrl, setWmsLegendUrl] = React.useState<string | undefined>(undefined);\n    React.useEffect(() => {\n        setLayers(props.layers);\n    }, [props.layers]);\n    if (layers.length) {\n        return <div>\n            {layers.map((lyr, i) => {\n                const cannotMoveUp = (i == 0 || layers.length <= 1);\n                const cannotMoveDown = (i >= layers.length - 1 || layers.length <= 1);\n                return <ManageLayerItem\n                    key={`manage-layer-${i}`}\n                    layer={lyr}\n                    locale={locale}\n                    canMoveUp={!cannotMoveUp}\n                    canMoveDown={!cannotMoveDown}\n                    currentResolution={currentResolution}\n                    onSetOpacity={onSetOpacity}\n                    onRemoveLayer={onRemoveLayer}\n                    onMoveLayerUp={onMoveLayerUp}\n                    onMoveLayerDown={onMoveLayerDown}\n                    onZoomToBounds={onZoomToBounds}\n                    onSetVisibility={onSetVisibility}\n                    onVectorStyleChanged={onVectorStyleChanged} />;\n            })}\n        </div>;\n    } else {\n        return <NonIdealState\n            icon=\"layers\"\n            title={tr(\"NO_EXTERNAL_LAYERS\", locale)}\n            description={tr(\"NO_EXTERNAL_LAYERS_DESC\", locale, { tabName: tr(\"ADD_LAYER\", locale) })} />\n    }\n}","import * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { GenericEvent, ILayerInfo } from \"../../api/common\";\nimport { AddWmsLayer } from \"./add-wms-layer\";\nimport { AddWfsLayer } from \"./add-wfs-layer\";\nimport { HTMLSelect, Label, RadioGroup, Radio, NonIdealState, Button, Intent, EditableText, ButtonGroup, FormGroup, Callout, NumericInput, FileInput } from '@blueprintjs/core';\nimport * as Runtime from \"../../api/runtime\";\nimport { strIsNullOrEmpty } from \"../../utils/string\";\nimport proj4 from \"proj4\";\nimport { ensureProjection } from '../../api/registry/projections';\nimport { IParsedFeatures } from '../../api/layer-manager/parsed-features';\nimport { parseEpsgCodeFromCRS } from './wfs-capabilities-panel';\n\n/**\n * @hidden\n */\nexport interface IAddLayerProps {\n    locale: string;\n    onLayerAdded: (layer: ILayerInfo) => void;\n    onAddLayerBusyWorker: (name: string) => void;\n    onRemoveLayerBusyWorker: (name: string) => void;\n}\n\n/**\n * @hidden\n */\nexport interface IAddLayerState {\n    selectedType: string;\n}\n\n/**\n * @hidden\n */\nexport interface IAddLayerContentProps {\n    locale: string;\n    onLayerAdded: (layer: ILayerInfo) => void;\n    onAddLayerBusyWorker: (name: string) => void;\n    onRemoveLayerBusyWorker: (name: string) => void;\n}\n\ninterface IAddLayerConf {\n    label: string;\n    content: (props: IAddLayerContentProps) => JSX.Element;\n}\n\nconst ADD_URL_LAYER_TYPES: { [key: string]: IAddLayerConf } = {\n    \"WMS\": {\n        label: \"WMS\",\n        content: (props: IAddLayerContentProps) => <AddWmsLayer {...props} />\n    },\n    \"WFS\": {\n        label: \"WFS\",\n        content: (props: IAddLayerContentProps) => <AddWfsLayer {...props} />\n    }\n};\n\nenum AddLayerKind {\n    File,\n    Url\n}\n\ninterface LoadedFile {\n    name: string;\n    size: number;\n    type: string;\n    defaultProjection: string | null;\n}\n\nconst AddFileLayer = (props: IAddLayerProps) => {\n    const { locale } = props;\n    const [isAddingLayer, setIsAddingLayer] = React.useState(false);\n    const [addLayerError, setAddLayerError] = React.useState<any>(undefined);\n    const [loadedFile, setLoadedFile] = React.useState<LoadedFile | undefined>(undefined);\n    const [addLayerName, setAddLayerName] = React.useState<string | undefined>(undefined);\n    const [addProjection, setAddProjection] = React.useState(4326);\n    const parsedFeaturesRef = React.useRef<IParsedFeatures | undefined>(undefined);\n    const setParsedFile = (parsed: IParsedFeatures | undefined) => {\n        parsedFeaturesRef.current = parsed;\n        if (parsed) {\n            setAddLayerName(parsed.name);\n            setLoadedFile({\n                name: parsed.name,\n                size: parsed.size,\n                type: parsed.type,\n                defaultProjection: parsed.projection\n            });\n            if (parsed.projection) {\n                const epsg = parseEpsgCodeFromCRS(parsed.projection);\n                if (epsg) {\n                    setAddProjection(epsg);\n                }\n            }\n        } else {\n            setLoadedFile(undefined);\n            parsedFeaturesRef.current = undefined;\n        }\n    };\n    const onFileDropped = async (file: File) => {\n        const viewer = Runtime.getViewer();\n        if (viewer) {\n            setAddLayerError(undefined);\n            const layerMgr = viewer.getLayerManager();\n            try {\n                const parsed = await layerMgr.parseFeaturesFromFile({\n                    file: file,\n                    name: file.name,\n                    locale: locale\n                });\n                setParsedFile(parsed);\n            } catch (e) {\n                setAddLayerError(e);\n            }\n        }\n    };\n    const onCancelAddFile = () => {\n        setParsedFile(undefined);\n    };\n    const onAddFileLayer = async (layerProjection: number) => {\n        const viewer = Runtime.getViewer();\n        if (viewer && parsedFeaturesRef?.current) {\n            setIsAddingLayer(true);\n            setAddLayerError(undefined);\n            try {\n                const [_, layerProj] = await ensureProjection(layerProjection, locale);\n                const layerName = addLayerName ?? parsedFeaturesRef.current.name;\n                const layerMgr = viewer.getLayerManager();\n                if (layerMgr.hasLayer(layerName)) {\n                    throw new Error(tr(\"LAYER_NAME_EXISTS\", locale, { name: layerName }));\n                }\n                const layer = await layerMgr.addLayerFromParsedFeatures({\n                    features: parsedFeaturesRef.current,\n                    projection: layerProj\n                });\n                setIsAddingLayer(false);\n                viewer.toastSuccess(\"success\", tr(\"ADDED_LAYER\", props.locale, { name: layer.name }));\n                setAddLayerError(undefined);\n                setLoadedFile(undefined);\n                setAddLayerName(undefined);\n                props.onLayerAdded(layer);\n            } catch (e) {\n                setAddLayerError(e);\n                if (!strIsNullOrEmpty(e?.message)) {\n                    viewer.toastError(\"error\", e.message);\n                }\n            }\n            setIsAddingLayer(false);\n        }\n    };\n    if (loadedFile) {\n        const projections = Object.keys(proj4.defs);\n        return <NonIdealState\n            title={<EditableText value={addLayerName} onChange={v => setAddLayerName(v)} />}\n            icon=\"upload\"\n            description={tr(\"FMT_UPLOADED_FILE\", locale, { size: loadedFile.size, type: (strIsNullOrEmpty(loadedFile.type) ? tr(\"UNKNOWN_FILE_TYPE\", locale) : loadedFile.type) })}\n            action={<>\n                {addLayerError && <Callout intent={Intent.DANGER} title={tr(\"ADDING_LAYER_ERROR\", locale)}>\n                    {addLayerError.message}\n                </Callout>}\n                <FormGroup label={tr(\"ADD_LAYER_PROJECTION\", locale)}>\n                    {loadedFile.defaultProjection ? <strong>EPSG:{addProjection}</strong> : <FormGroup label={<a href=\"https://epsg.io\" target=\"_blank\">EPSG:</a>} inline>\n                        <NumericInput style={{ width: 60 }} min={0} value={addProjection} onValueChange={v => setAddProjection(v)} />\n                    </FormGroup>}\n                </FormGroup>\n                <ButtonGroup>\n                    <Button loading={isAddingLayer} onClick={(e: any) => onAddFileLayer(addProjection)} intent={Intent.PRIMARY}>{tr(\"ADD_LAYER\", locale)}</Button>\n                    <Button loading={isAddingLayer} onClick={(e: any) => onCancelAddFile()} intent={Intent.DANGER}>{tr(\"CANCEL\", locale)}</Button>\n                </ButtonGroup>\n            </>} />\n    } else {\n        return <>\n            {addLayerError && <Callout intent={Intent.DANGER} title={tr(\"ADDING_LAYER_ERROR\", locale)}>\n                {addLayerError.message}\n            </Callout>}\n            <NonIdealState\n                title={tr(\"ADD_FILE\", locale)}\n                icon=\"upload\"\n                description={tr(\"ADD_FILE_INSTRUCTIONS\", locale)}\n                action={<FileInput fill text={tr(\"CHOOSE_FILE\", locale)} buttonText={tr(\"BROWSE\", locale)} onInputChange={(e: any) => e.target.files && onFileDropped(e.target.files[0])} />} />\n        </>;\n    }\n}\n\nconst AddUrlLayer = (props: IAddLayerProps) => {\n    const { locale } = props;\n    const [selectedUrlType, setSelectedUrlType] = React.useState<string | undefined>(undefined);\n    const onUrlLayerTypeChanged = (e: GenericEvent) => {\n        setSelectedUrlType(e.target.value);\n    };\n    const items = Object.keys(ADD_URL_LAYER_TYPES).map(lt => ({ value: lt, label: ADD_URL_LAYER_TYPES[lt].label }));\n    return <div>\n        <Label>\n            {tr(\"LAYER_TYPE\", locale)}\n            <HTMLSelect value={selectedUrlType || \"\"} onChange={onUrlLayerTypeChanged}>\n                <option>{tr(\"SELECT_LAYER_TYPE\", locale)}</option>\n                {items.map(it => <option key={it.value} value={it.value}>{it.value}</option>)}\n            </HTMLSelect>\n        </Label>\n        {(() => {\n            if (selectedUrlType && ADD_URL_LAYER_TYPES[selectedUrlType]) {\n                const cprops: IAddLayerContentProps = {\n                    locale: locale,\n                    onLayerAdded: props.onLayerAdded,\n                    onAddLayerBusyWorker: props.onAddLayerBusyWorker,\n                    onRemoveLayerBusyWorker: props.onRemoveLayerBusyWorker\n                };\n                return ADD_URL_LAYER_TYPES[selectedUrlType].content(cprops);\n            }\n        })()}\n    </div>;\n}\n\n/**\n * @hidden\n */\nexport const AddLayer = (props: IAddLayerProps) => {\n    const [addLayerKind, setAddLayerKind] = React.useState<AddLayerKind>(AddLayerKind.File);\n    const onAddLayerKindChanged = (e: GenericEvent) => {\n        setAddLayerKind(parseInt(e.target.value, 10));\n    };\n    return <div>\n        <RadioGroup\n            label={tr(\"ADD_LAYER_KIND_PROMPT\", props.locale)}\n            onChange={onAddLayerKindChanged}\n            selectedValue={addLayerKind}>\n            <Radio label={tr(\"LAYER_KIND_FILE\", props.locale)} value={AddLayerKind.File} />\n            <Radio label={tr(\"LAYER_KIND_URL\", props.locale)} value={AddLayerKind.Url} />\n        </RadioGroup>\n        <hr />\n        {(() => {\n            switch (addLayerKind) {\n                case AddLayerKind.File:\n                    return <AddFileLayer {...props} />;\n                case AddLayerKind.Url:\n                    return <AddUrlLayer {...props} />;\n            }\n        })()}\n    </div>;\n}","import * as React from \"react\";\nimport {\n    GenericEvent,\n    WmsCapabilitiesDocument,\n    WMSLayerStyle,\n    LayerProperty,\n    SourceProperty\n} from \"../../api/common\";\nimport { tr } from \"../../api/i18n\";\nimport { Error } from \"../error\";\nimport * as Runtime from \"../../api/runtime\";\nimport { Client } from \"../../api/client\";\nimport { WmsCapabilitiesPanel } from \"./wms-capabilities-panel\";\nimport olWmsParser from \"ol/format/WMSCapabilities\";\nimport olTileLayer from \"ol/layer/Tile\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olWmsSource from \"ol/source/ImageWMS\";\nimport olTiledWmsSource from \"ol/source/TileWMS\";\nimport { Spinner, NonIdealState, Intent, ControlGroup, InputGroup, Button } from '@blueprintjs/core';\nimport { strIsNullOrEmpty } from \"../../utils/string\";\nimport { IAddLayerContentProps } from './add-layer';\nimport { getLayerInfo } from '../../api/layer-manager';\n\n/**\n * @hidden\n */\nexport const AddWmsLayer = (props: IAddLayerContentProps) => {\n    const { locale } = props;\n    const [wmsUrl, setWmsUrl] = React.useState(\"\");\n    const [loadingCapabilities, setLoadingCapabilities] = React.useState(false);\n    const [caps, setCaps] = React.useState<WmsCapabilitiesDocument | undefined>(undefined);\n    const [error, setError] = React.useState<Error | string | undefined>(undefined);\n    const onAddLayer = (name: string, selectable: boolean, isTiled: boolean, style: WMSLayerStyle | undefined) => {\n        const viewer = Runtime.getViewer();\n        if (caps && viewer) {\n            const params: any = {\n                LAYERS: name\n            };\n            if (style) {\n                params.STYLE = style.Name;\n            }\n            if (isTiled) {\n                params.TILED = true;\n            }\n            let layer;\n            let source: olTiledWmsSource | olWmsSource;\n            if (isTiled) {\n                source = new olTiledWmsSource({\n                    url: caps.Capability.Request.GetMap.DCPType[0].HTTP.Get.OnlineResource,\n                    params: params\n                });\n                layer = new olTileLayer({\n                    source: source\n                });\n            } else {\n                source = new olWmsSource({\n                    url: caps.Capability.Request.GetMap.DCPType[0].HTTP.Get.OnlineResource,\n                    params: params\n                });\n                layer = new olImageLayer({\n                    source: source\n                });\n            }\n            layer.set(LayerProperty.LAYER_TYPE, \"WMS\");\n            layer.set(LayerProperty.IS_SELECTABLE, selectable);\n            layer.set(LayerProperty.IS_EXTERNAL, true);\n            layer.set(LayerProperty.IS_GROUP, false);\n            if (style) {\n                const legendUrl = style.LegendURL?.[0]?.OnlineResource;\n                if (!strIsNullOrEmpty(legendUrl)) {\n                    layer.set(LayerProperty.HAS_WMS_LEGEND, true);\n                }\n            }\n            // Suppress automatic load event handling for this as we need our own\n            source.set(SourceProperty.SUPPRESS_LOAD_EVENTS, true);\n            const started = () => {\n                viewer.addImageLoading();\n                props.onAddLayerBusyWorker(name);\n            };\n            const finished = () => {\n                viewer.addImageLoaded();\n                props.onRemoveLayerBusyWorker(name);\n            };\n            if (source instanceof olTiledWmsSource) {  \n                source.on(\"tileloadstart\", started);\n                source.on(\"tileloadend\", finished);\n                source.on(\"tileloaderror\", finished);\n            } else if (source instanceof olWmsSource) {\n                source.on(\"imageloadstart\", started);\n                source.on(\"imageloadend\", finished);\n                source.on(\"imageloaderror\", finished);\n            }\n\n            viewer.getLayerManager().addLayer(name, layer);\n            viewer.toastSuccess(\"success\", tr(\"ADDED_LAYER\", locale, { name: name }));\n            props.onLayerAdded(getLayerInfo(layer, true));\n        }\n    };\n    const onLoadCaps = () => {\n        setCaps(undefined);\n        setLoadingCapabilities(true);\n        const client = new Client(\"\", \"mapagent\");\n        client.getText(wmsUrl).then(s => {\n            const parser = new olWmsParser();\n            const caps: WmsCapabilitiesDocument = parser.read(s);\n            if (caps.version != \"1.3.0\") {\n                setLoadingCapabilities(false);\n                setCaps(undefined);\n                setError(tr(\"WMS_UNSUPPORTED_VERSION\", locale, { version: caps.version }));\n            } else {\n                setLoadingCapabilities(false);\n                setCaps(caps);\n                setError(undefined);\n            }\n        }).catch(err => {\n            setLoadingCapabilities(false);\n            setCaps(undefined);\n            setError(err);\n        });\n    };\n    const onWmsUrlChange = (e: GenericEvent) => {\n        setWmsUrl(e.target.value);\n    };\n    return <div>\n        <ControlGroup fill>\n            <InputGroup leftIcon=\"geosearch\"\n                placeholder={tr(\"ADD_WMS_LAYER_URL\", locale)}\n                value={wmsUrl}\n                onChange={onWmsUrlChange}\n                readOnly={loadingCapabilities}\n                rightElement={<Button intent={Intent.PRIMARY} icon=\"arrow-right\" onClick={onLoadCaps} disabled={loadingCapabilities} />} />\n        </ControlGroup>\n        <br />\n        <div>\n            {(() => {\n                if (loadingCapabilities) {\n                    return <NonIdealState\n                        icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                        title={tr(\"ADD_WMS_LAYER_LOADING\", locale)}\n                        description={tr(\"ADD_WMS_LAYER_LOADING_DESC\", locale)} />;\n                } else {\n                    if (caps) {\n                        return <WmsCapabilitiesPanel onAddLayer={onAddLayer} capabilities={caps} locale={locale} />;\n                    } else if (error) {\n                        return <Error error={error} />;\n                    } else {\n                        return <NonIdealState\n                            icon=\"issue\"\n                            title={tr(\"ADD_WMS_LAYER_NO_LAYERS\", locale)}\n                            description={tr(\"WMS_NO_LAYER_DESCRIPTION\", locale)} />;\n                    }\n                }\n            })()}\n        </div>\n    </div>;\n}","import * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { WmsCapabilitiesDocument, WMSPublishedLayer, WMSLayerStyle } from \"../../api/common\";\nimport { Tooltip, ITreeNode, Card, Button, Intent, ButtonGroup, Icon } from '@blueprintjs/core';\n\ntype WMSLayerStylePair = [WMSPublishedLayer, WMSLayerStyle[]];\n\nfunction extractWmsLayers(caps: WmsCapabilitiesDocument): WMSLayerStylePair[] {\n    const layers = [] as WMSLayerStylePair[];\n    const { Layer, ...rootLayer } = caps.Capability.Layer;\n    if (rootLayer.Name) { //Must have name to be considered\n        layers.push([rootLayer, rootLayer.Style ?? []]);\n    }\n    if (caps.Capability.Layer.Layer) {\n        for (const layer of caps.Capability.Layer.Layer) {\n            layers.push([layer, layer.Style ?? []]);\n        }\n    }\n    return layers;\n}\n\n\nexport interface IWmsCapabilitiesPanelProps {\n    capabilities: WmsCapabilitiesDocument;\n    locale: string;\n    onAddLayer: (name: string, queryable: boolean, isTiled: boolean, style: WMSLayerStyle | undefined, getLegendUrl?: string) => void;\n}\n\nexport const WmsCapabilitiesPanel = (props: IWmsCapabilitiesPanelProps) => {\n    const { locale, onAddLayer } = props;\n    const { capabilities: caps } = props;\n    const layers = extractWmsLayers(caps);\n    return <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WMS_SERVICE_INFO\", locale)}</a></h5>\n            <p>{tr(\"WMS_VERSION\", locale, { version: caps.version })}</p>\n            <p>{tr(\"OWS_SERVICE_NAME\", locale, { name: caps.Service.Name })}</p>\n            <p>{tr(\"OWS_SERVICE_TITLE\", locale, { title: caps.Service.Title })}</p>\n            <p>{tr(\"OWS_SERVICE_ABSTRACT\", locale, { abstract: caps.Service.Abstract })}</p>\n        </Card>\n        <Card style={{ marginBottom: 10 }}>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WMS_AVAILABLE_LAYERS\", locale)}</a></h5>\n            {layers.map(([layer, styles]) => {\n                const otherActions = <></>;\n                return <Card key={layer.Name} style={{ padding: 15, paddingTop: 5 }}>\n                    <h4><Icon icon=\"layer\" /> {layer.Name}</h4>\n                    <p>{tr(\"OWS_LAYER_TITLE\", locale, { title: layer.Title })}</p>\n                    {/*<p>{tr(\"OWS_LAYER_ABSTRACT\", locale, { abstract: layer.Abstract })}</p>*/}\n                    {(() => {\n                        if (styles.length) {\n                            return styles.map(st => <ButtonGroup key={st.Name} vertical fill alignText=\"left\">\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, false, st, st.LegendURL?.[0]?.OnlineResource)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER_WITH_WMS_STYLE\", locale, { style: st.Name })}</Button>\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, true, st, st.LegendURL?.[0]?.OnlineResource)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER_WITH_WMS_STYLE_TILED\", locale, { style: st.Name })}</Button>\n                                {otherActions}\n                            </ButtonGroup>);\n                        } else {\n                            return <ButtonGroup vertical fill alignText=\"left\">\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, false, undefined)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER\", locale)}</Button>\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, true, undefined)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER_TILED\", locale)}</Button>\n                                {otherActions}\n                            </ButtonGroup>;\n                        }\n                    })()}\n                </Card>\n            })}\n        </Card>\n    </>\n}","import * as React from \"react\";\nimport { LayerProperty, GenericEvent, Bounds } from '../../api/common';\nimport { ControlGroup, InputGroup, Button, Intent, NonIdealState, Spinner } from '@blueprintjs/core';\nimport * as Runtime from \"../../api/runtime\";\nimport { tr } from \"../../api/i18n\";\nimport { Error } from \"../error\";\nimport { Client } from \"../../api/client\";\nimport { WfsCapabilitiesParser, IWfsServiceCapabilities } from \"./wfs-capabilities-parser\";\nimport { WfsCapabilitiesPanel } from './wfs-capabilities-panel';\nimport olVectorSource, { LoadingStrategy } from \"ol/source/Vector\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport { FeatureUrlFunction } from \"ol/featureloader\";\nimport { parseUrl } from '../../utils/url';\nimport { \n    setOLVectorLayerStyle,\n    DEFAULT_POINT_STYLE,\n    DEFAULT_LINE_STYLE,\n    DEFAULT_POLY_STYLE\n} from '../../api/ol-style-helpers';\nimport { ensureProjection } from '../../api/registry/projections';\nimport { IAddLayerContentProps } from './add-layer';\nimport { getLayerInfo } from '../../api/layer-manager';\n\n/**\n * @hidden\n */\nexport const AddWfsLayer = (props: IAddLayerContentProps) => {\n    const { locale } = props;\n    const [wfsUrl, setWfsUrl] = React.useState(\"\");\n    const [loadingCapabilities, setLoadingCapabilities] = React.useState(false);\n    const [caps, setCaps] = React.useState<IWfsServiceCapabilities | undefined>(undefined);\n    const [error, setError] = React.useState<Error | string | undefined>(undefined);\n    const onAddLayer = (name: string, version: string, format: string, origCrs: string, epsgCode: number, wfsWgs84Bounds?: Bounds) => {\n        const viewer = Runtime.getViewer();\n        if (caps && viewer) {\n            ensureProjection(epsgCode, locale, origCrs).then(([, resolvedProj]) => {\n                const sourceProj = viewer.getProjection();\n                //TODO: For correctness, we should be using the URL from the ows:Get element of the\n                //GetFeature operations metadata instead of just re-computing the WFS GetFeature URL\n                //relative to the capabilities URL that was entered\n                const parsed = parseUrl(wfsUrl);\n                let typeNameKey = \"typename\";\n                if (version == \"2.0.0\") { //WFS 2.0.0 want typename(s) over typename\n                    typeNameKey = \"typenames\";\n                }\n                let urlTemplate = `${parsed.url}?service=WFS&version=${version}&request=GetFeature&${typeNameKey}=${encodeURIComponent(name)}&outputFormat=${encodeURIComponent(format)}&srsName=${encodeURIComponent(origCrs)}`;\n                let sourceUrl: string | FeatureUrlFunction;\n                let strategy: LoadingStrategy | undefined;\n                const vectorFmt = new GeoJSON({\n                    dataProjection: resolvedProj,\n                    featureProjection: sourceProj\n                });\n                // FIXME: I can't seem to get bbox strategy working in general :(\n                if (false) {\n                /*if (repsg == 4326 || repsg == 3857) {\n                    urlTemplate += `&bbox={view_extent}`;\n                    sourceUrl = function (extent) {\n                        const xfextent = transformExtent(extent, sourceProj, resolvedProj);\n                        const reqUrl = strReplaceAll(urlTemplate, \"{view_extent}\", xfextent.join(','));\n                        return reqUrl;\n                    }\n                    strategy = bbox;\n                    // We need to \"decorate\" the underlying loadFeaturesXhr loader so that\n                    // we have the means to call busy worker incrementing/decrementing\n                    innerLoader = loadFeaturesXhr(sourceUrl, vectorFmt, () => { //success\n                        viewer.addImageLoaded();\n                        props.onRemoveLayerBusyWorker(name);\n                    }, () => { //failure\n                        viewer.addImageLoaded();\n                        props.onRemoveLayerBusyWorker(name);\n                    });*/\n                } else {\n                    sourceUrl = urlTemplate;\n                }\n                const source = new olVectorSource({\n                    format: vectorFmt,\n                    url: sourceUrl,\n                    strategy: strategy/*,\n                    loader: innerLoader ? (function() {\n                        viewer.addImageLoading();\n                        props.onAddLayerBusyWorker(name);\n                        innerLoader?.apply(source, arguments);\n                    }) : undefined*/\n                });\n                const layer = new olVectorLayer({\n                    source: source,\n                    className: \"external-vector-layer\" //This is to avoid false positives for map.forEachLayerAtPixel\n                });\n                layer.set(LayerProperty.LAYER_TYPE, \"WFS\");\n                layer.set(LayerProperty.IS_EXTERNAL, true);\n                layer.set(LayerProperty.IS_SELECTABLE, true);\n                layer.set(LayerProperty.IS_GROUP, false);\n                if (wfsWgs84Bounds) {\n                    layer.set(LayerProperty.WGS84_BBOX, wfsWgs84Bounds);\n                }\n                setOLVectorLayerStyle(layer, {\n                    point: DEFAULT_POINT_STYLE,\n                    line: DEFAULT_LINE_STYLE,\n                    polygon: DEFAULT_POLY_STYLE\n                });\n                viewer.getLayerManager().addLayer(name, layer);\n                viewer.toastSuccess(\"success\", tr(\"ADDED_LAYER\", locale, { name: name }));\n                props.onLayerAdded(getLayerInfo(layer, true));\n            });\n        }\n    };\n    const onLoadCaps = () => {\n        setCaps(undefined);\n        setLoadingCapabilities(true);\n        const client = new Client(\"\", \"mapagent\");\n        client.getText(wfsUrl).then(s => {\n            const parser = new WfsCapabilitiesParser();\n            const caps = parser.parse(s);\n            setLoadingCapabilities(false);\n            setCaps(caps);\n            setError(undefined);\n        }).catch(err => {\n            setLoadingCapabilities(false);\n            setCaps(undefined);\n            setError(err);\n        });\n    };\n    const onWmsUrlChange = (e: GenericEvent) => {\n        setWfsUrl(e.target.value);\n    };\n    return <div>\n        <ControlGroup fill>\n            <InputGroup leftIcon=\"geosearch\"\n                placeholder={tr(\"ADD_WFS_LAYER_URL\", locale)}\n                value={wfsUrl}\n                onChange={onWmsUrlChange}\n                readOnly={loadingCapabilities}\n                rightElement={<Button intent={Intent.PRIMARY} icon=\"arrow-right\" onClick={onLoadCaps} disabled={loadingCapabilities} />} />\n        </ControlGroup>\n        <br />\n        <div>\n            {(() => {\n                if (loadingCapabilities) {\n                    return <NonIdealState\n                        icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                        title={tr(\"ADD_WFS_LAYER_LOADING\", locale)}\n                        description={tr(\"ADD_WFS_LAYER_LOADING_DESC\", locale)} />;\n                } else {\n                    if (caps) {\n                        return <WfsCapabilitiesPanel onAddLayer={onAddLayer} capabilities={caps} locale={locale} />;\n                    } else if (error) {\n                        return <Error error={error} />;\n                    } else {\n                        return <NonIdealState\n                            icon=\"issue\"\n                            title={tr(\"ADD_WFS_LAYER_NO_LAYERS\", locale)}\n                            description={tr(\"WFS_NO_LAYER_DESCRIPTION\", locale)} />;\n                    }\n                }\n            })()}\n        </div>\n    </div>;\n}","import { Bounds } from '../../api/common';\nimport { strIsNullOrEmpty } from '../../utils/string';\n\n/**\n * The root WFS service capabilities\n * \n * @export\n * @interface IWfsServiceCapabilities\n * @since 0.13\n */\nexport interface IWfsServiceCapabilities {\n    info: IWfsServiceInfo;\n    layers: IWfsLayerInfo[];\n}\n\n/**\n * WFS service metadata\n * \n * @export\n * @interface IWfsServiceInfo\n * @since 0.13\n */\nexport interface IWfsServiceInfo {\n    title: string;\n    abstract: string;\n    version: string;\n    allowedOutputFormats?: string[];\n}\n\n/**\n * Metadata for a published WFS layer\n * \n * @export\n * @interface IWfsLayerInfo\n * @since 0.13\n */\nexport interface IWfsLayerInfo {\n    name: string;\n    title: string;\n    abstract: string;\n    wgs84Bounds?: Bounds;\n    formats?: string[];\n    defaultCrs: string;\n    otherCrs?: string[];\n}\n\nfunction tryGetElementContent(el?: Element): string | undefined {\n    if (el) {\n        return el.textContent ?? (el as any).text;\n    }\n}\n\nfunction getElements(root: Document | Element, tagName: string, ns?: string): Element[] {\n    let els: HTMLCollectionOf<Element> | NodeListOf<Element>;\n    if (ns) {\n        els = root.getElementsByTagName(`${ns}:${tagName}`);\n        if (els.length == 0) {\n            //Try un-qualified\n            els = root.getElementsByTagName(tagName);\n        }\n    } else {\n        els = root.getElementsByTagName(tagName);\n    }\n    const elements = [] as Element[];\n    if (els) {\n        for (let i = 0; i < els.length; i++) {\n            const el = els.item(i);\n            if (el) {\n                elements.push(el);\n            }\n        }\n    }\n    return elements;\n}\n\nfunction trySetProperty<T>(obj: T, setter: (o: T, v: string) => void, value: string | null | undefined) {\n    if (value) {\n        setter(obj, value);\n    }\n}\n\n/**\n * A basic parser for WFS capabilities XML\n *\n * @export\n * @class WfsCapabilitiesParser\n * @since 0.13\n */\nexport class WfsCapabilitiesParser {\n    private xmlDoc: Document;\n    constructor() {}\n    public parse(xml: string): IWfsServiceCapabilities {\n        const parser = new DOMParser();\n        this.xmlDoc = parser.parseFromString(xml, \"text/xml\");\n        const info = this.getServiceInfo();\n        const layers = this.getLayers();\n        return {\n            info,\n            layers\n        };\n    }\n    private getServiceInfo(): IWfsServiceInfo {\n        const els = getElements(this.xmlDoc, \"ServiceIdentification\", \"ows\");\n        const info: IWfsServiceInfo = {\n            title: \"\",\n            abstract: \"\",\n            version: \"\"\n        };\n        if (els.length == 1) {\n            const t = tryGetElementContent(getElements(els[0], \"Title\", \"ows\")?.[0]);\n            const a = tryGetElementContent(getElements(els[0], \"Abstract\", \"ows\")?.[0]);\n            const ops = getElements(this.xmlDoc, \"Operation\", \"ows\");\n            for (const op of ops) {\n                if (op.getAttribute(\"name\") == \"GetFeature\") {\n                    const parms = getElements(op, \"Parameter\", \"ows\");\n                    for (const parm of parms) {\n                        if (parm.getAttribute(\"name\") == \"outputFormat\") {\n                            const allowedValues = getElements(parm, \"Value\", \"ows\")\n                                .map(av => tryGetElementContent(av))\n                                .filter(s => !strIsNullOrEmpty(s)) as string[];\n                            if (allowedValues.length > 0) {\n                                info.allowedOutputFormats = allowedValues;\n                            }\n                        }\n                    }\n                }\n            }\n            const v: string[] = getElements(els[0], \"ServiceTypeVersion\", \"ows\")\n                .map(el => tryGetElementContent(el))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            v.sort();\n            trySetProperty(info, (i, v) => i.title = v, t);\n            trySetProperty(info, (i, v) => i.abstract = v, a);\n            //Pick the last (highest) version\n            if (v.length > 0) {\n                info.version = v[v.length - 1];\n            }\n        }\n        return info;\n    }\n    private getLayers(): IWfsLayerInfo[] {\n        const els = getElements(this.xmlDoc, \"FeatureType\", \"wfs\");\n        const layers = els.map(el => {\n            const info: IWfsLayerInfo = {\n                name: \"\",\n                title: \"\",\n                abstract: \"\",\n                defaultCrs: \"\"\n            };\n            const n = tryGetElementContent(getElements(el, \"Name\", \"wfs\")?.[0]);\n            const t = tryGetElementContent(getElements(el, \"Title\", \"wfs\")?.[0]);\n            const a = tryGetElementContent(getElements(el, \"Abstract\", \"wfs\")?.[0]);\n            const c = tryGetElementContent(\n                getElements(el, \"DefaultCRS\", \"wfs\")?.[0] ?? // WFS 2.0.0\n                getElements(el, \"DefaultSRS\", \"wfs\")?.[0]    // WFS older versions\n            );\n            const oc = getElements(el, \"OtherCRS\", \"wfs\")\n                .map(fel => tryGetElementContent(fel))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            const os = getElements(el, \"OtherSRS\", \"wfs\")\n                .map(fel => tryGetElementContent(fel))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            info.otherCrs = [...oc, ...os];\n            const fmts = getElements(el, \"Format\", \"wfs\")\n                .map(fel => tryGetElementContent(fel))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            const ll = tryGetElementContent(getElements(el, \"LowerCorner\", \"ows\")?.[0]);\n            const ur = tryGetElementContent(getElements(el, \"UpperCorner\", \"ows\")?.[0]);\n            trySetProperty(info, (i, v) => i.name = v, n);\n            trySetProperty(info, (i, v) => i.title = v, t);\n            trySetProperty(info, (i, v) => i.abstract = v, a);\n            trySetProperty(info, (i, v) => i.defaultCrs = v, c);\n            if (fmts.length > 0) {\n                info.formats = fmts;\n            }\n            const llParts = ll?.split(' ').map(s => parseFloat(s));\n            const urParts = ur?.split(' ').map(s => parseFloat(s));\n            if (llParts?.length == 2 && urParts?.length == 2) {\n                info.wgs84Bounds = [\n                    llParts[0],\n                    llParts[1],\n                    urParts[0],\n                    urParts[1]\n                ];\n            }\n            return info;\n        });\n        return layers;\n    }\n}","import * as React from \"react\";\nimport { IMapView, UnitOfMeasure } from \"../api/common\";\nimport { getUnitOfMeasure, getMapSize } from \"../utils/units\";\nimport { fmt } from '../api/i18n';\n\nexport interface IViewSizeProps {\n    /**\n     * Width in pixels\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    width: number;\n    /**\n     * Height in pixels\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    height: number;\n    /**\n     * Meters per unit\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    metersPerUnit: number;\n    /**\n     * Decimal precision to display\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    precision?: number;\n    /**\n     * The map view\n     * \n     * @type {IMapView}\n     * @memberof IViewSizeProps\n     */\n    view: IMapView;\n    /**\n     * The desired unit of measure to display the size in\n     * \n     * @type {UnitOfMeasure}\n     * @memberof IViewSizeProps\n     */\n    units: UnitOfMeasure;\n    /**\n     * @since 0.12.2\n     */\n    locale?: string;\n}\n\nconst ViewSizeContent = ({ gw, gh, unit }: { gw: number, gh: number, unit: string }) => {\n    const str = fmt(\"{gw} x {gh} ({unit})\", { gw, gh, unit });\n    return <span dangerouslySetInnerHTML={{ __html: str }} />;\n}\n\nexport const ViewSize = (props: IViewSizeProps) => {\n    const { width, height, view, metersPerUnit, units, precision, locale } = props;\n    const uom = getUnitOfMeasure(units);\n    const [gw, gh] = getMapSize([width, height], metersPerUnit, units, view.resolution, precision);\n    //TODO: Support format string extension parameter from fusion widget\n    return <div className=\"status-bar-component component-view-size\"><ViewSizeContent gw={gw} gh={gh} unit={uom.abbreviation(locale)} /></div>;\n};","import * as React from \"react\";\nimport { tr } from '../api/i18n';\nimport { getViewer } from '../api/runtime';\nimport CopyToClipboard = require('react-copy-to-clipboard');\nimport { parseUrl, stringifyQuery } from \"../utils/url\";\nimport { TextArea, Checkbox } from '@blueprintjs/core';\nimport { useViewerLocale } from './hooks';\n\n/**\n * \n * @since 0.11\n * @export\n * @interface IShareLinkToViewContainerProps\n */\nexport interface IShareLinkToViewContainerProps {\n\n}\n\nfunction NOOP() {}\n\nconst ShareLinkToViewContainer = () => {\n    const [showSession, setShowSession] = React.useState(false);\n    const locale = useViewerLocale();\n    const onShowSessionChanged = () => setShowSession(!showSession);\n    const onCopied = () => {\n        const v = getViewer();\n        if (v) {\n            v.toastSuccess(\"clipboard\", tr(\"SHARE_LINK_COPIED\", locale));\n        }\n    };\n    const parsed = parseUrl(`${window.location}`);\n    if (!showSession) {\n        delete parsed.query.session;\n    }\n    const shareUrl = `${parsed.url}?${stringifyQuery(parsed.query)}`;\n    return <div>\n        <TextArea fill={true} rows={16} readOnly value={shareUrl} onChange={NOOP} />\n        <br />\n        <div style={{ padding: 15 }}>\n            <Checkbox checked={showSession} label={tr(\"SHARE_LINK_INCLUDE_SESSION\", locale)} onChange={onShowSessionChanged} />\n            <CopyToClipboard text={shareUrl} onCopy={onCopied}>\n                <button className=\"pt-button\">{tr(\"SHARE_LINK_COPY_CLIPBOARD\", locale)}</button>\n            </CopyToClipboard>\n        </div>\n    </div>;\n};\n\nexport default ShareLinkToViewContainer;","import GeoJSON from \"ol/format/GeoJSON\";\nimport { IFormatDriver } from \"./format-driver\";\nimport { IParsedFeatures, ParsedFeatures } from './parsed-features';\nimport { strIsNullOrEmpty } from '../../utils/string';\n\nconst Papa = require(\"papaparse\");\n\ninterface IPapaParsedResults {\n    data: any[];\n    errors: {\n        type: string;\n        code: string;\n        message: string;\n        row: number;\n    }[];\n    meta: {\n        delimiter?: string;\n        linebreak?: string;\n        aborted?: boolean;\n        fields?: string[];\n        truncated?: boolean;\n    }\n}\n\nexport class CsvFormatDriver implements IFormatDriver {\n    private type: string;\n    constructor(private aliases: { xColumn: string, yColumn: string }[]) {\n        this.type = \"CSV\";\n    }\n    public tryParse(size: number, text: string): Promise<IParsedFeatures> {\n        const aliases = this.aliases;\n        const type = this.type;\n        return new Promise((resolve, reject) => {\n            Papa.parse(text, {\n                header: true,\n                complete: function (results: IPapaParsedResults) {\n                    if (!results.data || results.data.length == 0) {\n                        reject(new Error(\"No data parsed. Probably not a CSV file\"));\n                    } else {\n                        if (results.meta.fields) {\n                            let parsed: IParsedFeatures | undefined;\n                            //Run through the alias list and see if we get any matches\n                            for (const alias of aliases) {\n                                if (parsed) {\n                                    break;\n                                }\n                                const xc = results.meta.fields.filter(s => s.toLowerCase() == alias.xColumn.toLowerCase())?.[0];\n                                const yc = results.meta.fields.filter(s => s.toLowerCase() == alias.yColumn.toLowerCase())?.[0];\n                                // We found the columns, but before we accept this set, the columns\n                                // in question must be numeric. Being CSV and all, we'll use the most\n                                // scientific method to determine this: Sample the first row of data /s\n                                if (!strIsNullOrEmpty(xc) && !strIsNullOrEmpty(yc)) {\n                                    const first = results.data[0];\n                                    const firstX = parseFloat(first[xc]);\n                                    const firstY = parseFloat(first[yc]);\n                                    if (first && !isNaN(firstX) && !isNaN(firstY)) {\n                                        const json = {\n                                            type: 'FeatureCollection',\n                                            features: [] as any[]\n                                        };\n                                        for (const d of results.data) {\n                                            const x = parseFloat(d[xc]);\n                                            const y = parseFloat(d[yc]);\n                                            if (!isNaN(x) && !isNaN(y)) {\n                                                const f = {\n                                                    type: 'Feature',\n                                                    geometry: {\n                                                        coordinates: [x, y],\n                                                        type: 'Point'\n                                                    },\n                                                    properties: d\n                                                }\n                                                delete f.properties[xc];\n                                                delete f.properties[yc];\n                                                json.features.push(f);\n                                            }\n                                        }\n                                        const fmt = new GeoJSON();\n                                        const features = fmt.readFeatures(json);\n                                        parsed = new ParsedFeatures(type, size, features);\n                                        break;\n                                    }\n                                }\n                            }\n                            if (parsed) {\n                                resolve(parsed);\n                            } else {\n                                reject(new Error(\"Data successfully parsed as CSV, but coordinate columns could not be found\"));\n                            }\n                        } else {\n                            reject(new Error(\"No fields found in CSV metadata\"));\n                        }\n                    }\n                }\n            });\n        });\n    }\n}\n\nexport const CSV_COLUMN_ALIASES = [\n    { xColumn: \"lon\", yColumn: \"lat\" },\n    { xColumn: \"lng\", yColumn: \"lat\" },\n    { xColumn: \"longitude\", yColumn: \"latitude\" },\n    { xColumn: \"x\", yColumn: \"y\" },\n    { xColumn: \"easting\", yColumn: \"northing\" }\n];","import { ParsedFeatures, IParsedFeatures } from './parsed-features';\nimport TextFeature from 'ol/format/TextFeature';\nimport JSONFeature from 'ol/format/JSONFeature';\nimport XMLFeature from 'ol/format/XMLFeature';\n\n/**\n * Defines a format driver for reading plain text into vector features\n *\n * @export\n * @interface IFormatDriver\n * @since 0.13\n */\nexport interface IFormatDriver {\n    /**\n     * Attempts to read the given text content into vector features. A failure\n     * of this driver to parse the features is expressed by returning an object\n     * where calling hasFeatures() on it returns false.\n     *\n     * @param {number} size\n     * @param {string} text\n     * @returns {Promise<IParsedFeatures>}\n     * @memberof IFormatDriver\n     */\n    tryParse(size: number, text: string): Promise<IParsedFeatures>;\n}\n\n/**\n * A default format driver implementation primarily for interfacing with any\n * existing OpenLayers format driver instances\n *\n * @export\n * @class FormatDriver\n * @implements {IFormatDriver}\n * @since 0.13\n */\nexport class FormatDriver implements IFormatDriver {\n    constructor(private type: string, private format: TextFeature | JSONFeature | XMLFeature, private defaultProjection: string | null = null) { }\n    public async tryParse(size: number, text: string): Promise<IParsedFeatures> {\n        const fs = this.format.readFeatures(text);\n        return new ParsedFeatures(this.type, size, fs, this.defaultProjection);\n    }\n}","var map = {\n\t\"./1.map.stories.tsx\": 1091,\n\t\"./2.common.stories.tsx\": 1126,\n\t\"./3.accordion.stories.tsx\": 1139\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1090;","import * as React from \"react\";\nimport { storiesOf } from \"@storybook/react\";\nimport { withKnobs } from '@storybook/addon-knobs';\nimport { FakeApp } from './fake-app';\nimport { MapDebugContext, MapGuideMockMode } from '../components/map-viewer-context';\nimport LegendContainer from '../containers/legend';\nimport MapViewerContainer from '../containers/map-viewer';\nimport TaskPaneContainer from '../containers/task-pane';\nimport ScaleDisplayContainer from '../containers/scale-display';\nimport SelectedFeatureCountContainer from '../containers/selected-feature-count';\nimport SelectionPanelContainer from '../containers/selection-panel';\nimport NavigatorContainer from '../containers/navigator';\nimport MapMenuContainer from '../containers/map-menu';\nimport BaseLayerSwitcherContainer from '../containers/base-layer-switcher';\nimport CoordinateTrackerContainer from '../containers/coordinate-tracker';\nimport AddManageLayersContainer from '../containers/add-manage-layers';\nimport { Button, ButtonGroup, Card, Elevation, Intent } from '@blueprintjs/core';\nimport { useReducedToolbarAppState, useActiveMapName, useActiveMapState } from '../containers/hooks';\nimport { CommandConditions } from '../api/registry/command';\nimport * as MapActions from '../actions/map';\nimport { useDispatch } from 'react-redux';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { deArrayify } from '../api/builders/deArrayify';\nimport MouseCoordinatesContainer from '../containers/mouse-coordinates';\nimport ViewSizeContainer from '../containers/view-size';\nimport ViewerOptions from '../containers/viewer-options';\n//import MeasureContainer from '../containers/measure';\n\nconst testSelSheboygan: QueryMapFeaturesResponse = deArrayify(require(\"./data/test-selection-response-sheboygan.json\"));\n\ninterface MapDependentContainer {\n    mgMockMode: MapGuideMockMode;\n    includeSelect?: boolean;\n    children: React.ReactNode;\n}\n\nfunction getQueryMapFeaturesResponse(activeMapName: string) {\n    switch (activeMapName) {\n        case \"Sheboygan\":\n            return testSelSheboygan;\n    }\n    return {};\n}\n\nconst MapStoryFrame = (props: MapDependentContainer) => {\n    const SB_WIDTH = 350;\n    const includeTools = !!props.includeSelect;\n    const dispatch = useDispatch();\n    const state = useReducedToolbarAppState();\n    const activeMapName = useActiveMapName();\n    const doTestSelect = () => {\n        if (activeMapName) {\n            const q = MapActions.setSelection(activeMapName, getQueryMapFeaturesResponse(activeMapName));\n            dispatch(q);\n        }\n    }\n    const doClearSelection = () => {\n        if (activeMapName) {\n            const q = MapActions.setSelection(activeMapName, {});\n            dispatch(q);\n        }\n    }\n    return <div style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0 }}>\n        <div style={{ position: \"absolute\", left: 0, top: 0, bottom: 0, width: SB_WIDTH, overflowY: \"auto\" }}>\n            {props.children}\n        </div>\n        <div style={{ position: \"absolute\", left: SB_WIDTH, top: 0, bottom: 0, right: 0 }}>\n            <MapDebugContext.Provider value={{ mock: props.mgMockMode }}>\n                <MapViewerContainer />\n                {props.includeSelect && <ButtonGroup style={{ position: \"absolute\", right: 15, top: 15 }}>\n                    <Button intent={Intent.PRIMARY} onClick={() => doTestSelect()}>Test Select</Button>\n                    <Button intent={Intent.DANGER} onClick={() => doClearSelection()} disabled={!CommandConditions.hasSelection(state)}>Clear Selection</Button>\n                </ButtonGroup>}\n            </MapDebugContext.Provider>\n        </div>\n    </div>;\n}\n\nstoriesOf(\"Map and Map Interaction Components\", module)\n    .addDecorator(withKnobs)\n    .addDecorator(storyFn => <FakeApp>\n        <MapStoryFrame mgMockMode={MapGuideMockMode.DoNotRender}>\n            {storyFn()}\n        </MapStoryFrame>\n    </FakeApp>)\n    .add(\"Map Viewer\", () => <Card>\n        <h5 className=\"bp3-heading\"><a href=\"#\">Map Viewer</a></h5>\n        <p>This story (and all sibling stories) showcases the map viewer component and other components that depend or interact with map viewer state</p>\n        <p>For MapGuide-specific stories, the MapGuide layer has been mocked out with a placeholder that shows the mapagent request that would be made</p>\n        <p>Some components require selections to be made. Some fake select tools are included to trigger such selection actions</p>\n    </Card>)\n    .add(\"Task Pane\", () => <TaskPaneContainer />)\n    .add(\"Mouse Coordinates\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">Mouse Coordinates</a></h5>\n            <p>Move the mouse around the map and its geographic coordinates should be shown below</p>\n        </Card>\n        <MouseCoordinatesContainer />\n    </>)\n    .add(\"View Size\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">View Size</a></h5>\n            <p>Zoom in or out of the map. The physical map size should be shown below</p>\n        </Card>\n        <ViewSizeContainer />\n    </>)\n    .add(\"Scale Display\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">Scale Display</a></h5>\n            <p>Zoom in or out of the map. The map scale should be shown below</p>\n        </Card>\n        <ScaleDisplayContainer />\n    </>)\n    .add(\"Navigator\", () => <NavigatorContainer />)\n    .add(\"Map Menu\", () => <MapMenuContainer />)\n    .add(\"Base Layer Switcher\", () => <BaseLayerSwitcherContainer />)\n    .add(\"Viewer Options\", () => <ViewerOptions />)\n    //.add(\"Measure\", () => <MeasureContainer />)\n    .add(\"Coordinate Tracker\", () => <CoordinateTrackerContainer projections={[\"EPSG:4326\", \"EPSG:3857\"]} />)\n    .add(\"External Layer Manager\", () => <AddManageLayersContainer />);\n\nstoriesOf(\"Map and Map Interaction Components / MapGuide-specific\", module)\n    .addDecorator(withKnobs)\n    .addDecorator(storyFn => <FakeApp>\n        <MapStoryFrame mgMockMode={MapGuideMockMode.RenderPlaceholder} includeSelect={true}>\n            {storyFn()}\n        </MapStoryFrame>\n    </FakeApp>)\n    .add(\"Legend\", () => <LegendContainer />)\n    .add(\"Legend - with base layer switcher\", () => <LegendContainer inlineBaseLayerSwitcher={true} />)\n    .add(\"Selected Feature Count\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">Selected Feature Count</a></h5>\n            <p>Click the test select button to simulate a map selection request. The selection count should display below</p>\n        </Card>\n        <SelectedFeatureCountContainer />\n    </>)\n    .add(\"Selection Panel\", () => <SelectionPanelContainer />)","import * as React from \"react\";\nimport configureStore from '../store/configure-store';\nimport App, { IAppProps } from \"../containers/app\";\nimport { Provider } from 'react-redux';\nimport { CONFIG_INITIAL_STATE } from '../reducers/config';\nimport { registerRequestBuilder } from '../api/builders/factory';\nimport { RequestBuilder, ICreateRuntimeMapOptions, IQueryMapFeaturesOptions, IDescribeRuntimeMapOptions, QueryFeaturesSet } from '../api/request-builder';\nimport { ResourceBase } from '../api/contracts/common';\nimport { RuntimeMap } from '../api/contracts/runtime-map';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { ApplicationDefinition } from '../api/contracts/fusion';\nimport { deArrayify } from '../api/builders/deArrayify';\nimport { registerLayout } from '../api/registry/layout';\nimport { IConfigurationReducerState, IViewerReducerState } from '../api/common';\nconst testMapSheboygan: RuntimeMap = deArrayify(require(\"./data/test-runtime-map-sheboygan.json\"));\nconst testMapRedding: RuntimeMap = deArrayify(require(\"./data/test-runtime-map-redding.json\"));\nconst testMapMelbourne: RuntimeMap = deArrayify(require(\"./data/test-runtime-map-melbourne.json\"));\nconst testAppDef: ApplicationDefinition = deArrayify(require(\"./data/test-app-def.json\"));\n\nclass FakeMapAgent extends RequestBuilder {\n    constructor(private uri: string, private locale?: string) {\n        super(uri);\n    }\n    public createSession(username: string, password: string): Promise<string> {\n        return Promise.resolve(testMapSheboygan.SessionId);\n    }\n    public getServerSessionTimeout(session: string): Promise<number> {\n        return Promise.resolve(10000);\n    }\n    public getResource<T extends ResourceBase>(resourceId: string, args?: any): Promise<T> {\n        if (resourceId.endsWith(\".ApplicationDefinition\")) {\n            return Promise.resolve<any>(testAppDef);\n        }\n        throw new Error(`Method not implemented - getResource(${resourceId}).`);\n    }\n    public createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RuntimeMap> {\n        switch (options.mapDefinition) {\n            case \"Library://Samples/Sheboygan/Maps/Sheboygan.MapDefinition\":\n                return Promise.resolve(testMapSheboygan);\n            case \"Library://Redding/Maps/Redding.MapDefinition\":\n                return Promise.resolve(testMapRedding);\n            case \"Library://Samples/Melbourne/Maps/Melbourne.MapDefinition\":\n                return Promise.resolve(testMapMelbourne);\n        }\n        return Promise.reject(`Unknown test map: ${options.mapDefinition}`);\n    }\n    public queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        return Promise.resolve({});\n    }\n    public queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        return Promise.resolve({});\n    }\n    public describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RuntimeMap> {\n        switch (options.mapname) {\n            case \"Sheboygan\":\n                return Promise.resolve(testMapSheboygan);\n            case \"Redding\":\n                return Promise.resolve(testMapRedding);\n            case \"Melbourne\":\n                return Promise.resolve(testMapMelbourne);\n        }\n        return Promise.reject(`Unknown test map state: ${options.mapname}`);\n    }\n    public getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string {\n        throw new Error(\"Method not implemented - getTileTemplateUrl.\");\n    }\n}\n\nexport interface IFakeAppProps {\n    templateLayout?: () => React.ReactNode;\n    children?: React.ReactNode;\n}\n\n/**\n * This component sets up a mocked application environment from which any redux container component\n * can be housed within\n */\nexport class FakeApp extends React.Component<IFakeAppProps> {\n    private _store: any;\n    private _agentConf: any;\n    constructor(props: IFakeAppProps) {\n        super(props);\n        registerRequestBuilder(\"mapagent\", (uri, locale) => new FakeMapAgent(uri, locale));\n        registerLayout(\"fake-app\", () => <>{props.children}</>);\n        this._agentConf = {\n            agentUri: \"https://my-mapguide-server/mapguide/mapagent/mapagent.fcgi\",\n            agentKind: \"mapagent\"\n        };\n        const initState = {\n            ...{\n                config: {\n                    ...CONFIG_INITIAL_STATE,\n                    ...this._agentConf,\n                } as IConfigurationReducerState,\n                mapState: {\n                    Sheboygan: {\n                        currentView: {\n                            scale: 51439.16420267266,\n                            x: -87.73025425093128,\n                            y: 43.744459064634064\n                        }\n                    }\n                },\n                viewer: {\n                    featureTooltipsEnabled: false\n                } as IViewerReducerState\n            }\n        };\n        this._store = configureStore(initState);\n    }\n    render() {\n        return <Provider store={this._store}>\n            <App fusionRoot=\".\"\n                initialElementVisibility={{\n                    //Doesn't matter for the fake app, but this has to be true for the purpose of not breaking the reducer when no physical components are present\n                    taskpane: true,\n                    legend: true,\n                    selection: true\n                }}\n                agent={this._agentConf}\n                layout={this.props.templateLayout ?? \"fake-app\"}\n                resourceId=\"Library://Test/Viewer.ApplicationDefinition\"\n                {...this.props} />\n        </Provider>;\n    }\n}","import { createStore, applyMiddleware, compose, combineReducers } from 'redux';\nimport thunk from 'redux-thunk';\nimport promiseMiddleware from './promise-middleware';\nimport logger from './logger';\nimport rootReducer from '../reducers/root';\n\nfunction configureStore(initialState: any, extraReducers?: any) {\n    const root = extraReducers ? combineReducers({ ...rootReducer, ...extraReducers }) : combineReducers(rootReducer);\n    const store = (<any>compose)( //HACK: Something bogus about the compose() declaration\n        _getMiddleware(),\n        ..._getEnhancers()\n    )(createStore)(root, initialState);\n\n    _enableHotLoader(store);\n    return store;\n}\n\nfunction _getMiddleware() {\n    let middleware = [\n        promiseMiddleware,\n        thunk,\n    ];\n\n    if (__DEV__) {\n        middleware = [...middleware, logger];\n    }\n\n    return applyMiddleware(...middleware);\n}\n\nfunction _getEnhancers() {\n    let enhancers = [] as any[];\n    if (__DEV__ && window.__REDUX_DEVTOOLS_EXTENSION__) {\n        enhancers = [...enhancers, window.__REDUX_DEVTOOLS_EXTENSION__()];\n    }\n    return enhancers;\n}\n\nfunction _enableHotLoader(store: any) {\n    if (__DEV__ && module.hot) {\n        module.hot.accept('../reducers', () => {\n            const nextRootReducer = require('../reducers');\n            store.replaceReducer(nextRootReducer);\n        });\n    }\n}\n\n\nexport default configureStore;\n","/**\n * Returns whether the provided value is a promise\n *\n * @hidden\n * @param {object} value Potential promise\n * @return {Boolean}\n */\nfunction isPromise(value: any) {\n    if (value !== null && typeof value === 'object') {\n        return value.promise && typeof value.promise.then === 'function';\n    }\n}\n\n/**\n * @hidden\n */\nexport default function promiseMiddleware({ dispatch }: { dispatch: any }) {\n    return (next: any) => (action: any) => {\n        if (!isPromise(action.payload)) {\n            return next(action);\n        }\n\n        const { types, payload, meta } = action;\n        const { promise, data } = payload;\n        const [PENDING, FULFILLED, REJECTED] = types;\n\n        const p1 = { type: PENDING };\n        const p2 = data ? { payload: data } : {};\n        const p3 = meta ? { meta } : {};\n\n        /**\n         * Dispatch the pending action\n         */\n        dispatch({ ...p1, ...p2, ...p3 });\n\n        /**\n         * If successful, dispatch the fulfilled action, otherwise dispatch\n         * rejected action.\n         */\n        return promise.then(\n            (result: any) => {\n                dispatch({\n                    type: FULFILLED,\n                    payload: result,\n                    meta,\n                });\n            },\n            (error: any) => {\n                dispatch({\n                    type: REJECTED,\n                    payload: error,\n                    meta,\n                });\n            }\n        );\n    };\n}\n","import { ActionType } from '../constants/actions';\nconst createLogger = require(\"redux-logger\").createLogger;\n\nconst logger = createLogger({\n    collapsed: true,\n    stateTransformer: (state: any) => {\n        return state;\n    },\n    //Note the { type } syntax: https://github.com/Microsoft/TypeScript/issues/9657\n    predicate: (getState: any, { type }: { type: string }) => {\n        return type !== 'redux-form/BLUR' &&\n            type !== 'redux-form/CHANGE' &&\n            type !== 'redux-form/FOCUS' &&\n            type !== 'redux-form/TOUCH' &&\n            type !== ActionType.MAP_RESIZED &&\n            type !== ActionType.UPDATE_MOUSE_COORDINATES &&\n            type !== ActionType.MAP_SET_BUSY_COUNT &&\n            type !== ActionType.ADD_LAYER_BUSY_WORKER &&\n            type !== ActionType.REMOVE_LAYER_BUSY_WORKER;\n    },\n});\n\n\nexport default logger;\n","import { configReducer} from \"./config\";\nimport { toolbarReducer } from \"./toolbar\";\nimport { taskPaneReducer } from \"./taskpane\";\nimport { lastAction } from \"./last-action\";\nimport { modalReducer } from \"./modal\";\nimport { initErrorReducer } from \"./init-error\";\nimport { mapStateReducer } from \"./map-state\";\nimport { viewerReducer } from \"./viewer\";\nimport { mouseReducer } from \"./mouse\";\nimport { templateReducer } from \"./template\";\n\nconst rootReducer: any = {\n    initError: initErrorReducer,\n    config: configReducer,\n    template: templateReducer,\n    mapState: mapStateReducer,\n    viewer: viewerReducer,\n    toolbar: toolbarReducer,\n    taskpane: taskPaneReducer,\n    modal: modalReducer,\n    mouse: mouseReducer,\n    lastaction: lastAction\n};\n\nexport default rootReducer;\n","import { IToolbarReducerState, IDOMElementMetrics } from \"../api/common\";\nimport update = require(\"react-addons-update\");\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\nimport { isElementState } from './template';\nimport { WEBLAYOUT_TASKMENU, WEBLAYOUT_CONTEXTMENU } from '../constants';\n\nfunction mergeFlyoutState(flyoutId: string, state: any, flyoutPayload: any, flyoutUpdateAction: \"$set\" | \"$merge\", closeOtherFlyouts: boolean = false) {\n    const updateSpec: any = {\n        flyouts: {}\n    };\n    const flyoutUpdateSpec: any = {};\n    flyoutUpdateSpec[flyoutUpdateAction] = flyoutPayload;\n    updateSpec.flyouts[flyoutId] = flyoutUpdateSpec;\n    if (closeOtherFlyouts) {\n        //Close others\n        for (const key in state.flyouts) {\n            if (key != flyoutId) {\n                updateSpec.flyouts[key] = {\n                    \"$merge\": {\n                        open: false\n                    }\n                };\n            }\n        }\n    }\n    const newState = update(state, updateSpec);\n    return newState;\n}\n\nfunction mergeFlyoutCloseState(flyoutId: string, state: any) {\n    return mergeFlyoutState(flyoutId, state, {\n        open: false,\n        metrics: null\n    }, \"$merge\");\n}\n\nexport const TOOLBAR_INITIAL_STATE: IToolbarReducerState = {\n    toolbars: {},\n    flyouts: {}\n};\n\nexport function toolbarReducer(state = TOOLBAR_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.INIT_APP:\n            {\n                return { ...state, ...action.payload.toolbars };\n            }\n        case ActionType.COMPONENT_OPEN:\n            {\n                const payload = action.payload;\n                let flyoutId = payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutState(flyoutId, state,\n                        {\n                            open: true,\n                            metrics: payload.metrics,\n                            componentName: payload.name,\n                            componentProps: payload.props\n                        },\n                        \"$set\", //Need to use $set instead of $merge as the tree won't have component flyout info initially\n                        true);\n                }\n                return state;\n            }\n        case ActionType.COMPONENT_CLOSE:\n            {\n                let flyoutId = action.payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutState(flyoutId, state, {\n                        open: false,\n                        metrics: null,\n                        componentName: null,\n                        componentProps: null\n                    }, \"$set\"); //Need to use $set instead of $merge as the tree won't have component flyout info initially\n                }\n                return state;\n            }\n        case ActionType.CONTEXT_MENU_OPEN:\n            {\n                return mergeFlyoutState(WEBLAYOUT_CONTEXTMENU, state, {\n                    open: true,\n                    metrics: {\n                        posX: action.payload.x,\n                        posY: action.payload.y\n                    } as IDOMElementMetrics\n                }, \"$merge\", true);\n            }\n        case ActionType.FLYOUT_OPEN:\n            {\n                let flyoutId = action.payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutState(flyoutId, state, {\n                        open: true,\n                        metrics: action.payload.metrics\n                    }, \"$merge\", true);\n                }\n                return state;\n            }\n        case ActionType.FUSION_SET_ELEMENT_STATE:\n            {\n                if (isElementState(action.payload) && !action.payload.taskPaneVisible) {\n                    return mergeFlyoutCloseState(WEBLAYOUT_TASKMENU, state);\n                }\n                return state;\n            }\n        case ActionType.FUSION_SET_TASK_PANE_VISIBILITY:\n            {\n                if (!action.payload) {\n                    return mergeFlyoutCloseState(WEBLAYOUT_TASKMENU, state);\n                }\n                return state;\n            }\n        case ActionType.FLYOUT_CLOSE:\n            {\n                let flyoutId = action.payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutCloseState(flyoutId, state);\n                }\n            }\n        case ActionType.CONTEXT_MENU_CLOSE:\n            {\n                return mergeFlyoutCloseState(WEBLAYOUT_CONTEXTMENU, state);\n            }\n    }\n    return state;\n}","import { ITaskPaneReducerState } from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const TASK_PANE_INITIAL_STATE: ITaskPaneReducerState = {\n    navIndex: -1,\n    navigation: [],\n    initialUrl: undefined,\n    //Having this state sounds extremely hacky, but we need a way to signal to the \"dumb\" task pane that\n    //the url its about to receive was pushed and should not be reloaded into the internal iframe\n    lastUrlPushed: false\n};\n\nfunction mergeNavigatedUrl(state: any, url: string): any {\n    let index = state.navIndex;\n    const nav: string[] = state.navigation;\n    index++;\n    nav[index] = url;\n    //If we slotted at a position that is not the end of the array\n    //remove everything after it\n    if (nav.length > index + 1) {\n        nav.splice(index + 1);\n    }\n    const newState = {\n        navIndex: index,\n        navigation: nav,\n        lastUrlPushed: false\n    };\n    return { ...state, ...newState };\n}\n\nexport function taskPaneReducer(state = TASK_PANE_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.INIT_APP:\n            {\n                const { payload } = action;\n                const newState = {\n                    initialUrl: payload.initialUrl,\n                    navIndex: 0,\n                    navigation: [ payload.initialUrl ]\n                };\n                return { ...state, ...newState };\n            }\n        case ActionType.TASK_PANE_HOME:\n            {\n                if (state.initialUrl != null) {\n                    return mergeNavigatedUrl(state, state.initialUrl);\n                }\n                return state;\n            }\n        case ActionType.TASK_PANE_BACK:\n            {\n                let index = state.navIndex;\n                const nav = state.navigation;\n                index--;\n                const newState = {\n                    navIndex: index,\n                    navigation: nav,\n                    lastUrlPushed: false\n                };\n                return { ...state, ...newState };\n            }\n        case ActionType.TASK_PANE_FORWARD:\n            {\n                let index = state.navIndex;\n                const nav = state.navigation;\n                index++;\n                const newState = {\n                    navIndex: index,\n                    navigation: nav,\n                    lastUrlPushed: false\n                };\n                return { ...state, ...newState };\n            }\n        case ActionType.TASK_PANE_PUSH_URL:\n            {\n                const { payload } = action;\n                const index = state.navIndex;\n                const nav: string[] = state.navigation;\n                //if (areUrlsSame(nav[index], action.payload.url)) {\n                //    return state;\n                //}\n                nav[index + 1] = payload.url\n                //If we slotted at a position that is not the end of the array\n                //remove everything after it\n                if (nav.length > index + 2) {\n                    nav.splice(index + 2);\n                }\n                if (payload.silent === true) {\n                    const newState = {\n                        navigation: nav\n                    };\n                    return { ...state, ...newState };\n                } else {\n                    const newState = {\n                        navIndex: index + 1,\n                        navigation: nav,\n                        lastUrlPushed: true\n                    };\n                    return { ...state, ...newState };\n                }\n            }\n        case ActionType.TASK_INVOKE_URL:\n            {\n                return mergeNavigatedUrl(state, action.payload.url);\n            }\n    }\n    return state;\n}","// A reducer to remember the last dispatched action. This is primarily used by layout\n// templates to listen on certain actions and be able to update their\n//\n// As suggested by the creator of redux:\n// https://github.com/reactjs/redux/issues/580\nimport { isAction } from \"../utils/type-guards\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const NULL_ACTION = {};\n\nexport function lastAction(state = null, action: ViewerAction) {\n    if (isAction(action)) {\n        switch (action.type) {\n            case ActionType.MAP_SET_BUSY_COUNT:\n            case ActionType.TASK_INVOKE_URL:\n            case ActionType.MAP_SET_SELECTION:\n            case ActionType.MAP_SET_MAPTIP:\n            case ActionType.MAP_SET_ACTIVE_TOOL:\n                return action;\n        }\n    }\n    //As we're returning a const reference subsequent dispatched actions that\n    //are not the ones listed above should give us the same branch in the eyes\n    //of redux\n    return NULL_ACTION;\n}","import { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const MODAL_INITIAL_STATE = { };\n\nexport function modalReducer(state = MODAL_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.MODAL_SHOW_COMPONENT:\n            {\n                const newData: any = {};\n                newData[action.payload.name] = {\n                    modal: action.payload.modal,\n                    component: action.payload.component,\n                    componentProps: action.payload.componentProps\n                };\n                return { ...state, ...newData };\n            }\n        case ActionType.MODAL_SHOW_URL:\n            {\n                const newData: any = {};\n                newData[action.payload.name] = { ...action.payload };\n                return { ...state, ...newData };\n            }\n        case ActionType.MODAL_CLOSE:\n            {\n                let newState: any = { ...state };\n                delete newState[action.payload];\n                return newState;\n            }\n    }\n    return state;\n}","import { IInitErrorReducerState } from \"../api/common\";\nimport { makeUnique } from \"../utils/array\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const INIT_ERROR_INITIAL_STATE: IInitErrorReducerState = {\n    options: {},\n    error: undefined,\n    includeStack: true,\n    warnings: []\n};\n\nexport function initErrorReducer(state = INIT_ERROR_INITIAL_STATE, action: ViewerAction): IInitErrorReducerState {\n    switch (action.type) {\n        case ActionType.INIT_ACKNOWLEDGE_WARNINGS:\n            {\n                return { ...state, ...{ warnings: [] } };\n            }\n        case ActionType.INIT_APP:\n            {\n                return { ...state, ...{ warnings: makeUnique(action.payload.warnings) } }\n            }\n        case ActionType.INIT_ERROR:\n            {\n                const { payload } = action;\n                const error = payload.error;\n                const options = payload.options;\n                let includeStack: boolean | undefined = payload.includeStack;\n                if (typeof(includeStack) == 'undefined') {\n                    includeStack = true;\n                }\n                return { error: error, options: options, includeStack: includeStack, warnings: [] };\n            }\n    }\n    return state;\n}","import {\n    IBranchedMapState,\n    IBranchedMapSubState,\n    IExternalBaseLayer,\n    ILayerInfo\n} from \"../api/common\";\nimport { RuntimeMap } from \"../api/contracts/runtime-map\";\nimport { isMapView } from \"../utils/type-guards\";\nimport * as logger from \"../utils/logger\";\nimport { makeUnique } from \"../utils/array\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const MAP_STATE_INITIAL_STATE: IBranchedMapState = {\n\n};\n\nexport const MAP_STATE_INITIAL_SUB_STATE: IBranchedMapSubState = {\n    currentView: undefined,\n    initialView: undefined,\n    history: [],\n    historyIndex: -1,\n    selectionSet: undefined,\n    layerIndex: -1,\n    featureIndex: -1,\n    layerTransparency: {},\n    selectableLayers: {},\n    expandedGroups: {},\n    runtimeMap: undefined,\n    showLayers: [],\n    showGroups: [],\n    hideLayers: [],\n    hideGroups: [],\n    externalBaseLayers: [],\n    activeSelectedFeature: undefined,\n    layers: []\n};\n\nfunction setLayerAction<K extends keyof ILayerInfo>(state: IBranchedMapState, mapName: string, layerName: string, selector: (current: ILayerInfo) => Pick<ILayerInfo, K>): IBranchedMapState {\n    const subState = state[mapName];\n    if (subState) {\n        const layers = subState.layers.map(l => {\n            if (l.name == layerName) {\n                return {\n                    ...l,\n                    ...(selector(l))\n                } as ILayerInfo;\n            } else {\n                return l;\n            }\n        });\n        const state1: Partial<IBranchedMapSubState> = {\n            layers\n        };\n        return mergeSubState(state, mapName, { ...subState, ...state1 });\n    }\n    return state;\n}\n\nfunction mergeSubState(state: IBranchedMapState, mapName: string, subState: Partial<IBranchedMapSubState>): IBranchedMapState {\n    const state1: Partial<IBranchedMapState> = {};\n    state1[mapName] = { ...state[mapName], ...subState };\n    return { ...state, ...state1 } as IBranchedMapState;\n}\n\nexport function mapStateReducer(state = MAP_STATE_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.MAP_REFRESH:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const state1 = {\n                        runtimeMap: payload.map\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.INIT_APP:\n            {\n                const { payload } = action;\n                const maps = payload.maps;\n                const mapKeys = Object.keys(maps);\n                const newState: Partial<IBranchedMapState> = {};\n                let mapNameToApplyInitialState = payload.activeMapName;\n                if (!mapNameToApplyInitialState && mapKeys.length == 1) {\n                    mapNameToApplyInitialState = mapKeys[0];\n                }\n                for (const mapName of mapKeys) {\n                    let cv: Partial<IBranchedMapSubState> | undefined;\n                    if (payload.initialView && mapName == mapNameToApplyInitialState) {\n                        cv = {\n                            currentView: { ...payload.initialView }\n                        };\n                    }\n                    let isel: Partial<IBranchedMapSubState> | undefined;\n                    if (payload.initialSelections && payload.initialSelections[mapName]) {\n                        isel = {\n                            selectionSet: payload.initialSelections[mapName]\n                        };\n                        logger.debug(`Restoring client-side selection set for: ${mapName}`);\n                    }\n\n                    const sl = [];\n                    const sg = [];\n                    const hl = [];\n                    const hg = [];\n\n                    if (mapName == mapNameToApplyInitialState) {\n                        const rtm: RuntimeMap = maps[mapName].map;\n                        const isl = payload.initialShowLayers || [];\n                        const isg = payload.initialShowGroups || [];\n                        const ihl = payload.initialHideLayers || [];\n                        const ihg = payload.initialHideGroups || [];\n\n                        //Only initally show what is initially hidden and vice versa\n                        //NOTE: A map could have duplicate group/layer names, we make no attempt\n                        //to pick out the \"correct\" one. It's first come first serve.\n                        if (rtm.Layer) {\n                            for (const l of rtm.Layer) {\n                                if (isl.indexOf(l.Name) >= 0 && !l.Visible) {\n                                    sl.push(l.ObjectId);\n                                } else if (ihl.indexOf(l.Name) >= 0 && l.Visible) {\n                                    hl.push(l.ObjectId);\n                                }\n                            }\n                        }\n                        if (rtm.Group) {\n                            for (const g of rtm.Group) {\n                                if (isg.indexOf(g.Name) >= 0 && !g.Visible) {\n                                    sg.push(g.ObjectId);\n                                } else if (ihg.indexOf(g.Name) >= 0 && g.Visible) {\n                                    hg.push(g.ObjectId);\n                                }\n                            }\n                        }\n                        logger.debug(`Initially showing layers: ${isl.join(\"|\")}`);\n                        logger.debug(`Initially showing groups: ${isg.join(\"|\")}`);\n                        logger.debug(`Initially hiding layers: ${ihl.join(\"|\")}`);\n                        logger.debug(`Initially hiding groups: ${ihg.join(\"|\")}`);\n\n                        logger.debug(`Initially showing layer ids: ${sl.join(\"|\")}`);\n                        logger.debug(`Initially showing group ids: ${sg.join(\"|\")}`);\n                        logger.debug(`Initially hiding layer ids: ${hl.join(\"|\")}`);\n                        logger.debug(`Initially hiding group ids: ${hg.join(\"|\")}`);\n                    }\n                    const newMapState = {\n                        ...MAP_STATE_INITIAL_SUB_STATE,\n                        ...{ runtimeMap: maps[mapName].map },\n                        ...{ externalBaseLayers: maps[mapName].externalBaseLayers },\n                        ...{ initialView: maps[mapName].initialView },\n                        ...(cv || {}),\n                        ...(isel || {}),\n                        ...(sl.length > 0 ? { showLayers: [...sl] } : {}),\n                        ...(sg.length > 0 ? { showGroups: [...sg] } : {}),\n                        ...(hl.length > 0 ? { hideLayers: [...hl] } : {}),\n                        ...(hg.length > 0 ? { hideGroups: [...hg] } : {})\n                    };\n\n                    // As INIT_APP does not establish a currentView, if a currentView was\n                    // somehow established as part of the initial app state, we will keep\n                    // it instead of it being discarded\n                    if (state?.[mapName]?.currentView) {\n                        newMapState.currentView = state[mapName].currentView;\n                    }\n\n                    newState[mapName] = newMapState;\n                }\n\n                return { ...state, ...newState };\n            }\n        case ActionType.MAP_PREVIOUS_VIEW:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const index = subState.historyIndex - 1;\n                    const state1: Partial<IBranchedMapSubState> = {\n                        historyIndex: index,\n                        currentView: subState.history[index]\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.MAP_NEXT_VIEW:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const index = subState.historyIndex + 1;\n                    const state1: Partial<IBranchedMapSubState> = {\n                        historyIndex: index,\n                        currentView: subState.history[index]\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_SCALE:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    let view = subState.currentView;\n                    const scale = payload.scale;\n                    if (typeof view === 'object' && typeof scale === 'number') {\n                        const view1 = { scale: scale, resolution: payload.resolution };\n                        view = { ...view, ...view1 };\n                    }\n                    const state1: Partial<IBranchedMapSubState> = {\n                        currentView: view\n                    };\n                    const newSubState: Partial<IBranchedMapSubState> = { ...state1, ...{ historyIndex: subState.historyIndex } };\n                    newSubState.history = [...subState.history];\n                    if (view && newSubState.history && newSubState.historyIndex != null) {\n                        newSubState.historyIndex++;\n                        newSubState.history[newSubState.historyIndex] = view;\n                        //If we slotted at a position that is not the end of the array\n                        //remove everything after it\n                        if (newSubState.history.length > newSubState.historyIndex + 1) {\n                            newSubState.history.splice(newSubState.historyIndex + 1);\n                        }\n                    }\n                    return mergeSubState(state, payload.mapName, newSubState);\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_VIEW:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const data = payload.view;\n                    if (isMapView(data)) {\n                        const state1: Partial<IBranchedMapSubState> = {\n                            currentView: data\n                        };\n                        const newSubState: Partial<IBranchedMapSubState> = { ...state1, ...{ historyIndex: subState.historyIndex } };\n                        newSubState.history = [...subState.history];\n                        if (newSubState.history && newSubState.historyIndex != null) {\n                            newSubState.historyIndex++;\n                            newSubState.history[newSubState.historyIndex] = data;\n                            //If we slotted at a position that is not the end of the array\n                            //remove everything after it\n                            if (newSubState.history.length > newSubState.historyIndex + 1) {\n                                newSubState.history.splice(newSubState.historyIndex + 1);\n                            }\n                        }\n                        return mergeSubState(state, payload.mapName, newSubState);\n                    }\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_LAYER_TRANSPARENCY:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const trans = { ...subState.layerTransparency };\n                    trans[payload.layerName] = payload.opacity;\n                    const state1: Partial<IBranchedMapSubState> = {\n                        layerTransparency: trans\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.LEGEND_SET_LAYER_SELECTABLE:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers = { ...subState.selectableLayers };\n                    layers[payload.id] = payload.value;\n                    const state1: Partial<IBranchedMapSubState> = {\n                        selectableLayers: layers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.LEGEND_SET_GROUP_EXPANDABLE:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const groups = { ...subState.expandedGroups };\n                    groups[payload.id] = payload.value;\n                    const state1: Partial<IBranchedMapSubState> = {\n                        expandedGroups: groups\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.LEGEND_SET_GROUP_VISIBILITY:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    let showGroups: string[] = [...subState.showGroups];\n                    let hideGroups: string[] = [...subState.hideGroups];\n                    if (payload.value === true) { //Show it\n                        showGroups.push(payload.id);\n                        showGroups = makeUnique(showGroups);\n                        hideGroups = hideGroups.filter(g => g != payload.id);\n                    } else { //Hide it\n                        hideGroups.push(payload.id);\n                        hideGroups = makeUnique(hideGroups);\n                        showGroups = showGroups.filter(g => g != payload.id);\n                    }\n                    const state1: Partial<IBranchedMapSubState> = {\n                        showLayers: subState.showLayers,\n                        showGroups: showGroups,\n                        hideLayers: subState.hideLayers,\n                        hideGroups: hideGroups\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.LEGEND_SET_LAYER_VISIBILITY:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    let showLayers: string[] = [...subState.showLayers];\n                    let hideLayers: string[] = [...subState.hideLayers];\n                    if (payload.value === true) { //Show it\n                        showLayers.push(payload.id);\n                        showLayers = makeUnique(showLayers);\n                        hideLayers = hideLayers.filter(g => g != payload.id);\n                    } else { //Hide it\n                        hideLayers.push(payload.id);\n                        hideLayers = makeUnique(hideLayers);\n                        showLayers = showLayers.filter(g => g != payload.id);\n                    }\n                    const state1 = {\n                        showLayers: showLayers,\n                        showGroups: subState.showGroups,\n                        hideLayers: hideLayers,\n                        hideGroups: subState.hideGroups\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_SELECTION:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const state1: Partial<IBranchedMapSubState> = {\n                        selectionSet: payload.selection,\n                        layerIndex: -1,\n                        featureIndex: -1,\n                        activeSelectedFeature: undefined\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.MAP_SHOW_SELECTED_FEATURE:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const state1: Partial<IBranchedMapSubState> = {\n                        activeSelectedFeature: {\n                            layerId: payload.layerId,\n                            selectionKey: payload.selectionKey\n                        }\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_BASE_LAYER:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers: IExternalBaseLayer[] = (subState.externalBaseLayers || []);\n                    const baseLayers = layers.map(layer => {\n                        layer.visible = false;\n                        if (layer.name == payload.layerName) {\n                            layer.visible = true;\n                        }\n                        return layer;\n                    });\n                    const state1: Partial<IBranchedMapSubState> = {\n                        externalBaseLayers: baseLayers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.LAYER_ADDED:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers = [payload.layer, ...subState.layers];\n                    const state1: Partial<IBranchedMapSubState> = {\n                        layers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.REMOVE_LAYER:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers = subState.layers.filter(l => l.name != action.payload.layerName);\n                    const state1: Partial<IBranchedMapSubState> = {\n                        layers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.SET_LAYER_VISIBILITY:\n            {\n                const { mapName, layerName, visible } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, () => ({ visible: visible }));\n                return state1;\n            }\n        case ActionType.SET_LAYER_OPACITY:\n            {\n                const { mapName, layerName, opacity } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, () => ({ opacity: opacity }));\n                return state1;\n            }\n        case ActionType.SET_LAYER_INDEX:\n            {\n                const { mapName, index, layerName } = action.payload;\n                const subState = state[mapName];\n                if (subState) {\n                    const layers = [...subState.layers];\n                    let currentIdx = -1;\n                    for (let i = 0; i < layers.length; i++) {\n                        if (layers[i].name == layerName) {\n                            currentIdx = i;\n                            break;\n                        }\n                    }\n                    if (currentIdx >= 0 && currentIdx != index && index < layers.length && index >= 0) {\n                        const theLayer = layers[currentIdx];\n                        layers.splice(currentIdx, 1);\n                        layers.splice(index, 0, theLayer);\n                        const state1: Partial<IBranchedMapSubState> = {\n                            layers\n                        };\n                        return mergeSubState(state, mapName, { ...subState, ...state1 });\n                    }\n                }\n                return state;\n            }\n        case ActionType.SET_LAYER_VECTOR_STYLE:\n            {\n                const { mapName, layerName, style } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, () => ({ vectorStyle: style }));\n                return state1;\n            }\n        case ActionType.ADD_LAYER_BUSY_WORKER:\n            {\n                const { mapName, layerName } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, l => ({ busyWorkerCount: l.busyWorkerCount + 1 }));\n                return state1;\n            }\n        case ActionType.REMOVE_LAYER_BUSY_WORKER:\n            {\n                const { mapName, layerName } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, l => ({ busyWorkerCount: l.busyWorkerCount - 1 }));\n                return state1;\n            }\n    }\n    return state;\n}","import {\n    ActiveMapTool,\n    IViewerReducerState,\n    ILayerInfo\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const VIEWER_INITIAL_STATE: IViewerReducerState = {\n    busyCount: 0,\n    size: undefined,\n    tool: ActiveMapTool.None,\n    featureTooltipsEnabled: true\n}\n\nexport function viewerReducer(state = VIEWER_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.INIT_APP:\n            {\n                let tool = action.payload.initialActiveTool;\n                let ft = action.payload.featureTooltipsEnabled;\n                let state1: Partial<IViewerReducerState> | undefined;\n                if (tool) {\n                    state1 = {\n                        tool: tool\n                    };\n                }\n                let state2 : Partial<IViewerReducerState> | undefined;\n                if (typeof(ft) != 'undefined') {\n                    state2 = {\n                        featureTooltipsEnabled: ft\n                    };\n                }\n                return { ...state, ...state1, ...state2 };\n            }\n        case ActionType.MAP_SET_ACTIVE_TOOL:\n            {\n                const state1 = {\n                    tool: action.payload\n                };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_SET_MAPTIP:\n            {\n                const state1 = {\n                    featureTooltipsEnabled: action.payload\n                };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_SET_BUSY_COUNT:\n            {\n                const state1 = {\n                    busyCount: action.payload\n                };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_RESIZED:\n            {\n                const state1 = {\n                    size: [action.payload.width, action.payload.height]\n                };\n                return { ...state, ...state1 };\n            }\n    }\n    return state;\n}","import {\n    IMouseReducerState\n} from \"../api/common\";\nimport { isCoordinate } from \"../utils/type-guards\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const MOUSE_INITIAL_STATE: IMouseReducerState = {\n    coords: undefined\n};\n\nexport function mouseReducer(state = MOUSE_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.UPDATE_MOUSE_COORDINATES:\n            {\n                const data = action.payload.coord;\n                if (isCoordinate(data)) {\n                    const state1: Partial<IMouseReducerState> = { coords: data };\n                    return { ...state, ...state1 };\n                }\n            }\n    }\n    return state;\n}","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport * as logger from \"../utils/logger\";\nimport { getLayout } from \"../api/registry/layout\";\nimport {\n    IExternalBaseLayer,\n    IBranchedMapSubState,\n    ClientKind,\n    InitError,\n    IMapViewer\n} from \"../api/common\";\nimport * as InitActions from \"../actions/init\";\nimport { IInitAppLayout } from \"../actions/init\";\nimport { Error, normalizeStack } from \"../components/error\";\nimport { tr, DEFAULT_LOCALE } from \"../api/i18n\";\nimport * as TemplateActions from \"../actions/template\";\nimport { getAssetRoot } from \"../utils/asset\";\nimport { setFusionRoot } from \"../api/runtime\";\nimport { AppContext } from \"../components/context\";\nimport { IElementState } from '../actions/defs';\nimport { NonIdealState, Spinner, Intent, Callout } from '@blueprintjs/core';\nimport { useInitError, useInitErrorStack, useInitErrorOptions, useViewerLocale, useActiveMapBranch, useActiveMapName, useViewerFeatureTooltipsEnabled } from './hooks';\nimport { getStateFromUrl, IAppUrlState, updateUrl } from './url-state';\n\nexport interface SelectionOptions {\n    allowHtmlValues?: boolean;\n    cleanHtml?: (value: string) => string;\n}\n\n/**\n * App component properties\n *\n * @export\n * @interface IAppProps\n */\nexport interface IAppProps {\n    layout: string | (() => React.ReactNode);\n    /**\n     * A session id to init this viewer with\n     */\n    session?: string;\n    /**\n     * Agent configuration\n     *\n     * @type {{\n     *         uri: string,\n     *         kind?: ClientKind\n     *     }}\n     */\n    agent: {\n        uri: string,\n        kind?: ClientKind\n    },\n    /**\n     * Defines initial element visibility\n     *\n     * @type {{\n     *         taskpane: boolean;\n     *         legend: boolean;\n     *         selection: boolean;\n     *     }}\n     */\n    initialElementVisibility: {\n        taskpane: boolean;\n        legend: boolean;\n        selection: boolean;\n    }\n    /**\n     * A resource id to a Map Definition or Application Definition. If passing a Map Definition,\n     * a default viewer layout will be created\n     *\n     * @type {string}\n     */\n    resourceId: string;\n    /**\n     * The base URL for fusion. Used to determine the paths to the PHP backends for servicing tools like buffer/theme/featureinfo/redline/theme/etc\n     */\n    fusionRoot: string;\n    externalBaseLayers?: IExternalBaseLayer[];\n    onInit?: (viewer: IMapViewer) => void;\n    locale?: string;\n    /**\n     * Settings that control the selection panel (if provided by the template)\n     */\n    selectionSettings?: SelectionOptions;\n}\n\n/**\n * App component state\n *\n * @export\n * @interface IAppState\n */\nexport interface IAppState {\n    error: InitError | undefined;\n    includeStack: boolean;\n    initOptions: any;\n    //config: IConfigurationReducerState;\n    configuredLocale: string;\n    map: IBranchedMapSubState | undefined;\n    activeMapName: string | undefined;\n    featureTooltipsEnabled: boolean;\n}\n\n/**\n * App component action dispatchers\n *\n * @export\n * @interface IAppDispatch\n */\nexport interface IAppDispatch {\n    initLayout: (args: IInitAppLayout) => void;\n    setElementVisibility: (states: IElementState) => void;\n}\n\ntype AppInnerProps = IAppProps & IAppState & IAppDispatch;\n\nclass AppInner extends React.Component<AppInnerProps, any> {\n    constructor(props: AppInnerProps) {\n        super(props);\n        this.state = {\n            isLoading: true\n        };\n    }\n    private allowHtmlValuesInSelection(): boolean {\n        const { selectionSettings } = this.props;\n        if (selectionSettings) {\n            return selectionSettings.allowHtmlValues || false;\n        }\n        return false;\n    }\n    private getHtmlCleaner(): (value: string) => string {\n        const { selectionSettings } = this.props;\n        if (selectionSettings && selectionSettings.cleanHtml) {\n            return selectionSettings.cleanHtml;\n        }\n        return v => v;\n    }\n    componentDidMount() {\n        const {\n            onInit,\n            setElementVisibility,\n            initialElementVisibility,\n            initLayout,\n            locale,\n            session,\n            fusionRoot,\n            resourceId,\n            externalBaseLayers\n        } = this.props;\n        const {\n            locale: urlLocale,\n            resource: urlResource,\n            session: urlSession,\n            x: urlX,\n            y: urlY,\n            ft: urlFeatureTooltip,\n            scale: urlScale,\n            map: urlMap,\n            sl: urlShowLayers,\n            hl: urlHideLayers,\n            sg: urlShowGroups,\n            hg: urlHideGroups\n        } = getStateFromUrl();\n        if (setElementVisibility && initialElementVisibility) {\n            const { taskpane, legend, selection } = initialElementVisibility;\n            const states: IElementState = {\n                taskPaneVisible: typeof (taskpane) != 'undefined' ? taskpane : true,\n                legendVisible: typeof (legend) != 'undefined' ? legend : true,\n                selectionPanelVisible: typeof (selection) != 'undefined' ? selection : true\n            };\n            setElementVisibility(states);\n        }\n        logger.debug(`Asset root is: ${getAssetRoot()}`);\n        if (fusionRoot) {\n            setFusionRoot(fusionRoot);\n        }\n        if (initLayout) {\n            let ftArgs: Partial<IInitAppLayout> | undefined;\n            if (typeof(urlFeatureTooltip) != 'undefined') {\n                ftArgs = {\n                    featureTooltipsEnabled: urlFeatureTooltip\n                }\n            }\n            let amArgs: Partial<IInitAppLayout> | undefined;\n            if (urlMap) {\n                amArgs = {\n                    initialActiveMap: urlMap\n                };\n            }\n            let ivArgs: Partial<IInitAppLayout> | undefined;\n            if (urlX && urlY && urlScale) {\n                ivArgs = {\n                    initialView: {\n                        x: urlX,\n                        y: urlY,\n                        scale: urlScale\n                    }\n                };\n            }\n            let slArgs: Partial<IInitAppLayout> | undefined;\n            if (urlShowLayers) {\n                slArgs = {\n                    initialShowLayers: [...urlShowLayers]\n                };\n            }\n            let hlArgs: Partial<IInitAppLayout> | undefined;\n            if (urlHideLayers) {\n                hlArgs = {\n                    initialHideLayers: [...urlHideLayers]\n                };\n            }\n            let sgArgs: Partial<IInitAppLayout> | undefined;\n            if (urlShowGroups) {\n                sgArgs = {\n                    initialShowGroups: [...urlShowGroups]\n                };\n            }\n            let hgArgs: Partial<IInitAppLayout> | undefined;\n            if (urlHideGroups) {\n                hgArgs = {\n                    initialHideGroups: [...urlHideGroups]\n                };\n            }\n            const args: IInitAppLayout = {\n                ...{\n                    resourceId: urlResource || resourceId,\n                    locale: urlLocale || locale || DEFAULT_LOCALE,\n                    externalBaseLayers: externalBaseLayers,\n                    session: urlSession || session,\n                    onInit: onInit\n                },\n                ...(ftArgs || {}),\n                ...(amArgs || {}),\n                ...(ivArgs || {}),\n                ...(slArgs || {}),\n                ...(hlArgs || {}),\n                ...(sgArgs || {}),\n                ...(hgArgs || {})\n            };\n            initLayout(args);\n        }\n    }\n    componentDidUpdate(prevProps: AppInnerProps) {\n        const nextProps = this.props;\n        const curUrlState = getStateFromUrl();\n        //Preserve locale/resources/session if already present in url\n        const nextUrlState: IAppUrlState = {\n            locale: curUrlState.locale ?? this.props.locale,\n            resource: curUrlState.resource ?? this.props.resourceId,\n            session: curUrlState.session ?? this.props.session\n        };\n        if (nextProps.featureTooltipsEnabled != prevProps.featureTooltipsEnabled) {\n            nextUrlState.ft = nextProps.featureTooltipsEnabled;\n        }\n        if (nextProps.map != null && prevProps.map != nextProps.map) {\n            this.setState({ isLoading: false });\n        }\n        if (nextProps.activeMapName) {\n            const am = nextProps.activeMapName;\n            nextUrlState.map = am;\n        }\n        if (nextProps.map) {\n            if (nextProps.map.currentView) {\n                const { x, y, scale } = nextProps.map.currentView;\n                nextUrlState.x = x;\n                nextUrlState.y = y;\n                nextUrlState.scale = scale;\n            }\n            if (nextProps.map.runtimeMap) {\n                const { showGroups, showLayers, hideGroups, hideLayers } = nextProps.map;\n                const sg = [] as string[];\n                const hg = [] as string[];\n                const sl = [] as string[];\n                const hl = [] as string[];\n                if (nextProps.map.runtimeMap.Group) {\n                    for (const g of nextProps.map.runtimeMap.Group) {\n                        if (showGroups.indexOf(g.ObjectId) >= 0) {\n                            sg.push(g.Name);\n                        } else if (hideGroups.indexOf(g.ObjectId) >= 0) {\n                            hg.push(g.Name);\n                        }\n                    }\n                }\n                if (nextProps.map.runtimeMap.Layer) {\n                    for (const l of nextProps.map.runtimeMap.Layer) {\n                        if (showLayers.indexOf(l.ObjectId) >= 0) {\n                            sl.push(l.Name);\n                        } else if (hideLayers.indexOf(l.ObjectId) >= 0) {\n                            hl.push(l.Name);\n                        }\n                    }\n                }\n                nextUrlState.sg = sg;\n                nextUrlState.hg = hg;\n                nextUrlState.sl = sl;\n                nextUrlState.hl = hl;\n                const { SessionId } = nextProps.map.runtimeMap;\n                nextUrlState.session = SessionId;\n            }\n        }\n        updateUrl(nextUrlState);\n    }\n    private renderErrorMessage(err: Error | InitError, locale: string, args: any): JSX.Element {\n        const msg = err.message;\n        switch (msg) {\n            case \"MgConnectionFailedException\":\n                {\n                    const arg = { __html: tr(\"INIT_ERROR_NO_CONNECTION\", locale) };\n                    return <div dangerouslySetInnerHTML={arg} />;\n                }\n            case \"MgResourceNotFoundException\":\n                {\n                    const arg = { __html: tr(\"INIT_ERROR_RESOURCE_NOT_FOUND\", locale, { resourceId: args.resourceId }) };\n                    return <div dangerouslySetInnerHTML={arg} />;\n                }\n            case \"MgSessionExpiredException\":\n                {\n                    const arg = { __html: tr(\"INIT_ERROR_EXPIRED_SESSION\", locale, { sessionId: args.session }) };\n                    return <div dangerouslySetInnerHTML={arg} />;\n                }\n            default:\n                {\n                    const arg = { __html: msg };\n                    const stack = normalizeStack(err);\n                    return <div>\n                        <div dangerouslySetInnerHTML={arg} />\n                        {(() => {\n                            if (this.props.includeStack === true && stack.length > 0) {\n                                return <div>\n                                    <p>Stack Trace</p>\n                                    <ul>\n                                        {stack.map((ln, i) => <li key={`stack-line-${i}`}>{ln}</li>)}\n                                    </ul>\n                                </div>;\n                            }\n                        })()}\n                    </div>;\n                }\n        }\n    }\n    private initErrorRenderer = (err: Error | InitError) => {\n        const { configuredLocale, initOptions } = this.props;\n        let locale = configuredLocale;\n        if (initOptions && initOptions.locale) {\n            locale = initOptions.locale;\n        }\n        //Not showing stack as the error cases are well-defined here and we know where they\n        //originate from\n        return <Callout intent={Intent.DANGER} title={tr(\"INIT_ERROR_TITLE\", locale)} icon=\"error\">\n            {this.renderErrorMessage(err, locale, initOptions || {})}\n        </Callout>;\n    }\n    render(): JSX.Element {\n        const { layout, configuredLocale, error } = this.props;\n        const { isLoading } = this.state;\n        if (error) {\n            return <Error error={error} errorRenderer={this.initErrorRenderer} />\n        } else {\n            //NOTE: Locale may not have been set at this point, so use default\n            const locale = configuredLocale;\n            if (isLoading) {\n                return <NonIdealState \n                    icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                    title={tr(\"INIT\", locale)}\n                    description={tr(\"INIT_DESC\", locale)} />;\n            } else {\n                const layoutEl = typeof(layout) == 'function' ? layout : getLayout(layout);\n                if (layoutEl) {\n                    const providerImpl = {\n                        allowHtmlValuesInSelection: () => this.allowHtmlValuesInSelection(),\n                        getHTMLCleaner: () => this.getHtmlCleaner()\n                    };\n                    return <AppContext.Provider value={providerImpl}>\n                        {layoutEl()}\n                    </AppContext.Provider>\n                } else {\n                    return <Error error={tr(\"ERR_UNREGISTERED_LAYOUT\", locale, { layout: layout })} />;\n                }\n            }\n        }\n    }\n}\n\nconst App = (props: IAppProps) => {\n    const error = useInitError();\n    const includeStack = useInitErrorStack();\n    const initOptions = useInitErrorOptions();\n    const configuredLocale = useViewerLocale();\n    const map = useActiveMapBranch();\n    const activeMapName = useActiveMapName();\n    const ftEnabled = useViewerFeatureTooltipsEnabled();\n\n    const dispatch = useDispatch();\n    const initLayout = (args: InitActions.IInitAppLayout) => dispatch(InitActions.initLayout(args));\n    const setElementVisibility = (state: IElementState) => dispatch(TemplateActions.setElementStates(state));\n\n    return <AppInner error={error}\n        includeStack={includeStack}\n        initOptions={initOptions}\n        featureTooltipsEnabled={ftEnabled}\n        configuredLocale={configuredLocale}\n        map={map}\n        activeMapName={activeMapName}\n        initLayout={initLayout}\n        setElementVisibility={setElementVisibility}\n        {...props} />;\n}\n\nexport default App;","import * as Constants from \"../constants\";\nimport { Client } from \"../api/client\";\nimport * as Runtime from \"../api/runtime\";\nimport { ReduxDispatch, Dictionary, IMapView, CommandTarget, ActiveMapTool } from \"../api/common\";\nimport { RuntimeMapFeatureFlags } from \"../api/request-builder\";\nimport { registerCommand, DefaultCommands } from \"../api/registry/command\";\nimport {\n    WebLayout,\n    CommandDef,\n    isBasicCommand,\n    isTargetedCommand,\n    isSeparatorItem,\n    isFlyoutItem,\n    isCommandItem,\n    isInvokeURLCommand,\n    isSearchCommand,\n    UIItem\n} from \"../api/contracts/weblayout\";\nimport {\n    ApplicationDefinition,\n    Widget,\n    UIWidget,\n    MapSetGroup,\n    MapConfiguration,\n    ContainerItem\n} from \"../api/contracts/fusion\";\nimport {\n    IExternalBaseLayer,\n    ReduxThunkedAction,\n    IMapViewer\n} from \"../api/common\";\nimport { strEndsWith, strReplaceAll } from \"../utils/string\";\nimport { IView } from \"../api/contracts/common\";\nimport { RuntimeMap } from \"../api/contracts/runtime-map\";\nimport { tr } from \"../api/i18n\";\nimport { MgError } from \"../api/error\";\nimport * as logger from \"../utils/logger\";\nimport * as shortid from \"shortid\";\nimport { registerStringBundle, DEFAULT_LOCALE } from \"../api/i18n\";\nimport { assertNever } from \"../utils/never\";\nimport proj4 from \"proj4\";\nimport { register } from \"ol/proj/proj4\";\nimport { makeUnique } from \"../utils/array\";\nimport { ensureParameters } from \"../utils/url\";\nimport { strIsNullOrEmpty } from \"../utils/string\";\nimport { convertWidget, isFlyoutSpec, ToolbarConf, PreparedSubMenuSet } from '../api/registry/command-spec';\nimport {\n    IFlyoutSpec,\n    ISeparatorSpec,\n    IUnknownCommandSpec,\n    ICommandSpec\n} from \"../api/registry/command-spec\";\nimport { MapInfo, IInitAppActionPayload, IAcknowledgeStartupWarningsAction, IRestoredSelectionSets } from './defs';\nimport { ActionType } from '../constants/actions';\nimport { getSelectionSet, clearSessionStore } from '../api/session-store';\nimport { resolveProjectionFromEpsgIoAsync } from '../api/registry/projections';\n\nfunction isUIWidget(widget: any): widget is UIWidget {\n    return widget.WidgetType === \"UiWidgetType\";\n}\n\nfunction convertFlexLayoutUIItems(items: ContainerItem[], widgetsByKey: Dictionary<Widget>, locale: string, noToolbarLabels = false): (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[] {\n    const converted = items.map(item => {\n        switch (item.Function) {\n            case \"Widget\":\n                {\n                    const widget = widgetsByKey[item.Widget];\n                    if (widget && isUIWidget(widget)) {\n                        return convertWidget(widget, locale, noToolbarLabels);\n                    }\n                }\n            case \"Separator\":\n                return { isSeparator: true } as ISeparatorSpec;\n            case \"Flyout\":\n                return {\n                    label: item.Label,\n                    tooltip: item.Tooltip,\n                    icon: item.ImageUrl,\n                    spriteClass: item.ImageClass,\n                    children: convertFlexLayoutUIItems(item.Item, widgetsByKey, locale)\n                } as IFlyoutSpec;\n            default:\n                assertNever(item);\n        }\n        return null;\n    })\n    .filter(i => i != null)\n    .map(i => i as (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec));\n    return converted;\n}\n\nfunction convertWebLayoutUIItems(items: UIItem[] | undefined, cmdsByKey: Dictionary<CommandDef>, locale: string, noToolbarLabels = true): (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[] {\n    const converted = (items || []).map(item => {\n        if (isCommandItem(item)) {\n            const cmdDef: CommandDef = cmdsByKey[item.Command];\n            if (!cmdDef) {\n                logger.warn(`Invalid reference to command: ${item.Command}`);\n                return { error: tr(\"UNKNOWN_COMMAND_REFERENCE\", locale, { command: item.Command }) } as IUnknownCommandSpec;\n            } else if (cmdDef.TargetViewer != \"Dwf\") {\n                const commonParams: any = {};\n                if (isTargetedCommand(cmdDef)) {\n                    commonParams.Target = cmdDef.Target;\n                    commonParams.TargetFrame = cmdDef.TargetFrame;\n                }\n                if (isBasicCommand(cmdDef)) {\n                    let action: string = cmdDef.Action;\n                    if (action == \"ZoomRectangle\") {\n                        action = DefaultCommands.Zoom;\n                    } else if (action == \"FitToWindow\") {\n                        action = DefaultCommands.ZoomExtents;\n                    } else if (action == \"Refresh\") {\n                        action = DefaultCommands.RefreshMap;\n                    }\n                    return { command: action, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                } else {\n                    switch (cmdDef[\"@xsi:type\"]) {\n                        case \"ViewOptionsCommandType\":\n                            return { command: DefaultCommands.ViewerOptions, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"MeasureCommandType\":\n                            return { command: DefaultCommands.Measure, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"HelpCommandType\":\n                            return { command: DefaultCommands.Help, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"BufferCommandType\":\n                            return { command: DefaultCommands.Buffer, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"SelectWithinCommandType\":\n                            return { command: DefaultCommands.SelectWithin, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"GetPrintablePageCommandType\":\n                            return { command: DefaultCommands.QuickPlot, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        default:\n                            return { command: cmdDef.Name, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                    }\n                }\n            }\n        } else if (isSeparatorItem(item)) {\n            return { isSeparator: true } as ISeparatorSpec;\n        } else if (isFlyoutItem(item)) {\n            return {\n                label: item.Label,\n                tooltip: item.Tooltip,\n                children: convertWebLayoutUIItems(item.SubItem, cmdsByKey, locale, false)\n            } as IFlyoutSpec;\n        } else {\n            assertNever(item);\n        }\n        return null;\n    })\n    .filter(i => i != null)\n    .map(i => i as (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec));\n    return converted;\n}\n\nfunction convertToCommandTarget(fusionCmdTarget: string): CommandTarget {\n    //Treat empty/undefined target as new window\n    if (strIsNullOrEmpty(fusionCmdTarget)) {\n        return \"NewWindow\";\n    }\n    switch (fusionCmdTarget) {\n        case \"SearchWindow\":\n        case \"InvokeUrlWindow\":\n            return \"NewWindow\";\n        case \"TaskPane\":\n            return \"TaskPane\";\n        default:\n            return \"SpecifiedFrame\";\n    }\n}\n\nfunction prepareSubMenus(tbConf: Dictionary<ToolbarConf>): [PreparedSubMenuSet, boolean] {\n    const prepared: PreparedSubMenuSet = {\n        toolbars: {},\n        flyouts: {}\n    };\n    let bFoundContextMenu = false;\n    for (const key in tbConf) {\n        if (key == Constants.WEBLAYOUT_CONTEXTMENU) {\n            bFoundContextMenu = true;\n        }\n\n        //Special cases: Task pane and Context Menu. Transfer all to flyout\n        if (key == Constants.WEBLAYOUT_TASKMENU || key == Constants.WEBLAYOUT_CONTEXTMENU) {\n            const flyoutId = key;\n            prepared.flyouts[flyoutId] = {\n                children: tbConf[key].items\n            }\n        } else {\n            prepared.toolbars[key] = {\n                items: []\n            };\n            for (const item of tbConf[key].items) {\n                //Special case: contextmenu is all inline\n                if (isFlyoutSpec(item) && key != Constants.WEBLAYOUT_CONTEXTMENU) {\n                    const flyoutId = `${item.label}_${shortid.generate()}`;\n                    prepared.toolbars[key].items.push({\n                        label: item.label,\n                        tooltip: item.tooltip,\n                        icon: item.icon,\n                        spriteClass: item.spriteClass,\n                        flyoutId: flyoutId\n                    } as ICommandSpec);\n                    prepared.flyouts[flyoutId] = {\n                        children: item.children\n                    }\n                } else {\n                    prepared.toolbars[key].items.push(item);\n                }\n            }\n        }\n    }\n    return [prepared, bFoundContextMenu]\n}\n\nfunction getDesiredTargetMapName(mapDef: string) {\n    const lastSlash = mapDef.lastIndexOf(\"/\");\n    const lastDot = mapDef.lastIndexOf(\".\");\n    if (lastSlash >= 0 && lastDot >= 0 && lastDot > lastSlash) {\n        return `${mapDef.substring(lastSlash + 1, lastDot)}`;\n    } else {\n        return `Map_${shortid.generate()}`;\n    }\n}\n\nfunction setupMaps(appDef: ApplicationDefinition, mapsByName: Dictionary<RuntimeMap>, config: any, warnings: string[]): Dictionary<MapInfo> {\n    const dict: Dictionary<MapInfo> = {};\n    if (appDef.MapSet) {\n        for (const mgGroup of appDef.MapSet.MapGroup) {\n            let mapName: string | undefined;\n            //Setup external layers\n            const externalBaseLayers = [] as IExternalBaseLayer[];\n            for (const map of mgGroup.Map) {\n                if (map.Type === \"MapGuide\") {\n                    //TODO: Based on the schema, different MG map groups could have different\n                    //settings here and our redux tree should reflect that. Currently the first one \"wins\"\n                    if (!config.selectionColor && map.Extension.SelectionColor != null) {\n                        config.selectionColor = map.Extension.SelectionColor;\n                    }\n                    if (!config.imageFormat && map.Extension.ImageFormat != null) {\n                        config.imageFormat = map.Extension.ImageFormat;\n                    }\n                    if (!config.selectionImageFormat && map.Extension.SelectionFormat != null) {\n                        config.selectionImageFormat = map.Extension.SelectionFormat;\n                    }\n\n                    //NOTE: Although non-sensical, if the same map definition exists across multiple\n                    //MapGroups, we might be matching the wrong one. We just assume such non-sensical\n                    //AppDefs won't exist\n                    for (const name in mapsByName) {\n                        if (mapsByName[name].MapDefinition == map.Extension.ResourceId) {\n                            mapName = name;\n                            break;\n                        }\n                    }\n                } else {\n                    switch (map.Type) {\n                        case \"Google\":\n                            warnings.push(tr(\"INIT_WARNING_UNSUPPORTED_GOOGLE_MAPS\", config.locale));\n                            break;\n                        case \"VirtualEarth\":\n                            {\n                                //HACK: De-arrayification of arbitrary extension elements\n                                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                                const name = map.Extension.Options.name[0];\n                                const type = map.Extension.Options.type[0];\n                                const options: any = {};\n                                let bAdd = true;\n                                switch (type)\n                                {\n                                    case \"Aerial\":\n                                    case \"a\":\n                                        options.imagerySet = \"Aerial\";\n                                        break;\n                                    case \"AerialWithLabels\":\n                                        options.imagerySet = \"AerialWithLabels\";\n                                        break;\n                                    case \"Road\":\n                                        options.imagerySet = \"Road\";\n                                        break;\n                                    default:\n                                        bAdd = false;\n                                        warnings.push(tr(\"INIT_WARNING_BING_UNKNOWN_LAYER\", config.locale, { type: type }));\n                                        break;\n                                }\n\n                                if (appDef.Extension.BingMapKey) {\n                                    options.key = appDef.Extension.BingMapKey;\n                                } else {\n                                    bAdd = false;\n                                    warnings.push(tr(\"INIT_WARNING_BING_API_KEY_REQD\", config.locale));\n                                }\n\n                                if (bAdd) {\n                                    externalBaseLayers.push({\n                                        name: name,\n                                        kind: \"BingMaps\",\n                                        options: options\n                                    });\n                                }\n                            }\n                            break;\n                        case \"OpenStreetMap\":\n                            {\n                                //HACK: De-arrayification of arbitrary extension elements\n                                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                                const name = map.Extension.Options.name[0];\n                                const type = map.Extension.Options.type[0];\n                                const options: any = {};\n                                switch (type) {\n                                    case \"CycleMap\":\n                                        options.url = \"http://{a-c}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png\";\n                                        break;\n                                    case \"TransportMap\":\n                                        options.url = \"http://tile2.opencyclemap.org/transport/{z}/{x}/{y}.png\";\n                                        break;\n                                }\n                                externalBaseLayers.push({\n                                    name: name,\n                                    kind: \"OSM\",\n                                    options: options\n                                });\n                            }\n                            break;\n                        case \"Stamen\":\n                            {\n                                //HACK: De-arrayification of arbitrary extension elements\n                                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                                const name = map.Extension.Options.name[0];\n                                const type = map.Extension.Options.type[0];\n                                externalBaseLayers.push({\n                                    name: name,\n                                    kind: \"Stamen\",\n                                    options: {\n                                        layer: type\n                                    }\n                                });\n                            }\n                            break;\n                        case \"XYZ\":\n                            {\n                                //HACK: De-arrayification of arbitrary extension elements\n                                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                                const name = map.Extension.Options.name[0];\n                                const type = map.Extension.Options.type[0];\n                                //NOTE: From a fusion appdef, we're expecting placeholder tokens to be in ${this_format} instead of\n                                //{this_format} as the primary consumer is the Fusion viewer that is based on OpenLayers 2\n                                //As we're not using OL2, but OL4+ the expected format is {this_format}, so we need to convert these\n                                //placeholder tokens\n                                const urls = (map.Extension.Options.urls || []).map((s: string) => strReplaceAll(s, \"${\", \"{\"));\n                                externalBaseLayers.push({\n                                    name: name,\n                                    kind: \"XYZ\",\n                                    options: {\n                                        layer: type,\n                                        urls: urls\n                                    }\n                                });\n                            }\n                            break;\n                    }\n                }\n            }\n            //First come, first served\n            if (externalBaseLayers.length > 0) {\n                externalBaseLayers[0].visible = true;\n            }\n\n            //Setup initial view\n            let initialView: IView | undefined;\n            if (mgGroup.InitialView) {\n                initialView = {\n                    x: mgGroup.InitialView.CenterX,\n                    y: mgGroup.InitialView.CenterY,\n                    scale: mgGroup.InitialView.Scale\n                };\n            }\n\n            if (mapName) {\n                dict[mapName] = {\n                    mapGroupId: mgGroup[\"@id\"],\n                    map: mapsByName[mapName],\n                    initialView: initialView,\n                    externalBaseLayers: externalBaseLayers\n                };\n            }\n        }\n    }\n    return dict;\n}\n\n\nfunction getMapGuideConfiguration(appDef: ApplicationDefinition): [string, MapConfiguration][] {\n    const configs = [] as [string, MapConfiguration][];\n    if (appDef.MapSet) {\n        for (const mg of appDef.MapSet.MapGroup) {\n            for (const map of mg.Map) {\n                if (map.Type == \"MapGuide\") {\n                    configs.push([mg[\"@id\"], map]);\n                }\n            }\n        }\n    }\n    return configs;\n}\n\nfunction getMapDefinitionsFromFlexLayout(appDef: ApplicationDefinition): MapToLoad[] {\n    const configs = getMapGuideConfiguration(appDef);\n    if (configs.length > 0) {\n        return configs.map(c => ({ name: c[0], mapDef: c[1].Extension.ResourceId }));\n    }\n    throw new MgError(\"No Map Definition found in Application Definition\");\n}\n\nfunction getExtraProjectionsFromFlexLayout(appDef: ApplicationDefinition): string[] {\n    //The only widget we care about is the coordinate tracker\n    const epsgs: string[] = [];\n    for (const ws of appDef.WidgetSet) {\n        for (const w of ws.Widget) {\n            if (w.Type == \"CoordinateTracker\") {\n                const ps = w.Extension.Projection || [];\n                for (const p of ps) {\n                    epsgs.push(p.split(':')[1]);\n                }\n            } else if (w.Type == \"CursorPosition\") {\n                const dp = w.Extension.DisplayProjection;\n                if (dp) {\n                    epsgs.push(dp.split(':')[1]);\n                }\n            }\n        }\n    }\n    return makeUnique(epsgs);\n}\n\nfunction processAndDispatchInitError(error: Error, includeStack: boolean, dispatch: ReduxDispatch, opts: IInitAsyncOptions): void {\n    if (error.stack) {\n        dispatch({\n            type: ActionType.INIT_ERROR,\n            payload: {\n                error: {\n                    message: error.message,\n                    stack: (error.stack || \"\").split(\"\\n\")\n                },\n                includeStack: includeStack,\n                options: opts\n            }\n        });\n    } else {\n        dispatch({\n            type: ActionType.INIT_ERROR,\n            payload: {\n                error: {\n                    message: error.message,\n                    stack: []\n                },\n                includeStack: includeStack,\n                options: opts\n            }\n        });\n    }\n}\n\nexport interface IInitAppLayout {\n    locale: string;\n    resourceId: string;\n    externalBaseLayers?: IExternalBaseLayer[];\n    session?: string;\n    initialView?: IMapView;\n    /**\n     * \n     * @since 0.11\n     * @type {string}\n     * @memberof IInitAppLayout\n     */\n    initialActiveMap?: string;\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialShowLayers?: string[];\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialShowGroups?: string[];\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialHideLayers?: string[];\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialHideGroups?: string[];\n    onInit?: (viewer: IMapViewer) => void;\n    /**\n     * Sets whether feature tooltips should be initially enabled\n     * \n     * @since 0.13\n     */\n    featureTooltipsEnabled?: boolean;\n}\n\nexport interface IInitAsyncOptions extends IInitAppLayout {\n    locale: string;\n}\n\ntype MapToLoad = { name: string, mapDef: string };\n\nasync function tryDescribeRuntimeMapAsync(client: Client, mapName: string, session: string, mapDef: string) {\n    try {\n        const map = await client.describeRuntimeMap({\n            mapname: mapName,\n            requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups,\n            session: session\n        });\n        return map;\n    } catch (e) {\n        if (e.message === \"MgResourceNotFoundException\") {\n            const map = await client.createRuntimeMap({\n                mapDefinition: mapDef,\n                requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups,\n                session: session,\n                targetMapName: mapName\n            });\n            return map;\n        }\n        throw e;\n    }\n}\n\nasync function createRuntimeMapsAsync<TLayout>(client: Client, session: string, opts: IInitAsyncOptions, res: TLayout, mapDefSelector: (res: TLayout) => MapToLoad[], projectionSelector: (res: TLayout) => string[], sessionWasReused: boolean): Promise<[Dictionary<RuntimeMap>, string[]]> {\n    const mapDefs = mapDefSelector(res);\n    const mapPromises: Promise<RuntimeMap>[] = [];\n    const warnings = [] as string[];\n    for (const m of mapDefs) {\n        //sessionWasReused is a hint whether to create a new runtime map, or recover the last runtime map state from the given map name\n        if (sessionWasReused) {\n            //FIXME: If the map state we're recovering has a selection, we need to re-init the selection client-side\n            logger.info(`Session ID re-used. Attempting recovery of map state of: ${m.name}`);\n            mapPromises.push(tryDescribeRuntimeMapAsync(client, m.name, session, m.mapDef));\n        } else {\n            logger.info(`Creating runtime map state (${m.name}) for: ${m.mapDef}`);\n            mapPromises.push(client.createRuntimeMap({\n                mapDefinition: m.mapDef,\n                requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups,\n                session: session,\n                targetMapName: m.name\n            }));\n        }\n    }\n    const maps = await Promise.all(mapPromises);\n    const fetchEpsgs: { epsg: string, mapDef: string }[] = [];\n    //All must be non-zero\n    for (const m of maps) {\n        const epsg = m.CoordinateSystem.EpsgCode;\n        const mapDef = m.MapDefinition;\n        if (epsg == \"0\") {\n            throw new MgError(tr(\"INIT_ERROR_UNSUPPORTED_COORD_SYS\", opts.locale || DEFAULT_LOCALE, { mapDefinition: mapDef }));\n        }\n        //Must be registered to proj4js if not 4326 or 3857\n        if (!proj4.defs[`EPSG:${epsg}`]) {\n            fetchEpsgs.push({ epsg: epsg, mapDef: mapDef });\n        }\n    }\n    const extraEpsgs = projectionSelector(res);\n    for (const e of extraEpsgs) {\n        fetchEpsgs.push({ epsg: e, mapDef: \"\" });\n    }\n    const epsgs = await Promise.all(fetchEpsgs.map(f => resolveProjectionFromEpsgIoAsync(f.epsg, opts.locale, f.mapDef)));\n\n    //Previously, we register proj4 with OpenLayers on the bootstrap phase way before this init\n    //process is started. This no longer works for OL6 where it doesn't seem to pick up the extra\n    //projections we've registered with proj4 after linking proj4 to OpenLayers. So that registration\n    //step has been relocated here, after all the custom projections have been fetched and registered\n    //with proj4\n    logger.debug(`Register proj4 with OpenLayers`);\n    register(proj4);\n\n    //Build the Dictionary<RuntimeMap> from loaded maps\n    const mapsByName: Dictionary<RuntimeMap> = {};\n    for (const map of maps) {\n        mapsByName[map.Name] = map;\n    }\n    return [mapsByName, warnings];\n}\n\nasync function initFromWebLayoutAsync(webLayout: WebLayout, opts: IInitAsyncOptions, session: string, client: Client, sessionWasReused: boolean): Promise<IInitAppActionPayload> {\n    const [mapsByName, warnings] = await createRuntimeMapsAsync(client, session, opts, webLayout, wl => [ { name: getDesiredTargetMapName(wl.Map.ResourceId), mapDef: wl.Map.ResourceId } ], () => [], sessionWasReused);\n    const cmdsByKey: any = {};\n    //Register any InvokeURL and Search commands\n    for (const cmd of webLayout.CommandSet.Command) {\n        if (isInvokeURLCommand(cmd)) {\n            registerCommand(cmd.Name, {\n                url: cmd.URL,\n                disableIfSelectionEmpty: cmd.DisableIfSelectionEmpty,\n                target: cmd.Target,\n                targetFrame: cmd.TargetFrame,\n                parameters: (cmd.AdditionalParameter || []).map(p => {\n                    return { name: p.Key, value: p.Value };\n                }),\n                title: cmd.Label\n            });\n        } else if (isSearchCommand(cmd)) {\n            registerCommand(cmd.Name, {\n                layer: cmd.Layer,\n                prompt: cmd.Prompt,\n                target: cmd.Target,\n                targetFrame: cmd.TargetFrame,\n                resultColumns: cmd.ResultColumns,\n                filter: cmd.Filter,\n                matchLimit: cmd.MatchLimit,\n                title: cmd.Label\n            });\n        }\n        cmdsByKey[cmd.Name] = cmd;\n    }\n    const mainToolbar = (webLayout.ToolBar.Visible\n                        ? convertWebLayoutUIItems(webLayout.ToolBar.Button, cmdsByKey, opts.locale)\n                        : []);\n    const taskBar = (webLayout.TaskPane.TaskBar.Visible\n                    ? convertWebLayoutUIItems(webLayout.TaskPane.TaskBar.MenuButton, cmdsByKey, opts.locale, false)\n                    : []);\n    const contextMenu = (webLayout.ContextMenu.Visible\n                        ? convertWebLayoutUIItems(webLayout.ContextMenu.MenuItem, cmdsByKey, opts.locale, false)\n                        : []);\n    const config: any = {};\n    if (webLayout.SelectionColor != null) {\n        config.selectionColor = webLayout.SelectionColor;\n    }\n    if (webLayout.MapImageFormat != null) {\n        config.imageFormat = webLayout.MapImageFormat;\n    }\n    if (webLayout.SelectionImageFormat != null) {\n        config.selectionImageFormat = webLayout.SelectionImageFormat;\n    }\n    if (webLayout.PointSelectionBuffer != null) {\n        config.pointSelectionBuffer = webLayout.PointSelectionBuffer;\n    }\n    let initialView: IView | null = null;\n    if (webLayout.Map.InitialView != null) {\n        initialView = {\n            x: webLayout.Map.InitialView.CenterX,\n            y: webLayout.Map.InitialView.CenterY,\n            scale: webLayout.Map.InitialView.Scale\n        };\n    }\n\n    if (webLayout.Title != \"\") {\n        document.title = webLayout.Title || document.title;\n    }\n\n    const maps: any = {};\n    let firstMapName = \"\";\n    let firstSessionId = \"\";\n    for (const mapName in mapsByName) {\n        if (!firstMapName && !firstSessionId) {\n            const map = mapsByName[mapName];\n            firstMapName = map.Name;\n            firstSessionId = map.SessionId;\n            maps[firstMapName] = {\n                mapGroupId: map.Name,\n                map: map,\n                externalBaseLayers: opts.externalBaseLayers,\n                initialView: initialView\n            };\n            break;\n        }\n    }\n\n    const menus: Dictionary<ToolbarConf> = {};\n    menus[Constants.WEBLAYOUT_TOOLBAR] = {\n        items: mainToolbar\n    };\n    menus[Constants.WEBLAYOUT_TASKMENU] = {\n        items: taskBar\n    };\n    menus[Constants.WEBLAYOUT_CONTEXTMENU] = {\n        items: contextMenu\n    };\n    \n    const tb = prepareSubMenus(menus)[0];\n    return {\n        activeMapName: firstMapName,\n        featureTooltipsEnabled: opts.featureTooltipsEnabled,\n        initialUrl: ensureParameters(webLayout.TaskPane.InitialTask || \"server/TaskPane.html\", firstMapName, firstSessionId, opts.locale),\n        initialTaskPaneWidth: webLayout.TaskPane.Width,\n        initialInfoPaneWidth: webLayout.InformationPane.Width,\n        maps: maps,\n        locale: opts.locale,\n        config: config,\n        capabilities: {\n            hasTaskPane: webLayout.TaskPane.Visible,\n            hasTaskBar: webLayout.TaskPane.TaskBar.Visible,\n            hasStatusBar: webLayout.StatusBar.Visible,\n            hasNavigator: webLayout.ZoomControl.Visible,\n            hasSelectionPanel: webLayout.InformationPane.Visible && webLayout.InformationPane.PropertiesVisible,\n            hasLegend: webLayout.InformationPane.Visible && webLayout.InformationPane.LegendVisible,\n            hasToolbar: webLayout.ToolBar.Visible,\n            hasViewSize: webLayout.StatusBar.Visible\n        },\n        toolbars: tb,\n        warnings: warnings,\n        initialActiveTool: ActiveMapTool.Pan\n    };\n}\n\nasync function initFromAppDefAsync(appDef: ApplicationDefinition, opts: IInitAsyncOptions, session: string, client: Client, sessionWasReused: boolean): Promise<IInitAppActionPayload> {\n    const [mapsByName, warnings] = await createRuntimeMapsAsync(client, session, opts, appDef, fl => getMapDefinitionsFromFlexLayout(fl), fl => getExtraProjectionsFromFlexLayout(fl), sessionWasReused);\n    let initialTask: string;\n    let taskPane: Widget|undefined;\n    let viewSize: Widget|undefined;\n    let hasLegend = false;\n    let hasStatus = false;\n    let hasNavigator = false;\n    let hasSelectionPanel = false;\n    let hasTaskBar = false;\n    const config: any = {};\n    const tbConf: Dictionary<ToolbarConf> = {};\n    const widgetsByKey: Dictionary<Widget> = {};\n    //Register any InvokeURL and Search commands. Also set capabilities along the way\n    for (const widgetSet of appDef.WidgetSet) {\n        for (const widget of widgetSet.Widget) {\n            const cmd = widget.Extension;\n            switch (widget.Type) {\n                case \"TaskPane\":\n                    taskPane = widget;\n                    break;\n                case \"ViewSize\":\n                    viewSize = widget;\n                    break;\n                case \"Legend\":\n                    hasLegend = true;\n                    break;\n                case \"SelectionPanel\":\n                    hasSelectionPanel = true;\n                    break;\n                case \"CursorPosition\":\n                case \"SelectionInfo\":\n                    hasStatus = true;\n                    break;\n                case \"Navigator\":\n                    hasNavigator = true;\n                    break;\n                case \"Search\":\n                    registerCommand(widget.Name, {\n                        layer: cmd.Layer,\n                        prompt: cmd.Prompt,\n                        resultColumns: cmd.ResultColumns,\n                        filter: cmd.Filter,\n                        matchLimit: cmd.MatchLimit,\n                        title: (cmd.Title || (isUIWidget(widget) ? widget.Label : undefined)),\n                        target: convertToCommandTarget(cmd.Target),\n                        targetFrame: cmd.Target\n                    });\n                    break;\n                case \"InvokeURL\":\n                    registerCommand(widget.Name, {\n                        url: cmd.Url,\n                        disableIfSelectionEmpty: cmd.DisableIfSelectionEmpty,\n                        target: convertToCommandTarget(cmd.Target),\n                        targetFrame: cmd.Target,\n                        parameters: (cmd.AdditionalParameter || []).map((p: any) => {\n                            return { name: p.Key, value: p.Value };\n                        }),\n                        title: isUIWidget(widget) ? widget.Label : undefined\n                    });\n                    break;\n            }\n            widgetsByKey[widget.Name] = widget;\n        }\n    }\n    //Now build toolbar layouts\n    for (const widgetSet of appDef.WidgetSet) {\n        for (const cont of widgetSet.Container) {\n            let tbName = cont.Name;\n            tbConf[tbName] = { items: convertFlexLayoutUIItems(cont.Item, widgetsByKey, opts.locale) };\n        }\n        for (const w of widgetSet.Widget) {\n            if (w.Type == \"CursorPosition\") {\n                config.coordinateProjection = w.Extension.DisplayProjection;\n                config.coordinateDecimals = w.Extension.Precision;\n                config.coordinateDisplayFormat = w.Extension.Template;\n            }\n        }\n    }\n\n    const maps = setupMaps(appDef, mapsByName, config, warnings);\n\n    if (taskPane) {\n        hasTaskBar = true; //Fusion flex layouts can't control the visiblity of this\n        initialTask = taskPane.Extension.InitialTask || \"server/TaskPane.html\";\n    } else {\n        initialTask = \"server/TaskPane.html\";\n    }\n\n    if (appDef.Title) {\n        document.title = appDef.Title || document.title;\n    }\n\n    let firstMapName = \"\";\n    let firstSessionId = \"\";\n    for (const mapName in mapsByName) {\n        if (!firstMapName && !firstSessionId) {\n            const map = mapsByName[mapName];\n            firstMapName = map.Name;\n            firstSessionId = map.SessionId;\n            break;\n        }\n    }\n    const [tb, bFoundContextMenu] = prepareSubMenus(tbConf);\n    if (!bFoundContextMenu) {\n        warnings.push(tr(\"INIT_WARNING_NO_CONTEXT_MENU\", opts.locale, { containerName: Constants.WEBLAYOUT_CONTEXTMENU }));\n    }\n    return {\n        activeMapName: firstMapName,\n        initialUrl: ensureParameters(initialTask, firstMapName, firstSessionId, opts.locale),\n        featureTooltipsEnabled: opts.featureTooltipsEnabled,\n        locale: opts.locale,\n        maps: maps,\n        config: config,\n        capabilities: {\n            hasTaskPane: (taskPane != null),\n            hasTaskBar: hasTaskBar,\n            hasStatusBar: hasStatus,\n            hasNavigator: hasNavigator,\n            hasSelectionPanel: hasSelectionPanel,\n            hasLegend: hasLegend,\n            hasToolbar: (Object.keys(tbConf).length > 0),\n            hasViewSize: (viewSize != null)\n        },\n        toolbars: tb,\n        warnings: warnings,\n        initialActiveTool: ActiveMapTool.Pan\n    };\n}\n\nasync function sessionAcquiredAsync(opts: IInitAsyncOptions, session: string, client: Client, sessionWasReused: boolean): Promise<IInitAppActionPayload> {\n    if (!opts.resourceId) {\n        throw new MgError(tr(\"INIT_ERROR_MISSING_RESOURCE_PARAM\", opts.locale));\n    } else if (strEndsWith(opts.resourceId, \"WebLayout\")) {\n        const wl = await client.getResource<WebLayout>(opts.resourceId, { SESSION: session });\n        return await initFromWebLayoutAsync(wl, opts, session, client, sessionWasReused);\n    } else if (strEndsWith(opts.resourceId, \"ApplicationDefinition\")) {\n        const fl = await client.getResource<ApplicationDefinition>(opts.resourceId, { SESSION: session });\n        return await initFromAppDefAsync(fl, opts, session, client, sessionWasReused);\n    } else {\n        throw new MgError(tr(\"INIT_ERROR_UNKNOWN_RESOURCE_TYPE\", opts.locale, { resourceId: opts.resourceId }));\n    }\n} \n\nasync function initAsync(options: IInitAsyncOptions, dispatch: ReduxDispatch, client: Client): Promise<IInitAppActionPayload> {\n    //English strings are baked into this bundle. For non-en locales, we assume a strings/{locale}.json\n    //exists for us to fetch\n    if (options.locale != DEFAULT_LOCALE) {\n        const r = await fetch(`strings/${options.locale}.json`);\n        if (r.ok) {\n            const res = await r.json();\n            registerStringBundle(options.locale, res);\n            // Dispatch the SET_LOCALE as it is safe to change UI strings at this point\n            dispatch({\n                type: ActionType.SET_LOCALE,\n                payload: options.locale\n            });\n            logger.info(`Registered string bundle for locale: ${options.locale}`);\n        } else {\n            //TODO: Push warning to init error/warning reducer when we implement it\n            logger.warn(`Failed to register string bundle for locale: ${options.locale}`);\n        }\n    }\n    let session = options.session;\n    let sessionWasReused = false;\n    if (!session) {\n        session = await client.createSession(\"Anonymous\", \"\");\n    } else {\n        logger.info(`Re-using session: ${session}`);\n        sessionWasReused = true;\n    }\n    const payload = await sessionAcquiredAsync(options, session, client, sessionWasReused);\n    if (sessionWasReused) {\n        let initSelections: IRestoredSelectionSets = {};\n        for (const mapName in payload.maps) {\n            const sset = await getSelectionSet(session, mapName);\n            if (sset) {\n                initSelections[mapName] = sset;\n            }\n        }\n        payload.initialSelections = initSelections;\n        try {\n            //In the interest of being a responsible citizen, clean up all selection-related stuff from\n            //session store\n            await clearSessionStore();\n        } catch (e) {\n\n        }\n    }\n    return payload;\n}\n\n/**\n * Initializes the viewer\n *\n * @export\n * @param {IInitAppLayout} options\n * @returns {ReduxThunkedAction}\n */\nexport function initLayout(options: IInitAppLayout): ReduxThunkedAction {\n    const opts: IInitAsyncOptions = { ...options };\n    return (dispatch, getState) => {\n        const args = getState().config;\n        //TODO: Fetch and init the string bundle earlier if \"locale\" is present\n        //so the English init messages are seen only for a blink if requesting a\n        //non-english string bundle\n        if (args.agentUri && args.agentKind) {\n            const client = new Client(args.agentUri, args.agentKind);\n            initAsync(opts, dispatch, client).then(payload => {\n                let initPayload = payload;\n                if (opts.initialView) {\n                    initPayload.initialView = {\n                        ...opts.initialView\n                    };\n                }\n                if (opts.initialActiveMap) {\n                    initPayload.activeMapName = opts.initialActiveMap;\n                }\n                initPayload.initialHideGroups = opts.initialHideGroups;\n                initPayload.initialHideLayers = opts.initialHideLayers;\n                initPayload.initialShowGroups = opts.initialShowGroups;\n                initPayload.initialShowLayers = opts.initialShowLayers;\n                initPayload.featureTooltipsEnabled = opts.featureTooltipsEnabled;\n                dispatch({\n                    type: ActionType.INIT_APP,\n                    payload\n                });\n                if (options.onInit) {\n                    const viewer = Runtime.getViewer();\n                    if (viewer) {\n                        options.onInit(viewer);\n                    }\n                }\n            }).catch(err => {\n                processAndDispatchInitError(err, false, dispatch, opts);\n            })\n        }\n    };\n}\n\nexport function acknowledgeInitWarnings(): IAcknowledgeStartupWarningsAction {\n    return {\n        type: ActionType.INIT_ACKNOWLEDGE_WARNINGS\n    }\n}","import { UIWidget } from '../contracts/fusion';\nimport { DefaultCommands } from './command';\nimport * as shortid from \"shortid\";\nimport { DefaultComponentNames } from './component';\nimport { tr } from '../i18n';\nimport { Dictionary } from '../common';\n\n/**\n * @hidden\n */\nexport interface ToolbarConf {\n    items: (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[];\n}\n\n/**\n * @hidden\n */\nexport interface PreparedSubMenuSet {\n    toolbars: Dictionary<ToolbarConf>;\n    flyouts: Dictionary<IFlyoutSpec>;\n}\n\n/**\n * @hidden\n */\nexport function isFlyoutSpec(item: any): item is IFlyoutSpec {\n    return typeof(item.children) != 'undefined';\n}\n\n/**\n * @hidden\n */\nexport interface IFlyoutSpec {\n    label?: string;\n    tooltip?: string;\n    icon?: string;\n    spriteClass?: string;\n    children: (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[];\n}\n\n/**\n * @hidden\n */\nexport interface ISeparatorSpec {\n    isSeparator: boolean;\n}\n\n/**\n * @hidden\n */\nexport interface IUnknownCommandSpec {\n    error: string;\n}\n\n/**\n * @hidden\n */\nexport interface ICommandSpec {\n    icon: string;\n    spriteClass: string;\n    label: string | null;\n    tooltip: string;\n    parameters: any;\n    command?: string;\n    componentName?: string;\n    flyoutId?: string;\n}\n\n/**\n * @hidden\n */\nexport function convertWidget(widget: UIWidget, locale: string, noToolbarLabels: boolean): ICommandSpec | IUnknownCommandSpec {\n    switch (widget.Type) {\n        case \"Select\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Select, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"WmsQuery\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.WmsQuery, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"Pan\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Pan, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        //case \"PanQuery\":\n        //case \"PanOnClick\":\n        case \"Zoom\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Zoom, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"ZoomOnClick\": //Covers in and out. Look at Factor parameter\n            {\n                const factor = parseFloat(widget.Extension.Factor);\n                if (factor >= 1.0) {\n                    return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ZoomIn, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n                } else {\n                    return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ZoomOut, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n                }\n            }\n        case \"InitialMapView\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ZoomExtents, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"ZoomToSelection\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ZoomToSelection, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"ExtentHistory\": //Covers prev and next. Look at Direction parameter\n            {\n                if (widget.Extension.Direction == \"previous\") {\n                    return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.PreviousView, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n                } else {\n                    return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.NextView, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n                }\n            }\n        case \"CenterSelection\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.CenterSelection, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"About\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.About, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"BufferPanel\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Buffer, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"ClearSelection\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ClearSelection, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        //case \"ColorPicker\":\n        case \"CoordinateTracker\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.CoordinateTracker, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"FeatureInfo\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.FeatureInfo, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"Geolocation\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Geolocation, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        //case \"GoogleStreetViewer\":\n        case \"Help\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Help, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"Maptip\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.MapTip, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"MapMenu\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, componentName: DefaultComponentNames.MapMenu, flyoutId: `${DefaultComponentNames.MapMenu}_${shortid.generate()}`, parameters: widget.Extension };\n        case \"Query\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Query, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"QuickPlot\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.QuickPlot, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"Redline\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Redline, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"RefreshMap\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.RefreshMap, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        //case \"SaveMap\":\n        case \"InvokeURL\": //Commands with this name would've been registered beforehand\n        case \"Search\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: widget.Name, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"SelectPolygon\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.SelectPolygon, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"SelectRadius\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.SelectRadius, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        //case \"SelectRadiusValue\":\n        case \"SelectWithin\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.SelectWithin, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"Theme\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Theme, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"ViewOptions\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ViewerOptions, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"ZoomToSelection\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.ZoomToSelection, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"Measure\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: DefaultCommands.Measure, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"BasemapSwitcher\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, componentName: DefaultComponentNames.BaseMapSwitcher, flyoutId: `${DefaultComponentNames.BaseMapSwitcher}_${shortid.generate()}`, parameters: widget.Extension };\n        case \"InvokeScript\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: widget.Name, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        default:\n            return { error: tr(\"UNKNOWN_WIDGET\", locale, { widget: widget.Type }) }\n    }\n}","import { appendParameters, parseUrlParameters } from '../utils';\n\n/**\n * All relevant state that can be encoded into the main viewer URL\n * @since 0.13\n */\nexport interface IAppUrlState {\n    x?: number;\n    y?: number;\n    scale?: number;\n    resource?: string;\n    locale?: string;\n    session?: string;\n    map?: string;\n    ft?: boolean;\n    sl?: string[];\n    hl?: string[];\n    sg?: string[];\n    hg?: string[];\n}\n\nconst S_DELIM = \"_\"; //This is the current layer/group name delimiter\n\n/**\n * Updates the main URL with the given applicaton state\n * @since 0.13\n */\nexport function updateUrl(state: IAppUrlState): void {\n    const st: any = {};\n    for (const k in state) {\n        const val: any = (state as any)[k];\n        switch (k) {\n            case \"ft\":\n                st.ft = (val == true) ? 1 : 0;\n                break;\n            case \"sl\":\n                st.sl = val?.join(S_DELIM);\n                break;\n            case \"hl\":\n                st.hl = val?.join(S_DELIM);\n                break;\n            case \"sg\":\n                st.sg = val?.join(S_DELIM);\n                break;\n            case \"hg\":\n                st.hg = val?.join(S_DELIM);\n                break;\n            default:\n                st[k] = val;\n                break;\n        }\n    }\n    const url = appendParameters(window.location.href, st, true, false);\n    window.history.replaceState(st, \"\", url);\n}\n\n/**\n * Gets the application state from the current main URL\n * @since 0.13\n */\nexport function getStateFromUrl(): IAppUrlState {\n    const st = parseUrlParameters(window.location.href);\n    const state: IAppUrlState = {};\n    for (const k in st) {\n        const val = st[k];\n        switch (k) {\n            case \"ft\":\n                {\n                    const n = parseInt(val, 10);\n                    if (!isNaN(n)) {\n                        state.ft = (n == 0) ? false : true;\n                    }\n                }\n                break;\n            case \"x\":\n                {\n                    const n = parseFloat(val);\n                    if (!isNaN(n)) {\n                        state.x = n;\n                    }\n                }\n                break;\n            case \"y\":\n                {\n                    const n = parseFloat(val);\n                    if (!isNaN(n)) {\n                        state.y = n;\n                    }\n                }\n                break;\n            case \"scale\":\n                {\n                    const n = parseFloat(val);\n                    if (!isNaN(n)) {\n                        state.scale = n;\n                    }\n                }\n                break;\n            case \"sl\":\n                state.sl = val?.split(S_DELIM);\n                break;\n            case \"hl\":\n                state.hl = val?.split(S_DELIM);\n                break;\n            case \"sg\":\n                state.sg = val?.split(S_DELIM);\n                break;\n            case \"hg\":\n                state.hg = val?.split(S_DELIM);\n                break;\n            default:\n                (state as any)[k] = val;\n                break;\n        }\n    }\n    return state;\n}","import * as React from \"react\";\nimport { storiesOf } from \"@storybook/react\";\nimport { action } from \"@storybook/addon-actions\";\nimport { ColorPicker } from '../components/color-picker';\nimport { withKnobs, text, boolean } from '@storybook/addon-knobs';\nimport { VectorStyleEditor } from '../components/vector-style-editor';\n\nstoriesOf(\"Common Components\", module)\n    .addDecorator(withKnobs)\n    .add(\"Color Picker\", () => {\n        const act = action(\"color changed\");\n        const [color, setColor] = React.useState();\n        const onSetColor = (val: string) => {\n            act(val);\n            setColor(val);\n        };\n        return <ColorPicker locale=\"en\" value={color} onChange={onSetColor} />;\n    })\n    .add(\"Vector Style Editor\", () => {\n        return <VectorStyleEditor onChange={action(\"style changed\")}\n            locale=\"en\"\n            enablePoint={boolean(\"Enable Point\", true)}\n            enableLine={boolean(\"Enable Line\", true)}\n            enablePolygon={boolean(\"Enable Polygon\", true)} />;\n    });","import * as React from \"react\";\nimport { storiesOf } from \"@storybook/react\";\nimport { action } from \"@storybook/addon-actions\";\nimport { Accordion, IAccordionPanelSpec, IAccordionPanelContentDimensions } from \"../components/accordion\";\nimport { withKnobs, text, boolean } from '@storybook/addon-knobs';\n\nimport \"../styles/index.css\";\nimport \"./styles/accordion-slate.css\";\n\nconst PANELS: IAccordionPanelSpec[] = [\n    {\n        id: \"PanelA\",\n        title: \"Panel One\",\n        contentRenderer: (dim: IAccordionPanelContentDimensions) => {\n            return <div style={{ width: dim.width, height: dim.height }}>Panel One Content ({dim.width}x{dim.height})</div>\n        }\n    },\n    {\n        id: \"PanelB\",\n        title: \"Panel Two\",\n        contentRenderer: (dim: IAccordionPanelContentDimensions) => {\n            return <div style={{ width: dim.width, height: dim.height }}>Panel Two Content ({dim.width}x{dim.height})</div>\n        }\n    },\n    {\n        id: \"PanelC\",\n        title: \"Panel Three\",\n        contentRenderer: (dim: IAccordionPanelContentDimensions) => {\n            return <div style={{ width: dim.width, height: dim.height }}>Panel Three Content ({dim.width}x{dim.height})</div>\n        }\n    }\n];\n\nstoriesOf(\"Accordion (Slate)\", module)\n    .addDecorator(withKnobs)\n    .add(\"Default\", () => <Accordion style={{ width: 250, height: 500 }} onActivePanelChanged={action(\"activePanelChanged\")} panels={PANELS} />)\n    .add(\"Middle Panel Initially Visible\", () => <Accordion style={{ width: 250, height: 500 }} onActivePanelChanged={action(\"activePanelChanged\")} panels={PANELS} activePanelId=\"PanelB\" />);","import * as React from \"react\";\nimport {\n    GenericEvent\n} from \"../api/common\";\nimport { Collapse, Icon as BpIcon, ResizeSensor, IResizeEntry } from '@blueprintjs/core';\n\n/**\n * Accordion panel dimensions\n *\n * @export\n * @interface IAccordionPanelContentDimensions\n */\nexport interface IAccordionPanelContentDimensions {\n    width: number;\n    height: number;\n}\n\n/**\n * Describes a panel in the accordion\n *\n * @export\n * @interface IAccordionPanelSpec\n */\nexport interface IAccordionPanelSpec {\n    id: string;\n    title: string;\n    contentRenderer: (dim: IAccordionPanelContentDimensions, isResizing?: boolean) => JSX.Element;\n}\n\n/**\n * Accordion component props\n *\n * @export\n * @interface IAccordionProps\n */\nexport interface IAccordionProps {\n    style: React.CSSProperties;\n    panels: IAccordionPanelSpec[];\n    onActivePanelChanged?: (id: string) => void;\n    activePanelId?: string;\n    isResizing?: boolean;\n}\n\nconst PANEL_HEADER_HEIGHT = 24;\n\nfunction validatePanelId(panels: IAccordionPanelSpec[], id: string | undefined): string | null {\n    if (!id) {\n        return null;\n    }\n    const panel = panels.filter(p => p.id == id)[0];\n    if (panel) {\n        return id;\n    }\n    return null;\n}\n\n/**\n * A generic, reusable Accordion component\n * @param props \n */\nexport const Accordion = (props: IAccordionProps) => {\n    const { style, panels, isResizing, onActivePanelChanged } = props;\n    const activeId = validatePanelId(props.panels, props.activePanelId);\n    const [dim, setDim] = React.useState<Pick<DOMRectReadOnly, \"width\" | \"height\">>({\n        width: -1,\n        height: -1\n    });\n    const [openPanel, setOpenPanel] = React.useState(activeId || panels[panels.length - 1].id);\n    React.useEffect(() => {\n        setOpenPanel(activeId || panels[panels.length - 1].id);\n    }, [activeId]);\n    const onResize = (entries: IResizeEntry[]) => {\n        setDim(entries[0].contentRect);\n    };\n    const onTogglePanel = (e: GenericEvent) => {\n        const id = e.currentTarget.attributes[\"data-accordion-panel-id\"].value;\n        if (openPanel != id) {\n            setOpenPanel(id);\n            onActivePanelChanged?.(id);\n        }\n    }\n    return <ResizeSensor onResize={onResize}>\n        <div style={style} className=\"component-accordion\">\n            {panels.map(p => {\n                const isOpen = (p.id == openPanel);\n                return <div key={p.id} className=\"component-accordion-panel\">\n                    <div className=\"component-accordion-panel-header\" style={{ height: PANEL_HEADER_HEIGHT }} data-accordion-panel-id={p.id} onClick={onTogglePanel}>\n                        <BpIcon icon={isOpen ? \"chevron-up\" : \"chevron-down\"} /> {p.title}\n                    </div>\n                    <Collapse isOpen={isOpen}>\n                        {p.contentRenderer({ width: dim.width, height: (dim.height - (panels.length * PANEL_HEADER_HEIGHT)) }, isResizing)}\n                    </Collapse>\n                </div>;\n            })}\n        </div>\n    </ResizeSensor>;\n}","var api = require(\"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../node_modules/postcss-loader/src/index.js??postcss!./index.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_AT_RULE_IMPORT_0___ = require(\"-!../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../node_modules/postcss-loader/src/index.js??postcss!./ol.css\");\nvar ___CSS_LOADER_AT_RULE_IMPORT_1___ = require(\"-!../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../node_modules/postcss-loader/src/index.js??postcss!../../stdassets/sprites/icons.css\");\nvar ___CSS_LOADER_AT_RULE_IMPORT_2___ = require(\"-!../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../node_modules/postcss-loader/src/index.js??postcss!@blueprintjs/core/lib/css/blueprint.css\");\nvar ___CSS_LOADER_AT_RULE_IMPORT_3___ = require(\"-!../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../node_modules/postcss-loader/src/index.js??postcss!react-splitter-layout/lib/index.css\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\nexports.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\nexports.i(___CSS_LOADER_AT_RULE_IMPORT_1___);\nexports.i(___CSS_LOADER_AT_RULE_IMPORT_2___);\nexports.i(___CSS_LOADER_AT_RULE_IMPORT_3___);\n// Module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n\\n/* HACK: Clear out any trace of the font icon as HTMLSelect should be using the SVG counterpart */\\n.bp3-select:after {\\n    content: \\\"\\\";\\n}\\n\\n.legend-label-highlight-text {\\n    background-color: yellow;\\n}\\n\\n.mg-toast {\\n    z-index: 120;\\n}\\n\\n.map-viewer-component {\\n    background-color: white;\\n}\\n\\n.iframe-iehack-zindex {\\n    position: absolute;\\n    border: none;\\n    top: 0;\\n    left: 0;\\n    height: 100%;\\n    width: 100%;\\n    z-index: -1;\\n}\\n\\n/* OpenLayers overrides */\\n\\n.ol-attribution {\\n    right: 10px;\\n    bottom: 52px;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.ol-rotate {\\n    top: auto;\\n    right: 10px;\\n    bottom: 25px;\\n}\\n\\n.ol-rotate button {\\n    bottom: 1px;\\n    left: auto;\\n    right: 1px;\\n    top: auto;\\n}\\n\\n.ol-custom-overviewmap,\\n.ol-custom-overviewmap.ol-uncollapsible {\\n    bottom: 79px;\\n    left: auto;\\n    right: 10px;\\n    top: auto;\\n}\\n\\n.ol-custom-overviewmap:not(.ol-collapsed) {\\n    border: 1px solid black;\\n}\\n\\n.ol-custom-overviewmap .ol-overviewmap-map {\\n    border: none;\\n}\\n\\n.ol-custom-overviewmap .ol-overviewmap-box {\\n    border: 2px solid red;\\n}\\n\\n.ol-custom-overviewmap:not(.ol-collapsed) button {\\n    bottom: 1px;\\n    left: auto;\\n    right: 1px;\\n    top: auto;\\n}\\n\\n/* Accordion */\\n.component-accordion-panel-header {\\n    padding: 3px;\\n    cursor: pointer;\\n}\\n\\n/* Selection Panel */\\n\\n.selection-panel-property-grid {\\n    width: 100%;\\n}\\n\\n.selection-panel-layer-selector {\\n    max-width: 180px;\\n}\\n\\n.selection-panel-layer-selector select {\\n    max-width: 143px;\\n}\\n\\n/* Modal Dialogs */\\n\\n.modal-dialog {\\n    background: #fff;\\n    border: 1px solid black;\\n    border-radius: 3px;\\n    position: absolute;\\n    -webkit-transform: translate(-50%, -50%);\\n            transform: translate(-50%, -50%);\\n    z-index: 4999;\\n}\\n\\n.modal-dialog-header {\\n    border-top-left-radius: 3px;\\n    border-top-right-radius: 3px;\\n}\\n\\n.modal-dialog-body {\\n    border-bottom-left-radius: 3px;\\n    border-bottom-right-radius: 3px;\\n    padding-bottom: 3px;\\n}\\n\\n.modal-dialog-backdrop {\\n    position: absolute;\\n    width: 100%;\\n    height: 100%;\\n    top: 0px;\\n    left: 0px;\\n    z-index: 4998;\\n    background: rgba(0, 0, 0, 0.3);\\n}\\n\\n.mg-flyout-menu-container {\\n    position: absolute;\\n}\\n\\n.mg-flyout-component-container {\\n    position: absolute;\\n    background-color: white;\\n    padding: 15px;\\n    border-radius: 3px;\\n    border: 1px solid black;\\n}\\n\\n/* Toolbar */\\n.toolbar-separator-vertical {\\n    border-bottom: 1px solid black;\\n}\\n\\n.toolbar-separator-horizontal {\\n    border-left: 1px solid black;\\n}\\n\\n.selected-item {\\n    border-style: solid;\\n}\\n\\n.mouse-over {\\n    cursor: pointer;\\n    background: rgb(220, 220, 220);\\n    border-style: solid;\\n    border-color: rgb(160, 160, 160);\\n}\\n\\n/* Begin QuickPlot */\\ndiv.Label {\\n    padding: 5px 0px;\\n}\\n\\ndiv.Ctrl {\\n    padding: 5px 0px;\\n}\\n\\ndiv.Title {\\n    font-size: 14px;\\n    font-weight: bold;\\n    padding: 10px 0px;\\n}\\n\\ndiv.HPlaceholder5px {\\n    font-size: 0px;\\n    height: 5px;\\n}\\n\\ndiv.ButtonContainer {\\n    padding: 5px 0px;\\n    text-align: right;\\n}\\n\\n.FixWidth {\\n    width: 100%;\\n}\\n\\ndiv.InfoText {\\n    padding: 3px;\\n    background-color: #FFFFCC;\\n    color: #666666;\\n    font-family: Arial, Helvetica, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n/* End QuickPlot */\\n\\n.field,\\n.field-label {\\n    display: block;\\n}\\n\\n/*\\n.error-display {\\n    color: #ffffff;\\n    background-color: #ff0000;\\n    font-size: 0.8em;\\n}\\n\\n.error-header {\\n    font-weight: bold;\\n}\\n*/\\n.error-stack {\\n    text-decoration: none;\\n}\\n\\n.modal-dialog-header {\\n    font-weight: bold;\\n    padding: 5px;\\n    font-size: 1.1em;\\n    background-color: #cdcdcd;\\n    border-bottom: 1px solid black;\\n}\\n\\n.modal-dialog-body {\\n    padding: 0px;\\n}\\n\\n.context-menu-item-disabled {\\n    opacity: 0.4;\\n    cursor: none;\\n}\\n\\n/* https://gist.github.com/aiboy/7406727 */\\n.rotated-text {\\n    display: inline-block;\\n    overflow: hidden;\\n    width: 1.5em;\\n}\\n\\n.rotated-text-ccw {\\n    -webkit-transform: rotate(-90deg);\\n    transform: rotate(-90deg);\\n\\n    /* also accepts left, right, top, bottom coordinates; not required, but a good idea for styling */\\n    -webkit-transform-origin: 50% 50%;\\n    transform-origin: 50% 50%;\\n\\n    /* Should be unset in IE9+ I think. */\\n    filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);\\n}\\n\\n.rotated-text__inner {\\n    display: inline-block;\\n    white-space: nowrap;\\n}\\n\\n.rotated-text__inner:before {\\n    content: \\\"\\\";\\n    float: left;\\n    margin-top: 100%;\\n}\\n\\n.noselect {\\n    -webkit-touch-callout: none;\\n    /* iOS Safari */\\n    -webkit-user-select: none;\\n    /* Chrome/Safari/Opera */\\n    /* Konqueror */\\n    -moz-user-select: none;\\n    /* Firefox */\\n    -ms-user-select: none;\\n    /* Internet Explorer/Edge */\\n    user-select: none;\\n    /* Non-prefixed version, currently\\n                                    not supported by any browser */\\n}\\n\\n.component-about-dialog-content {\\n    padding: 5px;\\n}\\n\\n.component-session-expired {\\n    padding: 5px;\\n}\\n\\n.component-measure {\\n    padding: 5px;\\n}\\n\\n.component-quick-plot {\\n    padding: 5px;\\n}\\n\\n.component-viewer-options {\\n    padding: 5px;\\n}\\n\\n.component-mouse-coordinates,\\n.component-selected-feature-count,\\n.component-view-size {\\n    padding: 3px;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n.component-scale-display {\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n.component-scale-display .scale-input {\\n    margin: 0;\\n    padding: 0;\\n}\\n\\n.feature-tooltip {\\n    position: relative;\\n    background: rgb(255, 255, 153);\\n    border-radius: 4px;\\n    color: black;\\n    padding: 4px 8px;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.selected-tooltip {\\n    position: relative;\\n    background: rgb(255, 255, 255);\\n    border-radius: 4px;\\n    border: 1px solid black;\\n    color: black;\\n    padding: 4px 8px;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.tooltip-hidden {\\n    display: none;\\n}\\n\\n.tooltip {\\n    position: relative;\\n    background: rgba(0, 0, 0, 0.9);\\n    border-radius: 4px;\\n    color: white;\\n    padding: 4px 8px;\\n    opacity: 0.7;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.tooltip-measure {\\n    opacity: 1;\\n    font-weight: bold;\\n}\\n\\n.tooltip-static {\\n    background-color: #ffcc33;\\n    color: black;\\n    border: 1px solid white;\\n}\\n\\n.tooltip-measure:before,\\n.tooltip-static:before {\\n    border-top: 6px solid rgba(0, 0, 0, 0.5);\\n    border-right: 6px solid transparent;\\n    border-left: 6px solid transparent;\\n    content: \\\"\\\";\\n    position: absolute;\\n    bottom: -6px;\\n    margin-left: -7px;\\n    left: 50%;\\n}\\n\\n.tooltip-static:before {\\n    border-top-color: #ffcc33;\\n}\\n\\n.component-navigator {\\n    position: absolute;\\n    width: 51px;\\n    height: 204px;\\n    z-index: 1000;\\n    cursor: pointer;\\n    right: 10px;\\n    top: 10px;\\n}\\n\\n.wms-layer-info-tooltip p {\\n    max-width: 250px;\\n    word-wrap: break-word;\\n}\\n\\n.bp3-dark {\\n    background-color: #30404d;\\n}\\n\\n.colorpicker {\\n    position: relative;\\n    width: 100%;\\n    height: 13em;\\n    background-color: #fff;\\n    border: 1px solid rgba(0, 0, 0, 0.2);\\n    border-radius: 0.25em;\\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);\\n}\\n\\n.map {\\n    position: absolute;\\n    top: 1em;\\n    bottom: 1em;\\n    right: 2em;\\n    left: 1em;\\n    overflow: hidden;\\n    -webkit-user-select: none;\\n       -moz-user-select: none;\\n        -ms-user-select: none;\\n            user-select: none;\\n    border-radius: 0.25em;\\n}\\n\\n.map.active {\\n    cursor: none;\\n}\\n\\n.map.dark .pointer {\\n    border-color: #fff;\\n}\\n\\n.map.light .pointer {\\n    border-color: #000;\\n}\\n\\n.map .pointer {\\n    position: absolute;\\n    width: 10px;\\n    height: 10px;\\n    margin-left: -5px;\\n    margin-bottom: -5px;\\n    border-radius: 100%;\\n    border: 1px solid #000;\\n    will-change: left, bottom;\\n}\\n\\n.map .background {\\n    top: 0;\\n    left: 0;\\n    position: absolute;\\n    height: 100%;\\n    width: 100%;\\n}\\n\\n.map .background:before,\\n.map .background:after {\\n    display: block;\\n    content: '';\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.map .background:after {\\n    background: -webkit-gradient(linear, left top, left bottom, from(transparent), to(black));\\n    background: linear-gradient(to bottom, transparent 0%, black 100%);\\n}\\n\\n.map .background:before {\\n    background: -webkit-gradient(linear, left top, right top, from(white), to(rgba(255, 255, 255, 0)));\\n    background: linear-gradient(to right, white 0%, rgba(255, 255, 255, 0) 100%);\\n}\\n\\n.slider {\\n    position: absolute;\\n    -webkit-user-select: none;\\n       -moz-user-select: none;\\n        -ms-user-select: none;\\n            user-select: none;\\n}\\n\\n.slider.vertical {\\n    top: 0;\\n    bottom: 0;\\n    left: 50%;\\n    width: 10px;\\n    cursor: ns-resize;\\n}\\n\\n.slider.vertical .track {\\n    position: absolute;\\n    top: 0;\\n    bottom: 0;\\n    left: 50%;\\n    width: 8px;\\n    margin-left: -4px;\\n}\\n\\n.slider.horizontal {\\n    left: 0;\\n    right: 0;\\n    top: 50%;\\n    height: 10px;\\n    cursor: ew-resize;\\n}\\n\\n.slider.horizontal .track {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    top: 50%;\\n    height: 8px;\\n    margin-top: -4px;\\n}\\n\\n.slider .track {\\n    border-radius: 3px;\\n    background: #888;\\n}\\n\\n.slider .pointer {\\n    position: absolute;\\n    bottom: 50%;\\n    left: 50%;\\n    width: 16px;\\n    height: 16px;\\n    margin-left: -8px;\\n    margin-bottom: -8px;\\n    border-radius: 16px;\\n    background: #fff;\\n    box-shadow: inset 0 0 0 1px #ccc, 0 1px 2px #ccc;\\n    will-change: left, bottom;\\n}\\n\\n.hue-slider {\\n    position: absolute;\\n    top: 1em;\\n    bottom: 1em;\\n    right: 1.3em;\\n}\\n\\n.hue-slider .track {\\n    background: -webkit-gradient(linear, left top, left bottom, from(#FF0000), color-stop(10%, #FF0099), color-stop(20%, #CD00FF), color-stop(30%, #3200FF), color-stop(40%, #0066FF), color-stop(50%, #00FFFD), color-stop(60%, #00FF66), color-stop(70%, #35FF00), color-stop(80%, #CDFF00), color-stop(90%, #FF9900), to(#FF0000));\\n    background: linear-gradient(to bottom, #FF0000 0%, #FF0099 10%, #CD00FF 20%, #3200FF 30%, #0066FF 40%, #00FFFD 50%, #00FF66 60%, #35FF00 70%, #CDFF00 80%, #FF9900 90%, #FF0000 100%);\\n}\\n\\n.opacity-slider {\\n    position: absolute;\\n    bottom: 1.3em;\\n    left: 1em;\\n    right: 2em;\\n}\\n\\n.opacity-slider .slider {\\n    background: #fff url(\\\"data:image/gif;base64,R0lGODdhEAAQAPEAAMvLy8zMzP///wAAACwAAAAAEAAQAEACHYxvosstCAEMrq6Jj812Y59NIDQipdY5XLWqH4sVADs=\\\") repeat;\\n    background-size: 8px 8px;\\n    height: 8px;\\n}\\n\\n.opacity-slider .slider .track {\\n    height: 8px;\\n    margin-top: -4px;\\n    background: -webkit-gradient(linear, left top, right top, from(rgba(255, 255, 255, 0)), to(#FFF));\\n    background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, #FFF 100%);\\n}\\n\\n.with-opacity-slider {\\n    height: 14em;\\n}\\n\\n.with-opacity-slider .map {\\n    bottom: 2em;\\n}\\n\\n.with-opacity-slider .hue-slider {\\n    bottom: 2em;\\n}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".ol-box{box-sizing:border-box;border-radius:2px;border:2px solid #00f}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:rgba(0,60,136,.3);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid #eee;border-top:none;color:#eee;font-size:10px;text-align:center;margin:1px;will-change:contents,width}.ol-overlay-container{will-change:left,right,top,bottom}.ol-unsupported{display:none}.ol-viewport .ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-control{position:absolute;background-color:rgba(255,255,255,.4);border-radius:4px;padding:2px}.ol-control:hover{background-color:rgba(255,255,255,.6)}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;-webkit-transition:opacity .25s linear,visibility 0s linear;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;-webkit-transition:opacity .25s linear,visibility 0s linear .25s;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}@media print{.ol-control{display:none}}.ol-control button{display:block;margin:1px;padding:0;color:#fff;font-size:1.14em;font-weight:700;text-decoration:none;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:rgba(0,60,136,.5);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;font-size:1.2em;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:focus,.ol-control button:hover{text-decoration:none;background-color:rgba(0,60,136,.7)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em)}.ol-attribution ul{margin:0;padding:0 .5em;font-size:.7rem;line-height:1.375em;color:#000;text-shadow:0 0 2px #fff}.ol-attribution li{display:inline;list-style:none;line-height:inherit}.ol-attribution li:not(:last-child):after{content:\\\" \\\"}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button,.ol-attribution ul{display:inline-block}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution.ol-logo-only ul{display:block}.ol-attribution:not(.ol-collapsed){background:rgba(255,255,255,.8)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0;height:1.1em;line-height:1em}.ol-attribution.ol-logo-only{background:0 0;bottom:.4em;height:1.1em;line-height:1em}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-logo-only button,.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:inline-block}.ol-overviewmap .ol-overviewmap-map{border:1px solid #7b98bc;height:150px;margin:2px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:1px;left:2px;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:rgba(255,255,255,.8)}.ol-overviewmap-box{border:2px dotted rgba(0,60,136,.7)}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_GET_URL_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/getUrl.js\");\nvar ___CSS_LOADER_URL_IMPORT_0___ = require(\"./icons.png\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\n// Module\nexports.push([module.id, \"/* glue: 0.13 hash: 28fada1b84 */\\n        .PoweredBy_en,\\n.zoom-out-fixed,\\n.zoom-in,\\n.zoom-in-fixed,\\n.zoom-full,\\n.zoom-dynamic,\\n.view-refresh,\\n.view-forward,\\n.view-back,\\n.ui-menu,\\n.toggle,\\n.toggle-expand,\\n.theme,\\n.select,\\n.select-zoom,\\n.select-radius,\\n.select-polygon,\\n.select-features,\\n.select-clear,\\n.select-centre,\\n.search,\\n.redline,\\n.query,\\n.property,\\n.print,\\n.preview,\\n.pan,\\n.pan-west,\\n.pan-south,\\n.pan-north,\\n.pan-east,\\n.overview-map,\\n.out-of-range,\\n.options,\\n.measure,\\n.maptip,\\n.legend-theme,\\n.legend-raster,\\n.legend-map,\\n.legend-layer,\\n.legend-DWF,\\n.lc_unselect,\\n.layer_add,\\n.invoke-url,\\n.invoke-script,\\n.initial-center,\\n.info,\\n.icon_zoomselect,\\n.icon_warning,\\n.icon_select,\\n.icon_refreshmap,\\n.icon_menuarrowup_disabled,\\n.icon_menuarrowup,\\n.icon_menuarrow_disabled,\\n.icon_menuarrow,\\n.icon_home,\\n.icon_error,\\n.iconNavigator,\\n.help,\\n.globe_add,\\n.globe-share,\\n.geolocation,\\n.forward,\\n.folder-horizontal,\\n.folder-horizontal-open,\\n.file-save,\\n.file-print,\\n.feature-info,\\n.edit-xml,\\n.edit-paste,\\n.edit-duplicate,\\n.edit-cut,\\n.edit-copy,\\n.coordinate-tracker,\\n.control,\\n.control-stop,\\n.control-stop-180,\\n.control-180,\\n.buffer,\\n.back,\\n.application-browser,\\n.about {\\n            background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \");\\n            background-repeat: no-repeat;\\n        }\\n        \\n        .PoweredBy_en {\\n            background-position: 0 0;\\n            width: 136px;\\n            height: 19px;\\n        }\\n        \\n        .zoom-out-fixed {\\n            background-position: 0 -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-in {\\n            background-position: -16px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-in-fixed {\\n            background-position: -32px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-full {\\n            background-position: -48px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-dynamic {\\n            background-position: -64px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-refresh {\\n            background-position: -80px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-forward {\\n            background-position: -96px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-back {\\n            background-position: -112px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .ui-menu {\\n            background-position: 0 -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .toggle {\\n            background-position: -16px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .toggle-expand {\\n            background-position: -32px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .theme {\\n            background-position: -48px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select {\\n            background-position: -64px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-zoom {\\n            background-position: -80px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-radius {\\n            background-position: -96px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-polygon {\\n            background-position: -112px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-features {\\n            background-position: 0 -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-clear {\\n            background-position: -16px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-centre {\\n            background-position: -32px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .search {\\n            background-position: -48px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .redline {\\n            background-position: -64px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .query {\\n            background-position: -80px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .property {\\n            background-position: -96px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .print {\\n            background-position: -112px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .preview {\\n            background-position: 0 -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan {\\n            background-position: -16px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-west {\\n            background-position: -32px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-south {\\n            background-position: -48px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-north {\\n            background-position: -64px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-east {\\n            background-position: -80px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .overview-map {\\n            background-position: -96px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .out-of-range {\\n            background-position: -112px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .options {\\n            background-position: 0 -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .measure {\\n            background-position: -16px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .maptip {\\n            background-position: -32px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-theme {\\n            background-position: -48px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-raster {\\n            background-position: -64px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-map {\\n            background-position: -80px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-layer {\\n            background-position: -96px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-DWF {\\n            background-position: -112px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .lc_unselect {\\n            background-position: 0 -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .layer_add {\\n            background-position: -16px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .invoke-url {\\n            background-position: -32px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .invoke-script {\\n            background-position: -48px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .initial-center {\\n            background-position: -64px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .info {\\n            background-position: -80px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_zoomselect {\\n            background-position: -96px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_warning {\\n            background-position: -112px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_select {\\n            background-position: 0 -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_refreshmap {\\n            background-position: -16px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrowup_disabled {\\n            background-position: -32px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrowup {\\n            background-position: -48px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrow_disabled {\\n            background-position: -64px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrow {\\n            background-position: -80px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_home {\\n            background-position: -96px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_error {\\n            background-position: -112px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .iconNavigator {\\n            background-position: -136px 0;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .help {\\n            background-position: -136px -16px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .globe_add {\\n            background-position: -136px -32px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .globe-share {\\n            background-position: -136px -48px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .geolocation {\\n            background-position: -136px -64px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .forward {\\n            background-position: -136px -80px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .folder-horizontal {\\n            background-position: -136px -96px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .folder-horizontal-open {\\n            background-position: -136px -112px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .file-save {\\n            background-position: 0 -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .file-print {\\n            background-position: -16px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .feature-info {\\n            background-position: -32px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-xml {\\n            background-position: -48px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-paste {\\n            background-position: -64px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-duplicate {\\n            background-position: -80px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-cut {\\n            background-position: -96px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-copy {\\n            background-position: -112px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .coordinate-tracker {\\n            background-position: -128px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control {\\n            background-position: -152px 0;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-stop {\\n            background-position: -152px -16px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-stop-180 {\\n            background-position: -152px -32px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-180 {\\n            background-position: -152px -48px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .buffer {\\n            background-position: -152px -64px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .back {\\n            background-position: -152px -80px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .application-browser {\\n            background-position: -152px -96px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .about {\\n            background-position: -152px -112px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        @media screen and (-webkit-min-device-pixel-ratio: 1.0), screen and (min-device-pixel-ratio: 1.0), screen and (min-resolution: 1.0dppx) {\\n            .PoweredBy_en,\\n    .zoom-out-fixed,\\n    .zoom-in,\\n    .zoom-in-fixed,\\n    .zoom-full,\\n    .zoom-dynamic,\\n    .view-refresh,\\n    .view-forward,\\n    .view-back,\\n    .ui-menu,\\n    .toggle,\\n    .toggle-expand,\\n    .theme,\\n    .select,\\n    .select-zoom,\\n    .select-radius,\\n    .select-polygon,\\n    .select-features,\\n    .select-clear,\\n    .select-centre,\\n    .search,\\n    .redline,\\n    .query,\\n    .property,\\n    .print,\\n    .preview,\\n    .pan,\\n    .pan-west,\\n    .pan-south,\\n    .pan-north,\\n    .pan-east,\\n    .overview-map,\\n    .out-of-range,\\n    .options,\\n    .measure,\\n    .maptip,\\n    .legend-theme,\\n    .legend-raster,\\n    .legend-map,\\n    .legend-layer,\\n    .legend-DWF,\\n    .lc_unselect,\\n    .layer_add,\\n    .invoke-url,\\n    .invoke-script,\\n    .initial-center,\\n    .info,\\n    .icon_zoomselect,\\n    .icon_warning,\\n    .icon_select,\\n    .icon_refreshmap,\\n    .icon_menuarrowup_disabled,\\n    .icon_menuarrowup,\\n    .icon_menuarrow_disabled,\\n    .icon_menuarrow,\\n    .icon_home,\\n    .icon_error,\\n    .iconNavigator,\\n    .help,\\n    .globe_add,\\n    .globe-share,\\n    .geolocation,\\n    .forward,\\n    .folder-horizontal,\\n    .folder-horizontal-open,\\n    .file-save,\\n    .file-print,\\n    .feature-info,\\n    .edit-xml,\\n    .edit-paste,\\n    .edit-duplicate,\\n    .edit-cut,\\n    .edit-copy,\\n    .coordinate-tracker,\\n    .control,\\n    .control-stop,\\n    .control-stop-180,\\n    .control-180,\\n    .buffer,\\n    .back,\\n    .application-browser,\\n    .about {\\n                background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \");\\n                background-size: 168px 147px;\\n            }\\n        }\\n        \", \"\"]);\n// Exports\nmodule.exports = exports;\n","export default __webpack_public_path__ + \"static/media/icons.c638cd94.png\";","var api = require(\"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../node_modules/postcss-loader/src/index.js??postcss!./accordion-slate.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".component-accordion {\\n    font: 10pt Verdana, sans-serif;\\n    background-color: #E4E3E3;\\n}\\n.component-accordion-panel-header {\\n    border: 1px solid black;\\n    font-weight: bold;\\n    color: white;\\n    /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#878787+0,747474+50,6e7774+50,555555+51,5e6666+100 */\\n    background: #878787; /* Old browsers */ /* FF3.6-15 */ /* Chrome10-25,Safari5.1-6 */\\n    background: -webkit-gradient(linear,  left top, left bottom,  from(#878787),color-stop(50%, #747474),color-stop(50%, #6e7774),color-stop(51%, #555555),to(#5e6666));\\n    background: linear-gradient(to bottom,  #878787 0%,#747474 50%,#6e7774 50%,#555555 51%,#5e6666 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#878787', endColorstr='#5e6666',GradientType=0 ); /* IE6-9 */\\n}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}